<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.490b7167ab7f2e669d51.css">a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:"";content:none}table{border-collapse:collapse;border-spacing:0}a{color:inherit;text-decoration:inherit}button,input,textarea{border-radius:0;-webkit-border-radius:0}button,input{-webkit-appearance:none}html{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;-ms-text-size-adjust:100%}:root{--brand:#81439c;--brand-lighten-10:#9c5ab8;--brand-lighten-20:#b17ec7;--brand-lighten-30:#c7a1d7;--brand-lighten-40:#dcc5e6;--brand-lighten-50:#f1e9f5;--brand-lighten-55:#fcfafd;--brand-darken-10:#633478;--brand-darken-20:#462455;--brand-darken-30:#281531;--brand-darken-35:#1a0d1f;--brand-darken-40:#0b060d;--brand-saturate-5:#833da2;--brand-desaturate-35:#726a75;--brand-desaturate-35-transp-50:rgba(114,106,117,0.5);--brand-complement:#9c8f43;--brand-complement-lighten-45:#eeead7;--brand-triadic-middle:#5e9c43;--link-color:#5d93ff;--inactive-color:#bbb;--post-link-color:var(--brand-lighten-10);--post-link-color-brighten:var(--brand-saturate-5);--post-link-color-hover:#999;--base-font-color:var(--brand-darken-35);--base-font-family:-apple-system,system-ui,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit}body{background-color:var(--brand-lighten-55);color:var(--base-font-color);color-adjust:exact!important;font-family:var(--base-font-family);font-size:1rem;font-weight:400;line-height:26px;margin:10px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-print-color-adjust:exact!important}.layout-module--container--zLeA4{margin:0 auto;max-width:900px}@media (max-width:768px){.layout-module--container--zLeA4{margin:0 16px}}@media (max-width:640px){.layout-module--container--zLeA4{margin:0 16px}}.header-module--container--18lpt{align-items:center;display:flex;justify-content:space-between}.header-module--logo--3gu8x{align-items:center;display:flex}.header-module--profile-wrapper--3R-fl{border:1px solid var(--brand-lighten-40);border-radius:50%;height:70px;overflow:hidden;position:relative;width:70px}.header-module--profile-img--wnp-Z{height:100%;left:0;-o-object-fit:cover;object-fit:cover;-o-object-position:center center;object-position:center center;position:absolute;top:0;width:100%}.header-module--header-item--17b7u{color:var(--brand);font-size:22px}.header-module--title--2iLmX{font-weight:600;margin-left:10px}.header-module--nav-list--2ganu{display:flex;flex-direction:row}.header-module--nav-item--2eEcY{font-weight:500;margin-left:15px}.nav-menu-responsive-module--nav-open--2t7ry{align-items:center;background:var(--brand-complement-lighten-45);display:flex;height:100%;justify-content:center;left:0;opacity:.95;position:absolute;top:0;width:100%;z-index:100}.nav-menu-responsive-module--nav-list--hVoy5{display:flex;flex-direction:column;text-align:center;width:100%}.nav-menu-responsive-module--header-item--2yJoY{color:var(--brand-saturate-5);font-size:22px}.nav-menu-responsive-module--nav-item--13nmf{box-shadow:5px 5px 5px 5px var(--brand-desaturate-35-transp-50);font-weight:500;margin-bottom:20px;margin-left:25px;margin-right:45px}.nav-menu-responsive-module--menu-button--3YgxZ{background-color:transparent;border-color:transparent;cursor:pointer;height:55px;width:55px}.nav-menu-responsive-module--menu-button-close--30tLV{position:absolute;right:10px;top:10px}.nav-menu-responsive-module--nav-link--1vE6I{font-size:1.8rem;font-weight:600;line-height:2.5;padding:15px 40%}.nav-menu-responsive-module--active--1EDSg{color:var(--brand-darken-10)}.nav-menu-module--nav-list--2gVNM{display:flex;flex-direction:row}.nav-menu-module--header-item--3ofg1{color:var(--brand);font-size:22px}.nav-menu-module--nav-item--1lKPw{font-weight:500;margin-left:15px}.nav-menu-module--active--31h8g{color:var(--brand-darken-20);cursor:inherit}.footer-module--container--2iXoO{margin-top:50px;text-align:center}.footer-module--sep--1iHNN{margin-bottom:30px;opacity:.2}.footer-module--copy--7yIGn{font-size:1.1rem;opacity:.7}.footer-module--social--3cljd{margin-top:25px}.footer-module--social--3cljd a{display:inline-block;margin-left:15px}.footer-module--social--3cljd a:first-child{margin-left:0}.footer-module--footer-icon--2phyq{color:var(--base-font-color);font-size:1.7em;opacity:.7;transition:all .3s ease}.footer-module--footer-icon--2phyq:hover{color:var(--brand-saturate-5);opacity:1}@media (max-width:768px){.footer-module--social--3cljd a{margin-left:25px}.footer-module--footer-icon--2phyq{font-size:2em}}.about-module--container--1ewHF{margin-top:30px;font-size:1.2em;font-weight:300;line-height:1.6}.about-module--header--2Gxwb{font-size:4rem;font-weight:300;letter-spacing:-1.5px;line-height:60px;margin:20px 0}.about-module--subheader--2z5zZ{font-size:1.8rem;font-weight:400;letter-spacing:-.5px;line-height:2.5rem;margin-bottom:15px}.about-module--para--S2W1Q{margin-top:10px;margin-bottom:25px}.about-module--link--5uLO_{text-decoration:none;background:linear-gradient(180deg,var(--post-link-color-hover) 0,var(--post-link-color-hover));background-position:0 100%;background-repeat:repeat-x;background-size:3px 3px;transition:background-size .4s;color:var(--post-link-color);padding:3px;border-radius:4px}.about-module--link--5uLO_:hover{text-decoration:none;color:var(--post-link-color-brighten);background-size:4px 50px}.intro-module--container--3fIA5{margin-bottom:30px;line-height:1.4;font-weight:300;font-size:1.1em}.article-module--container--1HbcQ{margin-top:25px;padding-right:150px}.article-module--title--2aaH5{font-size:1.5rem;font-weight:600;line-height:40px}.article-module--title--2aaH5:hover{border-bottom:1px solid var(--base-font-color)}.article-module--subheader--6GQfW{display:flex;font-size:.9em;font-weight:600;text-transform:uppercase}.article-module--date--A0OoP{margin-right:10px}.article-module--category--2qtxG{color:var(--brand-lighten-10)}.article-module--read--1fqTc{color:var(--link-color)}.article-module--read--1fqTc:hover{border-bottom:1px solid var(--link-color)}@media (max-width:768px){.article-module--container--1HbcQ{padding-right:50px}}@media (max-width:640px){.article-module--container--1HbcQ{padding-right:0}}.all-link-module--all-link--3uPzS{color:var(--brand-darken-30);display:inline-block;height:35px;padding:0 25px;line-height:35px;text-align:center;border:1px solid var(--brand-lighten-40);border-radius:20px}.all-link-module--all-link--3uPzS:hover{border-color:var(--brand-lighten-30)}._404-module--container---hXYv{align-items:center;display:flex;flex-direction:column;margin:30px 0}._404-module--main--D8CXV{font-size:15rem;font-weight:200;line-height:1.3;opacity:.7}._404-module--submain--3Ekrs{font-size:2.5rem;font-weight:500;line-height:1;margin-bottom:20px;opacity:.7}._404-module--message--2zDzP{font-size:1.5rem;font-weight:300;line-height:1;opacity:.7;text-transform:uppercase}@media (max-width:768px){._404-module--container---hXYv{margin:5px 0}._404-module--main--D8CXV{font-size:9rem;line-height:1.1}._404-module--submain--3Ekrs{font-size:2rem}._404-module--message--2zDzP{font-size:1.3rem}}.pagination-module--container--SLFjv{height:30px;margin:20px 0}.pagination-module--pagination--2HR3A{color:var(--brand-lighten-10);font-size:26px;font-weight:700;line-height:26px;text-transform:uppercase}.pagination-module--pagination--2HR3A:hover{color:var(--link-color)}.pagination-module--inactive--28Bzs{color:var(--inactive-color);pointer-events:none}.pagination-module--prev--1zJqU{float:left}.pagination-module--next--3GNag{float:right}.post-module--title--_4a8P{font-size:4rem;font-weight:300;letter-spacing:-1.5px;line-height:60px;margin:20px 0}.post-module--published--OKKle{font-style:italic;font-weight:300;margin:15px 0}.post-module--feature-image--1GQvY{margin-bottom:20px}.post-module--content--2Opks{font-size:1.2rem;line-height:30px}.post-module--content--2Opks h2{font-size:1.8rem;font-weight:400;letter-spacing:-.5px;line-height:2.5rem;margin-bottom:15px}.post-module--content--2Opks h3{font-size:1.4rem;font-weight:500;margin-bottom:5px}.post-module--content--2Opks p{margin-bottom:20px}.post-module--content--2Opks a{text-decoration:none;background:linear-gradient(180deg,var(--post-link-color-hover) 0,var(--post-link-color-hover));background-position:0 100%;background-repeat:repeat-x;background-size:3px 3px;transition:background-size .4s;color:var(--post-link-color);padding:3px;border-radius:4px}.post-module--content--2Opks a:hover{text-decoration:none;color:var(--post-link-color-brighten);background-size:4px 50px}.post-module--content--2Opks ol{list-style:decimal;margin-bottom:15px;margin-left:20px}.post-module--content--2Opks ul{list-style-type:"\2192";margin-bottom:15px;margin-left:20px}.post-module--content--2Opks li{padding-left:5px}.post-module--content--2Opks blockquote{border-left:3px solid var(--brand-triadic-middle);font-size:.9em;font-style:italic;font-weight:200;padding-left:15px}.post-module--content--2Opks kbd{display:inline-block;margin:0 .1em;padding:.1em .6em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:14px;line-height:1.4;color:#000;text-shadow:0 1px 0 #fff;background-color:#e4e6e8;border:1px solid #9fa6ad;border-radius:3px;box-shadow:0 1px 1px rgba(12,13,14,.15),inset 0 1px 0 0 #fff;white-space:nowrap}.post-module--content--2Opks code{background-color:rgba(27,31,35,.05);border-radius:6px;font-size:85%;margin:0;padding:.2em .4em}.post-module--content--2Opks code,.post-module--content--2Opks pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.post-module--content--2Opks pre{font-size:1rem;margin-bottom:20px;padding-top:25px}.post-module--content--2Opks pre[data-language]:before{background:#f7df1e;border-radius:4px;color:#000;font-size:.75rem;font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;letter-spacing:.075em;line-height:1;position:absolute;text-align:right;text-transform:uppercase;top:0;left:0;padding:3px}.post-module--content--2Opks pre[data-language=bash]:before{content:"bash"}.post-module--content--2Opks pre[data-language=js]:before{content:"js"}.post-module--content--2Opks pre[data-language=ruby]:before{content:"ruby"}.post-module--content--2Opks pre[data-language=yml]:before{content:"yml"}.post-module--content--2Opks pre[data-language=json]:before{content:"json"}.post-module--content--2Opks pre[data-language=html]:before{content:"html"}.post-module--content--2Opks pre[data-language=markdown]:before{content:"markdown"}.post-module--content--2Opks pre[data-language=sql]:before{content:"sql"}@media (max-width:1280px){.post-module--content--2Opks ul{list-style-type:disc;list-style-position:inside}}@media (max-width:768px){.post-module--title--_4a8P{font-size:2.3rem;line-height:40px}}@media (max-width:640px){.post-module--title--_4a8P{font-size:2rem;line-height:40px}}</style><meta name="generator" content="Gatsby 2.23.21"/><title data-react-helmet="true">TDD by Example · Daniela Baron</title><link data-react-helmet="true" rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png"/><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link data-react-helmet="true" rel="manifest" href="/manifest.json"/><meta data-react-helmet="true" name="description" content="A practical example of using TDD to add a new feature to an existing project."/><meta data-react-helmet="true" name="image" content="https://danielabaron.me/static/3977c358105da928e0f7cc22eb4addca/ee604/tdd-by-example.png"/><meta data-react-helmet="true" property="og:url" content="https://danielabaron.me/blog/tdd-by-example/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="TDD by Example"/><meta data-react-helmet="true" property="og:description" content="A practical example of using TDD to add a new feature to an existing project."/><meta data-react-helmet="true" property="og:image" content="https://danielabaron.me/static/3977c358105da928e0f7cc22eb4addca/ee604/tdd-by-example.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@DanielaMBaron"/><meta data-react-helmet="true" name="twitter:title" content="TDD by Example"/><meta data-react-helmet="true" name="twitter:description" content="A practical example of using TDD to add a new feature to an existing project."/><meta data-react-helmet="true" name="twitter:image" content="https://danielabaron.me/static/3977c358105da928e0f7cc22eb4addca/ee604/tdd-by-example.png"/><meta data-react-helmet="true" name="msapplication-TileColor" content="#ffffff"/><meta data-react-helmet="true" name="msapplication-TileImage" content="/ms-icon-144x144.png"/><meta data-react-helmet="true" name="theme-color" content="#ffffff"/><link as="script" rel="preload" href="/webpack-runtime-246df12a576c78d030e3.js"/><link as="script" rel="preload" href="/framework-95b680cb3190aa9bfe59.js"/><link as="script" rel="preload" href="/app-259f8badab9829128140.js"/><link as="script" rel="preload" href="/styles-89fd2ae28bdf06750a71.js"/><link as="script" rel="preload" href="/1bfc9850-5d16e0a00245e09d73c3.js"/><link as="script" rel="preload" href="/252f366e-4b8dd868f7f9c2a7ee52.js"/><link as="script" rel="preload" href="/commons-b7f0eac7930a2fe953ac.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-6c8dc3de4250d0615bc4.js"/><link as="fetch" rel="preload" href="/page-data/blog/tdd-by-example/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--container--zLeA4"><header class="header-module--container--18lpt"><a href="/"><div class="header-module--logo--3gu8x"><div class="header-module--profile-wrapper--3R-fl"><img class="header-module--profile-img--wnp-Z" src="/images/profile.png" alt="Profile"/></div><div class="header-module--header-item--17b7u header-module--title--2iLmX">Daniela Baron</div></div></a><nav><ul class="nav-menu-module--nav-list--2gVNM"><li class="nav-menu-module--header-item--3ofg1 nav-menu-module--nav-item--1lKPw"><a href="/">Home</a></li><li class="nav-menu-module--header-item--3ofg1 nav-menu-module--nav-item--1lKPw"><a href="/blog">Blog</a></li><li class="nav-menu-module--header-item--3ofg1 nav-menu-module--nav-item--1lKPw"><a href="/about">About</a></li></ul></nav></header><div><div><h1 class="post-module--title--_4a8P">TDD by Example</h1><div class="post-module--published--OKKle">Published <!-- -->02 Jan 2021</div><div class="post-module--feature-image--1GQvY gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:52.94117647058824%"></div><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAAClUlEQVQoz2WRzU8TQRjG92IE+rndfm232y7tlm+pWkCoCIJgAwcMQU1A+WhLu0XQNMbESGLUAzYqJCRePXP06MGrF5P+ByZcPIhgEBAIsdudx9ktRoiHX56ZZ9555p0ZhgBlQqBCB6eha2pZI2qpTNSjElEPf2vq/pGm7h2W1e39srq5p6rffpbUjZ1yaWNHw9fNo8/M+7U15PNpKAtzyGayyGYpikJVqaiSMzRDNZPNYTajIE1JzSpIGuQwPpnUPnz8hM1drchk0mmcsVQRq4cnJtZFTE4PqbGxxGy3kxqrjZw1WUiVgbmi5grVx5gsVsIwjPZ6eRW7B+Uik5zNwOb2kUg0hkB9M0SdSCNEuQ7+cB2EWhlCSIZPClfGfwlFDA1IEuycQ3uzsoqd3YMiMzWdBMtaSGNTBN6ABB8tdHl4cBwHzukC53L9U5cbzpO43XB7faiqMWmFVyv4sb1PA2eSsNosRK6X4QnW0tAgvLQbbzAEwS9B9IcgirUQhCB8QoAe5j2Fh/eh2mTWlgrL2Nj6Ra+cSsHi4IjU0AQxEDZCAgEZfkkGL0rw0A503Aa8EeJ0e/4L1Dvc2qZXnpicgY0GegXxeCN/IuQ44FRX1DN8vlLrE0A/Rnv67CW+rH8vMl1Xh+gbVBN9UT9ZfyfW6YSDwjo4ODin4VXmDgoLO2s3sFF0z2I1aR1XhjE9XygyDxeXcLmnj7Scb0NjaxuaL3SiPd6Hrt7rhuqeJNcj3BBF88VunIv1INrRj9b2fsTiCUTbaU00riXG5nFnfqXILBbeIXX/CbkxkcPY9ANM3nuO7KNlzC2+xdTCC9xOP8a1kbuID4yio3cILbFOxLoHcKlnGIMjMxgczSI+OK4lbuaRuJUv/gG6BJTaxEP1uwAAAABJRU5ErkJggg==" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/3977c358105da928e0f7cc22eb4addca/69585/tdd-by-example.png 200w,
/static/3977c358105da928e0f7cc22eb4addca/497c6/tdd-by-example.png 400w,
/static/3977c358105da928e0f7cc22eb4addca/ee604/tdd-by-example.png 800w,
/static/3977c358105da928e0f7cc22eb4addca/f3583/tdd-by-example.png 1200w,
/static/3977c358105da928e0f7cc22eb4addca/5707d/tdd-by-example.png 1600w,
/static/3977c358105da928e0f7cc22eb4addca/97728/tdd-by-example.png 1666w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="/static/3977c358105da928e0f7cc22eb4addca/69585/tdd-by-example.png 200w,
/static/3977c358105da928e0f7cc22eb4addca/497c6/tdd-by-example.png 400w,
/static/3977c358105da928e0f7cc22eb4addca/ee604/tdd-by-example.png 800w,
/static/3977c358105da928e0f7cc22eb4addca/f3583/tdd-by-example.png 1200w,
/static/3977c358105da928e0f7cc22eb4addca/5707d/tdd-by-example.png 1600w,
/static/3977c358105da928e0f7cc22eb4addca/97728/tdd-by-example.png 1666w" src="/static/3977c358105da928e0f7cc22eb4addca/ee604/tdd-by-example.png" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><div class="post-module--content--2Opks"><p>If you've been coding for any length of time, you've probably heard that you should test your code, and by that I mean writing automated tests. This can be challenging at first, but with some practice, it becomes easier. When first learning to write tests, it's easier to have already written the production code, then open up another editor tab side by side with that code, and write some tests against that code. However, there's another approach to writing tests called <a href="https://en.wikipedia.org/wiki/Test-driven_development">Test Driven Development</a>, aka TDD. According to Wikipedia, TDD is:</p>
<blockquote>
<p>A software development process relying on software requirements being converted to test cases before software is fully developed, and tracking all software development by repeatedly testing the software against all test cases. This is opposed to software being developed first and test cases created later.</p>
</blockquote>
<p>In practice what this means is, suppose you want to add a new feature to some software. You would first write a test for that feature and run the test. The test would fail since the new feature hasn't been written yet. Then you write just enough code to get that test to pass. When it passes, then you add another test for this feature, run it to see that it fails, write more code to get this to pass, and continue until the feature is complete. Typically the first test you write would be for the "happy path", then next test would be for an edge case such as invalid input and so on.</p>
<p>This is much harder to do because you don't have the actual code to look at, instead you have to picture what the result of the code should be and write a test to expect that result. In fact, this is the benefit of TDD. You end up with tests that verify the results of the code, rather than implementation details. But the first time you try this, it can be difficult to know where to start.</p>
<p>This post will walk you through an example of using TDD that I did recently to add a new feature to <a href="https://github.com/danielabar/tidysum">Tidysum</a>. I will assume that you already know how to write tests generally, but are new to TDD specifically.</p>
<p>First, what is Tidysum? Tidysum is a personal finance app that takes in a list of daily expenses and outputs a summary json file with year and month breakdowns of these expenses by category, showing total and average spending per month and per year, and makes savings and spending recommendations. It's written as an npm module and runs as a CLI. The feature I added was a percentage difference calculation for total and by-category spending year over year. The idea is to calculate a personalized rate of inflation based on your actual spending, rather than some theoretical basket of goods determined by government bureaucrats.</p>
<p>Aside: I was inspired to add this after learning from several finance podcasts that the official government inflation numbers may not reflect reality as they don't include food and energy. As some government benefits are indexed to inflation, as are many employers' annual cost of living increases, it may benefit some to have this number reported as lower than it really is. The inflation number is also used in personal finance for retirement planning and so can be disastrous if incorrect. Of course there's nothing I can do about the big macro, but as a developer, I can improve my software to generate more personalized information to help inform better decision making.</p>
<p>Ok back to TDD. Tidysum reads in a csv file of expenses like this (abbreviated, but imagine this goes on for several years):</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="csv" data-index="0"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">2018-01-01,...</span></span>
<span class="grvsc-line"><span class="grvsc-source">2018-10-01,34.29,Groceries,Loblaws</span></span>
<span class="grvsc-line"><span class="grvsc-source">2018-10-01,133.99,Restaurant,The Keg</span></span>
<span class="grvsc-line"><span class="grvsc-source">2018-10-04,5.99,Entertainment,Amazon</span></span>
<span class="grvsc-line"><span class="grvsc-source">2018-10-15,54.00,Groceries,Loblaws</span></span>
<span class="grvsc-line"><span class="grvsc-source">2018-11-15,11.67,Health,Loblaws</span></span>
<span class="grvsc-line"><span class="grvsc-source">2019-10-15,120,Groceries,Loblaws</span></span>
<span class="grvsc-line"><span class="grvsc-source">2019-10-20,20,Restaurant,Dominos</span></span>
<span class="grvsc-line"><span class="grvsc-source">2019-10-25,10.00,Entertainment,Apple</span></span>
<span class="grvsc-line"><span class="grvsc-source">2019-11-10,12.49,Health,Whole Foods</span></span>
<span class="grvsc-line"><span class="grvsc-source">...</span></span>
<span class="grvsc-line"><span class="grvsc-source">2020-12-24,...</span></span></code></pre>
<p>And generates a summary json where each key is the year. Each year shows the total spending for that year, and then has another object where each key is the month in that year. Each month shows total spending for that month, as well as the breakdown by category and by merchant.</p>
<p>Each year also has an <code>average</code> section, where it shows on average how much was spent each month, and again, an average breakdown by category. The summary looks something like this:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="json" data-index="1"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">&quot;2018&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;239.94&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;Oct&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;228.27&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Groceries&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;88.29&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Restaurant&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;133.99&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Entertainment&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;5.99&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byMerchant&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Loblaws&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;88.29&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;The Keg&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;133.99&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Amazon&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;5.99&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;Nov&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;11.67&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Health&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;11.67&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byMerchant&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Loblaws&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;11.67&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;average&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;monthly&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;119.97&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Groceries&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;44.15&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Restaurant&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;67.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Entertainment&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;3.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Health&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;5.84&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">&quot;2019&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;162.49&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;Oct&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;150&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Groceries&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;120&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Restaurant&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;20&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Entertainment&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;10.00&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byMerchant&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Loblaws&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;120&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Dominos&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;20&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Apple&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;10.00&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;Nov&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;12.49&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Health&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;12.49&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byMerchant&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Whole Foods&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;12.49&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;average&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;monthly&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;81.25&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Groceries&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;60.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Restaurant&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;10.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Entertainment&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;5.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Health&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;6.25&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>What I wanted to add was another per year entry to show the percentage difference in total and per category spending as compared to the previous year, like this:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="json" data-index="2"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">&quot;2018&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;239.94&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;Oct&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;228.27&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Groceries&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;88.29&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Restaurant&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;133.99&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Entertainment&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;5.99&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byMerchant&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Loblaws&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;88.29&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;The Keg&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;133.99&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Amazon&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;5.99&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;Nov&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;11.67&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Health&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;11.67&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byMerchant&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Loblaws&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;11.67&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;average&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;monthly&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;119.97&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Groceries&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;44.15&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Restaurant&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;67.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Entertainment&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;3.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Health&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;5.84&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;percentageDiffPreviousYear&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;N/A&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">&quot;2019&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;162.49&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;Oct&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;150&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Groceries&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;120&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Restaurant&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;20&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Entertainment&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;10.00&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byMerchant&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Loblaws&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;120&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Dominos&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;20&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Apple&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;10.00&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;Nov&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;12.49&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Health&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;12.49&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byMerchant&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Whole Foods&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;12.49&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;average&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;monthly&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;81.25&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;byCategory&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Groceries&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;60.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Restaurant&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;10.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Entertainment&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;5.00&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">&quot;Health&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;6.25&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;percentageDiffPreviousYear&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;total&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;-32.28&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;Groceries&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;35.9&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;Restaurant&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;-85.07&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;Entertainment&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;66.67&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">&quot;Health&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;7.02&quot;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>So for the first recorded year, <code>percentageDiffPreviousYear</code> would be <code>N/A</code> because there's nothing to compare it to. Then for the following year, it should calculate percentage difference in total and by category spending as compared to the previous year.</p>
<p>This kind of problem lends itself very well to TDD because the desired output is exactly known. And this is exactly what goes in the tests.</p>
<p>Ok let's get into the code. Recall this project already exists and most of the code is already written. The processing of the file happens in a function named <code>processFile</code> in the <code>lib/expense.js</code> module. It first generates the <code>expenseSummary</code> by reading the expense csv line by line. then it goes over the expense summary to add in the averages - this part is delegated to a <code>calculator</code> module in a method named <code>calcAvg</code>.</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="3"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/expense.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> csv </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;csv-streamify&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> calculator </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;./calculator&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> recommendation </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;./recommendation&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// other imports...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">async</span><span class="mtk1"> </span><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">process</span><span class="mtk1">(</span><span class="mtk10 mtki">inputFile</span><span class="mtk1">, </span><span class="mtk10 mtki">mothlyIn</span><span class="mtk1">, </span><span class="mtk10 mtki">fixedExp</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// Read input csv of expenses to generate summary json</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> expenseSummary </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk7">await</span><span class="mtk1"> </span><span class="mtk5">processFile</span><span class="mtk1">(inputFile);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// Enhance the json summary with averages</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> expenseSummaryWithAvg </span><span class="mtk7">=</span><span class="mtk1"> calculator.</span><span class="mtk5">calcAvg</span><span class="mtk1">(expenseSummary);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">if</span><span class="mtk1"> (mothlyIn </span><span class="mtk7">&amp;&amp;</span><span class="mtk1"> fixedExp) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    recommendation.</span><span class="mtk5">determine</span><span class="mtk1">(expenseSummaryWithAvg, mothlyIn, fixedExp);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// TODO: Further enhance json summary - Calculate percentage diff year over year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> expenseSummaryWithAvg;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">async</span><span class="mtk1"> </span><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">processFile</span><span class="mtk1">(</span><span class="mtk10 mtki">file</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// Use csv-streamify to stream in input csv and generate expense summary json object</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// Details are not relevant for this post, see project on github for complete code.</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// rest of functions...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">module</span><span class="mtk1">.</span><span class="mtk9 mtki">exports</span><span class="mtk1"> </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  process,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">};</span></span></span></code></pre>
<p>My thought was after the averages have been added to the expense summary, it would be a good time to further process <code>expenseSummaryWithAvg</code> to add the percentage differences. Since the average calculation is delegated to the calculator module, it makes sense to delegate percentage difference calculation to this module as well. So it will look something like this:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="4"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk7">async</span><span class="mtk1"> </span><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">process</span><span class="mtk1">(</span><span class="mtk10 mtki">inputFile</span><span class="mtk1">, </span><span class="mtk10 mtki">mothlyIn</span><span class="mtk1">, </span><span class="mtk10 mtki">fixedExp</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> expenseSummary </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk7">await</span><span class="mtk1"> </span><span class="mtk5">processFile</span><span class="mtk1">(inputFile);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> expenseSummaryWithAvg </span><span class="mtk7">=</span><span class="mtk1"> calculator.</span><span class="mtk5">calcAvg</span><span class="mtk1">(expenseSummary);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">if</span><span class="mtk1"> (mothlyIn </span><span class="mtk7">&amp;&amp;</span><span class="mtk1"> fixedExp) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    recommendation.</span><span class="mtk5">determine</span><span class="mtk1">(expenseSummaryWithAvg, mothlyIn, fixedExp);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// NEW LINE ADDED HERE:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> withYearlyDiff </span><span class="mtk7">=</span><span class="mtk1"> calculator.</span><span class="mtk5">calcYearlyDiff</span><span class="mtk1">(expenseSummaryWithAvg);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> withYearlyDiff;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<h2>Calculator Tests</h2>
<p>Now instead of jumping in to add a new method <code>calcYearlyDiff</code> to the calculator module and implement it, this is where the TDD approach will come in. Let's first add a test to specify what should be the expected output of this method. This project uses the <a href="https://mochajs.org/">Mocha</a> test framework and <a href="https://www.chaijs.com/api/assert/">Chai</a> for assertions, but TDD principles can be used with any testing library.</p>
<p>Here is the existing calculator module:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="javascript" data-index="5"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/calculator.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> decimalUtil </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;./decimal-util&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">calcAvg</span><span class="mtk1">(</span><span class="mtk10 mtki">expenseSummary</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// existing logic...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">module</span><span class="mtk1">.</span><span class="mtk9 mtki">exports</span><span class="mtk1"> </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  calcAvg,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">};</span></span></span></code></pre>
<p>And the existing calculator tests:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="javascript" data-index="6"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// test/lib/calculator.test.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> calculator </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;../../lib/calculator&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> { expect } </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;chai&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;calculator&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;calcAvg&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// tests for existing calcAvg method</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">});</span></span></span></code></pre>
<p>We know the calculator module needs to have a new method <code>calcYearlyDiff</code> so let's add a test for that. The style I'm following is a <code>describe</code> block for each method in the module, and an <code>it</code> test for each condition of the method to be tested:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="7"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// test/lib/calculator.test.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> calculator </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;../../lib/calculator&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> { expect } </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;chai&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;calculator&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;calcAvg&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// tests for existing calcAvg method</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;calcYearlyDiff&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">it</span><span class="mtk1">(</span><span class="mtk6">&#39;calculates percentage difference in total and categories compared to previous year&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// do test things here!</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">});</span></span></span></code></pre>
<p>So what should go in the test body? I like to follow the <a href="https://martinfowler.com/bliki/GivenWhenThen.html">GivenWhenThen</a> approach. Just about every test can be expressed as "Given" a certain set of inputs, "When" the system under test is invoked, "Then" expect certain results.</p>
<p>In this case, the input to the <code>calcYearlyDiff</code> method will be the expense summary json object which contains a key for each year, then each year having total and average by category spending. The system under test is the <code>calcYearlyDiff</code> method in the calculator module. The expected result is a modified expense summary object having an additional property <code>percentageDiffPreviousYear</code>, which itself is an object containing percentage differences for total spending, and for each category.</p>
<p>Let's express this in a test:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="8"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;calcYearlyDiff&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">it</span><span class="mtk1">(</span><span class="mtk6">&#39;calculates percentage difference in total and categories compared to previous year&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Given total spending increase of 25%, grocery spending increase of 11.11% and gift spending decrease of 20%</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> summary </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk6">&#39;2019&#39;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        total: </span><span class="mtk6">&#39;20000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        average: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          byCategory: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            groceries: </span><span class="mtk6">&#39;900&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            gifts: </span><span class="mtk6">&#39;100&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk6">&#39;2020&#39;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        total: </span><span class="mtk6">&#39;25000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        average: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          byCategory: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            groceries: </span><span class="mtk6">&#39;1000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            gifts: </span><span class="mtk6">&#39;80&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    };</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> expectedSummaryWithDiff </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk6">&#39;2019&#39;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        total: </span><span class="mtk6">&#39;20000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        average: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          byCategory: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            groceries: </span><span class="mtk6">&#39;900&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            gifts: </span><span class="mtk6">&#39;100&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        percentageDiffPreviousYear: </span><span class="mtk6">&#39;N/A&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk6">&#39;2020&#39;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        total: </span><span class="mtk6">&#39;25000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        average: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          byCategory: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            groceries: </span><span class="mtk6">&#39;1000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            gifts: </span><span class="mtk6">&#39;80&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        percentageDiffPreviousYear: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          total: </span><span class="mtk6">&#39;25&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          groceries: </span><span class="mtk6">&#39;11.11&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          gifts: </span><span class="mtk6">&#39;-20&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    };</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// When calculator function calcYearlyDiff is invoked</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> result </span><span class="mtk7">=</span><span class="mtk1"> calculator.</span><span class="mtk5">calcYearlyDiff</span><span class="mtk1">(summary);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Then expect result to contain `percentageDiffPreviousYear` as shown in `expectedSummaryWithDiff`</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">expect</span><span class="mtk1">(result).to.</span><span class="mtk5">eql</span><span class="mtk1">(expectedSummaryWithDiff);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">});</span></span></span></code></pre>
<p>The amazing this is all this can be written without knowing yet how the <code>calcYearlyDiff</code> function will be implemented. In fact we don't care about implementation at this point, the only thing that matters is expressing what the function should return given a certain input.</p>
<p>Next step is to run the tests, this project uses npm scripts with the test script defined to run mocha as follows:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="json" data-index="9"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// package.json</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">{</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">&quot;scripts&quot;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">&quot;test&quot;</span><span class="mtk1">: </span><span class="mtk12">&quot;NODE_ENV=test mocha test/**/*.test.js&quot;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk8">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk8">...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Tests are run by entering the <code>npm test</code> command in a terminal. At this point, the newly added test will fail with the following error:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="" data-index="10"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">1) calculator</span></span>
<span class="grvsc-line"><span class="grvsc-source">  calcYearlyDiff</span></span>
<span class="grvsc-line"><span class="grvsc-source">    calculates percentage difference in total and categories compared to previous year:</span></span>
<span class="grvsc-line"><span class="grvsc-source">TypeError: calculator.calcYearlyDiff is not a function</span></span>
<span class="grvsc-line"><span class="grvsc-source"> at Context.it (test/lib/calculator.test.js:96:33)</span></span></code></pre>
<p>This is expected as we haven't yet touched the calculator module. Let's change that now by adding an empty function definition and exporting it:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="11"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/calculator.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">calcYearlyDiff</span><span class="mtk1">(</span><span class="mtk10 mtki">expenseSummary</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// TODO...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">module</span><span class="mtk1">.</span><span class="mtk9 mtki">exports</span><span class="mtk1"> </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  calcAvg,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  calcYearlyDiff,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">};</span></span></span></code></pre>
<p>Running the tests again <code>npm test</code> results in a different error:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="" data-index="12"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source">1) calculator</span></span>
<span class="grvsc-line"><span class="grvsc-source">  calcYearlyDiff</span></span>
<span class="grvsc-line"><span class="grvsc-source">    calculates percentage difference in total and categories compared to previous year:</span></span>
<span class="grvsc-line"><span class="grvsc-source">AssertionError: expected undefined to deeply equal { Object (2019, 2020) }</span></span>
<span class="grvsc-line"><span class="grvsc-source"> at Context.it (test/lib/calculator.test.js:98:25)</span></span></code></pre>
<p>Again, this is expected because the function has no implementation, it implicitly returns <code>undefined</code>, which does not match the <code>expectedSummaryWithDiff</code> the test expects.</p>
<h2>Calculator Implementation</h2>
<p>Ok, NOW we're ready to write some implementation in the calculator module. This solution iterates over each year in the <code>expenseSummary</code> using <code>Object.entries(obj)</code> which returns an array of key/value pairs of the given object, and then <code>forEach</code> to loop over these.</p>
<p>For each year, find the previous year in the object, if it's not found, set the current year's <code>percentageDiffPreviousYear</code> to <code>N/A</code> because there's nothing to compare to. Otherwise calculate percentage difference between the current year's total spending to previous years total spending and save this in the <code>percentageDiffPreviousYear.total</code> property of the current year. And then iterate over each average by category spending for current year, calculate its percentage difference relative to previous year, and save it in the <code>percentageDiffPreviousYear[curCategory]</code> property of the current year.</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="13"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/calculator.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">calcYearlyDiff</span><span class="mtk1">(</span><span class="mtk10 mtki">expenseSummary</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(expenseSummary).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">year</span><span class="mtk1">, </span><span class="mtk10 mtki">yearSummary</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> intYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">parseInt</span><span class="mtk1">(year, </span><span class="mtk4">10</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevYear </span><span class="mtk7">=</span><span class="mtk1"> intYear </span><span class="mtk7">-</span><span class="mtk1"> </span><span class="mtk4">1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">if</span><span class="mtk1"> (</span><span class="mtk7">!</span><span class="mtk1">expenseSummary[prevYear]) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;N/A&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    } </span><span class="mtk7">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear </span><span class="mtk7">=</span><span class="mtk1"> {};</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear.total </span><span class="mtk7">=</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        ((yearSummary.total </span><span class="mtk7">-</span><span class="mtk1"> expenseSummary[prevYear].total) </span><span class="mtk7">/</span><span class="mtk1"> expenseSummary[prevYear].total) </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1"> </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk6">&#39;&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(yearSummary.average.byCategory).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">curCategory</span><span class="mtk1">, </span><span class="mtk10 mtki">curAvg</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevAvg </span><span class="mtk7">=</span><span class="mtk1"> expenseSummary[prevYear].average.byCategory[curCategory];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        yearSummary.percentageDiffPreviousYear[curCategory] </span><span class="mtk7">=</span><span class="mtk1"> ((curAvg </span><span class="mtk7">-</span><span class="mtk1"> prevAvg) </span><span class="mtk7">/</span><span class="mtk1"> prevAvg) </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1"> </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk6">&#39;&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }); </span><span class="mtk3">// for each category average within year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }); </span><span class="mtk3">// for each year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> expenseSummary;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Now running the test results in a different failure, the returned object is not quite as expected.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/1092c7575efc0803f4399221d0a2c997/5205c/tdd-fail-1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 46.0984393757503%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABGElEQVQoz5VS2W7DMAzrb2w5fMZxHDtu06Ybhv3/b3FSjsLDBqx7oClaAi0JPkltEfMZbx+fxBco69AqA6EZFq3Uqy6x3he6oZq6lWiEwokDazrcLzcs1wUpTcgpI40JU5wQfEAMIwIhT5niSHxemZFiWmvYjL1WQ20MTHBwWiNTopcKlrjb4QhGyG+xK/I9oT0MGzoqEo3t8NIKVI3AK6Hi+wI11Tx0GR/5Y2Q+2GQcJyzLO+brHTnPiDR2P4wQvKO9+C9sHe6BNha3+UzGAX4Y4EkHWraT6vH6/wxdD3+b4VKCcA61Uj86e8b4YeiHCOf8OrrtPKq6pb1tu6mLHZXxr4ac5D0p+jrMDEnjsuY/ylBm42c6/ALWofuqMGgXbAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="tdd fail 1"
        title="tdd fail 1"
        src="/static/1092c7575efc0803f4399221d0a2c997/5a190/tdd-fail-1.png"
        srcset="/static/1092c7575efc0803f4399221d0a2c997/772e8/tdd-fail-1.png 200w,
/static/1092c7575efc0803f4399221d0a2c997/e17e5/tdd-fail-1.png 400w,
/static/1092c7575efc0803f4399221d0a2c997/5a190/tdd-fail-1.png 800w,
/static/1092c7575efc0803f4399221d0a2c997/5205c/tdd-fail-1.png 833w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Well we've made some progress as the gifts and total percentage calculations are correct. But notice the color coding for expected (green) vs actual (red) results. If the result of the calculation is a decimal, we only want to see two decimals of precision. Currently there's no rounding or truncation so results are not as expected.</p>
<p>Let's fix the code to make the test pass. To get the desired decimal precision, will use <code>Math.round(num * 100) / 100</code> where <code>num</code> is the percentage difference calculation:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="14"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/calculator.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">calcYearlyDiff</span><span class="mtk1">(</span><span class="mtk10 mtki">expenseSummary</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(expenseSummary).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">year</span><span class="mtk1">, </span><span class="mtk10 mtki">yearSummary</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> intYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">parseInt</span><span class="mtk1">(year, </span><span class="mtk4">10</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevYear </span><span class="mtk7">=</span><span class="mtk1"> intYear </span><span class="mtk7">-</span><span class="mtk1"> </span><span class="mtk4">1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">if</span><span class="mtk1"> (</span><span class="mtk7">!</span><span class="mtk1">expenseSummary[prevYear]) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;N/A&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    } </span><span class="mtk7">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> totalDiff </span><span class="mtk7">=</span><span class="mtk1"> ((yearSummary.total </span><span class="mtk7">-</span><span class="mtk1"> expenseSummary[prevYear].total) </span><span class="mtk7">/</span><span class="mtk1"> expenseSummary[prevYear].total) </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> totalDiffRounded </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">Math</span><span class="mtk1">.</span><span class="mtk9">round</span><span class="mtk1">(totalDiff </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">) </span><span class="mtk7">/</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear.total </span><span class="mtk7">=</span><span class="mtk1"> totalDiffRounded </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk6">&#39;&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(yearSummary.average.byCategory).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">curCategory</span><span class="mtk1">, </span><span class="mtk10 mtki">curAvg</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevAvg </span><span class="mtk7">=</span><span class="mtk1"> expenseSummary[prevYear].average.byCategory[curCategory];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">const</span><span class="mtk1"> categoryDiff </span><span class="mtk7">=</span><span class="mtk1"> ((curAvg </span><span class="mtk7">-</span><span class="mtk1"> prevAvg) </span><span class="mtk7">/</span><span class="mtk1"> prevAvg) </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">const</span><span class="mtk1"> categoryDiffRounded </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">Math</span><span class="mtk1">.</span><span class="mtk9">round</span><span class="mtk1">(categoryDiff </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">) </span><span class="mtk7">/</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        yearSummary.percentageDiffPreviousYear[curCategory] </span><span class="mtk7">=</span><span class="mtk1"> categoryDiffRounded </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk6">&#39;&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }); </span><span class="mtk3">// for each category average within year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }); </span><span class="mtk3">// for each year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> expenseSummary;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>And now the test passes - yay!</p>
<p>At this point, you may have noticed two things: 1) The percentage difference calculation is repeated in two places - once for the total difference, and again in the loop for each category. And 2) this code is getting messy, especially once the rounding logic is added. At this point, it might be tempting to refactor, but let's hold off for now until all the tests are in place. The goal here is to get all the functionality working, then we can refactor to make improvements.</p>
<h2>Detect New Categories</h2>
<p>One more feature this code needs to support is detection of new categories. For example, suppose you purchased some vitamins in 2020, but didn't purchase any in 2019. In this case we can't calculate the percentage difference in vitamin spending because there's nothing to compare it to.  In this case, the code should simply display <code>new category</code>. Let's define this behavior in a new test. Again, this is TDD, we write the test before implementing the requirement:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="15"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// test/lib/calculator.test.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> calculator </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;../../lib/calculator&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> { expect } </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;chai&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;calculator&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;calcAvg&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// existing tests for calcAvg function...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;calcYearlyDiff&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">it</span><span class="mtk1">(</span><span class="mtk6">&#39;calculates percentage difference in total and categories compared to previous year&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// test we just wrote...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// Our new test here:</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">it</span><span class="mtk1">(</span><span class="mtk6">&#39;detects a new category in the current year&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Given</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> summary </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&#39;2019&#39;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          total: </span><span class="mtk6">&#39;20000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          average: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            byCategory: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">              groceries: </span><span class="mtk6">&#39;900&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&#39;2020&#39;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          total: </span><span class="mtk6">&#39;25000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          average: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            byCategory: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">              groceries: </span><span class="mtk6">&#39;1000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">              vitamins: </span><span class="mtk6">&#39;90&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      };</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> expectedSummaryWithDiff </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&#39;2019&#39;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          total: </span><span class="mtk6">&#39;20000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          average: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            byCategory: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">              groceries: </span><span class="mtk6">&#39;900&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          percentageDiffPreviousYear: </span><span class="mtk6">&#39;N/A&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk6">&#39;2020&#39;</span><span class="mtk1">: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          total: </span><span class="mtk6">&#39;25000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          average: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            byCategory: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">              groceries: </span><span class="mtk6">&#39;1000&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">              vitamins: </span><span class="mtk6">&#39;90&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          percentageDiffPreviousYear: {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            total: </span><span class="mtk6">&#39;25&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            groceries: </span><span class="mtk6">&#39;11.11&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">            vitamins: </span><span class="mtk6">&#39;new category&#39;</span><span class="mtk1">,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        },</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      };</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// When</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      calculator.</span><span class="mtk5">calcYearlyDiff</span><span class="mtk1">(summary);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Then</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5">expect</span><span class="mtk1">(summary).to.</span><span class="mtk5">eql</span><span class="mtk1">(expectedSummaryWithDiff);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">});</span></span></span></code></pre>
<p>Now when we run the calculation tests, the first test that we wrote earlier passes, but the newly added test fails:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 798px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f00ad508e984f49fa04c96e54beb3076/898f6/tdd-fail-2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 70.80200501253132%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAABmklEQVQ4y42TWXIDIQxEfY14DANiGWbxmqVS+Ulluf+VOi3GdlxJyvHHMzIDTUuCRUgddocHdMME6wMa67AkzQ9WN2Baj0UrEfv7Bzw/PmG73iLFhJJyHXPMiPyeQoKECOF/rzHHGovOpTpnnVTRhZ5uVhbJtAiMMz8MdJo45iMdEWKIdb5uVtTRaVSqoBFBO3awOZ1TbvjxnG6N/e0pC21vyoCSS51o6FZZ0XFzwWnDNapDdTVs93h9/8Tj8wvKuEbuRwibFXhI7HpEHuhYp7lZ/lfDTlSHerow2PQDJgqsKbAfJ4yMJ8aKZtCz+FJr7BG5PpD0g7mG/PEpwo4ZzrUoSwPfGBjSEscDvaLrjkJyJFwgZ0EGS27QNEemrpRpg2GzQ8f0LWv8q1HXUq6NoGDHtD7fPvDCOh52B0wUE5nvl7mhIebSYYW1yWNh+gGBNCXhrkvn7q5uEPx2yE09HUU2o9/uKDyh8Vwg4U8XVwV1gWOdFMsJx2vU6jPSu2f+vrzXRGdBiuibPAl/v9f5nXq+48D/Ldf95/ALQOmFGO/mr3kAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="tdd fail 2"
        title="tdd fail 2"
        src="/static/f00ad508e984f49fa04c96e54beb3076/898f6/tdd-fail-2.png"
        srcset="/static/f00ad508e984f49fa04c96e54beb3076/772e8/tdd-fail-2.png 200w,
/static/f00ad508e984f49fa04c96e54beb3076/e17e5/tdd-fail-2.png 400w,
/static/f00ad508e984f49fa04c96e54beb3076/898f6/tdd-fail-2.png 798w"
        sizes="(max-width: 798px) 100vw, 798px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Again this makes sense because vitamin spending for 2019 doesn't exist therefore the line to retrieve the previous years category average will return <code>undefined</code>. Then trying to use <code>undefined</code> in a calculation results in <code>NaN</code>:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="16"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// When `curCategory` is &#39;vitamins&#39;, `prevAvg` will be undefined</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> prevAvg </span><span class="mtk7">=</span><span class="mtk1"> expenseSummary[prevYear].average.byCategory[curCategory];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> categoryDiff </span><span class="mtk7">=</span><span class="mtk1"> ((curAvg </span><span class="mtk7">-</span><span class="mtk1"> prevAvg) </span><span class="mtk7">/</span><span class="mtk1"> prevAvg) </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;    </span><span class="mtk3">// NaN</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> categoryDiffRounded </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">Math</span><span class="mtk1">.</span><span class="mtk9">round</span><span class="mtk1">(categoryDiff </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">) </span><span class="mtk7">/</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;   </span><span class="mtk3">// NaN</span></span></span></code></pre>
<p>Now that the test is in place, we can enhance the code to handle this case. The solution is to first check if the previous years average exists. If it doesn't, then output <code>new category</code>, otherwise, go ahead and run the percentage difference calculation:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="17"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/calculator.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">calcYearlyDiff</span><span class="mtk1">(</span><span class="mtk10 mtki">expenseSummary</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(expenseSummary).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">year</span><span class="mtk1">, </span><span class="mtk10 mtki">yearSummary</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> intYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">parseInt</span><span class="mtk1">(year, </span><span class="mtk4">10</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevYear </span><span class="mtk7">=</span><span class="mtk1"> intYear </span><span class="mtk7">-</span><span class="mtk1"> </span><span class="mtk4">1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">if</span><span class="mtk1"> (</span><span class="mtk7">!</span><span class="mtk1">expenseSummary[prevYear]) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;N/A&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    } </span><span class="mtk7">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> totalDiff </span><span class="mtk7">=</span><span class="mtk1"> ((yearSummary.total </span><span class="mtk7">-</span><span class="mtk1"> expenseSummary[prevYear].total) </span><span class="mtk7">/</span><span class="mtk1"> expenseSummary[prevYear].total) </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> totalDiffRounded </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">Math</span><span class="mtk1">.</span><span class="mtk9">round</span><span class="mtk1">(totalDiff </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">) </span><span class="mtk7">/</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear.total </span><span class="mtk7">=</span><span class="mtk1"> totalDiffRounded </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk6">&#39;&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(yearSummary.average.byCategory).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">curCategory</span><span class="mtk1">, </span><span class="mtk10 mtki">curAvg</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevAvg </span><span class="mtk7">=</span><span class="mtk1"> expenseSummary[prevYear].average.byCategory[curCategory];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">if</span><span class="mtk1"> (</span><span class="mtk7">!</span><span class="mtk1">prevAvg) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          yearSummary.percentageDiffPreviousYear[curCategory] </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;new category&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk7">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk9 mtki">const</span><span class="mtk1"> categoryDiff </span><span class="mtk7">=</span><span class="mtk1"> ((curAvg </span><span class="mtk7">-</span><span class="mtk1"> prevAvg) </span><span class="mtk7">/</span><span class="mtk1"> prevAvg) </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk9 mtki">const</span><span class="mtk1"> categoryDiffRounded </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">Math</span><span class="mtk1">.</span><span class="mtk9">round</span><span class="mtk1">(categoryDiff </span><span class="mtk7">*</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">) </span><span class="mtk7">/</span><span class="mtk1"> </span><span class="mtk4">100</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          yearSummary.percentageDiffPreviousYear[curCategory] </span><span class="mtk7">=</span><span class="mtk1"> categoryDiffRounded </span><span class="mtk7">+</span><span class="mtk1"> </span><span class="mtk6">&#39;&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }); </span><span class="mtk3">// for each category average within year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }); </span><span class="mtk3">// for each year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> expenseSummary;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>This time both tests should pass.</p>
<p>But we're not done yet. Remember earlier I pointed out several issues with this code - the same percentage difference calculation is written twice, and overall code is getting messy. This code is both iterating the expense summary and doing some mathematical calculations. Now that we've got all the percentage difference feature covered by tests, we can tackle a refactor to fix these issues.</p>
<h2>Refactoring Calculation</h2>
<p>This project actually has another module <code>lib/decimal-util.js</code> to perform all numeric calculations. This module uses the <a href="https://github.com/MikeMcl/decimal.js/">decimal.js</a> library. I was looking for something similar to <a href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/math/BigDecimal.html">BigDecimal</a> in Java to avoid some Javascript known issues with decimal calculations. The decimal-util module would be a perfect place for the percentage difference calculation to live. Then the calculator module could simply make use of it wherever needed. Here's what I'm picturing:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="18"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/calculator.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// This module is already imported because its used in other functions in the calculator module</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> decimalUtil </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;./decimal-util&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// other imports and functions...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">calcYearlyDiff</span><span class="mtk1">(</span><span class="mtk10 mtki">expenseSummary</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(expenseSummary).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">year</span><span class="mtk1">, </span><span class="mtk10 mtki">yearSummary</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> intYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">parseInt</span><span class="mtk1">(year, </span><span class="mtk4">10</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevYear </span><span class="mtk7">=</span><span class="mtk1"> intYear </span><span class="mtk7">-</span><span class="mtk1"> </span><span class="mtk4">1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">if</span><span class="mtk1"> (</span><span class="mtk7">!</span><span class="mtk1">expenseSummary[prevYear]) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;N/A&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    } </span><span class="mtk7">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear </span><span class="mtk7">=</span><span class="mtk1"> {};</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// NEW: Use decimal-util module for percentage diff calculation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear.total </span><span class="mtk7">=</span><span class="mtk1"> decimalUtil.</span><span class="mtk5">percentDiff</span><span class="mtk1">(expenseSummary[prevYear].total, yearSummary.total);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(yearSummary.average.byCategory).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">curCategory</span><span class="mtk1">, </span><span class="mtk10 mtki">curAvg</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevAvg </span><span class="mtk7">=</span><span class="mtk1"> expenseSummary[prevYear].average.byCategory[curCategory];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">if</span><span class="mtk1"> (</span><span class="mtk7">!</span><span class="mtk1">prevAvg) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          yearSummary.percentageDiffPreviousYear[curCategory] </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;new category&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk7">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk3">// NEW: Use decimal-util module for percentage diff calculation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          yearSummary.percentageDiffPreviousYear[curCategory] </span><span class="mtk7">=</span><span class="mtk1"> decimalUtil.</span><span class="mtk5">percentDiff</span><span class="mtk1">(prevAvg, curAvg);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }); </span><span class="mtk3">// for each category average within year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }); </span><span class="mtk3">// for each year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> expenseSummary;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>Now running the tests will fail:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/4ab940436d77bc3aaa0fb0f79c6be3c9/d4c13/tdd-fail-3.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 65.81818181818181%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAABi0lEQVQ4y41SW1LDMAzsOWhi5+HYjvMuMDCUtsP9D7WsnKSEDmX6sbOyLW2kVXZ5adBPB/i2hyoMnlQWsd/wI0iIVOfYpVmB537EaTzgpW4QeNnxriFawmc5arLTN8x7y9gvLGIiuttrKqcaloeKkEQRkiS3FAhyxnpBtolXXAVVUSAPFqoySHQxj8zH/Qo1c/IAUhHM8hJd22Gij8bV8WHPjqM3K69+8pxs+BbRQxGoKXQ5nnA+fuKVwgMXNHUDDsOEhr62ocXQdBiGEYFv3cI17xrm1U0LRZtmD8U3bre1DqFy6J1HXwcMPsSzNxaurNAwNmRZovoDP0th+5qCNjSoKCLs2NF8rlFaTzgU5LXoHuLImh5aFnqOllE4XTamsnz+up5Z8lbBNWeLq6AkB3pxvnzh7f0jxo6dGhmRqOivQC8e/ScaBaOH8nOzw4Gdys/9SqPlPIqXshDGvYy9Eb0rKAklO5GNORYKPEUEhr4VXErOZUgsYz8kKImlFNJDKS5MtbD9FasHOvwG+G1tZvobWyQAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="tdd fail 3"
        title="tdd fail 3"
        src="/static/4ab940436d77bc3aaa0fb0f79c6be3c9/5a190/tdd-fail-3.png"
        srcset="/static/4ab940436d77bc3aaa0fb0f79c6be3c9/772e8/tdd-fail-3.png 200w,
/static/4ab940436d77bc3aaa0fb0f79c6be3c9/e17e5/tdd-fail-3.png 400w,
/static/4ab940436d77bc3aaa0fb0f79c6be3c9/5a190/tdd-fail-3.png 800w,
/static/4ab940436d77bc3aaa0fb0f79c6be3c9/d4c13/tdd-fail-3.png 825w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>The reason both tests are failing now is because it's trying to invoke a function <code>decimalUtil.percentDiff(...)</code> that doesn't exist. The solution to this is to add the <code>percentDiff</code> function to the <code>decimal-util</code> module, write the implementation and export it. But wait, we're doing this TDD style. So before writing any implementation, let's write a test, this time for the decimal util module.</p>
<p>Here's the existing decimal util module:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="19"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/decimal-util.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> Decimal </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;decimal.js&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">divideAndRound</span><span class="mtk1">(</span><span class="mtk10 mtki">numeratorIn</span><span class="mtk1">, </span><span class="mtk10 mtki">denominatorIn</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> numerator </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk7">new</span><span class="mtk1"> </span><span class="mtk5 mtku">Decimal</span><span class="mtk1">(numeratorIn);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> denominator </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk7">new</span><span class="mtk1"> </span><span class="mtk5 mtku">Decimal</span><span class="mtk1">(denominatorIn);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> numerator</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    .</span><span class="mtk5">dividedBy</span><span class="mtk1">(denominator)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    .</span><span class="mtk5">toFixed</span><span class="mtk1">(</span><span class="mtk4">2</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    .</span><span class="mtk5">toString</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">sum</span><span class="mtk1">(</span><span class="mtk10 mtki">in1</span><span class="mtk1">, </span><span class="mtk10 mtki">in2</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> in1Dec </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk7">new</span><span class="mtk1"> </span><span class="mtk5 mtku">Decimal</span><span class="mtk1">(in1);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> in2Dec </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk7">new</span><span class="mtk1"> </span><span class="mtk5 mtku">Decimal</span><span class="mtk1">(in2);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> in1Dec.</span><span class="mtk5">plus</span><span class="mtk1">(in2Dec).</span><span class="mtk5">toString</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// more functions...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">module</span><span class="mtk1">.</span><span class="mtk9 mtki">exports</span><span class="mtk1"> </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  divideAndRound,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  sum,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// other functions...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">};</span></span></span></code></pre>
<p>And the existing decimal util tests:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="20"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// test/lib/decimal-utils.test.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> decimalUtil </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;../../lib/decimal-util&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> { expect } </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;chai&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;decimalUtil&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;divideAndRound&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// tests for divideAndRound function...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// tests for other functions...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">});</span></span></span></code></pre>
<p>Looking at the refactored calculator module, we need a method in decimal util <code>percentDiff</code> that takes two numbers - a previous and current, and returns the percentage difference between them. If the current value is greater than previous, we expect a percentage increase. If current value is less than previous, we expect a percentage decrease. If they are the same, then percentage difference should be 0. Finally, if the result is not an integer, it should round to two decimal places. That's 4 different requirements, let's define all of these as tests:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="21"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// test/lib/decimal-utils.test.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> decimalUtil </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;../../lib/decimal-util&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> { expect } </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;chai&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;decimalUtil&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;divideAndRound&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk3">// tests for divideAndRound function...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// NEW: Tests for percentDiff function</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk5">describe</span><span class="mtk1">(</span><span class="mtk6">&#39;percentDiff&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">it</span><span class="mtk1">(</span><span class="mtk6">&#39;Returns percentage increase when current is greater than previous&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Given</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> prev </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;80&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> cur </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;100&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// When</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> result </span><span class="mtk7">=</span><span class="mtk1"> decimalUtil.</span><span class="mtk5">percentDiff</span><span class="mtk1">(prev, cur);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Then</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5">expect</span><span class="mtk1">(result).to.</span><span class="mtk5">equal</span><span class="mtk1">(</span><span class="mtk6">&#39;25&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">it</span><span class="mtk1">(</span><span class="mtk6">&#39;Returns percentage decrease when current is less than previous&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Given</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> prev </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;100&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> cur </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;80&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// When</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> result </span><span class="mtk7">=</span><span class="mtk1"> decimalUtil.</span><span class="mtk5">percentDiff</span><span class="mtk1">(prev, cur);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Then</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5">expect</span><span class="mtk1">(result).to.</span><span class="mtk5">equal</span><span class="mtk1">(</span><span class="mtk6">&#39;-20&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">it</span><span class="mtk1">(</span><span class="mtk6">&#39;Returns 0 when current is the same as previous&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Given</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> prev </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;80&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> cur </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;80&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// When</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> result </span><span class="mtk7">=</span><span class="mtk1"> decimalUtil.</span><span class="mtk5">percentDiff</span><span class="mtk1">(prev, cur);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Then</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5">expect</span><span class="mtk1">(result).to.</span><span class="mtk5">equal</span><span class="mtk1">(</span><span class="mtk6">&#39;0&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk5">it</span><span class="mtk1">(</span><span class="mtk6">&#39;Rounds to 2 decimal places&#39;</span><span class="mtk1">, () </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Given</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> prev </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;900&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> cur </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;1000&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// When</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">const</span><span class="mtk1"> result </span><span class="mtk7">=</span><span class="mtk1"> decimalUtil.</span><span class="mtk5">percentDiff</span><span class="mtk1">(prev, cur);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// Then</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk5">expect</span><span class="mtk1">(result).to.</span><span class="mtk5">equal</span><span class="mtk1">(</span><span class="mtk6">&#39;11.11&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  });</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">});</span></span></span></code></pre>
<p>Running the decimal util tests now will result in all of them failing because we haven't yet defined the function:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 657px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/892bf0fdcec84991ea71737850cde681/a1253/tdd-fail-4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 101.67427701674276%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAACiUlEQVQ4y42UaXLbMAyFfYomtbVQFmUt1L5ajqs4nU5z/xOhDyxpKx57Jj8+gSsIAo/ahFFMbT9QA2Sc0s71yfEDcjzxlN2Tvot9Gz8IqesGeptmaquGhC9ojwkmWFlh2j4ITdsSmnF2umHvARgxMIo9jTjgZOD2ZNoDOIIaa6xtzPoK1rMO+cMn8KLZTM7GES/mTSnIwAHrFGxkNrMTb5UefWXO187kwbWTsO6KLca2Zs32QQ7teh2hK0PyVUwijykIIwr28rrI4n4T7VAEeyqSlOokozA63KLkiA3ON9FX9pCntKhofr/QGSSqoB2fiFw5BneFHfMAK8QzbfdLlaG9uW5pHiaamo5ObU8T6MuajuiPoMahPdaUaUYzZFagn2O+qGqqMM96Zg1rhyFOyJG/hEEOC0yqQ0IlhF6BFH0mQUoykB+Qb0Rnr2mj01cWcJBD0PUwUoWofDj9sXPp1fE0L8b+tBZRsN2u4MhuVWa1ywOdzwst7x/UwGmGPKq8pDTLKWPQj1E0tpIjTRXFBoWrS9zmGiFfWYIJle6weVA5/ULEMzghP2fYCZs6OOthWzg+8mGw/PbZOQd0qzIrHxN8Cif2kbidlejXYw+vzKXPcPJpudDb8l82zkoiWkJYc5UOF4PnVs6/FEVXGVz6kZbjDMl0tHQ9HSGRU9MiBQXNGJtAi4PPKB6nwHvyivTPIeCHjxcjcbpEm+UTIy8slQxEUIJkQqnbMebFnWyuDlk2CgKt8IMtIVABRy93srE/D435WTzKq3bIHwknfz5+0+ffT2pQ1QYH1PwCcDVGYJNvEAbXFu7eoZYNGi1eQBknVMiIBkihBX2mdFvhiqlG6hdVIoAg2D+88j8SlDia3a/pFwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="tdd fail 4"
        title="tdd fail 4"
        src="/static/892bf0fdcec84991ea71737850cde681/a1253/tdd-fail-4.png"
        srcset="/static/892bf0fdcec84991ea71737850cde681/772e8/tdd-fail-4.png 200w,
/static/892bf0fdcec84991ea71737850cde681/e17e5/tdd-fail-4.png 400w,
/static/892bf0fdcec84991ea71737850cde681/a1253/tdd-fail-4.png 657w"
        sizes="(max-width: 657px) 100vw, 657px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Same drill as last time, first step to fix this is to define the function in the decimal util module and export it so it's visible:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="22"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/decimal-util.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> Decimal </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;decimal.js&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// other functions</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">percentDiff</span><span class="mtk1">(</span><span class="mtk10 mtki">prev</span><span class="mtk1">, </span><span class="mtk10 mtki">cur</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// Implementation TBD...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">module</span><span class="mtk1">.</span><span class="mtk9 mtki">exports</span><span class="mtk1"> </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// other functions...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  percentDiff,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">};</span></span></span></code></pre>
<p>Results of running the tests again at this point should surprise no one - they all fail comparing <code>undefined</code> to the expected calculation. Just like when we started the TDD process in the calculator module, an empty function implicitly returns undefined:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 646px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/3afcbbd8fbe99b8d32d408d2856d6546/27524/tdd-fail-5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 103.40557275541795%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACpUlEQVQ4y5WVaVLbQBCFdQ3bsvbd2jeMbSgXBEhy//t03hvNEEc4VcmPj26N2r2pe7DCOJFxPsr4cJS8rGXneJ/Yd3R7dX7L3vXFcrxA+n6UC5zO/SCRH0qEFyTQkvg3ZyQBsT6LNQxk0bNnOzI6rhxx+ACHJ3ABj+AIzmDW55Nm9ANpkAwlST3tkH8YkUZ01jJj/7dhr41TV+MtODojlklMOyybD3zpLkbKAC+M7mrj7Qp7hXFsOVEoXpWJV+cSppn4QbwY6SC2CfKPWMwgRakZSqW+3btfov8PlhdEcmg6uX57k5e3D6m7YSkBAf4K2wO5RmXIHzvIqm9aOWMWH4ZJurZXI9RWtYzQSY0ZHRC4LiupoDcIfKgaqfC7GucVoFM1NpylEpk2GPIqjKVMUhmyXLqsgCykTTIp41T6NJcCMsX7ENJZZaoyZMlpUUqGqMRBPzeYyw2yZj83GqNvzWZQh53Bvt2UGJGvL6/y9v5d5uNJPTNIguwMEbI0ktnRRtnlB4WLRD43JUS0EYdn9OGIvsx1K0/o2yP6c8HZI56HQyUnyPZQSodgOZ4zyAI9LVAZK1UOmaYP74HG5SpiO6iHMCJ87+tnpUO6sLlbso+PULWdnJ+vCt447KHaDmRubpKt7uNOc7sdhs9ddsCEcXm+PMk8zlJxHFBSi3Jz9I1jUuOMo1Oj7AqYEvernVY95NXTRrgX8eMOTW/RzxlMcDpBDjnOwYyeNbApoAewXztbVo/3H3Y4TBZ2ev1uy93d7LXZbTN3dx3yi72+f8j7j58y4KJlORFGgllQct3u3dx7c4msS+YFO6CcU9fLhD611PGhJqzeCeNzQAC2JYdjdUNDesrRctX9kaG6YJFlwo3BF1f/AqgTZJhpEsC1i7UeRvGX7MgvfnNVgAQCbZAAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="tdd fail 5"
        title="tdd fail 5"
        src="/static/3afcbbd8fbe99b8d32d408d2856d6546/27524/tdd-fail-5.png"
        srcset="/static/3afcbbd8fbe99b8d32d408d2856d6546/772e8/tdd-fail-5.png 200w,
/static/3afcbbd8fbe99b8d32d408d2856d6546/e17e5/tdd-fail-5.png 400w,
/static/3afcbbd8fbe99b8d32d408d2856d6546/27524/tdd-fail-5.png 646w"
        sizes="(max-width: 646px) 100vw, 646px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Now we can solve this by filling in the implementation for the <code>percentDiff</code> function:</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="23"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/decimal-util.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> Decimal </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;decimal.js&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// other functions</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">percentDiff</span><span class="mtk1">(</span><span class="mtk10 mtki">prev</span><span class="mtk1">, </span><span class="mtk10 mtki">cur</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevDec </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk7">new</span><span class="mtk1"> </span><span class="mtk5 mtku">Decimal</span><span class="mtk1">(prev);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> curDec </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk7">new</span><span class="mtk1"> </span><span class="mtk5 mtku">Decimal</span><span class="mtk1">(cur);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">const</span><span class="mtk1"> diff </span><span class="mtk7">=</span><span class="mtk1"> curDec.</span><span class="mtk5">minus</span><span class="mtk1">(prevDec);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> diff</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    .</span><span class="mtk5">dividedBy</span><span class="mtk1">(prevDec)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    .</span><span class="mtk5">mul</span><span class="mtk1">(</span><span class="mtk4">100</span><span class="mtk1">)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    .</span><span class="mtk5">toDecimalPlaces</span><span class="mtk1">(</span><span class="mtk4">2</span><span class="mtk1">, Decimal.ROUND_HALF_UP)</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    .</span><span class="mtk5">toString</span><span class="mtk1">();</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">module</span><span class="mtk1">.</span><span class="mtk9 mtki">exports</span><span class="mtk1"> </span><span class="mtk7">=</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk3">// other functions...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  percentDiff,</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">};</span></span></span></code></pre>
<p>And now all the decimal util tests pass:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 617px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/713e7a2ed61a530d78bde762b025d19e/bc962/tdd-pass.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 34.35980551053485%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA1ElEQVQoz51Qy3LCMAzMd9Qk8UNOHD9ShjsM/f+P2kqCMIyHXnpY21qtVpKHcXZIuSDXHVuukPg02X9jkGM/X3C7/+B6u2PdiiYm69Vc8Oktd88L1NBYB2oVbT/rtFupqO1bJ5Z3Lk0hzQpvQktivmleuMeGDSGuGMbJwXAHm1asKat4SRsjszgjckwsDAdoecX91Lry+Nx99gHEYusJ1gUt8iHCPznRHAYH+v8TbjhJgghfKertuFg6mnFWkXkTfzLo8ZgwEkzmFZb4MvyroJ+w534BnAnDmsDgE8AAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="tdd-pass"
        title="tdd-pass"
        src="/static/713e7a2ed61a530d78bde762b025d19e/bc962/tdd-pass.png"
        srcset="/static/713e7a2ed61a530d78bde762b025d19e/772e8/tdd-pass.png 200w,
/static/713e7a2ed61a530d78bde762b025d19e/e17e5/tdd-pass.png 400w,
/static/713e7a2ed61a530d78bde762b025d19e/bc962/tdd-pass.png 617w"
        sizes="(max-width: 617px) 100vw, 617px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>Now let's turn our attention back to the calculator module, recall we had changed it to use the decimal util module to clean up the percentage difference calculation.</p>
<pre class="grvsc-container gatsby-highlight monokai" data-language="js" data-index="24"><code class="grvsc-code"><span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// lib/calculator.js</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// This module is already imported because its used in other functions in the calculator module</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">const</span><span class="mtk1"> decimalUtil </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">require</span><span class="mtk1">(</span><span class="mtk6">&#39;./decimal-util&#39;</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk3">// other imports and functions...</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk9 mtki">function</span><span class="mtk1"> </span><span class="mtk5">calcYearlyDiff</span><span class="mtk1">(</span><span class="mtk10 mtki">expenseSummary</span><span class="mtk1">) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(expenseSummary).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">year</span><span class="mtk1">, </span><span class="mtk10 mtki">yearSummary</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> intYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk9">parseInt</span><span class="mtk1">(year, </span><span class="mtk4">10</span><span class="mtk1">);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevYear </span><span class="mtk7">=</span><span class="mtk1"> intYear </span><span class="mtk7">-</span><span class="mtk1"> </span><span class="mtk4">1</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    </span><span class="mtk7">if</span><span class="mtk1"> (</span><span class="mtk7">!</span><span class="mtk1">expenseSummary[prevYear]) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;N/A&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    } </span><span class="mtk7">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear </span><span class="mtk7">=</span><span class="mtk1"> {};</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk3">// NEW: Use decimal-util module for percentage diff calculation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      yearSummary.percentageDiffPreviousYear.total </span><span class="mtk7">=</span><span class="mtk1"> decimalUtil.</span><span class="mtk5">percentDiff</span><span class="mtk1">(expenseSummary[prevYear].total, yearSummary.total);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      </span><span class="mtk9 mtki">Object</span><span class="mtk1">.</span><span class="mtk5">entries</span><span class="mtk1">(yearSummary.average.byCategory).</span><span class="mtk5">forEach</span><span class="mtk1">(([</span><span class="mtk10 mtki">curCategory</span><span class="mtk1">, </span><span class="mtk10 mtki">curAvg</span><span class="mtk1">]) </span><span class="mtk9 mtki">=&gt;</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk9 mtki">const</span><span class="mtk1"> prevAvg </span><span class="mtk7">=</span><span class="mtk1"> expenseSummary[prevYear].average.byCategory[curCategory];</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        </span><span class="mtk7">if</span><span class="mtk1"> (</span><span class="mtk7">!</span><span class="mtk1">prevAvg) {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          yearSummary.percentageDiffPreviousYear[curCategory] </span><span class="mtk7">=</span><span class="mtk1"> </span><span class="mtk6">&#39;new category&#39;</span><span class="mtk1">;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        } </span><span class="mtk7">else</span><span class="mtk1"> {</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          </span><span class="mtk3">// NEW: Use decimal-util module for percentage diff calculation</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">          yearSummary.percentageDiffPreviousYear[curCategory] </span><span class="mtk7">=</span><span class="mtk1"> decimalUtil.</span><span class="mtk5">percentDiff</span><span class="mtk1">(prevAvg, curAvg);</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">        }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">      }); </span><span class="mtk3">// for each category average within year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">    }</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  }); </span><span class="mtk3">// for each year</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">  </span><span class="mtk7">return</span><span class="mtk1"> expenseSummary;</span></span></span>
<span class="grvsc-line"><span class="grvsc-source"><span class="mtk1">}</span></span></span></code></pre>
<p>At this point the calculator tests should pass since we've finished implementing the decimal util <code>percentDiff</code> function:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 749px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f97fe6b373c9e705332595fc7d9ecb56/5bb8b/tdd-pass-2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 23.49799732977303%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAAk0lEQVQY06WP2w7CIBBE+Q+w5bJciq0m2hij//9dI0tDvSTWBx9Oll3YGUbk/YQ8HqAtYdcbqE7/hTieZ1xvd5zmCygkdNqiN64aaOvWvsHz5z29zRghjYUvQgwLxpSR8ljPPg6FpVKI0GXBkq8CxvkKi3BtBkIRQfnFgX/DsRsc4bP/GVmmADmE6sKCW49fxb/xAOcxirTCMbJ2AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="tdd pass 2"
        title="tdd pass 2"
        src="/static/f97fe6b373c9e705332595fc7d9ecb56/5bb8b/tdd-pass-2.png"
        srcset="/static/f97fe6b373c9e705332595fc7d9ecb56/772e8/tdd-pass-2.png 200w,
/static/f97fe6b373c9e705332595fc7d9ecb56/e17e5/tdd-pass-2.png 400w,
/static/f97fe6b373c9e705332595fc7d9ecb56/5bb8b/tdd-pass-2.png 749w"
        sizes="(max-width: 749px) 100vw, 749px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>A quick note about the calculator module - since it's now delegating some of the functionality to the decimal-util module, the calculator tests function more like integration tests than unit tests because they're not isolated to just the one module. If this bothers you, you can introduce a mock to mock out the behavior of the decimal util module. I'm not a huge fan of this approach as it results in testing the implementation details rather than the actual output of the function. This is not strictly related to TDD so won't go into any more detail here, other than to say, I'm fine with having some of the tests more like integration tests. If in the future a bug gets introduced into decimal util that affects the calculator result, the calculator tests will fail which would be a good warning.</p>
<p>One more quick note about the calculator - eagle eyed readers may have observed that the <code>calcYearlyDiff</code> function modifies its input. Normally I wouldn't do this, especially in a large application where there could be many callers of this function and modifying the input would be unexpected. But for a small side project where the input is actually running through a series of transformations and isn't used anywhere else, I decided this was fine. A future refactor could first make a deep copy of the input, and then operate only on the copy. Since the test makes assertions on the returned result, it would still be expected to pass.</p>
<h2>Conclusion</h2>
<p>I hope this post has given you some ideas about how to get started with TDD. The TDD approach lends itself really well to cases where the exact requirements are known. I've found this to especially be the case with calculations, validations and transformation type code. Next time you're adding a new feature to a project, if you know exactly how the new feature should behave, try to write a test for it first.</p>
<style class="grvsc-styles">
  .grvsc-container {
    overflow: auto;
    position: relative;
    -webkit-overflow-scrolling: touch;
    padding-top: 1rem;
    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));
    padding-bottom: 1rem;
    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));
    border-radius: 8px;
    border-radius: var(--grvsc-border-radius, 8px);
    font-feature-settings: normal;
    line-height: 1.4;
  }
  
  .grvsc-code {
    display: table;
  }
  
  .grvsc-line {
    display: table-row;
    box-sizing: border-box;
    width: 100%;
    position: relative;
  }
  
  .grvsc-line > * {
    position: relative;
  }
  
  .grvsc-gutter-pad {
    display: table-cell;
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  .grvsc-gutter {
    display: table-cell;
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter::before {
    content: attr(data-content);
  }
  
  .grvsc-source {
    display: table-cell;
    padding-left: 1.5rem;
    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));
    padding-right: 1.5rem;
    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));
  }
  
  .grvsc-source:empty::after {
    content: ' ';
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }
  
  .grvsc-gutter + .grvsc-source {
    padding-left: 0.75rem;
    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);
  }
  
  /* Line transformer styles */
  
  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {
    content: ' ';
    position: absolute;
    width: 100%;
  }
  
  .grvsc-line-diff-add::before {
    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));
  }
  
  .grvsc-line-diff-del::before {
    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));
  }
  
  .grvsc-line-number {
    padding: 0 2px;
    text-align: right;
    opacity: 0.7;
  }
  
  .monokai {
    background-color: #272822;
    color: #f8f8f2;
  }
  .monokai .mtku {
    text-decoration: underline;
    text-underline-position: under;
  }
  .monokai .mtki { font-style: italic; }
  .monokai .mtk1 { color: #F8F8F2; }
  .monokai .mtk9 { color: #66D9EF; }
  .monokai .mtk12 { color: #CFCFC2; }
  .monokai .mtk3 { color: #75715E; }
  .monokai .mtk7 { color: #F92672; }
  .monokai .mtk6 { color: #E6DB74; }
  .monokai .mtk5 { color: #A6E22E; }
  .monokai .mtk10 { color: #FD971F; }
  .monokai .mtk8 { color: #F8F8F0; }
  .monokai .mtk4 { color: #AE81FF; }
  .monokai .grvsc-line-highlighted::before {
    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));
    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));
  }
</style></div></div><div style="margin-top:30px"><a class="all-link-module--all-link--3uPzS" href="/blog">All Articles</a></div></div><footer class="footer-module--container--2iXoO"><hr class="footer-module--sep--1iHNN"/><p class="footer-module--copy--7yIGn">All materials © Daniela Baron 2020</p><div class="footer-module--social--3cljd"><a href="https://twitter.com/DanielaMBaron" class="footer-module--footer-icon--2phyq"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a href="https://github.com/danielabar" class="footer-module--footer-icon--2phyq"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a href="https://codepen.io/danielabar" class="footer-module--footer-icon--2phyq"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M502.285 159.704l-234-156c-7.987-4.915-16.511-4.96-24.571 0l-234 156C3.714 163.703 0 170.847 0 177.989v155.999c0 7.143 3.714 14.286 9.715 18.286l234 156.022c7.987 4.915 16.511 4.96 24.571 0l234-156.022c6-3.999 9.715-11.143 9.715-18.286V177.989c-.001-7.142-3.715-14.286-9.716-18.285zM278 63.131l172.286 114.858-76.857 51.429L278 165.703V63.131zm-44 0v102.572l-95.429 63.715-76.857-51.429L234 63.131zM44 219.132l55.143 36.857L44 292.846v-73.714zm190 229.715L61.714 333.989l76.857-51.429L234 346.275v102.572zm22-140.858l-77.715-52 77.715-52 77.715 52-77.715 52zm22 140.858V346.275l95.429-63.715 76.857 51.429L278 448.847zm190-156.001l-55.143-36.857L468 219.132v73.714z"></path></svg></a><a href="https://www.linkedin.com/in/danielabaron/" class="footer-module--footer-icon--2phyq"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg></a></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/tdd-by-example/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-259f8badab9829128140.js"],"component---src-pages-404-js":["/component---src-pages-404-js-8ca39113c3eed1cf43be.js"],"component---src-pages-about-js":["/component---src-pages-about-js-e5413481af6451153bf0.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d136d8fa61ba2e95f4c2.js"],"component---src-templates-blog-list-js":["/component---src-templates-blog-list-js-0fd517719f7bdebe4c8c.js"],"component---src-templates-post-js":["/component---src-templates-post-js-6c8dc3de4250d0615bc4.js"]};/*]]>*/</script><script src="/component---src-templates-post-js-6c8dc3de4250d0615bc4.js" async=""></script><script src="/commons-b7f0eac7930a2fe953ac.js" async=""></script><script src="/252f366e-4b8dd868f7f9c2a7ee52.js" async=""></script><script src="/1bfc9850-5d16e0a00245e09d73c3.js" async=""></script><script src="/styles-89fd2ae28bdf06750a71.js" async=""></script><script src="/app-259f8badab9829128140.js" async=""></script><script src="/framework-95b680cb3190aa9bfe59.js" async=""></script><script src="/webpack-runtime-246df12a576c78d030e3.js" async=""></script></body></html>