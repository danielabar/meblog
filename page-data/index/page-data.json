{"componentChunkName":"component---src-pages-index-js","path":"/","result":{"data":{"allMarkdownRemark":{"totalCount":10,"edges":[{"node":{"id":"cc09b42e-b111-566f-889d-27d1a2345f9c","frontmatter":{"title":"Dockerize a Rails Application for Development","date":"September 2020","category":"rails"},"excerpt":"At work, I was recently tasked with Dockerizing a Rails monolith. This app has a React front end built with Webpacker, client sideâ€¦","html":"<p>At work, I was recently tasked with Dockerizing a Rails monolith. This app has a React front end built with Webpacker, client side dependencies managed with Yarn, runs background jobs with Active Job, and uses a MySQL database and Redis. The existing setup involved developers installing all dependencies on their laptops and took some non-trivial amount of time to get working. The goal of packaging everything with Docker was to make it easier and faster for new developers to get up and running. It was also important to ensure the project could still be run the \"old fashioned\" way, i.e. all dependencies installed directly on laptop. This was a hedge in case something was found that could not be made to work with Docker.</p>\n<h2>Development Workflow</h2>\n<p>Although there are many benefits to using Docker for development, there are also some challenges such as how to run tests? how to debug? In order for the Docker setup to be effective, it needs to cover the entire development workflow, including:</p>\n<ol>\n<li>Running the Rails app with changes to server side code made on host machine automatically reflected in container.</li>\n<li>Running one-time setup tasks such as applying the schema to database and populating it with <code>db/seeds.rb</code>.</li>\n<li>Running a Webpack dev server so that changes in client side code made on host machine are automatically compiled in container and browser is automatically refreshed to reflect these changes.</li>\n<li>Running a background job processor (this project uses Active Job, but Sidekiq could be used instead).</li>\n<li>Debugging with either a command line debugger (<code>binding.pry</code>) or an IDE such as VS Code.</li>\n<li>Running one off commands such as applying database migrations or running tests.</li>\n<li>Being able to access an interactive Rails console.</li>\n</ol>\n<p>This post will walk through the setup, to achieve each of the above workflows steps. A quick note first - this post assumes knowledge of Docker concepts such as Images, Containers and Volumes. For those unfamiliar or new to Docker, I recommend the <a href=\"https://www.pluralsight.com/courses/docker-deep-dive-update\">Docker Deep Dive</a> course on Pluralsight.</p>\n<h2>Introducing docker-compose</h2>\n<p>According to <a href=\"https://docs.docker.com/develop/develop-images/dockerfile_best-practices/\">Docker Best Practices</a>:</p>\n<blockquote>\n<p>Each container should have only one concern. Decoupling applications into multiple containers makes it easier to scale horizontally and reuse containers. For instance, a web application stack might consist of three separate containers, each with its own unique image, to manage the web application, database, and an in-memory cache in a decoupled manner.</p>\n</blockquote>\n<p>Looking at what's needed to run a Rails app (server, webpacker, MySQL, Redis, etc), it becomes clear that each of these is a separate concern, therefore should be run in a separate container. However, these containers will need to communicate with each other, and be coordinated such that they run at the appropriate time. For example, it would not make sense for the container that seeds the database to start running before the container that houses the MySQL database is available.</p>\n<p><a href=\"https://docs.docker.com/compose/\">Docker Compose</a> is a great tool to coordinate and synchronize multiple containers for this purpose. Here is a visual representation of what we will be creating:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/274cc9f675b6637bd48b37c8c0039759/efcdd/dockerize-rails.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAC4jAAAuIwF4pT92AAACTElEQVQ4y21T2W7bMBD0//9KX/peoEARpAhSpE3RBkFs6z4pitRFSrYke7qklMspgQXBJTk7uzu7OZ/POGNZZjdns8bpBKV7KKUwjtNyb95emFnTNEFrbc+bZjghKDqERY2Qt0ibEUl1RCZqxLxCKAbE1QFpTf76aM28ielN1c8mCjoKKqWkwCM2oj/BTUuUv26RxBm2rKdPClfXGW7vGHI1wi0P8MV7Mz7eTTavvu/Rdd0KqGf4XIGlBVKh4AnDYsDdg8DvJ4mkORLAEYFcjcDM7tFeqqUUBrCqKszzjI3UkwXZ8x47puAUGi7rICqJQlbwygG+PMALUnhhjqAaLahnGK6AbdtCCPHMkADlaIH2ZM+AZdWCiQb7vCWfQhxxRCFHQLUMKkNifGFY1zXyPF8AJaXsshZezOCz2qbnlz32xMZJuGWzTVsk1KSMgriUhZsU9o53RwvYNI21lxqGvIF++gOeZNgVPYJSw/dD+GFCqfUIya4en3CzDxAJjdrZovEcFPo1ZVPDV4aUkh8XiAjI1Mh0MW86ko+yjKN6wkMk8ZiQtKiecdEiIqnxbsTlsk0xEjANMYV2+UA6G/D9B8PPvyWS9rj6NTxqnOmwTzV3KdBzDd8KfQUcLEvzwaGU00bj67XAzb2RzWB9rmkWgS7yed/l/wPax4toA5qOTHZIpVrPBysfd2V4qcO3Y2hl4/DBysXYNtfIWo1Pn1N8+caQdgN2+SIpE9hbJ8V5mZQLwO4wI29HFHT5anSm+WX14YOf2bej/dMM8wfAf9aIJ70EoouMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker compose rails\"\n        title=\"Docker Compose Rails\"\n        src=\"/static/274cc9f675b6637bd48b37c8c0039759/5a190/dockerize-rails.png\"\n        srcset=\"/static/274cc9f675b6637bd48b37c8c0039759/772e8/dockerize-rails.png 200w,\n/static/274cc9f675b6637bd48b37c8c0039759/e17e5/dockerize-rails.png 400w,\n/static/274cc9f675b6637bd48b37c8c0039759/5a190/dockerize-rails.png 800w,\n/static/274cc9f675b6637bd48b37c8c0039759/c1b63/dockerize-rails.png 1200w,\n/static/274cc9f675b6637bd48b37c8c0039759/29007/dockerize-rails.png 1600w,\n/static/274cc9f675b6637bd48b37c8c0039759/efcdd/dockerize-rails.png 3450w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>In order to proceed with the next steps in this post, make sure <a href=\"https://docs.docker.com/get-docker/\">Docker</a> is installed, this installation also comes with docker-compose.</p>\n<h2>1. Run Rails with changes on host machine reflected in container</h2>\n<p>Start by creating a <code>Dockerfile</code> at the root of the project as follows. This particular project uses Ruby version 2.6.6 and is deployed on Debian Stretch. It's a good idea to have the base image be the same as the projects' production environment. This provides an early warning in case of environment issues such as something that works on a laptop (eg: Mac or Windows) but fails or behaves differently in production (eg: Linux).</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace this with your Ruby version and Linux flavor/version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:2.6.6-stretch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Package dependencies</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt-get update &amp;&amp; apt-get install -y curl build-essential gnupg mysql-client</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace with newer bundler version if using</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> gem install bundler --no-document -v </span><span class=\"mtk6\">&#39;1.17.3&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace this with your Node version if newer than 10.x, this is for client side tooling.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Install Node.js https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-debian-9</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> curl -sL https://deb.nodesource.com/setup_10.x -o nodesource_setup.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bash nodesource_setup.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt-get install -y nodejs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Skip this if your project uses npm instead of yarn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Install yarn https://linuxize.com/post/how-to-install-yarn-on-debian-9/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> echo </span><span class=\"mtk6\">&quot;deb https://dl.yarnpkg.com/debian/ stable main&quot;</span><span class=\"mtk1\"> | tee /etc/apt/sources.list.d/yarn.list</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt update</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt install -y yarn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ENV</span><span class=\"mtk1\"> PATH $(yarn global bin):$PATH</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Copy all project source to working directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">WORKDIR</span><span class=\"mtk1\"> /app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">COPY</span><span class=\"mtk1\"> . /app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Run server and client side builds. These steps are performed one time as part of the image build,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># so they don&#39;t need to be re-run each time a container is started.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle check || bundle install</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> yarn install --check-files</span></span></span></code></pre>\n<p>Next, create a <code>docker-compose.yml</code> file at the root of the project as follows. Note that the <code>web</code> service refers to the Dockerfile created previously:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># The main service that runs a Rails server</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">web</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">dockerfile</span><span class=\"mtk1\">: </span><span class=\"mtk6\">Dockerfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># This runs when container started as part of docker-compose up.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: </span><span class=\"mtk6\">bash -c &quot;rm -f tmp/pids/server.pid &amp;&amp; bundle exec rails s -b &#39;0.0.0.0&#39;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;redis&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount current directory as shared volume for development so that changes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># made to local code will reflect on app running on container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount a persistent docker volume in place of local node_modules directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># this prevents yarn (or npm) errors in case developer has also been running the app natively.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Expose port 3000 from container to host so can run http://localhost:3000 in browser on laptop.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3000:3000&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Used in database.yml to tell Rails where the database is.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">DB_HOST</span><span class=\"mtk1\">: </span><span class=\"mtk6\">db</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">REDIS_URL</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;redis://redis/&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run MySQL database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Replace with your MySQL version or refer to Postgres image if using.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">mysql:5.7</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Use a named volume so that changes to db state will persist even if container removed.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">db_data:/var/lib/mysql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If a MySQL database is also running on laptop, map 3306 in container to a different port on host,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># such as 3307. Otherwise can use &quot;3306:3306&quot; here. This is useful for connecting a SQL client from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># host machine to container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3307:3306&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;yes&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Replace with your app&#39;s database name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">MYSQL_DATABASE</span><span class=\"mtk1\">: </span><span class=\"mtk6\">appdb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Enable if required for development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># MYSQL_USERNAME: appdbuser</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># MYSQL_PASSWORD: appdbpassword</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run Redis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">redis</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">redis:3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If you&#39;re also running a Redis instance on host, map 6379 in container to a different port on host,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># such as 6380. Otherwise can use &quot;6379:6379&quot; here. This is useful for connecting a Redis client from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># host machine to container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;6380:6379&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># All named volumes referenced by services must be listed here.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db_data</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">node_modules</span><span class=\"mtk1\">:</span></span></span></code></pre>\n<p>Next, modify the application's <code>database.yml</code> file to tell Rails where the database is located:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">adapter</span><span class=\"mtk1\">: </span><span class=\"mtk6\">mysql2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Use DB_HOST environment variable if set, otherwise default to localhost,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># This ensures that project can still run the &quot;old fashioned&quot; way when everything</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># is installed directly on laptop.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">host</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&lt;%= ENV[&#39;DB_HOST&#39;] || &quot;127.0.0.1&quot; %&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Replace with your app&#39;s database name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">database</span><span class=\"mtk1\">: </span><span class=\"mtk6\">appdb</span></span></span></code></pre>\n<p>Next, open a terminal and run the following commands to build the app image, and run the containers:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose build</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose up</span></span></span></code></pre>\n<p>At this point, the containers should all start up (run <code>docker ps</code> to confirm), but the app won't work yet because the database schema has not been loaded. Hit <kbd>Ctrl</kbd> + <kbd>C</kbd> to stop the containers, then continue to next step.</p>\n<h2>2. Run one-time database setup</h2>\n<p>This project makes use of <code>db/seeds.rb</code> to initialize the database with some sample data, which should only run on first time setup. The solution is to use an ephemeral container, based on the app image to issue the <code>rake db:reset</code> command, if the <code>INIT_DBS</code> environment variable is set. This will drop the database if it already exists, then run <code>db:setup</code> which will create the database, load the schema (defined in <code>db/schema.rb</code> which gets populated every time a new migration is added), and run <code>db:seed</code> to populate the database.</p>\n<p>Aside: See this <a href=\"https://stackoverflow.com/a/10302357/3991687\">Stack Overflow Answer</a> for an explanation of what all the various <code>rake db:xxx</code> tasks do.</p>\n<p>One thing to watch out for, is that the <code>db:reset</code> command cannot run until the database is available to handle requests. We will use <a href=\"https://github.com/vishnubob/wait-for-it\">wait-for-it.sh</a> to solve this synchronization issue.</p>\n<p>Download <a href=\"https://github.com/vishnubob/wait-for-it\">wait-for-it.sh</a> from Github and place it in project root.</p>\n<p>Then modify <code>Dockerfile</code> so that this file is included in the image and made executable:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace this with your Ruby version and Linux flavor/version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:2.6.6-stretch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Package dependencies</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt-get update &amp;&amp; apt-get install -y curl build-essential gnupg mysql-client</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace with newer bundler version if using</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> gem install bundler --no-document -v </span><span class=\"mtk6\">&#39;1.17.3&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace this with your Node version if newer than 10.x, this is for client side tooling.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Install Node.js https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-debian-9</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> curl -sL https://deb.nodesource.com/setup_10.x -o nodesource_setup.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bash nodesource_setup.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt-get install -y nodejs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Skip this if your project uses npm instead of yarn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Install yarn https://linuxize.com/post/how-to-install-yarn-on-debian-9/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> echo </span><span class=\"mtk6\">&quot;deb https://dl.yarnpkg.com/debian/ stable main&quot;</span><span class=\"mtk1\"> | tee /etc/apt/sources.list.d/yarn.list</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt update</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt install -y yarn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ENV</span><span class=\"mtk1\"> PATH $(yarn global bin):$PATH</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">############## NEW SECTION TO ADD HERE #############################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Use wait-for-it.sh to control startup order of containers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">COPY</span><span class=\"mtk1\"> wait-for-it.sh /wait-for-it.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> chmod +x /wait-for-it.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">####################################################################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Copy all project source to working directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">WORKDIR</span><span class=\"mtk1\"> /app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">COPY</span><span class=\"mtk1\"> . /app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Run server and client side builds. These steps are performed one time as part of the image build,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># so they don&#39;t need to be re-run each time a container is started.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle check || bundle install</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> yarn install --check-files</span></span></span></code></pre>\n<p>Then modify <code>docker-compose.yml</code> to define a new <code>dbcmd</code> service. Note that it's based on the same app image as the <code>web</code> service, which means that when <code>docker-compose build</code> is run, it won't need to run a separate build for this service because it can re-use the same image that's already been built for the <code>web</code> service. For this to work, the <code>web</code> service definition is modified to name the image <code>app</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># The main service that runs a Rails server</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">web</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">dockerfile</span><span class=\"mtk1\">: </span><span class=\"mtk6\">Dockerfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">############### ADD THIS LINE HERE #####################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># name this image so it can be used by other containers without requiring a build</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># This runs when container started as part of docker-compose up.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: </span><span class=\"mtk6\">bash -c &quot;rm -f tmp/pids/server.pid &amp;&amp; bundle exec rails s -b &#39;0.0.0.0&#39;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;redis&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount current directory as shared volume for development so that changes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># made to local code will reflect on app running on container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount a persistent docker volume in place of local node_modules directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># this prevents yarn (or npm) errors in case developer has also been running the app natively.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Expose port 3000 from container to host so can run http://localhost:3000 in browser on laptop.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3000:3000&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Used in database.yml to tell Rails where the database is.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">DB_HOST</span><span class=\"mtk1\">: </span><span class=\"mtk6\">db</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">REDIS_URL</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;redis://redis/&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">############### ADD NEW SERVICE HERE #####################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Ephemeral container to issue rake db:reset command</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">dbcmd</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Use same image as `web` service to avoid multiple builds</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Make sure MySQL is up before attempting db population</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: [</span><span class=\"mtk6\">&quot;/wait-for-it.sh&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;db:3306&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;--&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;./docker-entrypoint-dbcmd.sh&quot;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">DB_HOST</span><span class=\"mtk1\">: </span><span class=\"mtk6\">db</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Usage to populate databases with seed data: INIT_DBS=yes docker-compose up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">INIT_DBS</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run MySQL database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Replace with your MySQL version or refer to Postgres image if using.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">mysql:5.7</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Use a named volume so that changes to db state will persist even if container removed.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">db_data:/var/lib/mysql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If a MySQL database is also running on laptop, map 3306 in container to a different port on host,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># such as 3307. Otherwise can use &quot;3306:3306&quot; here. This is useful for connecting a SQL client from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># host machine to container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3307:3306&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;yes&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Replace with your app&#39;s database name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">MYSQL_DATABASE</span><span class=\"mtk1\">: </span><span class=\"mtk6\">appdb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Enable if required for development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># MYSQL_USERNAME: appdbuser</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># MYSQL_PASSWORD: appdbpassword</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run Redis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">redis</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">redis:3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If you&#39;re also running a Redis instance on host, map 6379 in container to a different port on host,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># such as 6380. Otherwise can use &quot;6379:6379&quot; here. This is useful for connecting a Redis client from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># host machine to container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;6380:6379&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># All named volumes referenced by services must be listed here.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db_data</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">node_modules</span><span class=\"mtk1\">:</span></span></span></code></pre>\n<p>Also add <code>docker-entrypoint-dbcmd.sh</code> to project root which contains the database reset commands for the development and test databases:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sh\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#!/bin/sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">set</span><span class=\"mtk1\"> -e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">if</span><span class=\"mtk1\"> [ </span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">$INIT_DBS</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;yes&quot;</span><span class=\"mtk1\"> ]</span><span class=\"mtk7\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">then</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;=== INITIALIZING DATABASES&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  bin/rails db:environment:set RAILS_ENV=development </span><span class=\"mtk7\">&amp;&amp;</span><span class=\"mtk1\"> bundle </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> rake db:reset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  bin/rails db:environment:set RAILS_ENV=test </span><span class=\"mtk7\">&amp;&amp;</span><span class=\"mtk1\"> bundle </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> rake db:test:reset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">fi</span></span></span></code></pre>\n<p>Now run the build again (since the <code>Dockerfile</code> was modified) and bring up the containers with the <code>INIT_DBS</code> environment variable set to trigger database population:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose build</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">INIT_DBS=yes docker-compose up</span></span></span></code></pre>\n<p>Now open a browser and navigate to <a href=\"http://localhost:3000\">http://localhost:3000</a>, your app's homepage should load. It may be very slow due to webpacker compiling front end assets on demand, but not to worry, this will be resolved in the next step.</p>\n<p>Before moving on to next step, make sure that the <code>/app</code> bind mount is working by making a small change to the server side code on your laptop, then check that it's reflected in the <code>web</code> container. For example, add some logging to the <code>index</code> method of the main controller:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">index</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.logger.info(</span><span class=\"mtk6\">&quot;Hello from Docker!)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">  ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">end</span></span></span></code></pre>\n<p>Refresh the app in browser (assuming it's still on the main page) and watch the console output where <code>docker-compose up</code> is running, it should display <code>Hello from Docker!</code>.</p>\n<h2>3. Run Webpacker</h2>\n<p>The next step is to run a Webpack dev server in another container to watch for changes to front end assets, recompile them, and refresh the browser. This will greatly speed up page load time during development.</p>\n<p>But first, take a look at the <code>dev_server</code> section of <code>config/webpacker.yml</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">dev_server</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">https</span><span class=\"mtk1\">: </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">host</span><span class=\"mtk1\">: </span><span class=\"mtk6\">localhost</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">port</span><span class=\"mtk1\">: </span><span class=\"mtk4\">3035</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">...</span></span></span></code></pre>\n<p>In order for the Webpack dev server to work in a container, the host can no longer be <code>localhost</code>, instead it should be the container this service will be running in, which will be named <code>webpacker</code>. However, the goal is to also have this setup work in a non Docker environment, so it won't work to simply change it to <code>host: webpacker</code>. One would think that since this is a yaml file in Rails, ERB syntax is supported to make a similar change as was done in <code>database.yml</code>, for example something like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">dev_server</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">https</span><span class=\"mtk1\">: </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># DOES NOT WORK!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">host</span><span class=\"mtk1\">: </span><span class=\"mtk7\">host</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&lt;%= ENV[&#39;WEBPACK_HOST&#39;] || &quot;localhost&quot; %&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">port</span><span class=\"mtk1\">: </span><span class=\"mtk4\">3035</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">...</span></span></span></code></pre>\n<p>However, this particular yaml file is also used on the JavaScript side therefore ERB cannot be used. Fortunately, Webpacker has a solution for this, the <code>WEBPACKER_DEV_SERVER_HOST</code> environment variable can be specified when running Webpacker, which will override the <code>host</code> value in <code>config/webpacker.yml</code>. It should also be specified in the container running the Rails server.</p>\n<p>Modify <code>docker-compose.yml</code> to add a new <code>webpacker</code> service as shown below. Also note the change to the <code>web</code> container command to specify the <code>WEBPACKER_DEV_SERVER_HOST</code> environment variable.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># The main service that runs a Rails server</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">web</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">dockerfile</span><span class=\"mtk1\">: </span><span class=\"mtk6\">Dockerfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># name this image so it can be used by other containers without requiring a build</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">################ MODIFY COMMAND HERE ####################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># This runs when container started as part of docker-compose up.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: </span><span class=\"mtk6\">bash -c &quot;rm -f tmp/pids/server.pid &amp;&amp; WEBPACKER_DEV_SERVER_HOST=webpacker bundle exec rails s -b &#39;0.0.0.0&#39;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;redis&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount current directory as shared volume for development so that changes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># made to local code will reflect on app running on container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount a persistent docker volume in place of local node_modules directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># this prevents yarn (or npm) errors in case developer has also been running the app natively.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Expose port 3000 from container to host so can run http://localhost:3000 in browser on laptop.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3000:3000&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Used in database.yml to tell Rails where the database is.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">DB_HOST</span><span class=\"mtk1\">: </span><span class=\"mtk6\">db</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">REDIS_URL</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;redis://redis/&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Ephemeral container to issue rake db:reset command</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">dbcmd</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Use same image as `web` service to avoid multiple builds</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Make sure MySQL is up before attempting db population</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: [</span><span class=\"mtk6\">&quot;/wait-for-it.sh&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;db:3306&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;--&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;./docker-entrypoint-dbcmd.sh&quot;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">DB_HOST</span><span class=\"mtk1\">: </span><span class=\"mtk6\">db</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Usage to populate databases with seed data: INIT_DBS=yes docker-compose up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">INIT_DBS</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run MySQL database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Replace with your MySQL version or refer to Postgres image if using.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">mysql:5.7</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Use a named volume so that changes to db state will persist even if container removed.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">db_data:/var/lib/mysql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If a MySQL database is also running on laptop, map 3306 in container to a different port on host,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># such as 3307. Otherwise can use &quot;3306:3306&quot; here. This is useful for connecting a SQL client from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># host machine to container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3307:3306&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;yes&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Replace with your app&#39;s database name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">MYSQL_DATABASE</span><span class=\"mtk1\">: </span><span class=\"mtk6\">appdb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Enable if required for development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># MYSQL_USERNAME: appdbuser</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># MYSQL_PASSWORD: appdbpassword</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run Redis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">redis</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">redis:3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If you&#39;re also running a Redis instance on host, map 6379 in container to a different port on host,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># such as 6380. Otherwise can use &quot;6379:6379&quot; here. This is useful for connecting a Redis client from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># host machine to container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;6380:6379&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">############## ADD NEW SERVICE HERE ##################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run Webpack</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">webpacker</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: </span><span class=\"mtk6\">bash -c &quot;WEBPACKER_DEV_SERVER_HOST=webpacker ./bin/webpack-dev-server&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">3035:3035</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># All named volumes referenced by services must be listed here.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db_data</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">node_modules</span><span class=\"mtk1\">:</span></span></span></code></pre>\n<p>Now start the containers again (<code>docker-compose up</code>), give webpacker a few seconds to compile all front end assets, then open a browser and navigate to <a href=\"http://localhost:3000\">http://localhost:3000</a>. This time the home page should load quickly. Also make a change to some front end code on your laptop, save it, then watch the terminal where docker-compose is running. Webpack should pick up the change, recompile, and browser should refresh and the change should be visible.</p>\n<h2>4. Running background job processor</h2>\n<p>This project uses <a href=\"https://guides.rubyonrails.org/active_job_basics.html\">Active Job</a> with Delayed Job queuing backend, which uses the <code>delayed_job</code> table. As we've seen in previous sections, the job processor is a separate process therefore will run in its own container. However, because it depends on the existence of the <code>delayed_job</code> table, this introduces another synchronization issue with the database. The simplest solution would be to use <code>wait-for-it.sh</code> again, waiting for the database on port 3306. But this will fail on first time setup when the database is being seeded. Since the seeds take some time to run, its possible the database will be available, but the schema has not yet been applied therefore the <code>delayed_job</code> table doesn't exist yet.</p>\n<p>A custom wait wrapper can be used to solve this. Start by modifying the <code>docker-compose.yml</code> file to add a new <code>delayedjob</code> service:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># The main service that runs a Rails server</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">web</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">dockerfile</span><span class=\"mtk1\">: </span><span class=\"mtk6\">Dockerfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># name this image so it can be used by other containers without requiring a build</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># This runs when container started as part of docker-compose up.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: </span><span class=\"mtk6\">bash -c &quot;rm -f tmp/pids/server.pid &amp;&amp; WEBPACKER_DEV_SERVER_HOST=webpacker bundle exec rails s -b &#39;0.0.0.0&#39;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;redis&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount current directory as shared volume for development so that changes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># made to local code will reflect on app running on container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount a persistent docker volume in place of local node_modules directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># this prevents yarn (or npm) errors in case developer has also been running the app natively.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Expose port 3000 from container to host so can run http://localhost:3000 in browser on laptop.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3000:3000&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Used in database.yml to tell Rails where the database is.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">DB_HOST</span><span class=\"mtk1\">: </span><span class=\"mtk6\">db</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">REDIS_URL</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;redis://redis/&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Ephemeral container to issue rake db:reset command</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">dbcmd</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Use same image as `web` service to avoid multiple builds</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Make sure MySQL is up before attempting db population</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: [</span><span class=\"mtk6\">&quot;/wait-for-it.sh&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;db:3306&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;--&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;./docker-entrypoint-dbcmd.sh&quot;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">DB_HOST</span><span class=\"mtk1\">: </span><span class=\"mtk6\">db</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Usage to populate databases with seed data: INIT_DBS=yes docker-compose up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">INIT_DBS</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run MySQL database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Replace with your MySQL version or refer to Postgres image if using.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">mysql:5.7</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Use a named volume so that changes to db state will persist even if container removed.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">db_data:/var/lib/mysql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If a MySQL database is also running on laptop, map 3306 in container to a different port on host,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># such as 3307. Otherwise can use &quot;3306:3306&quot; here. This is useful for connecting a SQL client from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># host machine to container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3307:3306&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;yes&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Replace with your app&#39;s database name</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">MYSQL_DATABASE</span><span class=\"mtk1\">: </span><span class=\"mtk6\">appdb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Enable if required for development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># MYSQL_USERNAME: appdbuser</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># MYSQL_PASSWORD: appdbpassword</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run Redis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">redis</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">redis:3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If you&#39;re also running a Redis instance on host, map 6379 in container to a different port on host,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># such as 6380. Otherwise can use &quot;6379:6379&quot; here. This is useful for connecting a Redis client from</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># host machine to container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;6380:6379&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Run Webpack</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">webpacker</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: </span><span class=\"mtk6\">bash -c &quot;WEBPACKER_DEV_SERVER_HOST=webpacker ./bin/webpack-dev-server&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">3035:3035</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">############## ADD NEW SERVICE HERE ##################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">delayedjob</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Make sure delayed_jobs table has been created before starting jobs processing</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: [</span><span class=\"mtk6\">&quot;/wait-for-mysql.sh&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;db&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;./docker-entrypoint-delayedjob.sh&quot;</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;web&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;dbcmd&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">DB_HOST</span><span class=\"mtk1\">: </span><span class=\"mtk6\">db</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># All named volumes referenced by services must be listed here.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db_data</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">node_modules</span><span class=\"mtk1\">:</span></span></span></code></pre>\n<p>Create a new file in project root named <code>delayed_job.sql</code>, this simply queries the <code>delayed_job</code> table:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">select</span><span class=\"mtk1\"> </span><span class=\"mtk7\">*</span><span class=\"mtk1\"> </span><span class=\"mtk7\">from</span><span class=\"mtk1\"> delayed_jobs;</span></span></span></code></pre>\n<p>Then create a new file in project root named <code>wait-for-mysql.sh</code>. Notice the way it gets invoked from the compose file, the first argument will be the host, in this case the <code>db</code> service to query. Then it enters a loop, invoking <code>mysql</code> client with the <code>delayed_job.sql</code> file. The <code>mysql</code> client is installed on the image as part of the <code>Dockerfile</code>. If the table exists, this will return 0 (i.e. success) and exit the loop. Otherwise, it sleeps for 3 seconds, then tries again. Upon successful exit of the loop, it then runs whatever command the script was called with as its remaining arguments. In our case, <code>docker-entrypoint-delayedjob.sh</code>, which will be created in the next step.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#!/bin/sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># wait-for-mysql.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># https://docs.docker.com/compose/startup-order/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">host=</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">$1</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">shift</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">cmd=</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">$@</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">while</span><span class=\"mtk1\"> </span><span class=\"mtk9\">true</span><span class=\"mtk7\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  mysql -h </span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">$host</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\"> -u root appdbpswd </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> /delayed_job.sql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> [ $? </span><span class=\"mtk7\">-eq</span><span class=\"mtk1\"> 0 ]</span><span class=\"mtk7\">;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">then</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9\">break</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">fi</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">&gt;&amp;2</span><span class=\"mtk1\"> </span><span class=\"mtk9\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;MySQL delayed_jobs table is UNAVAILABLE - sleeping&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  sleep 3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">done</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">&gt;&amp;2</span><span class=\"mtk1\"> </span><span class=\"mtk9\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;MySQL delayed_jobs table is AVAILABLE - executing command&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">exec</span><span class=\"mtk1\"> $cmd</span></span></span></code></pre>\n<p>Add another file <code>docker-entrypoint-delayedjob.sh</code> in project root, which simply starts the Active Job processor:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#!/bin/sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">set</span><span class=\"mtk1\"> -e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;=== RUNNING DELAYED JOBS&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> rails jobs:work</span></span></span></code></pre>\n<p>One final change required to make this all work is to modify the <code>Dockerfile</code> to add these additional files and make them executable.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace this with your Ruby version and Linux flavor/version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:2.6.6-stretch</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Package dependencies</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt-get update &amp;&amp; apt-get install -y curl build-essential gnupg mysql-client</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace with newer bundler version if using</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> gem install bundler --no-document -v </span><span class=\"mtk6\">&#39;1.17.3&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace this with your Node version if newer than 10.x, this is for client side tooling.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Install Node.js https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-debian-9</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> curl -sL https://deb.nodesource.com/setup_10.x -o nodesource_setup.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bash nodesource_setup.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt-get install -y nodejs</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Skip this if your project uses npm instead of yarn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Install yarn https://linuxize.com/post/how-to-install-yarn-on-debian-9/</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> echo </span><span class=\"mtk6\">&quot;deb https://dl.yarnpkg.com/debian/ stable main&quot;</span><span class=\"mtk1\"> | tee /etc/apt/sources.list.d/yarn.list</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt update</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> apt install -y yarn</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ENV</span><span class=\"mtk1\"> PATH $(yarn global bin):$PATH</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Use wait-for-it.sh to control startup order of containers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">COPY</span><span class=\"mtk1\"> wait-for-it.sh /wait-for-it.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> chmod +x /wait-for-it.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">############## NEW COMMANDS TO ADD HERE #############################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">COPY</span><span class=\"mtk1\"> wait-for-mysql.sh /wait-for-mysql.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> chmod +x /wait-for-mysql.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">COPY</span><span class=\"mtk1\"> delayed_job.sql /delayed_job.sql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">####################################################################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Copy all project source to working directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">WORKDIR</span><span class=\"mtk1\"> /app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">COPY</span><span class=\"mtk1\"> . /app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Run server and client side builds. These steps are performed one time as part of the image build,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># so they don&#39;t need to be re-run each time a container is started.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle check || bundle install</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> yarn install --check-files</span></span></span></code></pre>\n<p>Now if the database has not been seeded, and the containers are started, the console will display several <code>MySQL delayed_jobs table is UNAVAILABLE - sleeping</code>. Then when the <code>dbcmd</code> service has finished seeding the database, shortly after the compose console should display <code>MySQL delayed_jobs table is AVAILABLE - executing command</code>, then the Active Job processor should start up. Remember to run a build first as the <code>Dockerfile</code> wss modified:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose build</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">INIT_DBS=yes docker-compose up</span></span></span></code></pre>\n<h2>5. Debugging</h2>\n<p>At this point, all app services are fully functional. However, we also need the ability to debug (i.e. step through the code one line at a time, inspecting variables). There are two ways to do this depending on the developers preference - either via command line with <a href=\"https://github.com/pry/pry\">binding.pry</a>, or with an IDE such as VS Code.</p>\n<h3>Command line debugging</h3>\n<p>First add <a href=\"https://github.com/pry/pry\">pry</a> and <a href=\"https://github.com/deivid-rodriguez/pry-byebug\">pry-byebug</a> to the <code>Gemfile</code>, then run <code>docker-compose build</code> to update the app image with these installed gems.</p>\n<p>Given that the <code>pry</code> is available, the line <code>binding.pry</code> can be inserted anywhere in a running Ruby program, which will suspend execution and open an interactive <code>pry</code> session. From there, variable values can be inspected, expressions can be evaluated, basically anything that could be done in pry.</p>\n<p>To make this work in a Docker container, add the following two properties to the <code>web</code> service definition in <code>docker-compose.yml</code>. The code below only shows the web service portion of the file:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># The main service that runs a Rails server</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">web</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">dockerfile</span><span class=\"mtk1\">: </span><span class=\"mtk6\">Dockerfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># name this image so it can be used by other containers without requiring a build</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># This runs when container started as part of docker-compose up.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: </span><span class=\"mtk6\">bash -c &quot;rm -f tmp/pids/server.pid &amp;&amp; WEBPACKER_DEV_SERVER_HOST=webpacker bundle exec rails s -b &#39;0.0.0.0&#39;&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;redis&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount current directory as shared volume for development so that changes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># made to local code will reflect on app running on container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Mount a persistent docker volume in place of local node_modules directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># this prevents yarn (or npm) errors in case developer has also been running the app natively.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Expose port 3000 from container to host so can run http://localhost:3000 in browser on laptop.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3000:3000&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">################# ADD THESE TWO PROPERTIES ################################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Keep the stdin open to support attaching to app containers process for binding.pry</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">tty</span><span class=\"mtk1\">: </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Allow for sending signals (CTRL+C, CTRL+P + CTRL+Q) into the container</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">stdin_open</span><span class=\"mtk1\">: </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">###########################################################################</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># Used in database.yml to tell Rails where the database is.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">DB_HOST</span><span class=\"mtk1\">: </span><span class=\"mtk6\">db</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">RAILS_ENV</span><span class=\"mtk1\">: </span><span class=\"mtk6\">development</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">REDIS_URL</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;redis://redis/&quot;</span></span></span></code></pre>\n<p>Restart the containers with these new properties set, then add <code>binding.pry</code> to any section of code to be inspected, for example, the <code>index</code> method in home controller:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">index</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9\">binding</span><span class=\"mtk1\">.pry</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p>Then open a new terminal and <code>attach</code> to the running <code>web</code> container. You'll need the name of the container to do this, first run <code>docker ps</code>, it will be named after the directory compose is running in. For example, if you're in a directory named <code>myproject</code>, then the <code>web</code> container name will be <code>myproject_web_1</code>. To attach to it, run the following:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker attach myproject_web_1</span></span></span></code></pre>\n<p>This will display the console output of the <code>web</code> container. It may display nothing at the moment because there's no activity. Let's change that. On your laptop, open a browser and navigate to your project's home page (or any page that will exercise the code where <code>binding.pry</code> was added earlier). Keep an eye on the terminal where the <code>attach</code> command is running. It will now show the console output, AND pause execution at the line where <code>binding.pry</code> was added, and open an interactive pry session. Go ahead and inspect variables.</p>\n<p>When finished, type <code>exit</code> to end <code>pry</code>. Do NOT use <kbd>Ctrl</kbd> + <kbd>C</kbd> to end the attach session because that will cause the process (rails server) in the container to end, which causes the container to exit. Instead, use the detach sequence <kbd>Ctrl</kbd> + <kbd>P</kbd> + <kbd>Q</kbd>.</p>\n<h3>IDE Debugging</h3>\n<p>This is a little more complicated than command line debugging because the Rails server needs to be started in a different way, with some additional ports exposed. To start, make sure the <a href=\"https://github.com/ruby-debug/ruby-debug-ide\">rdebug-ide</a> gem is included in the Gemfile. If it's not, add it, then run <code>docker-compose build</code>.</p>\n<p>Then add a new file to project root named <code>docker-compose.debug.yml</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">web</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">command</span><span class=\"mtk1\">: </span><span class=\"mtk6\">bash -c &quot;rm -f tmp/pids/server.pid &amp;&amp; WEBPACKER_DEV_SERVER_HOST=webpacker bundle exec rdebug-ide --debug --host 0.0.0.0 --port 1234 -- bin/rails s -p 3000 -b 0.0.0.0&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">depends_on</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;db&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;redis&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;webpacker&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">node_modules:/app/node_modules</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># IDE debug</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;1234:1234&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;26166:26168&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;26162:26162&quot;</span></span></span></code></pre>\n<p>Now run the containers with the debug file specified as an override. What this will do is override the definition of the <code>web</code> service in <code>docker-compose.yml</code> with the version in <code>docker-compose.debug.yml</code>.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose -f docker-compose.debug.yml up</span></span></span></code></pre>\n<p>Since the <code>command</code> is running <code>rdebug-ide</code>, the rails server won't start as it usually does, but rather, it's waiting for an IDE debugger to be attached. to do that, open your project in VS Code, click on the Run button from the sidebar as shown below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 448px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/76e3e90dd8376678ac4dc25c2b3b458e/33b38/vscode-run.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 110.71428571428572%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAADO0lEQVQ4y4VU2VYbWRDzF0wO9O7e933xgoGB4LCGkzzk/79GUd0GDyaBedC5DbetlkpVteiHCWe7C5yc6oiSDFXdoRtWcP2Q/9NgmDZ0w1IwXs73kHcse6meF0K2PTuH7bgoqwZdPxGjIs7yEj6J/SBCQLiER/h/QRDGcL0AC2HXdAtZVmC/v8X35x+4v3/i+ROPj88YSS4fqInLrsWm69F1A/p3GEQEBS08KojiBElW4vJqj3uS7O+e1PPVzS0u9g/omg6PbYWHrkHbjWi6iRgPqOWks7xqsVi6PhxKNfwMlp/i6S7HtD3D9O8t+t01vo4r/Npu0KQF/rED6MtQwfRiWF5CzKfpRbCjAgvTcmDarnrJMUzUto60qHA+jngsEtxSVUM7ed2iJoqyZn1bLF0Pum4yEGuGbpA4wiJn4ZO8gu7w6yT34xpfiww/hhZlkiKte9oaULfzOa62yIuaIpYwRMwLhFTULuRLhuPhyzJCYdsYVtfYtR3G7TmqlgTTGqvNDgNPaaeibGCxIzSqm4ns+TReCOUyZuzPnom1Y8KtJqVqnDbIaU9C6FnHOYABUnNV96V3IDsi/HZ3j6vLK6pzlOXvpY+2rObUaK1qaJVKS6khbbfSRhyGKM4OKo8IgzCCKZadCI5l4ybzVZtM6zPUJBvGtXoWu+Nqo+yvtzt1Fuw7mY4jQqlhmOQw3VBdfKm2yNhPMpJiVaZFfiSTJOMl5+vzX2vY0oY0pGb76iWtuUFWtmoEpWYygmLvVDMOc/sWf1iWOmgGL11a5wurwUfTNLR0zmQ3VLlWAaUczSUH4NXiexwIkzSnogYa+1AIv/U62qZmzdYqgIr1lFYRpbIA/pewH5gaVZxYHhwm/cDpqIo5ZUlXCKM4VevtUK93do8ITzUdJ9w2Ytlmyhcp26ZplV0hFMiefN15/03GB4RZXqhtccrBF8Jrtk3JZGsSZRxJ6T8JR2ZY1ZvhvFX6B6HHQgdMUXdCWLyI0krVTBS2tC2QYKQPpcnlTiblQ4VCYjn+vJJk3TMcP4gR02bMwMIoQUCov9mvIesp4/qpZQlgTtlSkCSVvQ/wqWXbWcJxgxeF1tFK+gwfKfwNlPhhpn+FpNcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"VS Code run\"\n        title=\"VS Code run\"\n        src=\"/static/76e3e90dd8376678ac4dc25c2b3b458e/33b38/vscode-run.png\"\n        srcset=\"/static/76e3e90dd8376678ac4dc25c2b3b458e/772e8/vscode-run.png 200w,\n/static/76e3e90dd8376678ac4dc25c2b3b458e/e17e5/vscode-run.png 400w,\n/static/76e3e90dd8376678ac4dc25c2b3b458e/33b38/vscode-run.png 448w\"\n        sizes=\"(max-width: 448px) 100vw, 448px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Then add the following configuration to <code>launch.json</code>. If this file hasn't been created, click on <code>create a launch.json file</code> link in the <code>Run</code> panel.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"23\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;name&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Attach to Docker&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Ruby&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;request&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;attach&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;remotePort&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;1234&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;remoteHost&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;0.0.0.0&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;remoteWorkspaceRoot&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;/app&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;cwd&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;${workspaceRoot}&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;showDebuggerOutput&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>After this is added, <code>Attach to Docker</code> will show up in the dropdown menu at the top of the Run panel. Click on the green triangle to run it. This will attach to the Rails server via rdebug-ide on port <code>1234</code>.</p>\n<p>Then add breakpoints in VS Code, navigate to a page in your browser to exercise that code, and VS Code will suspend at that point in the Debugger.</p>\n<h2>6. Run one-off commands such as migrations or tests</h2>\n<p>To run commands such as migrations or tests, the <code>docker-compose run</code> command will be used. This will start up another container based on the service specified (<code>web</code>), overriding the <code>command</code> in the compose file with a provided command. Use the <code>--no-deps</code> option to tell compose not to also start up this service's dependent containers and the <code>--rm</code> option to have this temporary container removed after the command is finished.</p>\n<p>To run migrations: (if you use a rake task, replace the command in quotes with your command)</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"24\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose run --no-deps --rm web bash -c </span><span class=\"mtk6\">&quot;bin/rails db:migrate RAILS_ENV=development&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose run --no-deps --rm web bash -c </span><span class=\"mtk6\">&quot;bin/rails db:migrate RAILS_ENV=test&quot;</span></span></span></code></pre>\n<p>A similar technique is used to run tests. Use <code>-e</code> option to override the services' <code>RAILS_ENV: development</code> environment variable to <code>test</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"25\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose run -e RAILS_ENV=test --no-deps --rm web bash -c </span><span class=\"mtk6\">&quot;bundle exec rspec&quot;</span></span></span></code></pre>\n<p>More generally, this technique can be used for any command to run against the Rails environment. Anywhere you would have opened a new terminal tab at the project root and run a command, place that command in the quotes:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"26\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose run --no-deps --rm web bash -c </span><span class=\"mtk6\">&quot;your command here&quot;</span></span></span></code></pre>\n<h2>7. Rails Console</h2>\n<p>Last thing that's needed to complete the development workflow is to have access to an interactive Rails console. Turns out this is simple, use the same technique as in the previous section to run a command against a temporary container from the same image as <code>web</code>. Except this time, since the Rails console is interactive, you will be in a shell in the container until exiting <kbd>Ctrl</kbd> + <kbd>D</kbd>, at which point the container will be removed:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"27\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose run --no-deps --rm web bash -c </span><span class=\"mtk6\">&quot;bundle exec rails c&quot;</span></span></span></code></pre>\n<h2>Conclusion</h2>\n<p>Phew, that was a lot of work, but well worth it to have a complete development workflow in Docker. This took me several weeks of work to figure out all the details but hopefully will save you some time if you're looking to Dockerize your Rails setup.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk12 { color: #CFCFC2; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/dockerize-rails-app-for-dev-debug-and-testing/"}}},{"node":{"id":"89e4e716-bc62-5eed-b6e4-7803c7221d77","frontmatter":{"title":"VS Code Shell Integration","date":"September 2019","category":"vscode"},"excerpt":"Today I'm going to share a simple technique for making it easier and faster to open projects or individual files with VS Code, using yourâ€¦","html":"<p>Today I'm going to share a simple technique for making it easier and faster to open projects or individual files with <a href=\"https://code.visualstudio.com/\">VS Code</a>, using your terminal instead of the VS Code editor. By default, the process for opening a folder or file goes something like this:</p>\n<ol>\n<li>Launch VS Code (clicking on it from Desktop, Dock, Applications Folder or Alfred)</li>\n<li>Click on <code>File</code> -> <code>Open</code> from the menu</li>\n<li>Navigate the folder structure in the resulting popup window until the desired file or folder is reached</li>\n<li>Double-click on the file/folder</li>\n<li>The content is now displayed in VS Code</li>\n</ol>\n<p>Phew, that's actually a lot of work - all that mouse movement is tedious and slow. Fortunately there is a faster and simpler way by enabling Shell Integration. Here's how to do it:</p>\n<p>Enter <kbd>Cmd</kbd> + <kbd>Shift</kbd> + <kbd>P</kbd> (or <kbd>Ctrl</kbd> for Windows users) to bring up the Command Palette. Start typing in the word \"shell\" and select the option <code>Shell Command: Install 'code' command in PATH</code>, it should look something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 460px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ce65ad94f0f91eb36416b9564b9591c/08a84/vscode-command-palette-shell-integration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.95652173913043%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABrklEQVQoz12Q2XqiQBCFfQAVDSoCogFk643NjRHU0eRirvP+z3Km6IkzyVz83ym66VN1ahDJGj8ev3C6PpDXRygi3z31pFU9VXPQWuwb/R8vdt8YuGkF4/SB9HhHd7mivT1wOl/QdDecr3c0LZ21HZpzh8v9Hd3Pdxzp/kJaHxqsXkOsgwhrv2eLwcYPUfSdixpC5qhogqLaIWWC6j0yVcNsPjDnLWzLguu4cJY2HGcF+yu2S+qS4eYVVa7AGEeSCWRMIidzJnIwLslYImAlElpNkjJMWIcRv8E055oXYja3MF8sNQMrSDEr3uALmirNtEHGlZ6QCaW/UzLKOYfgAj6vEcgD/GBLRNRUwdv42mxh2RjYlN2t3xDJHZQqKO4enKL39LUSkuoCq/qBsDyjLiuUPbSOmBr5Ib1frf8Zet4GhRCQZJBRRJlXyMsdpCohqEFcd/Bkg3HWwopLBDRZsE0QJwyO6+nIT7M/E9JhRJd9t22U6gjhNtbmcZJhyjsY2RkL8wVz04Q5W2ieu1tYy7/70zs0JlMMR+NvjL7UxnAIYzTE2Jh+MtEYn/o/vwHu/gM80WbLZwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"vscode command palette shell integration\"\n        title=\"vscode command palette shell integration\"\n        src=\"/static/7ce65ad94f0f91eb36416b9564b9591c/08a84/vscode-command-palette-shell-integration.png\"\n        srcset=\"/static/7ce65ad94f0f91eb36416b9564b9591c/772e8/vscode-command-palette-shell-integration.png 200w,\n/static/7ce65ad94f0f91eb36416b9564b9591c/e17e5/vscode-command-palette-shell-integration.png 400w,\n/static/7ce65ad94f0f91eb36416b9564b9591c/08a84/vscode-command-palette-shell-integration.png 460w\"\n        sizes=\"(max-width: 460px) 100vw, 460px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Then, quit VS Code, and open a terminal (if terminal was already open, it may need to be closed and restarted or source your profile for the changes to take effect).</p>\n<p>Now in your terminal, you can type in <code>code .</code> in any directory and it will open VS Code with that folder open. You can also type <code>code /path/to/file</code> and it will open just that file in VS Code. For example:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">pwd</span><span class=\"mtk1\"> </span><span class=\"mtk3\"># /some/folder</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">code </span><span class=\"mtk9\">.</span><span class=\"mtk1\"> </span><span class=\"mtk3\"># open /some/folder in VS Code</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">code </span><span class=\"mtk7\">~</span><span class=\"mtk1\">/projects/meblog </span><span class=\"mtk3\"># open my blog project in VS Code</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">code </span><span class=\"mtk7\">~</span><span class=\"mtk1\">/.zshrc </span><span class=\"mtk3\"># open my profile in VS Code</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">code </span><span class=\"mtk3\"># open an &quot;empty&quot; VS Code</span></span></span></code></pre>\n<p>If VS Code is already open at the time the <code>code</code> command is used, there's a few more options available:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">code -n /path/to/file_or_folder </span><span class=\"mtk3\"># open file_or_folder in a NEW VS Code window</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">code -r /path/to/file_or_folder </span><span class=\"mtk3\"># open file_or_folder in a EXISTING VS Code window</span></span></span></code></pre>\n<p>Also, the <code>code</code> command supports a number of other options, to see them all:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">code -h </span><span class=\"mtk3\"># list all options</span></span></span></code></pre>\n<p>As for how this works under the hood, the implementation details may vary by OS and VS Code version. On my computer, it adds a symlink <code>/usr/local/bin/code</code> to the Application folder where the VS Code binary is located. And since <code>/usr/local/bin</code> is in the <code>$PATH</code> environment variable defined in my profile, then typing <code>code</code> in a shell will automatically launch VS Code.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/vscode-shell-integration/"}}},{"node":{"id":"a9ac7d05-43cc-5fe8-9ccb-d613659ec2b6","frontmatter":{"title":"Is a Career in Software Development Right for You?","date":"September 2019","category":"career"},"excerpt":"A career in software development can be very rewarding. Being able to build things that are used in the real world and helping people isâ€¦","html":"<p>A career in software development can be very rewarding. Being able to build things that are used in the real world and helping people is amazing. It can be a surprisingly creative field. It's generally well compensated and most jobs come with good benefits such as health/dental, paid vacation, etc. At the time of this writing, demand for developers far outweighs supply, so employment opportunities are very good (although there can be instability within specific companies or even industries).</p>\n<p>A few years ago a \"Learn to Code\" movement started, encouraging everyone to learn how to program, kind of as a type of literacy. While I believe very strongly that anyone can learn to code, not everyone will necessarily enjoy it enough to want to make it their 9-5 career. So how do you know if its right for you? Over my years as a software developer, I've observed a number of characteristics among myself and colleagues that make up the \"programmer brain\". In this post, I'll go over these so you can decide for yourself if this is something you might like to try.</p>\n<h2>1. Super Math Genius (NOT!)</h2>\n<p>First, let's get a common misconception out of the way. You do not need to be a super genius or have a PhD in mathematics to be a successful programmer. Well maybe if your goal is to work at NASA on a rocket guidance system... But seriously, aside from some specific areas such as computer graphics and animation which require a solid understanding of linear algebra and trigonometry, for most jobs this simply isn't required (not covering AI or Machine Learning in this post as those are completely different areas outside of my expertise). Being logical however, is definitely a must. Some of the most common concepts a programmer encounters are conditionals, as in \"if something is true, then do task A, otherwise, do task B\".</p>\n<h2>2. Curiosity</h2>\n<p>While this may have killed the cat, curiosity most certainly benefits programmers. Being curious about how something works, \"what's under the hood\" so to speak is a good quality to have. For example, if you're reading some code and there's a function call you've never seen before, inspect into it to see what it does. If it's part of the language API, go ahead and look it up in the documentation. Curiosity ensures developers are always learning something new about the code they're working with. If you find yourself frequently asking \"why\" or doing some research on how something works, this is a good sign that you're curious.</p>\n<h2>3. Persistence</h2>\n<p>In programming, code rarely runs exactly right the first time. It may run but not produce the expected result, or it may encounter a runtime error. These error messages can sometimes be helpful in pointing to where the problem lies, or sometimes may be red herrings leading to hours of work trying to solve. Persistence is a useful quality to have here to keep at it, working through the problem until its resolved. If you find that you don't give up easily when facing problems, this is a good sign that you're persistent.</p>\n<h2>4. Analytical</h2>\n<p>Persistence without an equal amount of analytical skills however, leads to insanity. Quite literally, the definition of insanity is doing the same thing over and over while expecting a different result. So to make that persistence useful, you need to apply analytic reasoning to the problem. For example, read the error message carefully, then make one modification to the code to try and address the issue, then run the code again. Does the same error result? Or a different error? Try a different change to the code, or start a debug session, or maybe a unit test to verify your understanding of the code. Or maybe the current function you're working on is too large to understand, try breaking it down smaller to isolate just the problem code. This is analytical thinking and is definitely required for programming.</p>\n<h2>5. Not easily frustrated</h2>\n<p>In software development, things rarely work correctly the first time, and require multiple iterations to get right. That's why persistence and analytical skills are so useful. But what's also important is how you feel during this very typical cycle. Some people will interpret the repeated run/debug cycle as a fun challenge or puzzle to figure out. For example, if some code was resulting in an error message, then making a small modification results in a different error message - that's actually progress and something to feel good about. And when it does finally work, a happy dance could be totally appropriate! Others may feel frustrated or exasperated with how much effort it can take to make even seemingly simple things work. Think back to the last time you had to solve a difficult problem - did it feel satisfying to step up to the challenge and solve it or did you want to tear your hair out? This feeling will be encountered frequently in software development.</p>\n<h2>6. Detail Oriented</h2>\n<p>Programming is all about the details, lots and lots of details. Of course there's bigger picture thinking as well especially when it comes to architecture and design, but when it comes to the hands-on work of programming, there are many details involved. For example, leaving off the <code>.</code> in css can make a difference between a style being applied or the css being invalid. In JavaScript, one extra equals sign, as in the difference between <code>==</code> and <code>===</code> can be significant. If you care about getting the small details right and always put effort into this, then you're detail oriented.</p>\n<h2>7. Optimizer</h2>\n<p>One principle that comes up frequently in software development is \"could we do better?\". There may be some code that solves the problem, but there's always room for improvement. For example, maybe the way it's currently written is confusing, or it's too slow. Or it could be a process that everyone has to follow that involves several manual steps and could instead be automated. It's good to be thinking about ways that the code and process can be improved. You may be an optimizer if you frequently look for ways to improve your life such as automating savings and bill payments, or even re-arranging storage in your home to make more space.</p>\n<h2>8. Enjoy learning new things</h2>\n<p>The field of software development is constantly evolving - there's always a new language, framework, tool or paradigm to learn. What this means is that even if someone is comfortable with their current skills, if they're not frequently learning new skills, it may be harder to land the next job. This can be a plus as things never get boring, on the downside, there is extra effort involved which can extend beyond the 9 - 5. If you enjoy learning new things (eg: via books, courses, video tutorials etc.), then programming could be a good fit. I wrote another post on <a href=\"/blog/how-to-learn-new-things/\">how to learn new things</a>.</p>\n<h2>Conclusion</h2>\n<p>If you recognize some of these qualities in yourself and have never done any programming, definitely consider taking an introductory workshop or pick up a beginner book. As for what to try, web development (HTML, CSS and JavaScript) is popular and these skills are in demand. Python is also very beginner friendly. But even if none of these qualities resonate with you, if you're curious about programming I would still encourage everyone to try it and find out for themselves if they enjoy it.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","fields":{"slug":"/blog/is-career-in-software-development-right-for-you/"}}},{"node":{"id":"bd15f0ab-32cf-5791-8218-afc9229f0bbc","frontmatter":{"title":"What Makes a Good Podcast","date":"September 2019","category":"podcasts"},"excerpt":"I absolutely love podcasts. It's probably safe to assume everyone already knows what a podcast is, but just in case, Wikipedia defines it asâ€¦","html":"<p>I absolutely love podcasts. It's probably safe to assume everyone already knows what a podcast is, but just in case, <a href=\"https://en.wikipedia.org/wiki/Podcast\">Wikipedia</a> defines it as:</p>\n<blockquote>\n<p>An episodic series of spoken word digital audio files that a user can download to a personal device for easy listening.</p>\n</blockquote>\n<p>There are podcasts on every topic under the sun, from comedy, to sports, true crime stories, health, business and everything in between. My favorite categories include programming, personal finance and alternative health.</p>\n<p>One of the things I like best about the format is it feels like \"hacking the brain\". Since they're (mostly) free and so easily accessible, you can be learning and exposing yourself to new ideas while doing the most mundane things like commuting, going for a run, or chores around the house. In this post I'm going to share some opinions on what makes a good podcast. Keep in mind my preference is on education and always learning new things over idle chit chat.</p>\n<h2>1. Not making assumptions about the audiences' knowledge</h2>\n<p>With the exploding popularity of podcasts, new listeners are always joining in. So even if a podcast has been around for a while and has a distinct target audience (for example, Rails developers or do-it-yourself investors), it's still valuable to briefly define any relevant terms or acronyms that are introduced. Otherwise it can leave some audience members confused or feeling foolish that they're supposed to know what that term means. It doesn't have to take long, just a sentence or two does the trick. Some examples of shows that do a good job of this include <a href=\"https://hanselminutes.com/\">Hanselminutes</a> by Scott Hanselman and <a href=\"https://syntax.fm/\">Syntax</a> by Wes Bos and Scott Tolinski.</p>\n<h2>2. Clearly identify ads</h2>\n<p>Look, I get it, it takes valuable time to create and produce a podcast. Hosting is not free. If there's music and design involved in the logo and website, a designer needs to get paid for that. There are real costs involved in creating quality content, and yet, this content is available for free to everyone. So naturally, most podcasts are ad supported. The few I've heard that don't run ads are sponsored by a company and work in mentions of the company and what services they offer as part of the content. Examples of this include <a href=\"https://www.schwab.com/resource-center/insights/content/financial-decoder\">Financial Decoder</a> by Charles Schwab, <a href=\"https://www.thebrianbuffinishow.com/\">The Brian Buffini Show</a> and <a href=\"https://rationalreminder.ca/\">Rational Reminder</a> by Benjamin Felix and Cameron Passmore of PWL Capital.</p>\n<p>However, for all the others that do run ads, it's important to clearly distinguish the ad from the actual content, otherwise, it can feel like you've been tricked. Some good ways of doing this are a verbal cue such as \"And now a word from our sponsor...\" or \"Let's go to our second sponsor break\". Another way is to play some background music that only plays for the duration of the ad and is the same on each episode so listeners can recognize it. Shows that do this well include <a href=\"https://twit.tv/shows/security-now\">Security Now</a> with Steve Gibson and Leo Laporte, <a href=\"https://shoptalkshow.com/\">Shop Talk Show</a> with Dave Rupert and Chris Coyier and <a href=\"https://www.ridehome.info/podcast/techmeme-ride-home/\">Techmeme Ride Home</a> with Brian McCullough.</p>\n<h2>3. Limit inside jokes</h2>\n<p>This can happen when there are two or more co-hosts that know each other well or have a long history of working together. Something will be said that causes all the hosts to start laughing hysterically or go on giggling for some time, but it won't be apparent to the audience what's so funny. This can leave the listener feeling left out of the \"inside joke\".  If you run a podcast and find this happening, try to take a few minutes to fill in the audience on the joke, or if its one of those \"you just had to be there\" moments, try to limit how often it happens or even edit these out.</p>\n<h2>4. Limit the fillers</h2>\n<p>This one's a little tricky because I understand that guests may be nervous, or a new host may not yet have much speaking experience, but try to limit the filler words like umm, ahh, like, you know. These can distract from the main content. This may also depend on the nature of the show. For example those that are more conversational may have a few more filler words than those that are narrated, but as a listener, I really appreciate when everyone speaking is well prepared on the topic. Some great narrated podcasts include <a href=\"https://swindledpodcast.com/\">Swindled</a> and <a href=\"https://apostrophepodcasts.ca/rejection/\">We Regret to Inform You</a>. On the conversational side, some shows that do a great job of this include <a href=\"https://syntax.fm/\">Syntax</a> and <a href=\"https://www.npr.org/podcasts/510289/planet-money\">Planet Money</a>.</p>\n<h2>5. Signal to noise</h2>\n<p>Wikipedia defines <a href=\"https://en.wikipedia.org/wiki/Signal-to-noise_ratio\">signal-to-noise ratio</a> as:</p>\n<blockquote>\n<p>A measure used in science and engineering that compares the level of a desired signal to the level of background noise.</p>\n</blockquote>\n<p>What does this have to do with podcasts you ask? Well, allow me a small tangent... Suppose you have a speaker that emits a small hiss, so even when nothing is playing, if you turn the volume all the way up, you'll hear that hiss get even louder. That's the noise. Now the music you want to play on that speaker is the signal. Imagine if the hiss was really loud, then when you turned up the volume, although the music would get louder, it would partially get drowned out by the hiss, this would be a low signal to noise ratio. Ideally you want a high signal to noise ratio so that the music comes out clearly with little static. Really good explanation of this <a href=\"https://www.lifewire.com/signal-to-noise-ratio-3134701\">here</a>.</p>\n<p>Ok, now back to podcasts. Many will have some level of \"noise\" in some conversational banter or tangents that the hosts go on. The \"signal\" is the topic that's being covered. A good podcast, in my opinion, will limit the amount of noise the audience has to wade through to get to the signal. Of course, some podcasts are all about the banter and that's part of their charm, but I tend to gravitate towards educational shows and so value mostly signal. Some podcasts that do a good balance of banter and education include <a href=\"https://hbr.org/2018/01/podcast-dear-hbr\">Dear HBR</a> and <a href=\"https://www.fool.com/podcasts/motley-fool-money/\">Motley Fool Money</a>.</p>\n<h2>6. Let the guests speak</h2>\n<p>This applies to the interview format - there's a host, and then each week a different guest is brought on to be interviewed. What I've noticed on some podcasts, is the host has a point they'd like to make, so they'll ask a question, but before letting the guest answer, the host keeps going on appending their opinion, so by the time they're finished asking their \"question\", it's lost the flow of the question and answer format. Or sometimes the guest will be interrupted when they're in the middle of answering a question. Presumably the guest was brought on for their expertise in a particular subject. A good podcast will give the guest an opportunity to share their knowledge. A podcast that does this really well is <a href=\"https://www.se-radio.net/\">Software Engineering Radio</a>.</p>\n<h2>Conclusion</h2>\n<p>Podcasts are a fantastic way to improve your knowledge on a variety of topics. If you're not already subscribed, I would encourage everyone to download the <a href=\"https://en.wikipedia.org/wiki/List_of_podcatchers\">podcatcher</a> app of their choice and start listening. Over time you'll discover what style you prefer and learn many new things.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","fields":{"slug":"/blog/what-makes-a-good-podcast/"}}},{"node":{"id":"a4bd55e6-17c1-567f-9930-0ac8023f5033","frontmatter":{"title":"Off with the Digital Distractions!","date":"September 2019","category":"productivity"},"excerpt":"As a programmer, it's important to have long uninterrupted stretches of time to focus on complex tasks. When working on a difficult task, Iâ€¦","html":"<p>As a programmer, it's important to have long uninterrupted stretches of time to focus on complex tasks. When working on a difficult task, I often have a lot of \"context\" in my head, kind of a house of cards. An interruption will cause the cards to come tumbling down. It can take 20 minutes or more to get back in the zone after an interruption, which is a serious hit to productivity, especially considering the source of potential distractions has exploded in recent years. Ever since the ubiquity of smart phones and social media, these digital interruptions have become a normal part of everyone's day.  In this post, I'll share a few things you can do to minimize these, and get your focus back.</p>\n<h2>1. Phone: Notifications</h2>\n<p>Go to your phone's Notification Settings, go over each app, and unless it's something critical, turn off all Banner, Sound, and Badge notifications. If there's an option to display the Banner on the lock screen, disable that. Otherwise even if your phone is locked, the notification will tempt you to open it. I find the Badge notifications (that orange circled number overlaid on app icons) especially devious, there's something so compelling about seeing, for example a number 3 on the Twitter app icon and wanting to know who's engaged with you. I cannot stress this strongly enough, unless it's part of your job to engage with social media, turn off all social media notifications. And of course, any Sound emanating from your phone will make whatever else you're working on seem less important than responding to the phone.</p>\n<p>I'm not including screenshots of how to do this as the details will vary depending on the phone. To find the steps for your phone, use your favorite search engine to search for example <code>iPhone 11 disable notifications</code> or <code>Samsung Galaxy Note 20 disable notifications</code>.</p>\n<p>Depending on your situation, you may need to leave some of these on, for example, Phone and SMS in case a family member needs to reach you at work if it's an emergency, see next section for how to optimize this.</p>\n<p>Of course, if you're on call and your team uses Pager Duty, you'll have to leave those notifications on.</p>\n<h2>2. Phone: Custom Contacts Tones</h2>\n<p>For myself, the only two apps for which notifications are enabled are Phone and SMS, but even this can be limited. For each contact that is important to me such as family and close friends (i.e. will accept an interruption while at work), I set a custom unique SMS and Ringtone sound per contact. This way if the phone does make a sound, I can distinguish if it's someone in my circle and should answer. All others can wait until my next break. The details for how to do this will vary by phone and version, query your favorite search engine for example <code>iPhone 11 contact ringtone</code> or <code>Samsung Galaxy Note 20 contact sms tone</code>. At first, you may forget who you set to which tone, but over time, you'll start to associate the tones with the most important people in your life.</p>\n<h2>3. Phone: Block Unknown Callers</h2>\n<p>This feature is a relatively new arrival to iPhone, and has been around for a long time on Android. Once enabled, only phone calls from people in your contacts will be allowed through. Calls from people not in your contacts will go straight to voicemail. You will be notified about the missed caller. This is a great way to filter out all those annoying spammy calls like those duct cleaning people, and the \"you owe money on your taxes\" scams.</p>\n<p>One downside to this is if you're expecting a delivery, when they call to notify that they're on the way, you'll miss the call.  So far the only way I've found around this is to remember to disable the block around the hours when delivery is expected. For some people this may be a one-off event (eg: a furniture delivery) and not a big deal, but if you regularly expect deliveries (eg: groceries), it can be annoying. Since I always enter expected deliveries in my calendar, what would be great is if the phone could scan the calendar for a keyword such as \"delivery\", then temporarily lift the block during the hours indicated in the calendar entry. If any phone manufacturer is reading this, please consider this feature request.</p>\n<h2>4. Phone: Do not Disturb Mode</h2>\n<p>An alternative to turning off notifications per app is to set your phone on Do Not Disturb mode during specific hours when you really need to focus. If your focus hours are the same each day, this mode can also be scheduled so that you don't need to remember to turn it on and off each day. However, this will block everything, including Phone and SMS which may or may not work for you. One way around this is to designate some of your contacts as Emergency, or to set them as exceptions to the Do Not Disturb mode. This way if someone in your exception list needs to contact you, they'll get through. One small bug I found with this on my older iPhone model, is that it will make the exception contacts come through via Sound ringtone, even when I've got the phone set to buzz. This can make a lot of people mad at you at the movie theatre, so buyer beware with this option!</p>\n<h2>5. Phone: Airplane Mode</h2>\n<p>This is the nuclear option - block absolutely everything, no exceptions. This could be an ok option for those who really struggle to focus and no one needs to reach them for any emergencies. I'm not aware if this mode can be scheduled so you'd have to remember to turn it back on when you're no longer incommunicado. Personally, I find this a little too heavy handed, and would constantly forget to disable it.</p>\n<h2>6. Laptop: Slack</h2>\n<p>Digital disrputions are not limited to the phone, your work laptop can also be a source of these. The biggest culprit here is Slack (or Teams if you're a Microsoft shop). By default, you'll get a banner and sound notification for every message posted on every channel you're part of, in addition to DMs. The first thing I do when configuring a new work laptop, is to disable ALL sounds from Slack, and disable all notifications except for DMs. I'll also mute less critical channels like social/news/classified etc, and just check them periodically, for example on a lunch break.</p>\n<h2>7. Laptop: Email</h2>\n<p>Whether you use Outlook or Gmail or any other email client, go to the notification settings and turn off all alerts. Outlook and Gmail for example, will both show desktop notifications that will fade or slide in from top or bottom right corner of the screen - turn this off. Most email these days is from bots (Jira notifications, newsletters, etc.) and not critical. My theory is if someone at work needs to reach me urgently, they'll DM me on Slack, so no reason to have email notifications on. I usually check my email first thing when I logon in the morning, and then again around a lunch break. This way it doesn't cause any context switches.</p>\n<h2>Final Thoughts</h2>\n<p>If you've been losing productivity due to digital distractions, I hope trying some of these tips will help you. Just one final word of caution - before doing any of these, especially the work related apps, check with your manager on expectations around communication. For example, if you receive an email, are you expected to reply within an hour? The next day? How about a Slack message in a team channel? In my opinion, the ideal is a company that values <a href=\"https://blog.doist.com/asynchronous-communication/\">asynchronous communication</a> but from my experience, this has been the exception rather than the rule.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","fields":{"slug":"/blog/off-with-the-digital-distractions/"}}}]}},"pageContext":{}}}