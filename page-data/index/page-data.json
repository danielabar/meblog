{"componentChunkName":"component---src-pages-index-js","path":"/","result":{"data":{"allMarkdownRemark":{"totalCount":17,"edges":[{"node":{"id":"3a1ba4b4-52d8-52c5-a9b6-09cb99867c93","frontmatter":{"title":"Promotional interest rates and the fine print","date":"December 2020","category":"personal finance"},"excerpt":"Taking a break from programming topics to blog about personal finance today. Wanted to share an experience I had recently with one of the…","html":"<p>Taking a break from programming topics to blog about personal finance today. Wanted to share an experience I had recently with one of the banks in Canada that left me feeling deceived, even though strictly speaking, they did nothing wrong.</p>\n<h2>Background</h2>\n<p>First, a little background. If there’s one thing the Covid era has taught us, it’s the importance of having a well stocked emergency fund.  Readers familiar with basic personal finance may want to skip this section and jump ahead to “The Incident”, otherwise, read on while I explain the concept.</p>\n<p>An emergency fund is basically a pile of cash that you sock away somewhere safe but that can be accessed easily and quickly, so that you have something to fall back on should an emergency happen. For example, being able to pay for an unexpected car repair when you rely on your car to get to work, or paying to replace the hot water tank should it break down.</p>\n<p>Financial experts say you should have approximately 3 - 6 months worth of expenses saved up in an emergency fund. This can be calculated by tracking all your expenses for a few months including fixed expenses such as mortgage/rent, car payments, property taxes, utilities, cell phone/internet, etc, and variable expenses such as groceries, personal care, clothing, gas, restaurants, entertainment etc. (albeit, much less of the latter categories lately). Then take an average of your monthly expenses, multiply by either 3 or 6 and that’s how much you should have saved in an emergency fund.</p>\n<p>As an aside, if you’re looking for an app to track your expenses and make recommendations on savings and an emergency fund, check out <a href=\"https://github.com/danielabar/tidysum\">Tidysum</a>, a free, privacy-focused command line tool I wrote.</p>\n<p>I would argue that given the effects of this pandemic, a 1 year or slightly larger emergency fund is more appropriate to provide breathing room in case of a job loss where the entire industry is affected. This probably won’t be the last pandemic we face and who knows what other catastrophes may occur so better safe than sorry.</p>\n<p>Ok so we’ve established the need for an emergency fund. Next question is - where should it be located? Keeping that amount of physical cash in your home is not a good idea because it could be lost due to theft or a fire. And physical cash loses its value due to inflation (has been running ~2% in Canada), so you’re literally losing money by holding on to physical cash.</p>\n<p>On the other extreme, to get an inflation beating return, the most common option these days is the stock market, HOWEVER DO NOT PUT YOUR EMERGENCY FUND THERE! The stock market is too volatile for this purpose. Financial experts say don’t put any money in the stock market that you might need in less than 10 years.</p>\n<p>So basically that leaves savings accounts at banks. Unfortunately with interest rates being near 0 these days, it’s difficult to get much return on your cash. The best consistent rate in Canada has been 1.5% from one of the online-only banks. So you’re still losing money to inflation but its better than the big chartered banks that are paying at most 0.1% (at the time of this writing).</p>\n<h2>The Incident</h2>\n<p>Which brings me to the incident that led to writing this blog post. Given the strong need to have an emergency fund (ideally not losing money to inflation), low interest rate environment and knowing that banks pay almost nothing in interest, imagine my delight to receive this offer from one of the major banks. The email subject line was “Ready, set, save with 2.30% interest”</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 757px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ad8a7a72ea80ccd77bb39cd98116dbda/1fbe8/bank-offer-crop.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.03302509907529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACJElEQVQ4y4VUa2/aQBDkX1dqqlbq50qR+ruqJCgUwiuAwRiD329j4+nOmgtf0uSk0XIP5mZ39jz48u0X3KOHg+vBOZw0HlwTb78d54j93hWY2MO+4iD//frjHgPPC3FuGgRBhLwokaYZ8rxEkmSIkxRZXmjsug6fDXIMTl4gJDnCMFZEcaII5DdBMkZeVtdnVHUtFxYoZM614goO3w8xOB59lWvbLqztXtN7XW2x3TlYrXfYWHvFerPDzj5g+WppPJ58BTOkqJ6QCk+BKvJFLjcZeZAxzXJVGEUJ4jhFWVbIZO1/6SshFZLA2jqqwqIaUcb5R4OkBpdLdyOkklrqwnSpVt0TR1kG4zqVte0FjZjXtq3E9o3EkL4R0plI0nkcTrBYWhiN54rn0UxrxfoQzIIXmViJQT0hboR02RNnOrk9lTYpxL2qLJFJ66RSu4so+SBniMxbNC57dEhS6apacakqiT3aokAjOOe5opELz2IK0cjc7NdZBqlbT8i6sVbaIlLHtWVjtbElzVDBHuS+4xJev+73e0zRFVN3Und2BM8qYZYV2uWJpMq2CKP405fx3j7LN+AN48lCTWAcPr/gz8MID09jTF6WmC/WmEyXeBLTHodj/JUzC2luZjSdr/p9OUeyUPpVTWHT8gPhSkqu9mWgTprBJ6cfANlvrwa8N5TwTr4QfFqL5UaflQGfH2+fUYXscc71fq1fN3E6W4niLb7//I1/r9lwWGuEQckAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bank offer\"\n        title=\"bank offer\"\n        src=\"/static/ad8a7a72ea80ccd77bb39cd98116dbda/1fbe8/bank-offer-crop.png\"\n        srcset=\"/static/ad8a7a72ea80ccd77bb39cd98116dbda/772e8/bank-offer-crop.png 200w,\n/static/ad8a7a72ea80ccd77bb39cd98116dbda/e17e5/bank-offer-crop.png 400w,\n/static/ad8a7a72ea80ccd77bb39cd98116dbda/1fbe8/bank-offer-crop.png 757w\"\n        sizes=\"(max-width: 757px) 100vw, 757px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Well this sounds just wonderful, even if it is only for a limited time (at the time I received it, it would have provided 6 months of the high interest). So naturally I called to sign up. Keep in mind this is from a large, chartered and reputable bank in Canada. Also I’d had some accounts with them in the past, already had their call centre number from having called them before, and confirmed it was the same number as shown in the promotion. So there was no concern about this being a scam.</p>\n<p>The sign up process was straightforward, my account was opened in minutes, and I was able to transfer funds from another institution where I was keeping my emergency fund previously, and only earning 1.5%, looking forward to end of the month to start seeing the 2.3% build up (with the understanding that this is an annualized rate).</p>\n<p>But when month end came and went, was very surprised to see the interest only being a tiny portion of the promised 2.3%. Figuring there must have been a mistake and the promotion hadn’t yet been applied to my account, I called them to determine the issue.</p>\n<p>And this is where things went sideways. I was told that the 2.3% is a combination of of the regular rate of 0.1% and a promotional rate of 2.2%, but that during the promotional period, only the 0.1% would be paid out monthly (and compounded). The 2.2% would only be paid out one-time, after the offer period had finished, and would be based on the average daily balance during the offer period.</p>\n<p>In other words, the 2.2% would NOT be compounded, the way every other interest rate on savings accounts (promotional or otherwise) is calculated and how my intuition had told me this would work. Suddenly this “wonderful” offer was not looking so good, in fact, it was looking more like a trick. When I pointed this out I was told that all this was explained in the terms and conditions.</p>\n<p>Luckily I kept the promotional email. It turns out the the terms and conditions are displayed in tiny font below the fold of the catchy promotional material (bank name has been blanked out as it’s not the point of this post to call out any particular institution):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 715px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/203d40fe0052aeb11134e86307633e5d/d0c0e/bank-terms-and-conditions-tiny.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.8041958041958%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABpklEQVQ4y22TabLCQAiEvf+xNO5rNO67cUm0XG6A9WF1THzvRxczwAANTOn5fFocxzafz229XttqtbLtdutSQC8cDgfbbDYObMvl0t/fbje73+9WIiDGdrtt3W7XOp1OJgF62ZC73c5Op5MHarVarhsMBna9Xr8ByVyv163RaDiq1apLHgBsoFarZT6AYPIjyePx+ATc7/c2Go1sPB5bFEUWhqEDHRgOh5ldUnbpaAWxPCA0yNbr9bx8wBn0+32/E1R3SYLSFgKez+dPha/Xy5tbqVScarPZdKc8zV+q5XLZgiBwP/wXi0Wxh1AmG1VMJhOnDRWBO1Ugp9NpdgYMlIBMOushShrLJEWJ7OioAD3gjE2T1yaQ9HK5FCmLFo+oVH1Ur4AqVZ/RIak6TdPilDHoATumpdVys/hQyy880JIX1oaR0ztAttlsVuilEskHOwk4s8MES5LkG5C10Q+hN9DkTtX5dcJOAipHypeghSnrL0MhT4uHuiN/bUB//Hg8/t9DbT508j9DtIFWDD2SgFD+85eZsFYCsDYkUkCkequE9JOhaA/fMx4eMH9UNbIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bank offer terms\"\n        title=\"bank offer terms\"\n        src=\"/static/203d40fe0052aeb11134e86307633e5d/d0c0e/bank-terms-and-conditions-tiny.png\"\n        srcset=\"/static/203d40fe0052aeb11134e86307633e5d/772e8/bank-terms-and-conditions-tiny.png 200w,\n/static/203d40fe0052aeb11134e86307633e5d/e17e5/bank-terms-and-conditions-tiny.png 400w,\n/static/203d40fe0052aeb11134e86307633e5d/d0c0e/bank-terms-and-conditions-tiny.png 715w\"\n        sizes=\"(max-width: 715px) 100vw, 715px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>And indeed, zooming way in reveals some surprising details about how the interest is calculated. I’ve plucked out the relevant portions below:</p>\n<p>“The special annual interest rate of 2.30% is a combination of promotional and regular annual interest rates…”</p>\n<p>“Promotional interest is calculated as follows:… on the portion of the applicable account’s average daily closing balance from the date the account is opened to the end of the Offer Period…”</p>\n<p>“Promotional interest will be paid in Ap‌ril 2021 into a single Eligible Savings Account”</p>\n<p>“Eligible Accounts will continue to earn regular interest, calculated on the daily closing balance and paid monthly.”</p>\n<p>Ok so technically and legally speaking, there’s nothing wrong here, the interest is being paid out exactly as per the terms. So why am I left with a bad feeling? Well the problem is how most ordinary people understand how interest on savings accounts work, based on their experiences at other banks. It’s generally understood that the posted regular or promotional rate will compound on a monthly basis. This is why people open savings account to get the “magic” of compounding, however small the interest rate may be.</p>\n<p>It is not at all intuitive that an interest rate would only get calculated one-time and not compound. This isn’t even hinted at in the main promotional material. How many people are actually going to zoom in on the tiny font in the terms and conditions to decipher that it will only be a one-time payment and not compounded? Even if you read the terms closely, it’s not obvious that it’s a one-time non-compounding payment because these words are not used. It’s like they went out of their way to not use these obvious words that might set off alarm bells in customers heads that maybe this deal isn’t as good as it sounds.</p>\n<p>I can almost imagine the marketing team (or whoever comes up with these promotions at banks) sitting around a zoom meeting coming up with this idea. Something like…</p>\n<p>“How can we get Canadians to withdraw their funds from our online-only high interest competitors and get them to come to our bank?”</p>\n<p>“I know let’s offer a slightly higher rate, maybe 1.6%”</p>\n<p>“Nah, that would increase our costs but it’s too small to get people out of their natural inertia”</p>\n<p>“How about a really high rate that they wouldn’t be able to ignore, like 2.3%?”</p>\n<p>“Yeah that would work but would affect our bottom line too much”</p>\n<p>“I’ve got an idea, how about we offer the 2.3% but don’t compound it, just make it a one-time payment at the end of the promotional period”</p>\n<p>“Would anyone go for that?”</p>\n<p>“They would if we present it like a regular interest rate, then bury the details in the tiny point font terms and conditions that no one ever reads”</p>\n<p>“Brilliant, we have a winner!”</p>\n<p>Of course that’s all just a dramatization and my possibly over-active imagination of how bank meetings go.</p>\n<h2>Conclusion</h2>\n<p>So what’s the moral of the story here? Could I have been more vigilant about reading the terms? Sure, although I’m not sure that the wording would have overridden my strong intuition about how interest works on savings accounts, based on all my past experience. Is there any legal case to be made that the bank is in the wrong here? Nope, the terms are very clear about how it works.</p>\n<p>However, people don’t make their impressions based on legalities and technicalities. My perception is that I’ve been tricked, even if legally everything is above board. That perception becomes reality, that I can no longer trust this institution and would not want to do business with them again. It’s sad that a Canadian bank would resort to a tactic like this to gain more customers. I hope other institutions won’t attempt to emulate this, and that with this post, I’ve increased some awareness of this issue.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","fields":{"slug":"/blog/emergency-fund-fine-print/"}}},{"node":{"id":"c0869cac-b2c2-502a-a83f-d20efc85f1b8","frontmatter":{"title":"Improve Productivity with VS Code Snippets","date":"November 2020","category":"vscode"},"excerpt":"Have you ever found yourself repeating a certain pattern while coding over and over and thought there's got to be a faster way? For example…","html":"<p>Have you ever found yourself repeating a certain pattern while coding over and over and thought there's got to be a faster way? For example, if you work with React and hooks, many component file will have this as the first line:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">import</span><span class=\"mtk1\"> React, { useState, useEffect } </span><span class=\"mtk7\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;react&#39;</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>Well there is a faster way to enter these common lines. For React specifically, install the <a href=\"https://marketplace.visualstudio.com/items?itemName=burkeholland.simple-react-snippets\">Simple React Snippets</a> VS Code extension. After it's installed, open a Javascript file and type <code>imr</code>. An intellisense menu will appear like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/59fe44e6fc7363cb170b18c22ffb9cdb/20751/react-snippets.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.3404050144648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABD0lEQVQY022Q207DMBBE8x9tkvre2LFj7CS9gMQLQuL/P2hYb/sAiIfRxvLs8Uw6qS1SzFhyRikB2gWcpCYZnmP7VgZCWQjyKuMgteOpzJml7WM2T3foR0ghYdd3DJIulCYZlnVkNhY+RNR1Q60btm2nhytCmDHPEXNMiKR2tgTujsMJgoD+7QsuJBitMU2eVUrB5XolUMXtfse+X5DmjEAPTa55KCX5pVQcRFKb7sBAgfD6CU/VNV1M3mNZMtKycJp1eySrdcUoFHraGUaJ4STQj7/1BEqE2wfOlJCBlM77wDUasIHqunK11uhIizz/0bOygCeg9YmiKzg3IaaE/FL43xWq3OrGtPDS31Q/9Q3LjK+44YmD/wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"react snippets\"\n        title=\"react snippets\"\n        src=\"/static/59fe44e6fc7363cb170b18c22ffb9cdb/5a190/react-snippets.png\"\n        srcset=\"/static/59fe44e6fc7363cb170b18c22ffb9cdb/772e8/react-snippets.png 200w,\n/static/59fe44e6fc7363cb170b18c22ffb9cdb/e17e5/react-snippets.png 400w,\n/static/59fe44e6fc7363cb170b18c22ffb9cdb/5a190/react-snippets.png 800w,\n/static/59fe44e6fc7363cb170b18c22ffb9cdb/20751/react-snippets.png 1037w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Keep typing until <code>imrse</code> is selected and hit enter. It will get replaced with:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">import</span><span class=\"mtk1\"> React, { useState, useEffect } </span><span class=\"mtk7\">from</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;react&#39;</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>What's going on here is the Simple React Snippets extension has added a collection of frequently used React code sections as VS Code snippets. So what exactly are snippets? According to the VS Code docs:</p>\n<blockquote>\n<p>Code snippets are templates that make it easier to enter repeating code patterns, such as loops or conditional-statements.</p>\n</blockquote>\n<p>But what if you have some other frequently typed lines that aren't related to React or any other framework? It could be something very specific to your code style or the project you're working on. In this case, there won't be an extension for this. The good news is VS Code allows you to add your own snippets. This post will walk you through how to do just that with an example.</p>\n<p>Since I write a lot of documentation in markdown, I frequently want to insert a local image. The markdown for this is:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"markdown\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">![</span><span class=\"mtk6\">alt</span><span class=\"mtk1\">](path </span><span class=\"mtk6\">&quot;title&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">For example:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">![</span><span class=\"mtk6\">dog and cat</span><span class=\"mtk1\">](../images/dog-and-cat.jpg  </span><span class=\"mtk6\">&quot;dog and cat&quot;</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p>Let's build a snippet for this so that it only requires typing <code>img</code>, then <kbd>Ctrl</kbd> + <kbd>Space</kbd> to bring up the snippet template, which can then be filled in to specify the alt text, local path to image and a title. The final result will work like this:</p>\n<p><img src=\"/9eccd2efc7566ded54bc30c859df2582/user-snippet2.gif\" alt=\"user snippet\"></p>\n<h2>Create a Snippet</h2>\n<p>To get started, select Code -> Preferences -> User Snippets from the VS Code menu.</p>\n<p>From the \"New Snippets\" menu section, scroll down and select markdown.</p>\n<p>This will open a new <code>markdown.json</code> file in your user directory, for example mine is at <code>~/Library/Application Support/Code/User/snippets/markdown.json</code>.</p>\n<p>This file contains one json object. Each entry in this object represents a snippet. First add the <code>img</code> entry:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;img&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// snippet content will go here</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h2>Fill in Snippet Content</h2>\n<p>Next, tell VS Code what text you want to type in order to bring up the snippet in the intellisense menu. This is specified with the <code>prefix</code> property. In this case, we want this text to be <code>img</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;img&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;prefix&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;img&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Now comes the tricky part, the <code>body</code> property is where you define the template for the snippet. This is the text that will be inserted into the document when you hit enter from the intellisense menu. Recall we want this to generate a markdown image with the ability to tab through and enter alt text, image path and image title. So we will enter <code>![alt](path \"title\")</code> as the <code>body</code>, but with some variables denoted in a special syntax to indicate the tab stops.</p>\n<p>Tab stops are indicated with <code>$1</code>, <code>$2</code>, etc. But if you want the template to be more helpful and show a label (to make it clear what's supposed to go where), use the <code>${1:label}</code> syntax. Since we have 3 variables (alt text, path, and title), we will have 3 variables. Since the markdown image has double quotes for the title, and we're in a json file where quotes have a special meaning, these need to be escaped with <code>\\</code>.</p>\n<p>So the snippet is now:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;img&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;prefix&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;img&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;body&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;![${1:alt}](${2:path} </span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">${3:title}</span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">)&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>It looks confusing but take a closer look, and its the same familiar syntax of a markdown image <code>![alt](path \"title\")</code>, but with <code>alt</code> replaced with <code>${1:alt}</code>, <code>path</code> replaced with <code>${2:path}</code>, <code>title</code> replaced with <code>${3:title}</code>, and the double quotes surrounding <code>title</code> escaped by preceding each one with a backslash <code>\\</code>.</p>\n<p>Finally, add a <code>description</code> property that will be displayed in the intellisense menu when this snippet is highlighted. You may think it's obvious now but if you create a lot of snippets, the description will be helpful in reminding your future self what it does:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;img&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;prefix&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;img&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;body&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;![${1:alt}](${2:path} </span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">${3:title}</span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">)&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;description&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Markdown image with alt text and title.&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h2>Try it out</h2>\n<p>Save the <code>markdown.json</code> file. Then open a new or existing markdown file in your project, type <code>img</code>, then then <kbd>Ctrl</kbd> + <kbd>Space</kbd> to bring up snippet suggestions and select your new custom snippet. It should replace <code>img</code> with the markdown template and you can tab through entering the image alt text, path to image and a title.</p>\n<h2>Further Improvements</h2>\n<p>There's a few further improvements that can make this workflow even more efficient.</p>\n<p>First, I tend to make the alt text and title be the same value, so it would be faster to have the <code>title</code> field automatically be filled in wth the value of whatever is entered into the <code>alt</code> field. This can be achieved by using the same variable number.</p>\n<p>To do this, open the <code>markdown.json</code> snippets file and make the following change. If you've closed the file, go to Code -> Preferences -> User Snippets, and this time select Markdown from the Existing Snippets menu section (should be near the top).</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;img&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;prefix&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;img&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;body&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;![${1:alt}](${2:path} </span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">${1:title}</span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">)&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;description&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Markdown image with title&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Notice this time the variable number <code>1</code> is being used both for <code>alt</code> and <code>title</code> fields. Save this and try to use the snippet again. This time as you're typing the alt text, notice the title is automatically populated with the same value as alt text.</p>\n<p>One last improvement is the final tab position. Notice that after you fill out all the fields when using the snippet, if you press tab one more time, it moves your cursor to the end of the line.</p>\n<p>Typically with a markdown image, it would be on a line by itself, so you have to hit enter twice to continue with the markdown editing. To save yourself from this extra work of having to hit enter twice, the snippet can be modified to use the special variable <code>$0</code> to indicate the final tab stop.</p>\n<p>Again edit the <code>markdown.json</code> snippets file, adding two new line characters after the markdown image, and then <code>$0</code> to indicate the final tab stop:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;img&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;prefix&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;img&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;body&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;![${1:alt}](${2:path} </span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">${1:title}</span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">)</span><span class=\"mtk4\">\\n\\n</span><span class=\"mtk12\">$0&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;description&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Markdown image with title&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Again save these changes and try the snippet again in a markdown file. This time it will show a subtle grey line where the cursor will land from hitting tab after you've entered all the fields. It looks something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 744px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c4590f9f6649c745383169b725ebdf86/cab8c/snippet-final-tab-stop.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.61290322580645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAAA3ElEQVQY041Q2XKDMBDjK1Iu21xJMCYkaQBjCJD+/0epa+cY+tYHeXa1Ho0kb38scZQKt67DYAzU+Qp16aGHEYdSIuYJmEj/gcT99XiSQaQ5yuoAsxgsa49Wa3RmQF4I+CGDHzEEL/hh/Jm3XMSEE3aCSVaAESG/dsiDCFngo8gLTPPqnM7rA9pMMNMd8/LAd0tpxjt6umkzkokfSlM5UW9rO+UCgmxzwtN1japuUDcXqFMDSfv11kKqk+PtbuuqmzPSfP+MbB8HEvwD4sKYO9hY79lW8J639+jV9S/eUI8zbBXPCwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"snippet final stab stop\"\n        title=\"snippet final stab stop\"\n        src=\"/static/c4590f9f6649c745383169b725ebdf86/cab8c/snippet-final-tab-stop.png\"\n        srcset=\"/static/c4590f9f6649c745383169b725ebdf86/772e8/snippet-final-tab-stop.png 200w,\n/static/c4590f9f6649c745383169b725ebdf86/e17e5/snippet-final-tab-stop.png 400w,\n/static/c4590f9f6649c745383169b725ebdf86/cab8c/snippet-final-tab-stop.png 744w\"\n        sizes=\"(max-width: 744px) 100vw, 744px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Summary</h2>\n<p>That's it, your very first custom VS Code snippet. I hope this post has taught you how to continue building more of these to optimize your workflow.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk12 { color: #CFCFC2; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/improve-productivity-with-vs-code-snippets/"}}},{"node":{"id":"736f5c1e-fd4e-54cf-b5be-b3377433eb4a","frontmatter":{"title":"Construct a PATCH request for a JSON API","date":"November 2020","category":"rails"},"excerpt":"I'm currently building a subscription management and notification microservice in Rails and decided to use the jsonapi-resources gem to…","html":"<p>I'm currently building a subscription management and notification microservice in Rails and decided to use the <a href=\"https://github.com/cerebris/jsonapi-resources\">jsonapi-resources</a> gem to build a JSON spec compliant REST API. This will allow clients of the microservice to submit http requests to do things like add new plans and register new subscriptions for these plans.</p>\n<p>At this point some readers may be wondering why build a custom subscription management system? Why not use Stripe or Recurly or some other established subscription-as-a-service offering? The reasons for that are beyond the scope of this article, but suffice to say, several of these services were researched and determined not to be a good fit for this project.</p>\n<p>Back to the story. Another thing a client of this service may want to do is update a plan, for example, the price may have changed. Although the <code>jsonapi-resource</code> gem is fairly well documented, I couldn't find an example of how to construct a PATCH request to update a resource. After some trial and error, got it working, and wanted to share the results here.</p>\n<p>To start, here is the plan resource class, which is a wrapper for the <code>Plan</code> model. It exposes several attributes from the plan model such as currency, name, recurring interval and the price in cents (not related to this post, but it's generally good practice to store prices in cents to avoid rounding errors).</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># app/resources/api/v1/plan_resource.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">module</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">Api</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">module</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">V1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">PlanResource</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">JSONAPI::Resource</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      attributes </span><span class=\"mtk4\">:currency</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:recurring_interval</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:recurring_interval_count</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:unit_amount_cents</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      belongs_to </span><span class=\"mtk4\">:tenant</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">meta</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">_options</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">last_updated_at:</span><span class=\"mtk1\"> _model.updated_at</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p>And the plans resource is configured in the routes file as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># config/routes.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.application.routes.draw </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  namespace </span><span class=\"mtk4\">:api</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    namespace </span><span class=\"mtk4\">:v1</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      jsonapi_resources </span><span class=\"mtk4\">:plans</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p>Now suppose there exists a Plan in the system with id <code>6d369edf-af6b-4da3-a928-3ab6160b3284</code> (if you want to learn how to configure Rails and Postgres to work with UUID as a primary key, see my <a href=\"/blog/rails-uuid-primary-key-postgres/\">post on UUID</a>) that has a current price of $20.00 per month (i.e. 2000 cents), and the price has gone up to $22.00 (i.e. 2200 cents). Given a rails server running on the default port 3000 via <code>bundle exec rails s</code>, then the following curl request will update this plan with the new price:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">curl --location --request PATCH &#39;http://localhost:3000/api/v1/plans/6d369edf-af6b-4da3-a928-3ab6160b3284&#39; \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">--header &#39;Accept: application/vnd.api+json&#39; \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">--header &#39;Content-Type: application/vnd.api+json&#39; \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">--data-raw &#39;{</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;data&quot;: {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        &quot;id&quot;: &quot;6d369edf-af6b-4da3-a928-3ab6160b3284&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        &quot;type&quot;: &quot;plans&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        &quot;attributes&quot;: {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">            &quot;unit-amount-cents&quot;: 2200</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}&#39;</span></span></code></pre>\n<p>A 200 OK (success) response will be returned with the body containing the updated plan, as well as some metadata (configured to show last updated timestamp in the resource class) and self and relationship links:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;data&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;id&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;6d369edf-af6b-4da3-a928-3ab6160b3284&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;plans&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;links&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;self&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;http://localhost:3000/api/v1/plans/6d369edf-af6b-4da3-a928-3ab6160b3284&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;attributes&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;currency&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;USD&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;name&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;The Best Plan Ever&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;recurring-interval&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;month&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;recurring-interval-count&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">1</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;unit-amount-cents&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">2200</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;relationships&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;tenant&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;links&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;self&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;http://localhost:3000/api/v1/plans/6d369edf-af6b-4da3-a928-3ab6160b3284/relationships/tenant&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;related&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;http://localhost:3000/api/v1/plans/6d369edf-af6b-4da3-a928-3ab6160b3284/tenant&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;meta&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;last_updated_at&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;2020-11-20 20:46:12 UTC&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>The curious thing is that the plan id needs to be specified twice - once in the url so the route will match <code>PATCH /api/v1/plans/:id(.:format)</code>, but it also needs to be specified in the body, in the <code>data</code> hash. Not specifying it will result in a 400 bad request error:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;errors&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;title&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;A key is required&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;detail&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;The resource object does not contain a key.&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;code&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;109&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;status&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;400&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>At first I couldn't understand why this error was returned given the id is specified in the url, but it looks like the <code>jsonapi-resource</code> gem expects to also find it in the body. I hope this will save you some time if you're setting up an api with this gem.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk10 { color: #FD971F; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk12 { color: #CFCFC2; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/patch-request-with-json-api/"}}},{"node":{"id":"c975b7e7-6342-5dfc-9f0b-77f98d4db732","frontmatter":{"title":"Use UUID for primary key with Rails and Postgres","date":"November 2020","category":"rails"},"excerpt":"When working with Rails and a relational database such as Postgres, the default option for primary key is an auto-incrementing sequence. So…","html":"<p>When working with Rails and a relational database such as Postgres, the default option for primary key is an auto-incrementing sequence. So the first record inserted would get a primary key of 1, next one 2 and so on. Depending on the system, this can be an issue if these values get exposed in urls, for example <code>/subscription/265</code> would reveal that 265 subscriptions have been generated, and that the next one will be id 266.</p>\n<p>A less revealing option can be to use UUIDs (universally unique identifier) as a primary key. An example UUID looks like <code>123e4567-e89b-12d3-a456-426614174000</code>. The idea is that it's practically universally unique, and they are not sequential. So if this was a subscription id, the url would be <code>/subscription/123e4567-e89b-12d3-a456-426614174000</code> which reveals absolutely nothing about how many subscriptions have been created or what the next subscription id would be.</p>\n<p>This post shows the steps needed to configure Rails to use UUID for primary key with Postgres. This works best on a brand new application with no production data yet. Trying to convert an existing system could be risky because every single record in every table would have to get migrated and foreign key constraints temporarily dropped during migration.</p>\n<h2>Step 1: Enable pgycrypto</h2>\n<p>The <code>pgcrypto</code> module provides cryptographic functions for Postgres, however, it's not enabled by default. This should be the first migration to enable it:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">EnableUuid</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">6.0</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    enable_extension </span><span class=\"mtk6\">&#39;pgcrypto&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p>Run the migration:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> rake db:migrate</span></span></span></code></pre>\n<p>Verify the extension has been enabled. I'm using <a href=\"https://www.jetbrains.com/datagrip/\">Datagrip</a> but you can check with your sql client of choice. Expand the databases list, then check under extensions and you should see something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 628px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2d04dd917ab68a5442a832884c0e9d2/3d84d/postgres-pgcrypto-extension-enabled.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.917197452229296%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAByUlEQVQoz4VSy3LTQBDUH0AVlxRUoIKJZNl6S7taS9bDlq3YYMAQ8s4lBRyoJBU4JX/fzC5WSmC7OPTOvnqmt3c0w2LQ+xFk7NoM++4Auh2jS2vToWhztW/YAoYjzwR0i8Mgjk53jH+gyWG/F6HvJ4j8GE+Pf+D58gpFfoDq7RFGB58xnh0iHtZwwiGRor8SNGIeEzYbMsrE6kBWV+tQ4U/REG/MQKHT9dW6zd2sMBjg2ccr7M7PkKZTpOMF8skHcJpn1XuU9RJD2ivrT/BYAStI1xW2K5gU98QEr0UFly67RHKjHBYVk8+Vc5koGlRKgPR3a0LTjeF6Ai/GS+xlc/hEZqQsJHKUTCiOYQdD9L1EPVlf2dLwG7QSCrgOw87sFK+mh0hFiWT0DoNijjibKXi8XH0M2wrNCTNI2EFGnmTwqFUsVqKTLxDwApzUsaSCoF/m6USpbDiboHlshEfwEfwwh1kfYefyF84vvuH67h6nl99x8/MBx+dfEZK/HhX0eYvXgtajRl4D+WSSkh7ZYDpi1fSxwsb7LWhtQ1Xndz28pOc+ObtFktWYLk5Qzb8oSJ+b/tsGbc1YeUBKOlGh2kW2isvy/35Gg99AjYFQHF+f9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"alt\"\n        title=\"alt\"\n        src=\"/static/d2d04dd917ab68a5442a832884c0e9d2/3d84d/postgres-pgcrypto-extension-enabled.png\"\n        srcset=\"/static/d2d04dd917ab68a5442a832884c0e9d2/772e8/postgres-pgcrypto-extension-enabled.png 200w,\n/static/d2d04dd917ab68a5442a832884c0e9d2/e17e5/postgres-pgcrypto-extension-enabled.png 400w,\n/static/d2d04dd917ab68a5442a832884c0e9d2/3d84d/postgres-pgcrypto-extension-enabled.png 628w\"\n        sizes=\"(max-width: 628px) 100vw, 628px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Step 2: Configure Generator</h2>\n<p>Add the following to the generators config so it knows to generate uuid primary keys:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># config/initializers/generators.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.application.config.generators </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |g|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  g.orm </span><span class=\"mtk4\">:active_record</span><span class=\"mtk1\">, </span><span class=\"mtk4\">primary_key_type:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:uuid</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<h2>Step 3: Generate Model</h2>\n<p>Time to try it out. Start by generating a model:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> rails generate model Tenant name:string</span></span></span></code></pre>\n<p>Open the generated migration - notice the type for id is <code>uuid</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">CreateTenants</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">6.0</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    create_table </span><span class=\"mtk4\">:tenants</span><span class=\"mtk1\">, </span><span class=\"mtk4\">id:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:uuid</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |t|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.string </span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.timestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p>Run the migration:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> rake db:migrate</span></span></span></code></pre>\n<p>Verify how this looks in the database - notice that the id column is using the <code>gen_random_uuid()</code> function:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 626px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e74efdf2cd58bc560613499d727203c5/af590/tenant-table-uuid.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.9073482428115%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABGElEQVQoz5VSy07DMBDMv5C0SWjzdN5xEnBDmlYtKoL2WHHk/z9g2HUaJAQHOIy8s94de7w27HUKxiqq4AYFlquJO16m18W9oFzyZxgeCQWJxPn6gf5wQdc/Q42vGs3m+G9Rg4sZnpBwKWE6xG+bnDftEJYbUz7SmOIQd5SfeKQ5g+uNWdla+rC2Z+xf9qiaAetY0s1blN2O4hqiVEjrJ4Rph0wOKNoRSdUjSFvNuY7dfAku6GShjhj7HHHW0mYGXzRIqYnfl1dRKC0gyo0Wi/NHRITkxn8ImkkHvxrgaDGJdVRrWzYNyPVzDW5iu7Nlxhx/t2wHCE5X9Jd3ZHSi2r3hYTiRaIW82UKqA1oaGN+K35F/w29D+QQht+Aasg9/pQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"alt\"\n        title=\"alt\"\n        src=\"/static/e74efdf2cd58bc560613499d727203c5/af590/tenant-table-uuid.png\"\n        srcset=\"/static/e74efdf2cd58bc560613499d727203c5/772e8/tenant-table-uuid.png 200w,\n/static/e74efdf2cd58bc560613499d727203c5/e17e5/tenant-table-uuid.png 400w,\n/static/e74efdf2cd58bc560613499d727203c5/af590/tenant-table-uuid.png 626w\"\n        sizes=\"(max-width: 626px) 100vw, 626px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Launch the Rails console and insert some data into the new table - you should see that the id is a UUID:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">bundle exec rails console</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&gt; Tenant.create(name: &#39;Acme&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">=&gt; #&lt;Tenant id: &quot;bb57c11e-2ec7-44aa-8519-babd8b439b51&quot;, name: &quot;Acme&quot;, created_at: &quot;2020-11-01 22:06:58&quot;, updated_at: &quot;2020-11-01 22:06:58&quot;&gt;</span></span></code></pre>\n<h2>Step 4: Foreign Key Reference</h2>\n<p>One last thing to watch out for is adding a foreign key reference to a table. For example, suppose there is a <code>Plan</code> table and you want to add a reference to the Tenants table. The migration for this is:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> rails generate migration AddTenantRefToPlan tenant:references</span></span></span></code></pre>\n<p>Which would generate:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">AddTenantRefToPlan</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">6.0</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    add_reference </span><span class=\"mtk4\">:plans</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:tenant</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">, </span><span class=\"mtk4\">foreign_key:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">index:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p>However, running this won't work because it will try to create an integer type column <code>tenant_id</code> on the <code>Plans</code>  referencing the <code>id</code> column on <code>Tenants</code> table which is of type uuid which doesn't match. For these type of migrations, need to specify <code>type: :uuid</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">AddTenantRefToPlan</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">6.0</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    add_reference </span><span class=\"mtk4\">:plans</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:tenant</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">, </span><span class=\"mtk4\">foreign_key:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">index:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:uuid</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p>That's it, now you're all setup to use UUID as the primary key in all your models.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/rails-uuid-primary-key-postgres/"}}},{"node":{"id":"517e3854-9ffe-5a1c-bdd6-940cf899b728","frontmatter":{"title":"Start a Rails 6 Project with RSpec","date":"October 2020","category":"rails"},"excerpt":"Currently at work I have one of those rare opportunities to greenfield new project. Since we're a Rails shop, naturally I'm using Rails, and…","html":"<p>Currently at work I have one of those rare opportunities to greenfield new project. Since we're a Rails shop, naturally I'm using Rails, and since it's a new project, might as well use the latest and greatest, which at the time of this writing is Rails 6.</p>\n<p>However I ran into a little surprise when it came to testing. Being somewhat of a Rails noob, based on the handful of projects I've worked on so far, had assumed that RSpec was the default test framework that comes with Rails. But it turns out, this is not the case. There's a few additional steps needed to setup a Rails project to use RSpec. This post will walk you through the steps I took to scaffold a new Rails 6 project and set it up for testing with RSpec.</p>\n<h2>Project Scaffolding</h2>\n<p>Run the following commands to get the project started. I'm using Ruby 2.7.1 and will be using Postgres as the database.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">gem install rails -v 6.0.3.4 </span><span class=\"mtk3\"># the most recent version at the time of this writing</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">brew install postgresql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rails new myapp -d=postgresql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">cd</span><span class=\"mtk1\"> myapp</span></span></span></code></pre>\n<p>My next step was to generate some models. Since this will be a multi tenant system, first model is the Tenant class.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rails generate model Tenant name:string</span></span></span></code></pre>\n<p>The output of this command is:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Running via Spring preloader in process 19406</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  invoke  active_record</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  create    db/migrate/20201018145546_create_tenants.rb</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  create    app/models/tenant.rb</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  invoke    test_unit</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  create      test/models/tenant_test.rb</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  create      test/fixtures/tenants.yml</span></span></code></pre>\n<p>Notice it didn't generate an RSpec test. It turns out, the default testing library that comes with Rails is Minitest and the generator creates a Minitest test file and fixture. Here's what's needed to switch to RSpec.</p>\n<h2>Add RSpec</h2>\n<p>First start by adding the RSpec gem to the test section of the Gemfile. Actually the <a href=\"https://relishapp.com/rspec/rspec-rails/v/4-0/docs\">rspec-rails</a> gem is used which adds RSpec support to Rails:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">group </span><span class=\"mtk4\">:test</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  gem </span><span class=\"mtk6\">&#39;rspec-rails&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p>Then install and bootstrap it. This will generate the <code>spec</code> dir and some support files:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle install</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rails generate rspec:install</span></span></span></code></pre>\n<h2>Configure RSpec</h2>\n<p>You would think at this point, you could run the model generator and this time an RSpec test would get generated. But in my experience, it still generated the Minitest test and fixture. One more change you need to make is to tell the Rails generator that you only want RSpec tests. This configuration is specified in the <code>config/initializers/generators.rb</code> file. Go ahead and create this file if it's not already there. Then add the following:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.application.config.generators </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |g|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  g.test_framework </span><span class=\"mtk4\">:rspec</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p>Now the model generator will generate an RSpec test file:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rails generate model Tenant name:string</span></span></span></code></pre>\n<p>Command output:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Running via Spring preloader in process 21305</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  invoke  active_record</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  create    db/migrate/20201018150823_create_tenants.rb</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  create    app/models/tenant.rb</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  invoke    rspec</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  create      spec/models/tenant_spec.rb</span></span></code></pre>\n<h2>Cleanup</h2>\n<p>Final step is to remove the generated <code>test</code> dir to avoid confusion. RSpec uses the <code>spec</code> dir for all test and support files.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rm -rf </span><span class=\"mtk9\">test</span></span></span></code></pre>\n<p>That's it, now you're setup for RSpec testing, happy coding!</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/start-rails-6-project-with-rspec/"}}}]}},"pageContext":{}}}