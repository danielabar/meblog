{"componentChunkName":"component---src-pages-index-js","path":"/","result":{"data":{"allMarkdownRemark":{"totalCount":57,"edges":[{"node":{"id":"e033086f-0522-5adf-b26c-0299558696b4","frontmatter":{"title":"Private Gems and Docker for Development","date":"January 2023","category":"ruby"},"excerpt":"If you're using Docker for development with a Rails application, and want to introduce a private gem registry hosted with Github Packages…","html":"<p class=\"markdown-para\">If you're using Docker for development with a Rails application, and want to introduce a private gem registry hosted with <a href=\"https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-rubygems-registry\" class=\"markdown-link\">Github Packages</a>, you may encounter an authentication error when building the development Docker image, at the point where it tries to pull the private gem(s). This post will walk you through the steps to resolve this.</p>\n<p class=\"markdown-para\">An important note before moving on - the solution presented in this post is only suitable for a <em class=\"markdown-emphasis\">development</em> Docker image. That is, an image that remains on the developer's laptop and <em class=\"markdown-emphasis\">never</em> gets pushed to production or made public.</p>\n<h2 class=\"markdown-subtitle\" id=\"configure-bundler\" style=\"position:relative;\"><a href=\"#configure-bundler\" aria-label=\"configure bundler permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure Bundler</h2>\n<p class=\"markdown-para\">Given that your projects <code>Gemfile</code> is pulling some gems from Github Packages, for example:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">source &#39;https://rubygems.pkg.github.com/some-project/&#39; do</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  gem &#39;myprivate_gem&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">end</span></span></code></pre>\n<p class=\"markdown-para\">The Github documentation on configuring bundler so that you can pull private gems specifies that you must first run the following command:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">$ bundle config https://rubygems.pkg.github.com/OWNER USERNAME:TOKEN</span></span></code></pre>\n<p class=\"markdown-para\">Where:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\"><code>OWNER</code> is the user or organization account that owns the repository that contains the gem project source.</li>\n<li class=\"markdown-list-item\"><code>USERNAME</code> is in the individual user (Github account) that would like to pull the gem when building the Rails app that depends on it.</li>\n<li class=\"markdown-list-item\"><code>TOKEN</code> is a Github personal access token (aka <a href=\"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token\" class=\"markdown-link\">PAT</a>) that each user running the project needs to create.</li>\n</ul>\n<p class=\"markdown-para\">If everyone on your team was running the Rails project natively on their laptops, you would just update the <code>README.md</code> telling each developer to create their  PAT, run the <code>bundle config...</code> command locally, then run <code>bundle install</code> which will pull the new private gem(s) specified in <code>Gemfile</code>. You keep your <a href=\"../about-those-docs\" class=\"markdown-link\">project setup docs</a> up to date right?</p>\n<aside class=\"markdown-aside\">\nThe Github documentation on private gems also refers to creating or updating your ~/.gemrc file, including the Github credentials in this file. However, this is only required for publishing gems, and will not be covered in this post.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"dockerized-development\" style=\"position:relative;\"><a href=\"#dockerized-development\" aria-label=\"dockerized development permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerized Development</h2>\n<p class=\"markdown-para\">However, things are a little more complicated if using a <a href=\"../dockerize-rails-app-for-dev-debug-and-testing\" class=\"markdown-link\">Dockerized setup for development</a>. With this setup, it's the <code>Dockerfile</code> that runs <code>bundle install</code> when the image is being built. For example:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:whatever-version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle install</span></span></span></code></pre>\n<p class=\"markdown-para\">However, if any of the gems in the <code>Gemfile</code> are coming from a private registry, such as <a href=\"https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-rubygems-registry\" class=\"markdown-link\">Github Packages RubyGems</a>, trying to build this image will fail with the following authentication error:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Authentication is required for rubygems.pkg.github.com.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Please supply credentials for this source. You can do this by running:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">bundle config rubygems.pkg.github.com username:password</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">------</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">executor failed running [bundle install]: exit code: 17</span></span></code></pre>\n<p class=\"markdown-para\">This means the <code>bundle config...</code> needs to be run as part of the image building, before running <code>bundle install</code>, something like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:whatever-version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle config https://rubygems.pkg.github.com/OWNER USERNAME:TOKEN</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle install</span></span></span></code></pre>\n<p class=\"markdown-para\">The problem with the above is that the <code>Dockerfile</code> is committed in the project. You wouldn't  want to commit this line as is, because <code>USERNAME</code> will be different for each developer working on the project. <code>TOKEN</code> is a user-specific secret that provides some access to the developer's Github account so that definitely should not be committed.</p>\n<h2 class=\"markdown-subtitle\" id=\"dockerfile-arg\" style=\"position:relative;\"><a href=\"#dockerfile-arg\" aria-label=\"dockerfile arg permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerfile ARG</h2>\n<p class=\"markdown-para\">What we need to solve this problem is <em class=\"markdown-emphasis\">dynamic</em> values during the Docker build process. The <a href=\"https://docs.docker.com/engine/reference/builder/#arg\" class=\"markdown-link\">ARG</a> command in a Dockerfile can be used for exactly this. Specify the <code>ARG</code>s at beginning of the <code>Dockerfile</code>, just after the <code>FROM</code> command. Rather than <code>USERNAME</code> and <code>TOKEN</code> from the Github documentation, I'm going to name these to be more specific as to what they're used for:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:your-base-image</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ARG</span><span class=\"mtk1\"> GITHUB_USERNAME</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ARG</span><span class=\"mtk1\"> GITHUB_PAT_GEMS</span></span></span></code></pre>\n<p class=\"markdown-para\">Then later in Dockerfile, just before bundle install is run, add the <code>bundle config...</code> command from the Github documentation, but this time, using the <code>ARG</code> variables. Replace <code>project</code> with project name where the private gem source is located:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:whatever-version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ARG</span><span class=\"mtk1\"> GITHUB_USERNAME</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ARG</span><span class=\"mtk1\"> GITHUB_PAT_GEMS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle config https://rubygems.pkg.github.com/project GITHUB_USERNAME:GITHUB_PAT_GEMS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle install</span></span></span></code></pre>\n<p class=\"markdown-para\">Now if you were building the Docker image directly, you could run:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker build -t app-image:latest \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  --build-arg GITHUB_USERNAME=your-github-username \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  --build-arg GITHUB_PAT_GEMS=your-github-pat \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  .</span></span></code></pre>\n<p class=\"markdown-para\">To re-emphasize the note from the beginning of this post, using <code>ARG</code> in this way is only suitable for a development image that will never be made public. This is because the <code>ARG</code> values become part of the image and are viewable in the output of the <code>docker history</code> command. If you need build-time secrets for a production image, see the Docker documentation on <a href=\"https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information\" class=\"markdown-link\">BuildKit</a>.</p>\n<aside class=\"markdown-aside\">\nYou may be wondering why not use <a class=\"markdown-link\" href=\"https://docs.docker.com/engine/reference/builder/#env\">ENV</a>? The reason is Docker does not provide a way to dynamically set ENV values during the build process, and these values are only needed during the image build time, not container run time. Read this <a class=\"markdown-link\" href=\"https://www.baeldung.com/ops/dockerfile-env-variable\">blog post</a> for more on this topic.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"docker-compose\" style=\"position:relative;\"><a href=\"#docker-compose\" aria-label=\"docker compose permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Compose</h2>\n<p class=\"markdown-para\">This project uses several other services including MySQL and Redis, therefore, <a href=\"https://docs.docker.com/compose/\" class=\"markdown-link\">Docker Compose</a> is used to build the image and run all the containers together. This means we need to be able to pass through the Docker <code>ARG</code>s from the <code>docker-compose.yml</code> file to the <code>Dockerfile</code>. Fortunately, docker compose provides the <a href=\"https://docs.docker.com/compose/compose-file/compose-file-v3/#args\" class=\"markdown-link\">args</a> keyword for the <code>build</code> command for just this purpose.</p>\n<p class=\"markdown-para\">Trying it out however poses a new problem as shown below:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># docker-compose.yml</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">app</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">args</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">GITHUB_USERNAME</span><span class=\"mtk1\">: </span><span class=\"mtk6\">uh oh, what to put here?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">GITHUB_PAT_GEMS</span><span class=\"mtk1\">: </span><span class=\"mtk6\">uh oh, what to put here?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">mysql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">redis</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">redis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span></code></pre>\n<p class=\"markdown-para\">Since the <code>docker-compose.yml</code> file is also committed into the project, we do not want to hard-code Github user names and tokens in this file either. Fortunately, docker compose supports the use of <a href=\"https://docs.docker.com/compose/environment-variables/\" class=\"markdown-link\">environment variables</a>. Here's how to specify the Github username and PAT as environment variables in the compose file:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># docker-compose.yml</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">app</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">args</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">GITHUB_USERNAME</span><span class=\"mtk1\">: </span><span class=\"mtk6\">${GITHUB_USERNAME}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">GITHUB_PAT_GEMS</span><span class=\"mtk1\">: </span><span class=\"mtk6\">${GITHUB_PAT_GEMS}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">mysql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">redis</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">redis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span></code></pre>\n<p class=\"markdown-para\">Next step is being able to pass the values of these environment variables to docker compose via the command line. This can be accomplished with the <code>--env-file</code> argument, passing in a path to a file containing the values:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose --env-file .env.dockercompose.local build</span></span></code></pre>\n<p class=\"markdown-para\">Where <code>.env.dockercompose.local</code> is a gitignored file that specifies the secrets. You can name the .env file whatever you want, just make sure its in the <a href=\"https://git-scm.com/docs/gitignore\" class=\"markdown-link\">gitignore</a> so it doesn't get committed. Here's what the env file will look like:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">GITHUB_USERNAME=your-github-username</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">GITHUB_PAT_GEMS=your-github-pat</span></span></code></pre>\n<p class=\"markdown-para\">Now, when the docker-compose build command is run, it will have access to the values of <code>GITHUB_USERNAME</code> and <code>GITHUB_PAT_GEMS</code> from the .env file. Then these will get passed on to the <code>Dockerfile</code> as ARG's, where they can be used in building the image.</p>\n<h2 class=\"markdown-subtitle\" id=\"makefile\" style=\"position:relative;\"><a href=\"#makefile\" aria-label=\"makefile permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Makefile</h2>\n<p class=\"markdown-para\">To save yourself all that typing of the docker compose command with the env file, if your project uses a <code>Makefile</code>, you can add the following task:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"makefile\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose --env-file .env.dockercompose.local build</span></span></span></code></pre>\n<p class=\"markdown-para\">Now whenever you need to build the image (such as when new gems have been added to the project's <code>Gemfile</code>), simply run:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">make build</span></span></code></pre>\n<p class=\"markdown-para\">Remember to also update the project's <code>README.md</code> with the new setup instructions that everyone wanting to build the image on their laptop needs to create a <code>.env.dockercompose.local</code> file and populate it with their Github username and personal access token.</p>\n<aside class=\"markdown-aside\">\nI've mentioned a few times about keeping the README.md up to date when making changes to the setup process that impact all the other developers working on the project. Although almost no one likes writing engineering documentation, they certainly appreciate having good, up to date docs. See my post on <a class=\"markdown-link\" href=\"https://danielabaron.me/blog/about-those-docs/\">engineering documentation</a> for what kinds of things should get documented and how to get in a good frame of mind for writing it.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered how to authenticate to the Github Packages RubyGems private registry when using Docker for Rails development. The technique involves use of Docker <code>ARG</code>s to specify dynamic build time values, docker compose environment variables to pass them through to the build, and a gitignored env file to avoid committing the secrets. Again a reminder that this technique should only be used for a development image that will never leave the developer's laptop.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/private-gems-and-docker-dev/"}}},{"node":{"id":"41a3cfc2-1062-525c-b57b-3f04d6b73b8a","frontmatter":{"title":"When RSpec Doesn't Rollback","date":"December 2022","category":"rails"},"excerpt":"This post will walk you through some troubleshooting techniques when RSpec tests are failing due to unexpected data in the test database. I…","html":"<p class=\"markdown-para\">This post will walk you through some troubleshooting techniques when <a href=\"https://rspec.info/\" class=\"markdown-link\">RSpec</a> tests are failing due to unexpected data in the test database. I had experienced some RSpec tests that were passing the first time they ran, individually, but then failing on subsequent runs, or when run as part of the entire test suite. It turned out to be a combination of two things - not fully understanding how RSpec manages transactions, and how using or not using <code>let/let!</code> helper methods can impact this.</p>\n<h2 class=\"markdown-subtitle\" id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<p class=\"markdown-para\">The RSpec tests are part of a Rails project using the <a href=\"https://github.com/rspec/rspec-rails\" class=\"markdown-link\">rspec-rails</a> gem. The tests also make use of the <a href=\"https://github.com/thoughtbot/factory_bot\" class=\"markdown-link\">FactoryBot</a> and <a href=\"https://github.com/faker-ruby/faker\" class=\"markdown-link\">faker</a> gems to create test data. This post assumes some familiarity with these tools. The other thing to know is I listen to the <a href=\"https://www.bikeshed.fm/\" class=\"markdown-link\">Bike Shed</a> podcast, and recently there have been some discussions about not using <code>let</code>, or at least, avoid <a href=\"https://thoughtbot.com/blog/lets-not\" class=\"markdown-link\">overusing</a> it.</p>\n<p class=\"markdown-para\">The <code>rails_helper.rb</code>, which is included in every spec file configures transactions as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># spec/rails_helper.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">RSpec</span><span class=\"mtk1\">.configure </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.use_transactional_fixtures </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># other config ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">My understanding of this setting was that data inserted into the test database <em class=\"markdown-emphasis\">anywhere</em> in a test would always get rolled back, leaving the database nice and clean for the next test.</p>\n<h2 class=\"markdown-subtitle\" id=\"failing-test\" style=\"position:relative;\"><a href=\"#failing-test\" aria-label=\"failing test permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Failing Test</h2>\n<p class=\"markdown-para\">Here is the troublesome test, it's for a subscription management app. It creates several different plans for an email service, exercises some code that generates the available options based on what's in the database, and then expects exactly two options to be available:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;rails_helper&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">describe </span><span class=\"mtk6\">&quot;my test class&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;year&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  it </span><span class=\"mtk6\">&quot;some test&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    result </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.generate_options(</span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># expects exactly two options: a monthly plan and a yearly plan</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">This test would pass when run individually and the first time but fail on subsequent runs. Also when run as part of a suite, other tests that also depended on exactly two options being available were failing. The failures were all due to more plans being available in the database than expected. For example, 4 instead of 2, and on the next run, 6 instead of 2, and so on.</p>\n<p class=\"markdown-para\">Before moving on with troubleshooting, there's a command you can run to reset the test database. This is needed to reproduce the problem of \"run the test first time, it passes, subsequent runs, it fails\":</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Rails 5+</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bin/rails db:reset RAILS_ENV=test</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Older versions</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> rake db:reset RAILS_ENV=test</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"test-database\" style=\"position:relative;\"><a href=\"#test-database\" aria-label=\"test database permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test Database</h2>\n<p class=\"markdown-para\">My first step in troubleshooting was to connect to the test database (this project uses MySQL) and see what's in the <code>plans</code> table upon completion of a test run. This project does not run seeds against the test database, therefore the <code>plans</code> table should be empty after tests run, since any data created during the test should have been rolled back.</p>\n<p class=\"markdown-para\">Check your projects <code>config/database.yml</code> to determine the name of the test database. By default, if your development database is named <code>myapp</code>, then the test database will be <code>myapp_test</code>.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">mysql -u root -D myapp_test</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">mysql&gt; SELECT COUNT(*) FROM plans;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">2</span></span></code></pre>\n<p class=\"markdown-para\">That's not right, the count should have returned 0. I ran the test again, then the count returned 4. This confirms that the plan data inserted during the test is not being rolled back, but why?</p>\n<h2 class=\"markdown-subtitle\" id=\"test-log\" style=\"position:relative;\"><a href=\"#test-log\" aria-label=\"test log permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test Log</h2>\n<p class=\"markdown-para\">Next step in troubleshooting was to inspect the <code>log/test.log</code> file at the project root. By default, when tests run, all activity that would normally be displayed in the terminal when a Rails server is running, gets saved in this log file. This includes database inserts. Let's see if it reveals any clues as to what's going on with the database when this test is running.</p>\n<p class=\"markdown-para\">Here is the relevant portion of the file from running this test:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BEGIN</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;month&#39;, &#39;2022-07-27 19:59:17&#39;, &#39;2022-07-27 19:59:17&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">COMMIT</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BEGIN</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;year&#39;, &#39;2022-07-27 19:59:17&#39;, &#39;2022-07-27 19:59:17&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">COMMIT</span></span></code></pre>\n<p class=\"markdown-para\">The insert statements are a result of the <code>FactoryBot.create(:plan...)</code> methods run by the test. That part is expected. However, the INSERTs are being committed rather than rolled back. That is unexpected.</p>\n<h2 class=\"markdown-subtitle\" id=\"where-is-data-created\" style=\"position:relative;\"><a href=\"#where-is-data-created\" aria-label=\"where is data created permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Where is data created?</h2>\n<p class=\"markdown-para\">Taking a closer look at what the RSpec docs have to say about <a href=\"https://relishapp.com/rspec/rspec-rails/docs/transactions\" class=\"markdown-link\">transactions</a>:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">What it really means in Rails is \"run every test method within a transaction.\" In the context of rspec-rails, it means \"run every example within a transaction.\"</p>\n</blockquote>\n<p class=\"markdown-para\">So any data created within an example will be run within a transaction and rolled back. However, is data created within a <code>describe</code> block considered part of the example? Doing some research on RSpec and rollbacks led me to this Stack Overflow <a href=\"https://stackoverflow.com/questions/3333743/factory-girl-rspec-doesnt-seem-to-roll-back-changes-after-each-example/24372747#24372747\" class=\"markdown-link\">answer</a>. The sentence in particular:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">... use transactional fixtures will clear the DB as long as you created the data in the example itself. before :all do ... end is considered outside of the example, because the data remains untouched across multiple examples. Whatever you create in before :all you have to delete in after :all.</p>\n</blockquote>\n<p class=\"markdown-para\">Although my test wasn't using a <code>before</code> block, this got me wondering whether data created in a <code>describe</code> block is considered <em class=\"markdown-emphasis\">outside</em> of the example? To answer this question, I modified the test to move the data creation into the <code>it</code> block:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;rails_helper&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">describe </span><span class=\"mtk6\">&quot;my test class&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  it </span><span class=\"mtk6\">&quot;some test&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;year&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    result </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.generate_options(</span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># expects exactly two options: a monthly plan and a yearly plan</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">After running this version of the test, I checked the test database to see if it was clean - and it was. This time there were no records left in the <code>plans</code> table after the test run:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">mysql -u root -D myapp_test</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">mysql&gt; SELECT COUNT(*) FROM plans;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">0</span></span></code></pre>\n<p class=\"markdown-para\">I also checked what got generated in the <code>log/test.log</code> file. This time both inserts into the <code>plans</code> table are wrapped in named transactions using <a href=\"https://dev.mysql.com/doc/refman/8.0/en/savepoint.html\" class=\"markdown-link\">SAVEPOINT</a>, and rolled back at the end of the test:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BEGIN</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;month&#39;, &#39;2022-07-27 20:59:17&#39;, &#39;2022-07-27 20:59:17&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;year&#39;, &#39;2022-07-27 20:59:17&#39;, &#39;2022-07-27 20:59:17&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ROLLBACK</span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"multiple-tests-with-same-data\" style=\"position:relative;\"><a href=\"#multiple-tests-with-same-data\" aria-label=\"multiple tests with same data permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multiple Tests with Same Data</h2>\n<p class=\"markdown-para\">Good, so creating the data in the <code>it</code> block solves this problem. But what if there are other tests in the same test file and <code>describe</code> block that also need this data?</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"repeat-data-creation\" style=\"position:relative;\"><a href=\"#repeat-data-creation\" aria-label=\"repeat data creation permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Repeat Data Creation</h3>\n<p class=\"markdown-para\">One way to solve for this would be to repeat the test data creation in each test that needs it. Since transactional fixtures are enabled, the database inserts will be rolled back at the end of each example so each test will get a clean start. I've also added some temporary logging statements at the beginning of each test, which will help in identifying each run in the <code>log/test.log</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;rails_helper&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">describe </span><span class=\"mtk6\">&quot;my test class&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  it </span><span class=\"mtk6\">&quot;some test&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.logger.info(</span><span class=\"mtk6\">&quot;SOME TEST&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;year&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    result </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.generate_options(</span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># expects exactly two options: a monthly plan and a yearly plan</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  it </span><span class=\"mtk6\">&quot;some other test&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.logger.info(</span><span class=\"mtk6\">&quot;SOME OTHER TEST&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;year&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">The <code>log/test.log</code> from this test run confirms a transaction is created and rolled back for each example:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BEGIN</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SOME TEST</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;month&#39;, &#39;2022-07-27 21:59:17&#39;, &#39;2022-07-27 21:59:17&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;year&#39;, &#39;2022-07-27 21:59:18&#39;, &#39;2022-07-27 21:59:18&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ROLLBACK</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BEGIN</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SOME OTHER TEST</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;month&#39;, &#39;2022-07-27 21:59:19&#39;, &#39;2022-07-27 21:59:19&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;year&#39;, &#39;2022-07-27 21:59:20&#39;, &#39;2022-07-27 21:59:20&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ROLLBACK</span></span></code></pre>\n<h3 class=\"markdown-sub-subtitle\" id=\"use-describe-and-let\" style=\"position:relative;\"><a href=\"#use-describe-and-let\" aria-label=\"use describe and let permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use Describe and Let</h3>\n<p class=\"markdown-para\">But then I wondered whether use of the <a href=\"https://relishapp.com/rspec/rspec-core/docs/helper-methods/let-and-let\" class=\"markdown-link\">let</a> helper method could also solve for this, to avoid having to repeat the data creation statements in each example. In the test below, the data creation has been moved out of each <code>it</code> block and into the <code>describe</code> block, but using the <code>let!</code> helper method. I'm using the \"bang\" version of it to force execution because these tests need the data to already be there. Otherwise, the regular version <code>let</code> is lazily evaluated:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;rails_helper&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">describe </span><span class=\"mtk6\">&quot;my test class&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  let!(</span><span class=\"mtk4\">:monthly_plan</span><span class=\"mtk1\">) { </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">) }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  let!(</span><span class=\"mtk4\">:annual_plan</span><span class=\"mtk1\">) { </span><span class=\"mtk9 mtki\">FactoryBot</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">:plan</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;year&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">) }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  it </span><span class=\"mtk6\">&quot;some test&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.logger.info(</span><span class=\"mtk6\">&quot;SOME TEST&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    result </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.generate_options(</span><span class=\"mtk4\">service_type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;email&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># expects exactly two options: a monthly plan and a yearly plan</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  it </span><span class=\"mtk6\">&quot;some other test&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.logger.info(</span><span class=\"mtk6\">&quot;SOME OTHER TEST&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">This version of the test also passed, even on repeated runs. Taking a look at the <code>log/test.log</code> after this test run, the data creation happens before the logging statements and is repeated for each test, but this time, it does get included in the transaction, even though it occurs in the <code>describe</code> block. This is the effect of using the <code>let!</code> helper:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">BEGIN</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;month&#39;, &#39;2022-07-27 22:59:17&#39;, &#39;2022-07-27 22:59:17&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;year&#39;, &#39;2022-07-27 22:59:18&#39;, &#39;2022-07-27 22:59:18&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SOME TEST</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ROLLBACK</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BEGIN</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;month&#39;, &#39;2022-07-27 22:59:19&#39;, &#39;2022-07-27 22:59:19&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Plan Create INSERT INTO `plans` (`service_type`, `recurring_interval`, `created_at`, `updated_at`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">             VALUES (&#39;email&#39;, &#39;year&#39;, &#39;2022-07-27 22:59:20&#39;, &#39;2022-07-27 22:59:20&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">RELEASE SAVEPOINT active_record_1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">SOME OTHER TEST</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ROLLBACK</span></span></code></pre>\n<p class=\"markdown-para\">The <a href=\"https://relishapp.com/rspec/rspec-core/docs/helper-methods/let-and-let\" class=\"markdown-link\">docs</a> for the <code>let/let!</code> helper methods say:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">The value will be cached across multiple calls in the same example but not across examples.</p>\n</blockquote>\n<p class=\"markdown-para\">Which explains why the inserts are running repeatedly for each test. But what was less clear to me was that using the <code>let/let!</code> helper moves the execution of the logic into the transaction and therefore gets rolled back. Recall when the data creation was run in the <code>describe</code> block without the use of <code>let/let!</code> helper, it ran outside of each test transaction and got committed.</p>\n<h2 class=\"markdown-subtitle\" id=\"which-is-better\" style=\"position:relative;\"><a href=\"#which-is-better\" aria-label=\"which is better permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Which is Better?</h2>\n<p class=\"markdown-para\">So the problem of ensuring created data is rolled back can be solved in two ways. Either specify the data creation right in each example that needs it, i.e. in the <code>it</code> block, OR, if multiple tests need the same data, it can be created up one level in the <code>describe</code>, but then it must use the <code>let/let!</code> helper methods.</p>\n<p class=\"markdown-para\">Given the <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" class=\"markdown-link\">DRY</a> principle, it's tempting to say the better solution is to move the data creation up into <code>describe</code> block so it doesn't need to be repeated for each test. However, this has no impact on test performance because the data will still be created and rolled back for each example (as we saw earlier in the <code>log/test.log</code> file).</p>\n<p class=\"markdown-para\">Also \"DRYing\" up the tests can make them harder to read as it requires scrolling up to the top of the test file to understand where data, variables etc were defined. For a small test file maybe this isn't a big deal but can become an issue as the number of tests grow.</p>\n<aside class=\"markdown-aside\">\nA full discussion of optimal test design, is outside the scope of this post, but if you're interested in this topic, check out this Stack Overflow discussion on <a class=\"markdown-link\" href=\"https://stackoverflow.com/questions/6453235/what-does-damp-not-dry-mean-when-talking-about-unit-tests\">DAMP vs DRY</a> and an <a class=\"markdown-link\" href=\"https://www.globalapptesting.com/engineering/lets-take-a-closer-look-at-the-tests-created-in-rspec\">RSpec specific take</a> on DRY and let.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered some troubleshooting techniques you can use when RSpec tests are failing due to data not being cleaned up from the test database. Using these techniques, we have discovered that the <code>let/let!</code> helper methods have the effect of including any data created as part of the example's transaction. We also briefly touched on test design as to where data creation should be located.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/when-rspec-doesnt-rollback/"}}},{"node":{"id":"50a20a25-7223-5e5b-b818-72c4b9799868","frontmatter":{"title":"Maximize Learning from Screencasts","date":"November 2022","category":"career"},"excerpt":"This post will cover some techniques to get the most out of online learning with screencasts. There are many services offering this…","html":"<p class=\"markdown-para\">This post will cover some techniques to get the most out of online learning with screencasts. There are many services offering this including <a href=\"https://www.pluralsight.com/product/skills\" class=\"markdown-link\">Pluralsight</a>, <a href=\"https://www.linkedin.com/learning/subscription/topics\" class=\"markdown-link\">LinkedIn Learning</a>, <a href=\"https://wesbos.com/courses\" class=\"markdown-link\">Wes Bos Courses</a>, and <a href=\"https://www.learnui.design/\" class=\"markdown-link\">Learn UI Design</a> to name just a few. I happen to have the most experience with Pluralsight, but the advice in this post applies to all screencast style courses. Note that these are generally paid services.</p>\n<h2 class=\"markdown-subtitle\" id=\"definition\" style=\"position:relative;\"><a href=\"#definition\" aria-label=\"definition permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Definition</h2>\n<p class=\"markdown-para\">A screencast is a digital video recording of a computer screen while someone is using it, and usually includes audio narration. A course based on screencasts will have the instructor recording their screen while they run through presentation slides, terminal commands, setting up a development environment, writing code in an editor, running code, etc.</p>\n<p class=\"markdown-para\">Typically these will be broken down into smaller sections rather than one massive recording. When taking the course, you can select which video to watch, then use the video player controls to pause, go forward, go back, speed up and so on. There is no time limit to complete the course, and no one is taking attendance.</p>\n<aside class=\"markdown-aside\">\nIn an ever changing tech landscape, it's beneficial to one's career to keep on learning - whether it be a new language, framework, tool, etc. Video screencasts are just one of many different ways to do this. I've written about different types of learning I've experienced and <a class=\"markdown-link\" href=\"../how-to-learn-new-things\">pros and cons</a> of each.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"passive-learning\" style=\"position:relative;\"><a href=\"#passive-learning\" aria-label=\"passive learning permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Passive Learning</h2>\n<p class=\"markdown-para\">Let's start with what not to do. Since the course format is video, it's tempting to treat this like a Netflix series, pop some popcorn, sit back, and binge watch.</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 177.99999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAAAAQFAgED/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAABk03lleSSOKukPTPbooXDdYBbAF//xAAbEAEAAwEBAQEAAAAAAAAAAAACAAEDBBEQEv/aAAgBAQABBQK80ZhzVF1EL2qidqI2bx91pmXqZmyaP72TCK5jSlfP/8QAGBEAAwEBAAAAAAAAAAAAAAAAAQIQABH/2gAIAQMBAT8BCQPzF7//xAAYEQACAwAAAAAAAAAAAAAAAAAQEgABAv/aAAgBAgEBPwFheYp//8QAHRAAAgIDAAMAAAAAAAAAAAAAAAERIQIQEjFBgf/aAAgBAQAGPwK0dZr4znHGlrmYIZJZakm+z2yGhtrxv//EABwQAQEBAAMBAQEAAAAAAAAAAAERACExQVEQYf/aAAgBAQABPyEoXBzSn+YcU8FsyDVKWS5H2mSlxHRtQPXXzh+5HUOvk+Y3MD16MkWOepeLuHX5/9oADAMBAAIAAwAAABCQOvN7/wD/xAAZEQEAAgMAAAAAAAAAAAAAAAABADEQESH/2gAIAQMBAT8QR6R3GtEWs//EABgRAQEBAQEAAAAAAAAAAAAAAAEAERAx/9oACAECAQE/EEWFq7Ayfef/xAAeEAEAAgIDAQEBAAAAAAAAAAABABEhMUFhgZFRcf/aAAgBAQABPxCvTFNXvj+zEt9naQV7MAF9ENqC8X+w8rUBioRVN97h8isFXJdYgcx0qF+7gRbihgYlJUKSW+iPqU31gwHB5Og3SzyDMaAZB5HQAAaAm9g+T//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"popcorn\"\n        title=\"popcorn\"\n        src=\"/static/c4bb19ff7c8861674a18c2407accd94e/066f9/popcorn-linus-mimietz-uWjBqbCHY7g-unsplash.jpg\"\n        srcset=\"/static/c4bb19ff7c8861674a18c2407accd94e/e07e9/popcorn-linus-mimietz-uWjBqbCHY7g-unsplash.jpg 200w,\n/static/c4bb19ff7c8861674a18c2407accd94e/066f9/popcorn-linus-mimietz-uWjBqbCHY7g-unsplash.jpg 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">This is the passive approach, and while not a complete waste of time, it's not the most effective way of learning. You're likely to forget most of what was covered. Instead, I recommend active learning. This requires more effort and takes longer, but the payoff is more information retained and a higher quality learning experience.</p>\n<h2 class=\"markdown-subtitle\" id=\"organize\" style=\"position:relative;\"><a href=\"#organize\" aria-label=\"organize permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Organize</h2>\n<p class=\"markdown-para\">One of the most effective ways to retain what you've learned is to write it down as you go. This requires some organization, a kind of <a href=\"https://en.wikipedia.org/wiki/Mise_en_place\" class=\"markdown-link\">mise en place</a> for techies.</p>\n<p class=\"markdown-para\">When starting a new course, create a directory. I suggest having one directory for all courses, then sub-directories for each course you take. For example, if taking a course on Idiomatic Ruby from Pluralsight:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">cd</span><span class=\"mtk1\"> </span><span class=\"mtk7\">~</span><span class=\"mtk1\">/path/to/courses</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">mkdir idiomatic-ruby-pluralsight </span><span class=\"mtk7\">&amp;&amp;</span><span class=\"mtk1\"> </span><span class=\"mtk9\">cd</span><span class=\"mtk1\"> idiomatic-ruby-pluralsight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">mkdir exercises doc-images</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">touch README.md</span></span></span></code></pre>\n<p class=\"markdown-para\">The resulting directory will be something like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">courses</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">└── idiomatic-ruby-pluralsight</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ├── README.md</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ├── doc-images</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    └── exercises</span></span></code></pre>\n<p class=\"markdown-para\">The <code>README.md</code> is where the course notes will go. It doesn't have to be markdown, you could write in a plain text file, or even a Google/Microsoft/Libre Office document. But I've found that <a href=\"https://en.wikipedia.org/wiki/Markdown\" class=\"markdown-link\">markdown</a> is optimal for technical writing as it supports syntax highlighted code blocks.</p>\n<p class=\"markdown-para\">The <code>exercises</code> folder will be used for saving any code examples developed during the course. The <code>doc-images</code> folder is where you will place any screenshots - for example, if taking a course on css, svg, or developing a web app, it will be useful to save screenshots of what the app looks like as you build it up, and then reference these images in <code>README.md</code>.</p>\n<p class=\"markdown-para\">Most courses are broken up into major sections, with each section having several smaller subsections with a short video for each. A good place to start organizing your notes is to create headings and subheadings matching the course structure. This way you'll know where to add your notes as you're watching each video.</p>\n<p class=\"markdown-para\">For example, here's the table of contents from the Idiomatic Ruby course on Pluralsight:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 389px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 363%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAABJCAYAAAA9mQYkAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKcklEQVRYw41YZ3cbtxbcX5BiWSLV2LlsyyWXvfcqURTVmy3JvcRxjpO8xCftvPfL5525S6xpWrbz4RIgFsBeAHPnDlbzBiOIGmn4wzGxUDQBfziKmJFGKGrAE9AR0OPY8oWwtuGBe8v3RdPK9RZevv4RJ+dXOL+6xpNnL9Eb7uLw5BxPX7ySsj+eQI8lcd+99fUJV9e3pSNLVacnK65NKbf9Ybg2vVjb8MoA1r84YbXREQ/Ek9EupgfHGO7sYf/wFN6gLi9Rnb82mUyo9oim9pD7GowksOkNftR5fdv/1Yllyd+uuPDtihvfra7bdt+Nb+6tSakOYsW9hXtrG47Hn5tUixop7B+eoN0bodbqodUdotUbYrg7xWiyj3DMEM9K1SYq9TbiSeujbfhkwk1vANl8EclUBjHDRNxIwUxnkbJysLIFeAJhrK1vIxw1EEum4QtFnYO7yzRvIodVqw13ros1q41Vq4X7aVoTK6kmtqNpBPU4vKEYPMEofOEYAhEDgUhiyew2rdjoozWaodAYYDA9wWh2htH+KYbTE+weXaI52EO+2kGh3rOt1r3TpE+tC62/e4Drxy/RHkxwfHGNm6ev8Pj5D7h+/ELax/snyJSayFXaX7RqeySl1uzv4uDsIerdHTT7E4ynJxjuHUk9VagjN3/zl6xY76HSGqJQ60GLpwrwR5JIWEWwHklmETVziNFSeSTSBSQzJRh3GNv5nP3Y37BK0Aji2eGJnFDCzCCVLSCRyiCZzkmdQOcpE3fLxjH+UFROn/AT2JBFyrWmdCC7cDI9bkrdSGUlgtY+A2KOoUMkDoVXjeHFSVxbPqEqkoHHH4Y3oGPLG/xXlEWnNjwB20O+4fzqoYDVzOSRL9eQL1WRK1aRzhXvWKrHWS4jZsPjh5HOSgTJhBEjI6CMJrPw6wZ84QR8egLBaFLqNmCT8oxtwagJf8QAx0WTGSn1RBq6Ycl/rVDrIF/vC4Yurp/i9OoRjs6vBX/nD5/g6vYZLm6e4fLmGY4vbzE9usDV7XOUmwPkCZt6T2Bjg74HrdDfR/fyJbKtMW4ev8DN09d49PwHHF/cYHp8idnJFfaPL3F49lDKnf0THJw+EPxly61PAK4VR8cY3P6EbGeKiwe3ePT8DZ68/BEnl7dIF+pI5WtI5T+Uqu1zEaPxTbnGUN7YHk4x3j/FzuwMg8kRGOfF+ZKW7UOk9D6Kc83MlpE0LZi5CkyrCNMqwMwUxZLpvF3ns+wdxnZGDKOJ47IVaC5/BN7xjUTDulHAerKE9VgG61FL6u6gHSl38h8jyKdLf3ckLQGgubxhrOYHcBNjegquWA4u3YQrZMAVz2NdT8mzO0HNdn8E7ogFN/tt+aFt+0Jo1BoCVj0SRzAUQSAUQTAcRViPYsvj/2z+YPvGtg9efwhen53QNFL723e/CuqZS5hHGp0+Ov0x9mbHoir47K6Mx3ZmR/ZnvmH4aYsdmNyZ6e6t2SVtUQCovioM7Uk9+H51QzIi27RIwsRf//xPBlWbHUny472ZJH16W2t2sTs9RKPdv9NDUl693ZOsKB7yARXC8j5xiTTVTiZanlDV2c9hG+4BRRFhYOVKKJTrsh+5UhXFagPFSgP1Vk88WU7yHEO+5LhY0rL5kG/m8vgwmkghlSkIU7NMZ4tIpLKyHLLyMjfyP/N00srJc5mQ5MgBfKsvGBEG5hbwRaxzAA9LSbnlJXOpJGWlgwQ2P81hU2t2MJ7sozvYQaXRRqc/ws7ezIHOMg7ZFkmk0OoOhJgd2Kil0IvvV9fFVJ1w+BL9c1LCZmUOK41Z7Zf/vJdl8fgJmd5wR7yjt4QRl7S6FM9MBRzDfSe0eIiyh9QqRjoHTyACfziOYMSALxRDQE/YOkZPYMsfxrbsaRSeYERM1dk3JFnPlDaNmqTaGoo26e8coLczE+VQ744lDXRH+6BcqbaHjn5Z1jQkVrI369re4Tne/vw7hpNDXF4/xYs37/DyzTvcPnuNx8/f4PXbX/D01Vv0d2awik1ngkXLV9uodcb2hGRmUj49YeNoeozJwTl2D85EJNHSxYYMtD3qSnLKz+uKtW1t04WWzJahG1mYuSqSmTL438iUkbBKjvGZVWA+qX1iZG3qIlo6X4PG0Lm6fiQnly1UJLlnixUJuQz/Z4u2vrlDQYi2CccksihbHOWwOz0QWHDCcq0lxjiuNtoS24TGImwWY5m3rky+LKH6kbZZZhp1+VEhxdIXimDbH/qEExXbCLCpmt798hvuu7clhMgsJIu92ZGUg/EE/dFEbgndwRij3akwDAfTa3ovN4hm90PoqfBiqULPDr9tp43szbvMN/dc+O7+urOnqxse+c8+NmPHTfz5938dxiYz8430lHXmC4YiS/WM3pMUGO8MS7KVw9hcfziWdKiIdMb9UnU+p15kduQBKlpbzDO86zj0FQjHcPnwVpZAfUgpzFOjxc2MBL3IZDMjZEskmJmClKGIfS80rfwH2JBAD47PZEJijuzLyciHhA4H5ks1gUWmUJal8fAIKSY4amzilvh1YMNJFDS4VJqtTgOO8ZmjXOcHog7Gtblw16Pbv73/QzBH8d7s9AUqhAj5kQdSrNSFF8no7d5QPCSTcyxhZ6fRxjzrRZNyhwvFTGwHItjy03QpN312yeds43NP0L7rUS5zDMdTLrONnKjxSkV2KTX6IoVnpw+kpFES8/90rmBpvHWxb8nRjov1HjRK3l/f/y1Sl/r54eMXYrznnV09EvlLop2dXmF3diqyWHhwLoeVLCYhi4JtDfZwcvUIDd71ervCh6M920ioVqmJbLk9L1vIlFofqVhVLzUHtmjn3c6nG3JXCycshGIpuSqoUpdrgyXXDpb8H46n5RnveWznf47lnU9jlPzx1z9yyo12T04wV6zIaTPUKvWWYI744wnX5uHJux3jl+OJV2JUYpkY4y1I3fV4z2N4qfseTX154mD+ZxyTcYhVuevN+wqwSZD8ZiPaxkjLNYsDRa8YabkYUlAxtOKmJaKIvHh/QUkE9Ji8QHDINzMF8G2UE+RAhpkwdrMjrEPWpnEb2LZ4B+QKGZ4M103FNkr7sa4+W9Fj1tUXEEWodwmnxfSg6fEk3v/5t3Sid/yGw4Npdgc4vXgg+YbkQUYmDw7m0kRNRLHFw+QnL8a7tiaM63bEEj1YcW05eyRezb8qKY+ViFJkoVY1zylJEUt8QOXKPWr3R0JfrNPE405fsiFJg0RBj7hFPPFCpS7UJ4zNH54uZ+dekkF4sjwsQkJgEjfl5O2PbjEhWyWB1cc4ZkNbfYWimOwfiYfEI+FBuPDNZGJijC8gW6s27qFaMrclOHfCYWxuPu8bZF6VcCjECRkVBYwOlcSIR3Xy9IoKw1GwbCCNKxgsftajsc6DYgpViWn5e6LdPj8Uuvr7H3/NYTMRiJCN6dl4MhPYdIc7chhMofSy1rIhxKTGSRnrzc7A9pBXUgUbeqIgYdvmPE0GnTSpImTx7keYcawjRX7+9Xf7FtDqiid8G9UXwczcrCLhri9LfM5PMgw95+LDBrrLU+QB8CFzb1K0t+5kvWVTYoD6htBj/f8A7sck+3psmgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"idiomatic Ruby course TOC\"\n        title=\"idiomatic Ruby course TOC\"\n        src=\"/static/6556559c5822fcfc6504ba6c77df42e9/00a4e/idiomatic-ruby-course-toc.png\"\n        srcset=\"/static/6556559c5822fcfc6504ba6c77df42e9/772e8/idiomatic-ruby-course-toc.png 200w,\n/static/6556559c5822fcfc6504ba6c77df42e9/00a4e/idiomatic-ruby-course-toc.png 389w\"\n        sizes=\"(max-width: 389px) 100vw, 389px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">In this case, I would create headings in <code>courses/idiomatic-ruby-pluralsight/README.md</code> as follows. I also link to the main course website:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"markdown\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\"># Idiomatic Ruby</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">My notes from Pluralsight [</span><span class=\"mtk6\">course</span><span class=\"mtk1\">](https://app.pluralsight.com/library/courses/ruby-idiomatic/table-of-contents).</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">## Blocks, Conditionals, and Symbols</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">### Blocks Coding</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">### Blocks Details</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">## Building Objects</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">### Desired Behavior</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"arrange-windows\" style=\"position:relative;\"><a href=\"#arrange-windows\" aria-label=\"arrange windows permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arrange Windows</h2>\n<p class=\"markdown-para\">If your monitor is wide enough, I've found the optimal window arrangement for watching course videos and taking notes and the same time is to have the video playing on the right half of the monitor, and the editor open on the left half. For example, here's a screenshot from when I was learning Idiomatic Ruby with Pluralsight, at the section where we're learning about Enumerable methods:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsklEQVQoz3WS6W7iMBSFXQIJxU6cDZppS2LHSxbCMqVVh/d/sDOyoSM0Ej8+3WtL9+guh4ynL3T9iEYqiFZDtArilittUYsWebkB4zlinoMl2UPSfA2ijIUddrD9CNOP19gNkNpCKOOFeVogemZgSYokLR7iRIkyHYZhhLYajZSohUAjJISQkLLFtm5w/vzEn+9vVNULVpSBrigojcFYcoscMYuxjCIQN9au72Gt8UL1HY1o8V4LTPsjxqHHr6rCcrlEFEVYLBYIggDzIPDxB6JNByk13mvpi+952wpsG4m8KEApRRzHSNMUWZb5txO9Zz6fg2jbod9Z2N5AKneM9h9Stf4v4Ryz2cwX/HTi8v8FwzAEMV2Hj68Rp/MA02lIrbyQ2+e2EWhkiyTheHoiVxEvNPf5PX5cQq4damugO+Njq6/WcTZy4zqq1zcU5dofJHT7C0PfjWO1WoEyBs5TXC6X65Wnwwn742+M08HnO3eE6YBx2nsLlS+v4GWFON+AZWskaQmeFZ40Lz1ZsUEtFIhUBqePs2d/PGI6HG+iB/TjDqbrkRVrUGeNJPM8MvYzTfAXtfj/QXTq+K0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screencast notes and video side by side\"\n        title=\"screencast notes and video side by side\"\n        src=\"/static/b0cccffe0da34be4343d735303f1c10d/5a190/screencast-notes-and-video-side-by-side.png\"\n        srcset=\"/static/b0cccffe0da34be4343d735303f1c10d/772e8/screencast-notes-and-video-side-by-side.png 200w,\n/static/b0cccffe0da34be4343d735303f1c10d/e17e5/screencast-notes-and-video-side-by-side.png 400w,\n/static/b0cccffe0da34be4343d735303f1c10d/5a190/screencast-notes-and-video-side-by-side.png 800w,\n/static/b0cccffe0da34be4343d735303f1c10d/c1b63/screencast-notes-and-video-side-by-side.png 1200w,\n/static/b0cccffe0da34be4343d735303f1c10d/29007/screencast-notes-and-video-side-by-side.png 1600w,\n/static/b0cccffe0da34be4343d735303f1c10d/09096/screencast-notes-and-video-side-by-side.png 2104w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">If that's awkward for you, try different arrangements or even put each one one a different monitor if using multiple monitors. Once you find an optimal window layout, stick with that for video learning.</p>\n<aside class=\"markdown-aside\">\nOne way to arrange windows is to use the mouse, hovering over the corner of any window to drag it to resize, and drag to move a window from the top bar. However, it's more efficient to use a windows manager to quickly \"snap\" windows to various positions such as left half, right half, top half, etc. Mac users can try <a class=\"markdown-link\" href=\"https://www.spectacleapp.com/\">Spectacle</a> or <a class=\"markdown-link\" href=\"https://rectangleapp.com/\">Rectangle</a>. Windows users check out this <a class=\"markdown-link\" href=\"https://support.microsoft.com/en-us/windows/snap-your-windows-885a9b1e-a983-a3b1-16cd-c531795e6241\">support</a> article.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"take-notes\" style=\"position:relative;\"><a href=\"#take-notes\" aria-label=\"take notes permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Take Notes</h2>\n<p class=\"markdown-para\">Now that you're organized for note taking, it's time to start watching the videos. But this is not the same as watching funny cat videos on Youtube.</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADXUlEQVQozy3M/VOTBQDA8ecP6crq8rJDzigEIiDEiJcSxoxtAo+ywRxvwzEmMBgwBntgwxFvrknKm2OEIfIi7zAWO5QImxinvZ1Xh0R15+H1B3y7un74/PoRDtcdvAg6ebHu5O8NF4fr7TwPOHi+5uAvfyu/r7ayvyL959mynWdLLfw6Z+WnSQuPJqwEh+uY6algstPIolSCsNlv4vFX9fx218ZOfwX78zYOg/+nXzv4M+DgwN/Kgb+NgzUH+6tt7K04ebogsezSMdVeSsBrZarDyHxLEcKOr4atwctsDVYxVZfLUpPIw+EqHo/XE/Ka2bll5cfZK/y80sMP/s/544GP/W0f966buaFOxaNXMDfQyJef1bJg0yEs9ZSzOWAi5DOz4bnErUolU43nmW1VM27NZaRBpN+Sj8+mxlOpxGvJYbrpAl59NlJmIqP2MpZ9dlbHXMxZdQgB9yUeequ4f93I9qCJu/UiQ3oZI9VyVjvyud2oYsSswO8U+cKQiUuTgqckA6cqnYb0eGbdNQw4jNyQDNwxFyDcrMlnoauM5S49gWtGxurP06eXkRwZTqk8gafeIr7t0aDPiOXE0TcwyuKwX0jlYmwEnko1m9O9eDvr6KjV4TPkIYwaRYJ9Btbd5az1ljFsUjBUkcVCbxEzNiXtshima+UsXhGR9HKGas9hVSShORXNZGclS/1NuKp15GekMlisQnBrFYw0ahhvLmSmTcdoRSYd8vfYm7SwO+XgYlIce8Fr/DJWxe1KOTWnIuguSKdalshEj4WNiV7cdhMmTTaewk8RylOSmLAV4u8qZdGp5XpBGosNeWz3luHKTUOMjKBTLWehqYBxvQxTwtsUx52gQ/MJHoOKSakERXwsYS+9TLfmLMKd4jPca85juz2fULcWt3ga80dRVKVE05z5Ac6s05w9dgxt7Em6xTOYP04kK+xNkl8/Qos6k/nuy3wYGUnEK0dw/Bt+Vy/nUbOS7+0Kdu0KZsVobmaE05d+nKspx2mLO0pT1Gt0JYcxkh3N1bRw2pLeouLkq3TmJjErFZGTEIXy3XCkwiyEUIOc3RYFTyQVT6RsvilLZKskgZAhmQ1tPGvnIvGLMQS1CQQL32cl5x0WVREE1DE8sMgJtYpsWZXctygIGDP4BySyYsmAlpURAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"funny cat\"\n        title=\"funny cat\"\n        src=\"/static/71ee7f27c32a2e10f4e0aa5ed62f60c6/5a190/funny-cat.png\"\n        srcset=\"/static/71ee7f27c32a2e10f4e0aa5ed62f60c6/772e8/funny-cat.png 200w,\n/static/71ee7f27c32a2e10f4e0aa5ed62f60c6/e17e5/funny-cat.png 400w,\n/static/71ee7f27c32a2e10f4e0aa5ed62f60c6/5a190/funny-cat.png 800w,\n/static/71ee7f27c32a2e10f4e0aa5ed62f60c6/02cd5/funny-cat.png 821w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">Every time a significant point is covered in the course, pause the video, and write down what you just learned in the corresponding section of <code>README.md</code> <em class=\"markdown-emphasis\">in your own words</em>. This is key, do not simply transcribe the instructor's words. Make sure you understand the concept enough that you could explain it to someone else, then write down that explanation. In fact, that someone else is \"future you\", who will look back on these notes several months from now to reference the material.</p>\n<p class=\"markdown-para\">The power of writing is that it makes you remember that you learned a topic, even if you don't remember the details. Next time you need to recall that information, you'll be able to pull up your notes and find the section where you wrote it down. Some examples from my experience include negative indexing in Python and the splat operator in Ruby. I haven't used either of these often enough to have memorized the details, but distinctly remember learning about them in courses and can quickly find these topics in my notes whenever I encounter some code that uses these.</p>\n<p class=\"markdown-para\">Furthermore, while video is a great medium for learning, it's slow for recall. Later at work, if you need to pull up a detail that was covered in the course, it would be too slow to try and find in which video section this detail was covered and watch the video again. Or your membership might have expired or the course is no longer available. Your notes serve as a permanent reference.</p>\n<aside class=\"markdown-aside\">\nSome course platforms have a note taking feature built in, but I don't recommend using this. What if the service goes out of business or you no longer wish to pay for it? Then your notes would disappear. It's better to own your own content and have full control over the formatting.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"write-code\" style=\"position:relative;\"><a href=\"#write-code\" aria-label=\"write code permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Write Code</h2>\n<p class=\"markdown-para\">Since these are technical courses, there will be many sections where the instructor writes some code and explains it. This is another good place to pause the video. Write the code yourself in the <code>exercises</code> directory you created earlier, make sure it compiles/runs and returns the same result as shown in the course.</p>\n<p class=\"markdown-para\">Do not just watch the instructor code or copy/paste from the solutions (if provided), it won't stick. There's something very powerful about typing out the code yourself. After each section you type out, look back on it and make sure you understand every line. Go ahead and add explanatory comments, this is not the time to worry about \"clean code\" should there be comments or not. This is educational material - add any comments that will help future you understand the code.</p>\n<p class=\"markdown-para\">Another variation on this is sometimes the instructor will announce the next problem that will be solved in code. This is a good time to pause the video and try to write out the code yourself <em class=\"markdown-emphasis\">before</em> the instructor shows how to do it. Then compare your solution to the instructors.</p>\n<p class=\"markdown-para\">Finally, you'll want to link up the code you wrote to the <code>README.md</code> notes so the explanations you've been writing flow with the code. One way is to place relevant snippets of code directly in the <code>README.md</code> using fenced code blocks. Another way is to link from the <code>README.md</code> to the specific file in the <code>exercises</code> directory. For example:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.000000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVQY03WObW7DIBBEfY3KcQxrzNdicNr7n+1VEEeK1ObHaNDs8manlAtJD9r3DyEpR3sQc6HUE61tKJd6ZY2Q0uUZ5yM+ZWLW8fduhElrJZU6QD4qerQx7JD+1npS2olPStBMSH7sdmAHrHbDiBu+rJapaiDHnb03acBHxx42Ni+sYrFiENlxRojiMEb4mhfmZeV2N380JRfQ3RO1EOvBFjyrtRiR6wLB9CuMYO02sn7JJ02LFea7HY3PVsttfWq5/NU+X75c2b9Af1T2fBDKA68nXhuhvPyBi/pcfgN8gnXgLyyAqq1F4aIaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"screencast example code\"\n        title=\"screencast example code\"\n        src=\"/static/b21e478194874031da2208e6326aaef3/5a190/screencast-example-code.png\"\n        srcset=\"/static/b21e478194874031da2208e6326aaef3/772e8/screencast-example-code.png 200w,\n/static/b21e478194874031da2208e6326aaef3/e17e5/screencast-example-code.png 400w,\n/static/b21e478194874031da2208e6326aaef3/5a190/screencast-example-code.png 800w,\n/static/b21e478194874031da2208e6326aaef3/5205c/screencast-example-code.png 833w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 class=\"markdown-subtitle\" id=\"screenshot-flow\" style=\"position:relative;\"><a href=\"#screenshot-flow\" aria-label=\"screenshot flow permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Screenshot Flow</h2>\n<p class=\"markdown-para\">For courses that have a visual component - such as learning a framework for building a web app, css, svg, etc, you'll want to take screenshots of what you're building and save these as part of your notes. Here's the flow I use for Mac:</p>\n<ol class=\"markdown-list-ordered\">\n<li class=\"markdown-list-item\"><kbd class=\"markdown-kbd\">Cmd</kbd> + <kbd class=\"markdown-kbd\">Control</kbd> + <kbd class=\"markdown-kbd\">Shift</kbd> + <kbd class=\"markdown-kbd\">4</kbd> to turn the cursor into a crosshair. Right click on the mouse and drag to capture the relevant portion of the screen. When you release the mouse, the selection will be saved to the clipboard.</li>\n<li class=\"markdown-list-item\">Open the <a href=\"https://support.apple.com/en-ca/guide/preview/welcome/mac\" class=\"markdown-link\">Preview app</a> using either <a href=\"https://www.alfredapp.com/\" class=\"markdown-link\">Alfred</a> or <a href=\"https://support.apple.com/en-ca/guide/mac-help/mchlp1008/mac\" class=\"markdown-link\">Spotlight Search</a>. The default hot key for Alfred is <kbd class=\"markdown-kbd\">Option</kbd> + <kbd class=\"markdown-kbd\">Space</kbd>. For Spotlight Search it's <kbd class=\"markdown-kbd\">Command</kbd> + <kbd class=\"markdown-kbd\">Space</kbd>.</li>\n<li class=\"markdown-list-item\">Hit <kbd class=\"markdown-kbd\">Cmd</kbd> + <kbd class=\"markdown-kbd\">N</kbd> to create a new file. It will automatically place the contents of the clipboard into the new file.</li>\n<li class=\"markdown-list-item\">Hit <kbd class=\"markdown-kbd\">Cmd</kbd> + <kbd class=\"markdown-kbd\">S</kbd> and save the file to <code>/path/to/course/doc-images</code>.</li>\n<li class=\"markdown-list-item\">Update <code>README.md</code> to link to the newly created image, for example:</li>\n</ol>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"markdown\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Here is what the homepage looks like:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">![</span><span class=\"mtk6\">brief description of image</span><span class=\"mtk1\">](doc-images/my-screenshot.png </span><span class=\"mtk6\">&quot;brief description of image&quot;</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p class=\"markdown-para\">Windows users see this <a href=\"https://support.microsoft.com/en-us/windows/use-snipping-tool-to-capture-screenshots-00246869-1843-655f-f220-97299b865f6b\" class=\"markdown-link\">support article</a> on using the Snipping Tool to capture screenshots.</p>\n<p class=\"markdown-para\">It seems like a lot of steps but since most of this flow uses keyboard shortcuts, you'll get very efficient after doing it a few times. More on keyboard shortcuts in the next section.</p>\n<h2 class=\"markdown-subtitle\" id=\"keyboard-shortcuts\" style=\"position:relative;\"><a href=\"#keyboard-shortcuts\" aria-label=\"keyboard shortcuts permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Keyboard Shortcuts</h2>\n<p class=\"markdown-para\">The process of taking notes and writing code exercises from the video requires frequent pausing of the video player in the browser tab, where the course is hosted, switching to your code editor, then going back to the video player, possibly rewinding back a few seconds if you missed something. Trying to do all this with a mouse will be very tedious and could lead to wrist and shoulder pain due to frequency of switching.</p>\n<p class=\"markdown-para\">I highly recommend learning keyboard shortcuts to control all these activities. The majority of video players I've used support the following:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\"><kbd class=\"markdown-kbd\">Space</kbd> Pause video playback (or resume if currently paused).</li>\n<li class=\"markdown-list-item\"><kbd class=\"markdown-kbd\">Left Arrow</kbd> Go back 10 seconds.</li>\n<li class=\"markdown-list-item\"><kbd class=\"markdown-kbd\">Right Arrow</kbd> Go forward 10 seconds.</li>\n</ul>\n<p class=\"markdown-para\">For switching between applications such as browser and code editor, use <kbd class=\"markdown-kbd\">Command</kbd> + <kbd class=\"markdown-kbd\">Tab</kbd> for Mac, or <kbd class=\"markdown-kbd\">Alt</kbd> + <kbd class=\"markdown-kbd\">Tab</kbd> for Windows.</p>\n<h2 class=\"markdown-subtitle\" id=\"expect-issues\" style=\"position:relative;\"><a href=\"#expect-issues\" aria-label=\"expect issues permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Expect Issues</h2>\n<p class=\"markdown-para\">Sometimes you'll run into an issue where your code doesn't produce the same result as the instructor's or errors, doesn't compile etc. Don't shrug and skip over this. It's important to investigate why your result is different. Here are some possible reasons:</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Bug in your code:</strong> Review your code carefully and compare it to instructors for any typos. This is the root cause of many issues I've encountered in my years of learning from screencasts.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Version mismatches:</strong> It's possible that you have a different version of the language, library, framework etc. than what the instructor has installed. Go back to the beginning of the course and check if it mentions what version(s) are being used, then make sure to install those on your system. Many languages have version managers to make it easy to switch between projects using different versions such as <a href=\"https://github.com/nvm-sh/nvm\" class=\"markdown-link\">nvm</a>, <a href=\"https://github.com/pyenv/pyenv\" class=\"markdown-link\">pyenv</a>, <a href=\"https://github.com/rbenv/rbenv\" class=\"markdown-link\">rbenv</a>, etc. Use these wherever possible.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Operating system mismatch:</strong> You'll be able to tell what operating system the instructor is using from the video recordings of their screen. Windows and Mac are the most common, with the occasional instructor using Linux. It can happen that some code could be operating-system specific such as file paths and line endings. If you encounter this, update the code for your OS.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Bug in course:</strong> The last possibility is a bug in the course. For example, some video editing may have caused a few lines or an entire file that are needed to make the code work get missed from the recording. So even if you've copied the video code exactly, it still may not work. Some course platforms provide the code exercises as downloads. In this case, compare the downloaded solution files to your code to see if something's missing. It may also be possible to contact the instructor to ask about this, for example, Pluralsight integrates the Disqus commenting system for questions and answers. However, it could take a few days to receive an answer. You can also try to do a web search and solve the problem yourself, your solution may end up being different than what was in the course, but it will still be a valuable learning experience to solve the problem.</p>\n<p class=\"markdown-para\">After the issue is fixed, add some notes about what you encountered and how you fixed it in the <code>README.md</code>. Most importantly, try not to get frustrated about encountering an issue. This is part of the learning experience. It's similar to real world development, where sometimes the most learning occurs from fixing a bug rather than when all goes smoothly.</p>\n<h2 class=\"markdown-subtitle\" id=\"tangents\" style=\"position:relative;\"><a href=\"#tangents\" aria-label=\"tangents permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tangents</h2>\n<p class=\"markdown-para\">One of the benefits of asynchronous learning over real-time/in-classroom, is the ability to explore something that piques your curiosity in more detail, but isn't the main topic. This could be an API that's used, or maybe the course only covers the happy path and you want to see what happens during some exceptional conditions.</p>\n<p class=\"markdown-para\">Some examples from my experience - a Rails course I took was using the SQLite database, and added a length constraint to one of the fields but didn't test it. When I tried it, the length limit wasn't enforced. Doing some research revealed that although SQLite supports the SQL syntax for setting length limits on <code>VARCHAR</code> fields, it's not enforced.</p>\n<p class=\"markdown-para\">Another course I took invoked the <code>authenticate</code> method on a User model, which returns the user instance if authentication passed, or false otherwise. I got curious about where this method is defined as we hadn't written any code for it. Digging into this I learned about the <code>inspect</code> method to find more information about a method in Ruby, and eventually traced through the location in the Rails source code.</p>\n<p class=\"markdown-para\">When finished exploring a tangent, make sure to add the results of this exploration to the <code>README.md</code>. This will solidify what you've just learned.</p>\n<aside class=\"markdown-aside\">\nAt this point, some of you might be thinking - wow, with all this note taking, problem solving and exploring tangents, it's going to take forever to complete a course. The way I think about this is not to focus on the number of courses completed in a year, but rather, the enjoyment and quality of the learning experience. In other words, <a class=\"markdown-link\", href=\"https://pubmed.ncbi.nlm.nih.gov/31233318/\">it's the journey, not the destination</a>.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"publish-optional\" style=\"position:relative;\"><a href=\"#publish-optional\" aria-label=\"publish optional permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Publish (Optional)</h2>\n<p class=\"markdown-para\">This step is optional, but I recommend saving/publishing your notes somewhere they'll be easily searchable across devices. This could be any cloud storage such as Dropbox, OneDrive, Google Drive etc. My preference is to push the entire course folder to a Github repository. This is especially a good option when writing the notes in Markdown as they'll be automatically rendered on Github.</p>\n<p class=\"markdown-para\">For example, given the following directory structure:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">courses</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">└── idiomatic-ruby-pluralsight</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ├── README.md</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ├── doc-images</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    └── exercises</span></span></code></pre>\n<p class=\"markdown-para\">I would create a new <em class=\"markdown-emphasis\">empty</em> Github repository named <code>idiomatic-ruby-pluralsight</code> on <a href=\"https://github.com/\" class=\"markdown-link\">Github</a>, with no generated files such as readme or license). It's up to you if you want to make the repo public or private.</p>\n<p class=\"markdown-para\">Then from the terminal:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">cd</span><span class=\"mtk1\"> idiomatic-ruby-pluralsight</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Create a local git repository</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">git init</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">git add </span><span class=\"mtk9\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">gc -m </span><span class=\"mtk6\">&quot;Initial commit&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Connect it to the remote repository on Github</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">git remote add origin git@github.com:your-github-username/idiomatic-ruby-pluralsight.git</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">git branch -M main</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">git push -u origin main</span></span></span></code></pre>\n<p class=\"markdown-para\">You don't need to wait until you're finished the course to publish your notes. I work on small amounts at a time and publish as I go (more on this in the next section). This is to avoid the catastrophic situation of a hard drive crash and losing all the precious notes.</p>\n<aside class=\"markdown-aside\">\nIf your notes have a lot of sections and subsections, it can be useful to add a table of contents to make it even easier to find details later. If the notes are written in markdown, the <a class=\"markdown-link\" href=\"https://www.npmjs.com/package/doctoc\">DocToc</a> package on npm does a great job of this.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"break-it-up\" style=\"position:relative;\"><a href=\"#break-it-up\" aria-label=\"break it up permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Break it Up</h2>\n<p class=\"markdown-para\">I do not advise attempting to complete a course in a single session. For example, many courses on Pluralsight are approximately 2 to 3 hours in duration. This sounds like it could be completed in a morning or afternoon. However, remember you're going to be stopping to take notes, do the exercises, go on tangents, and fix issues. Not only does this extend the time to complete the course, it consumes significantly more mental energy than passively watching.</p>\n<p class=\"markdown-para\">There's also a limit to how much new information the brain can absorb all at once. This varies by person, but I've found that doing one or at most two subsections in a single learning session is just the right amount to optimize absorbing new information. This avoids exhaustion so I'm looking forward to returning for a session another day. More on this in the next section on habits.</p>\n<h2 class=\"markdown-subtitle\" id=\"make-it-a-habit\" style=\"position:relative;\"><a href=\"#make-it-a-habit\" aria-label=\"make it a habit permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Make it a Habit</h2>\n<p class=\"markdown-para\">One problem that can occur when the videos can be watched at any time, is that after an initial bout of enthusiasm, learning drops off. Somehow there's never enough time in the day to get around to sitting down with the videos and writing your notes. Or you wait to feel inspired but by the time it occurs to you to do some learning, its late and you're tired. The solution to this is to make learning a <em class=\"markdown-emphasis\">habit</em>:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">A habit is a routine or practice performed regularly; an automatic response to a specific situation.</p>\n</blockquote>\n<p class=\"markdown-para\">Here are a few techniques for cultivating the habit of learning.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"small-amounts-regularly\" style=\"position:relative;\"><a href=\"#small-amounts-regularly\" aria-label=\"small amounts regularly permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Small amounts regularly</h3>\n<p class=\"markdown-para\">It can be overwhelming to find an hour or more in a typical day to fit in learning. Instead, start with a very small amount, even 5 - 10 minutes, and commit to this several days a week. For example, Tuesday, Wednesday, and Thursday of each week, after dinner, you'll sit down for just 10 minutes with your code editor and the video course to listen and take notes. That's just an example, pick whichever days and times work for you, as long as its regularly occurring.</p>\n<p class=\"markdown-para\">You might be thinking what difference could 10 minutes possibly make? The key here is making the learning activity happen regularly. Those small increments will add up surprisingly quickly. For example, 10 minutes a day, 3 times per week is a half hour. In a year (let's say approximately 50 weeks, accounting for some vacation), that's 25 hours. Furthermore, with enough repetition, you may find that 10 minute session stretch out to 20 minutes of even a half hour, especially if you're enjoying what you're learning. That would get you to 75 hours per year! Imagine how much learning you can cover in that time.</p>\n<p class=\"markdown-para\">It's fine if you don't get through an entire subsection. Simply add a line to your notes such as <code>Left off at 2:35 of Map: Transforming Collections</code>. This makes it easy to pick up again in your next learning session.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"make-it-easy\" style=\"position:relative;\"><a href=\"#make-it-easy\" aria-label=\"make it easy permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Make it easy</h3>\n<p class=\"markdown-para\">Speaking of making things easy, this is another key to habit formation, if you have to overcome too many hurdles to start the activity, it won't get done. Think of trying to start an exercise program but the gym is an hour's drive away and your workout clothes are in the bottom of the laundry hamper, vs an at home workout or a park in your neighborhood and clean workout clothes ready to go. Similarly with screencast video learning, there's a few things you can do to make it easier to get each learning session started.</p>\n<p class=\"markdown-para\">Leave your editor open with the course folder you've started. On a Mac, next time your computer boots up, the editor will be open waiting for you. For Windows users, remembering open apps and files is not a native feature, although you could check out some <a href=\"https://www.pcworld.com/article/410688/how-to-have-windows-re-open-active-windows-and-programs-on-reboot.html\" class=\"markdown-link\">suggestions</a>.</p>\n<p class=\"markdown-para\">Leave the course url open in a browser tab, and enable remember previously open tabs in your browser so the videos will always be there waiting for you. An alternative if you don't want to always have the tab open is to bookmark the course url, then <a href=\"../how-to-access-chrome-bookmarks-via-keyboard\" class=\"markdown-link\">index your browser bookmarks</a> to load it quickly via keyboard.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"habit-stacking\" style=\"position:relative;\"><a href=\"#habit-stacking\" aria-label=\"habit stacking permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Habit Stacking</h3>\n<p class=\"markdown-para\">This is a technique where you identify a current habit you already do each day, and then \"stack\" a new habit on top. The general form of this is:</p>\n<p class=\"markdown-para\">\"After I <code>CURRENT_HABIT</code>, I will <code>NEW_HABIT</code>.\"</p>\n<p class=\"markdown-para\">For example, someone trying to establish a gratitude habit might say: \"After I sit down to dinner, I will say one thing I'm grateful for that happened today\".</p>\n<p class=\"markdown-para\">In this case, <code>NEW_HABIT</code> will be learning from screencasts. For me, I identified <code>CURRENT_HABIT</code> as making coffee first thing in the morning, which I've been doing for over 20 years! This leads to: \"After I make coffee each morning, I will set down my mug at my desk, and have coffee while doing some screencast learning\".</p>\n<p class=\"markdown-para\">This works because it's tying a desired new behaviour (learning from video courses) to something you already do every day, such as making coffee. Think about a typical day in your schedule, identify <code>CURRENT_HABIT</code>, then stack it with the learning habit.</p>\n<aside class=\"markdown-aside\">\nThe advice presented above just scratches the surface on the science of habit formation. It comes from the book <a class=\"markdown-link\" href=\"https://jamesclear.com/atomic-habits\">Atomic Habits</a>, which will teach you how to get 1% better each day. This book draws on research from the fields of biology, psychology, and neuroscience and converts these to practical, actionable advice that anyone can start right away. It sounds cliche to say this book is a game changer, but in this case, it's accurate. Whether you're trying to cultivate a new habit, or drop a bad one, I highly recommend reading this book.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered a number of active learning techniques to get the most out of video screencast courses, and why that's more beneficial than passive learning. It's also covered some advice to make learning a habit. If you only get one thing out of this, it's to write down what you're learning. Writing helps you remember what you've learned, provides a medium for faster recall than video, and is a useful reference even if you no longer have access to the course videos.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/learning-from-screencasts/"}}},{"node":{"id":"dd0209de-ae67-5936-afc4-ef653de147a6","frontmatter":{"title":"Homebrew Postgresql Service not Starting Resolved","date":"October 2022","category":"PostgreSQL"},"excerpt":"This post will cover how to troubleshoot when the postgresql service installed via Homebrew on a Mac isn't starting. If you work on a Mac…","html":"<p class=\"markdown-para\">This post will cover how to troubleshoot when the postgresql service installed via Homebrew on a Mac isn't starting. If you work on a Mac, it's likely you use <a href=\"https://brew.sh/\" class=\"markdown-link\">Homebrew</a> to install packages. In addition to installing, you can also manage services using Homebrew's <a href=\"https://docs.brew.sh/Manpage#services-subcommand\" class=\"markdown-link\">services</a> subcommand, a wrapper for <code>launchctl</code>. A common usage of the services subcommand is to start and stop databases.</p>\n<h2 class=\"markdown-subtitle\" id=\"whats-running\" style=\"position:relative;\"><a href=\"#whats-running\" aria-label=\"whats running permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What's Running</h2>\n<p class=\"markdown-para\">This all started when I wanted to follow along with a Rails tutorial that required scaffolding a new project with <a href=\"https://www.postgresql.org/\" class=\"markdown-link\">Postgresql</a> as the database. For production projects, I prefer to setup all databases in <a href=\"https://www.docker.com/\" class=\"markdown-link\">Docker</a> containers, but for a simple tutorial, it's fine to use a local service, which I had installed some time ago via <code>brew install postgresql</code>.</p>\n<p class=\"markdown-para\">However, I couldn't remember whether the database server was running. To get information about services that are currently being managed by Homebrew, use the <code>list</code> option of the <code>services</code> subcommand:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">brew services list</span></span></code></pre>\n<p class=\"markdown-para\">My output showed I had mysql, postgresql, and redis as managed services, but that postgres wasn't started:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">mysql      started dbaron ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">postgresql none</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">redis      started dbaron ~/Library/LaunchAgents/homebrew.mxcl.redis.plist</span></span></code></pre>\n<p class=\"markdown-para\">So the fix should be simple enough, just start it with the <code>start</code> option of the <code>services</code> subcommand:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">brew services start postgresql</span></span></code></pre>\n<p class=\"markdown-para\">The output of this command showed it was successful:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">==&gt; Successfully started `postgresql` (label: homebrew.mxcl.postgresql)</span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"the-problem\" style=\"position:relative;\"><a href=\"#the-problem\" aria-label=\"the problem permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Problem</h2>\n<p class=\"markdown-para\">But before pressing the <a href=\"https://www.staples.com/Staples-Easy-Button/product_606396\" class=\"markdown-link\">easy</a> button for finding such a quick fix, I wanted to check that a connection worked. PostgreSQL comes with <a href=\"https://www.postgresql.org/docs/current/app-psql.html\" class=\"markdown-link\">psql</a>, a command line tool to interact with the database. You can connect to the default <code>postgres</code> database as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">psql -d postgres</span></span></code></pre>\n<p class=\"markdown-para\">Unfortunately, the output of this command showed the database was not running:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">psql: error: connection to server on socket &quot;/tmp/.s.PGSQL.5432&quot; failed: No such file or directory</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Is the server running locally and accepting connections on that socket?</span></span></code></pre>\n<p class=\"markdown-para\">A further check with <code>lsof</code> (list open files belonging to active processes) confirmed there was no process listening on port 5432, which is the default port used by postgresql. The <code>-nP</code> options indicate not to include host and port names in the Node Name column and <code>+c 15</code> increases the command width display, which otherwise defaults to 9:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">lsof -nP +c 15 </span><span class=\"mtk7\">|</span><span class=\"mtk1\"> grep LISTEN</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># no output for 5432</span></span></span></code></pre>\n<p class=\"markdown-para\">So much for the easy button.</p>\n<h2 class=\"markdown-subtitle\" id=\"debugging\" style=\"position:relative;\"><a href=\"#debugging\" aria-label=\"debugging permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Debugging</h2>\n<p class=\"markdown-para\">The <code>info</code> command can be used to get more detailed information about a specific service. Running it for <code>postgresql</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">brew services info postgresql</span></span></code></pre>\n<p class=\"markdown-para\">The output shows that the <code>postgresql</code> service is loaded, but not running:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">postgresql (homebrew.mxcl.postgresql)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Running: ✘</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Loaded: ✓</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Schedulable: ✘</span></span></code></pre>\n<p class=\"markdown-para\">The <code>brew services list</code> command can be used again, but this time, instead of showing <code>none</code> for <code>postgresql</code>, it shows an error status and path to a plist file (because of the earlier attempt to start it which failed):</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">$ brew services list</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Name       Status     User   File</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">mysql      started    dbaron ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">postgresql error  256 dbaron ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">redis      started    dbaron ~/Library/LaunchAgents/homebrew.mxcl.redis.plist</span></span></code></pre>\n<p class=\"markdown-para\">The <code>.plist</code> files contain service configuration information. Let's take a look at the configuration for the postgresql service:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">cat ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist</span></span></code></pre>\n<p class=\"markdown-para\">The output shows that it's an xml file:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"xml\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;?</span><span class=\"mtk7\">xml</span><span class=\"mtk5\"> version</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;1.0&quot;</span><span class=\"mtk5\"> encoding</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;UTF-8&quot;</span><span class=\"mtk1\">?&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;!</span><span class=\"mtk7\">DOCTYPE</span><span class=\"mtk1\"> </span><span class=\"mtk10\">plist</span><span class=\"mtk1\"> PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">plist</span><span class=\"mtk1\"> </span><span class=\"mtk5\">version</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;1.0&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">dict</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;KeepAlive&lt;/</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">true</span><span class=\"mtk1\"> /&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;Label&lt;/</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;homebrew.mxcl.postgresql&lt;/</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;ProgramArguments&lt;/</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">array</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;/usr/local/opt/postgresql/bin/postgres&lt;/</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;-D&lt;/</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;/usr/local/var/postgres&lt;/</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk7\">array</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;RunAtLoad&lt;/</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">true</span><span class=\"mtk1\"> /&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;StandardErrorPath&lt;/</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;/usr/local/var/log/postgres.log&lt;/</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;StandardOutPath&lt;/</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;/usr/local/var/log/postgres.log&lt;/</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;WorkingDirectory&lt;/</span><span class=\"mtk7\">key</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;/usr/local&lt;/</span><span class=\"mtk7\">string</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk7\">dict</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk7\">plist</span><span class=\"mtk1\">&gt;</span></span></span></code></pre>\n<p class=\"markdown-para\">Notice that one of the values is a path to an error file (actually its the same file used for both standard out and standard error) - <code>/usr/local/var/log/postgres.log</code>. Let's take a look at this file to see if it has any clues as to why postgresql isn't starting:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">$ cat /usr/local/var/log/postgres.log</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">2022-06-16 15:15:04.193 EDT [69330] FATAL:  database files are incompatible with server</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">2022-06-16 15:15:04.193 EDT [69330] DETAIL:  The data directory was initialized by PostgreSQL version 13, which is not compatible with this version 14.3.</span></span></code></pre>\n<p class=\"markdown-para\">Aha, a version incompatibility error! To confirm the version of the currently installed service:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">$ psql --version</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">psql (PostgreSQL) 14.3</span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"solution\" style=\"position:relative;\"><a href=\"#solution\" aria-label=\"solution permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Solution</h2>\n<p class=\"markdown-para\">When the Postgres data directory was first created, I must have been on older Postgres version 13, and at some point updated the brew formula to 14. This version mismatch makes postgresql fail to start. Fortunately, there's a homebrew <a href=\"https://github.com/Homebrew/homebrew-core/blob/master/cmd/postgresql-upgrade-database.rb\" class=\"markdown-link\">command</a> that can be run to migrate the data from a previous major version:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">brew postgresql-upgrade-database</span></span></code></pre>\n<p class=\"markdown-para\">There will be a lot of output from this command, but here are some highlights of what it does:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">brew install postgresql@13</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Upgrading postgresql data from 13 to 14..</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Moving postgresql data from /usr/local/var/postgres to /usr/local/var/postgres.old...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Migrating and upgrading data...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">==&gt; Upgraded postgresql data from 13 to 14!</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">==&gt; Your postgresql 13 data remains at /usr/local/var/postgres.old</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">==&gt; Successfully started `postgresql` (label: homebrew.mxcl.postgresql)</span></span></code></pre>\n<p class=\"markdown-para\">It installs the previous major version of postgresql (in my case, I was on 14 so previous major was 13), migrates, backs up the current data directory to <code>.old</code>, then migrates the data to the new major version. The idea being if something goes wrong with data migration, you can still access your old data with the previous major.</p>\n<p class=\"markdown-para\">Finally this command also starts up the current/latest version of the service. Let's confirm its started:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">$ brew services list</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Name       Status     User   File</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">mysql      started    dbaron ~/Library/LaunchAgents/homebrew.mxcl.mysql.plist</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">postgresql started    dbaron ~/Library/LaunchAgents/homebrew.mxcl.postgresql.plist</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">redis      started    dbaron ~/Library/LaunchAgents/homebrew.mxcl.redis.plist</span></span></code></pre>\n<p class=\"markdown-para\">And re-run the <code>lsof</code> command from earlier to confirm there's a postgres process listening on 5432:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">lsof -nP +c 15 </span><span class=\"mtk7\">|</span><span class=\"mtk1\"> grep LISTEN</span></span></span></code></pre>\n<p class=\"markdown-para\">Output includes postgres, so far so good:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">COMMAND          PID   USER   FD      TYPE             DEVICE  SIZE/OFF    NODE NAME</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">postgres        1788 dbaron    7u     IPv6 0x696b8fad0ce2d7bd       0t0    TCP [::1]:5432 (LISTEN)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">...</span></span></code></pre>\n<p class=\"markdown-para\">Last check is to ensure we can connect:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">$ psql -d postgres</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">psql (14.2)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Type &quot;help&quot; for help.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">postgres=#</span></span></code></pre>\n<p class=\"markdown-para\">This time the <code>psql</code> connection command goes to the <code>postgres</code> prompt, which means connection could be established, success!</p>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has walked through how to fix an issue with the postgresql service not starting on a Mac when managed by homebrew. In general when debugging homebrew services, use the <code>brew services list</code> command to get information about managed services and their plist files which contain configuration for the service. Then inspect the contents of the plist file to see if it specifies any log files. Then check the log file(s) for reason why service won't start and fix that.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk10 { color: #FD971F; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/homebrew-postgresql-service-not-starting-resolved/"}}},{"node":{"id":"ba57bc3c-86eb-5750-ac7d-d97b060b81dd","frontmatter":{"title":"SQLite Varchar Surprise","date":"September 2022","category":"rails"},"excerpt":"I recently completed the Getting Started with Rails 6 course on Pluralsight and ran into a surprise with the use of SQLite and string column…","html":"<p class=\"markdown-para\">I recently completed the <a href=\"https://app.pluralsight.com/library/courses/getting-started-ruby-rails/table-of-contents\" class=\"markdown-link\">Getting Started with Rails 6</a> course on Pluralsight and ran into a surprise with the use of SQLite and string column lengths. SQLite is a popular choice in Rails courses as its the default database when starting an app with the <code>rails new...</code> command and very easy to use. However, I was surprised by how it handles string column lengths as this post will explain.</p>\n<h2 class=\"markdown-subtitle\" id=\"setup\" style=\"position:relative;\"><a href=\"#setup\" aria-label=\"setup permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup</h2>\n<p class=\"markdown-para\">The course uses Ruby 2.7.2 and Rails 6.1.4 to build a Wiki application where users can create, view, and edit posts. It also assumes that <a href=\"https://formulae.brew.sh/formula/sqlite\" class=\"markdown-link\">sqlite</a> is installed on the local machine. There's a single model <code>WikiPost</code> to persist the author, title, and description.</p>\n<p class=\"markdown-para\">To get started, the <code>scaffold</code> option of the <code>generate</code> command is used to generate not just a migration for the model, but also the model class, controller, views, view helpers, styles, routes and tests. For the purpose of this post, we will only be focusing on the migration and model.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">bin/rails generate scaffold WikiPost title:string description:string author:string</span></span></code></pre>\n<p class=\"markdown-para\">Generates this migration:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">CreateWikiPosts</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">6.1</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    create_table </span><span class=\"mtk4\">:wiki_posts</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |t|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.string </span><span class=\"mtk4\">:title</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.string </span><span class=\"mtk4\">:description</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.string </span><span class=\"mtk4\">:author</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.timestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">And this model:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">WikiPost</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">After running the migration with <code>bin/rails db:migrate</code>, we can use the <a href=\"https://www.sqlite.org/cli.html\" class=\"markdown-link\">sqlite3</a> command line tool that ships with SQLite to see what schema got created for this table. To work with any SQLite database from the terminal, run <code>sqlite3</code> passing in the path to the database file. In a Rails project, it will be in <code>db/{env}.sqlite3</code>. To open the development database, the command is:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># cd to the project root</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">sqlite3 db/development.sqlite3</span></span></span></code></pre>\n<p class=\"markdown-para\">From the sqlite prompt, the <code>.schema table_name</code> command can be used to display the schema for the given table name. By default, the display is all on line line which is hard to read. Passing in the <code>--indent</code> option produces more human readable output:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">sqlite</span><span class=\"mtk7\">&gt;</span><span class=\"mtk1\"> .</span><span class=\"mtk7\">schema</span><span class=\"mtk1\"> wiki_posts </span><span class=\"mtk3\">--indent</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">IF</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">EXISTS</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;wiki_posts&quot;</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;id&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">integer</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\"> </span><span class=\"mtk7\">PRIMARY</span><span class=\"mtk1\"> </span><span class=\"mtk7\">KEY</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;created_at&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">datetime</span><span class=\"mtk1\">(</span><span class=\"mtk4\">6</span><span class=\"mtk1\">) </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;updated_at&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">datetime</span><span class=\"mtk1\">(</span><span class=\"mtk4\">6</span><span class=\"mtk1\">) </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;title&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\"> DEFAULT </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;description&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\"> DEFAULT </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;author&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\"> DEFAULT </span><span class=\"mtk7\">NULL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">);</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"limit-length\" style=\"position:relative;\"><a href=\"#limit-length\" aria-label=\"limit length permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Limit Length</h2>\n<p class=\"markdown-para\">After trying out the generated UI and adding some styles, it's determined that it would be better to limit the title length. In the course it gets set to 50 characters, but for easier demonstration purposes, I will use 10 here. To modify the table definition, we first need to generate a new migration:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">bin/rails generate migration update_wiki_post_title</span></span></code></pre>\n<p class=\"markdown-para\">We use the <code>change_column</code> method in the migration file to change the <code>title</code> column in <code>wiki_posts</code> table to have a max length of 10 characters. Note the use of <code>up</code> and <code>down</code> methods rather than <code>change</code> because otherwise if running a rollback, Rails won't know what the previous state of the column was to undo this change:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">UpdateWikiPostTitle</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">6.1</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    change_column </span><span class=\"mtk4\">:wiki_posts</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:title</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:string</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:limit</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk4\">10</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">down</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    change_column </span><span class=\"mtk4\">:wiki_posts</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:title</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">After running this migration with <code>bin/rails db:migrate</code>, run the <code>sqlite3</code> command line tool again to verify the <code>wiki_posts</code> table schema has been updated to limit the title length:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">sqlite</span><span class=\"mtk7\">&gt;</span><span class=\"mtk1\"> .</span><span class=\"mtk7\">schema</span><span class=\"mtk1\"> wiki_posts </span><span class=\"mtk3\">--indent</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">IF</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">EXISTS</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;wiki_posts&quot;</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;id&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">integer</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\"> </span><span class=\"mtk7\">PRIMARY</span><span class=\"mtk1\"> </span><span class=\"mtk7\">KEY</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;created_at&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">datetime</span><span class=\"mtk1\">(</span><span class=\"mtk4\">6</span><span class=\"mtk1\">) </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;updated_at&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">datetime</span><span class=\"mtk1\">(</span><span class=\"mtk4\">6</span><span class=\"mtk1\">) </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;title&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\">(</span><span class=\"mtk4\">10</span><span class=\"mtk1\">) DEFAULT </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;description&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\"> DEFAULT </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;author&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\"> DEFAULT </span><span class=\"mtk7\">NULL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">);</span></span></span></code></pre>\n<p class=\"markdown-para\">Notice the <code>title</code> column now has a column type of <code>varchar(10)</code> whereas before it was simply <code>varchar</code>. It would be expected that now any rows saved to the table can have at most 10 characters for the title.</p>\n<h2 class=\"markdown-subtitle\" id=\"the-problem\" style=\"position:relative;\"><a href=\"#the-problem\" aria-label=\"the problem permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Problem</h2>\n<p class=\"markdown-para\">Let's try this out using the <code>WikiPost</code> model in a Rails console <code>bin/rails console</code>, and try to save some invalid data, that is, a model instance with a title longer than 10 characters:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Create a new post with a title of 11 characters</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">a_post </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">WikiPost</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">title:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;abcdefghijk&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Try to save it to the database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">a_post.save</span></span></span></code></pre>\n<p class=\"markdown-para\">I was expecting an error at this point, however, the output from saving the model shows that it was successfully saved to the database:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">  TRANSACTION (0.1ms)  begin transaction</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  WikiPost Create (3.3ms)  INSERT INTO &quot;wiki_posts&quot; (&quot;created_at&quot;, &quot;updated_at&quot;, &quot;title&quot;) VALUES (?, ?, ?)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  [[&quot;created_at&quot;, &quot;2022-06-15 11:14:59.474262&quot;], [&quot;updated_at&quot;, &quot;2022-06-15 11:14:59.474262&quot;],</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  [&quot;title&quot;, &quot;abcdefghijk&quot;]]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  TRANSACTION (1.4ms)  commit transaction</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">=&gt; true</span></span></code></pre>\n<p class=\"markdown-para\">Me:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGQABAAMBAQAAAAAAAAAAAAAAAAMEBQEG/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAG45Bl1kSKmeT6EYf/EABwQAQACAgMBAAAAAAAAAAAAAAEAAgMREiEiMf/aAAgBAQABBQI1F1MbyqJUlFrXH3fG+j5//8QAFxEAAwEAAAAAAAAAAAAAAAAAAQIQMf/aAAgBAwEBPwFRBk//xAAXEQEAAwAAAAAAAAAAAAAAAAABABAR/9oACAECAQE/AVm3/8QAHhAAAQMEAwAAAAAAAAAAAAAAAAERIQIDEDEyUaH/2gAIAQEABj8C1JGxx1I9OJU/SFzH/8QAHBAAAwACAwEAAAAAAAAAAAAAAAERMWEhQXFR/9oACAEBAAE/IbPbnRepawbnRvVL1S+GWr9oVUmFUJOZBkK+LNGHw//aAAwDAQACAAMAAAAQbDBC/8QAGBEBAAMBAAAAAAAAAAAAAAAAAQAQIRH/2gAIAQMBAT8QBOsTcu//xAAXEQEBAQEAAAAAAAAAAAAAAAAAAREx/9oACAECAQE/EKRleq//xAAeEAEAAwACAgMAAAAAAAAAAAABABEhMWFxsVGBkf/aAAgBAQABPxA7kqgTjGe4a0y6jzo36lehLBHa6/Ki62XppWNndPM34lE5z5meiCl0I3OLI1X24m1daep//9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sqlite surprise huh\"\n        title=\"sqlite surprise huh\"\n        src=\"/static/637fc118fd985e597fcbf7c441b3cde2/066f9/sqlite-surprise-huh.jpg\"\n        srcset=\"/static/637fc118fd985e597fcbf7c441b3cde2/e07e9/sqlite-surprise-huh.jpg 200w,\n/static/637fc118fd985e597fcbf7c441b3cde2/066f9/sqlite-surprise-huh.jpg 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">Well that was unexpected! What's the point of creating and running a migration to limit a column length if Rails ignores it and goes ahead and saves data that violates the limit?</p>\n<p class=\"markdown-para\">My first thought was maybe there was an issue with the combination of the Rails and SQLite versions used in the course. To investigate this, we can try bypassing Rails and use  <code>sqlite3</code> to try a direct insert into the database with the same too long title:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- Try to save invalid data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">INSERT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">INTO</span><span class=\"mtk1\"> wiki_posts(title, created_at, updated_at)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">VALUES</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;abcdefghijk&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk9\">CURRENT_TIMESTAMP</span><span class=\"mtk1\">, </span><span class=\"mtk9\">CURRENT_TIMESTAMP</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- Returns control to the prompt with no error, this means it worked.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- Verify</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">SELECT</span><span class=\"mtk1\"> title, created_at, updated_at</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> wiki_posts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ORDER BY</span><span class=\"mtk1\"> created_at </span><span class=\"mtk7\">DESC</span><span class=\"mtk1\"> </span><span class=\"mtk7\">LIMIT</span><span class=\"mtk1\"> </span><span class=\"mtk4\">1</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- Outputs: abcdefghijk|2022-06-16 10:54:27|2022-06-16 10:54:27</span></span></span></code></pre>\n<p class=\"markdown-para\">Surprisingly, the database allows data that violates the length constraint to be inserted. So this isn't a Rails problem, it seems to be a problem with SQLite. I did a little digging, and it turns out SQLite doesn't enforce varchar length limits. From the <a href=\"https://www.hwaci.com/sw/sqlite/faq.html\" class=\"markdown-link\">FAQ</a>:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">SQLite does not enforce the length of a VARCHAR. You can declare a VARCHAR(10) and SQLite will be happy to store a 500-million character string there. And it will keep all 500-million characters intact. Your content is never truncated. SQLite understands the column type of \"VARCHAR(N)\" to be the same as \"TEXT\", regardless of the value of N.</p>\n</blockquote>\n<p class=\"markdown-para\">Me:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD8ElEQVQ4yx2O229TBQCHz5/gX+Az8cUnMVFjYuIbYGKCAQlRH0iUxESjiYC7wBCYQ4Zc57otbHSOjW7dpRfW9bb2dL2cnbbr6e303m5d293aXVpYIprPjIcvv7fv9wm3AmZ6Qg7+UNz0RL30JGTuplf4qxBjtJzkeTXDWDXLaC3PXKOMZ38Vz7qMmDQTiTxDDQ6w7LmPU9QwL08h3Asv8Cgu8jgV4GFK5mFOob+UYGRdZWozi6lexNBYY2a3jHFvHdtWAlfajC/QR0rsoua9xJrjR+ILHfh9wwiPlQX6VZHB7DKaXBhNQWGwFENbUdFvZ1nYW8XRrGJrVbG0qlirIbyBPuTZiyT056jZz1J3nmfVeQklqEUYSth5kvEwkpcYKYYZWYsxupljoqoy90ZYwnlQxvNvA+fuGo6NKN7EJJLrFpK9nZi3jUy4m2hyFH/eiTBZ9DFdCWLYUDBvJVhoZBk33MUweYOlnSz+wwoRWvgKAaz2CeRGHn9tCU/WwFLGiC9jIFCysVSTWKyGEea3FRx7Ku79NCtsYku46bvwLsbek/hjBtKAuGxBe/U80oqDzOEqUkGHQ/4Tq9SPLTjMYtqIeyOEazuOYN9LIbayLL8u495Q+PniZ1w4cRz9L++THDuDbOpl7vpJXLanlDkgUxdZCbfjMZ3GojvNgvE7RLkPb8WPWFcRnAdZxGaOCHXua67y9XtvcfnU20xd+YBdzXESHe/gfHAGl6gjvhEmlR+kFPuenPQlEdc5IsFOoqsGgo0YS7tphMVmDvFlgcDrKr03v+KnT45x4/NjjLd/yGLXR4g3PuXpr6dw6HvwxJ2EFA3FVBv5bCdquhu1OkuilSTYKuBpJBFs+xns+xnEf2qMWIf49sTHXD5/Fs/wNyw++gI56yO2t044L7GU9SMVzIRK4ywfsTZLqBEi9KqIv5nHtRNHmNqMc8TcQRFtyEhH9w/cvnOVFxO/Y9H9RvBllTiHKByy8t8WgVYadyOGazuMayeC+yimmce9m8a2FUXoz8sMFEMMlRU0aR/3Aia6ZrRoTEPY/E8IbERxv6pgbpYxHZQxNcuY9wvM11Xmd5Jv1l5P4t6OYa2EELqjNu4knfSqLm6nPPTkJHrzfgZzfmwlLx7VgaEoo1tfYaYcQVeJMl6LMF0NY6yEMK7LWMrLuMo+LAU3Qpt/nK7gFNfkSdqk51yWnnNF1nEzpEOrzDCnmtHGDQzHjUwmX6BV5xnMWBnLLzKTd6PPONGnbRjSFqaSJoT2wN90SmN0SKN0Bie4pui5Hp3mlqLnXlRPf2ya/rieIXUarTrLQELPg5iOgeQc4xkrEykrY+o8z46OE0b+B1JSxHP359lCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"sqlite surprise wow\"\n        title=\"sqlite surprise wow\"\n        src=\"/static/f68568ad8496dee23c19b793991992c4/5a190/sqlite-surprise-wow.png\"\n        srcset=\"/static/f68568ad8496dee23c19b793991992c4/772e8/sqlite-surprise-wow.png 200w,\n/static/f68568ad8496dee23c19b793991992c4/e17e5/sqlite-surprise-wow.png 400w,\n/static/f68568ad8496dee23c19b793991992c4/5a190/sqlite-surprise-wow.png 800w,\n/static/f68568ad8496dee23c19b793991992c4/f96df/sqlite-surprise-wow.png 849w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 class=\"markdown-subtitle\" id=\"a-solution\" style=\"position:relative;\"><a href=\"#a-solution\" aria-label=\"a solution permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A Solution</h2>\n<p class=\"markdown-para\">If the database won't enforce the column length limit, we could instead enhance the <code>WikiPost</code> model to use the <a href=\"https://guides.rubyonrails.org/active_record_validations.html#length\" class=\"markdown-link\">length</a> validator from ActiveRecord as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">WikiPost</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:title</span><span class=\"mtk1\">, </span><span class=\"mtk4\">length:</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">maximum:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">10</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Let's see how this behaves in the console (start with <code>bin/rails c</code>):</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Create a new post with a title of 11 characters</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">a_post </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">WikiPost</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">title:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;abcdefghijk&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Try to save it to the database - this time it fails!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">a_post.save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># =&gt; false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Is the object valid? No!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">a_post.valid?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># =&gt; false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Show the error</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">a_post.errors[</span><span class=\"mtk4\">:title</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># =&gt; [&quot;is too long (maximum is 10 characters)&quot;]</span></span></span></code></pre>\n<p class=\"markdown-para\">However, this will only be enforced via the Rails app. There is no data integrity at database level. Invalid data could still be inserted by someone with access to the database.</p>\n<h2 class=\"markdown-subtitle\" id=\"postgres-comparison\" style=\"position:relative;\"><a href=\"#postgres-comparison\" aria-label=\"postgres comparison permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Postgres Comparison</h2>\n<p class=\"markdown-para\">I was curious to see how <a href=\"https://www.postgresql.org/\" class=\"markdown-link\">Postgres</a> compares in enforcing length limits on string columns. So I scaffolded another project using Postgres instead of SQLite by passing <code>-d=postgresql</code> to the <code>rails new...</code> and setup the same <code>WikiPost</code> model and migration.</p>\n<p class=\"markdown-para\">Quick reminder, here is the original migration that creates the <code>wiki_posts</code> table, and the simple model class with no ActiveRecord validations:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">CreateWikiPosts</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">6.1</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    create_table </span><span class=\"mtk4\">:wiki_posts</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |t|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.string </span><span class=\"mtk4\">:title</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.string </span><span class=\"mtk4\">:description</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.string </span><span class=\"mtk4\">:author</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.timestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">WikiPost</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">First let's see the schema that got created for this table. Connect to the Postgres database using the <a href=\"https://www.postgresql.org/docs/current/app-psql.html\" class=\"markdown-link\">psql</a> command line tool. For example, if the database name is <code>wiki</code> and Postgres is running locally:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">psql -U wiki -d wiki</span></span></span></code></pre>\n<p class=\"markdown-para\">At the database prompt, Use the <code>\\d</code> command to view a table schema. The same initial migration to create the WikiPost model results in the following table in Postgres. Notice the <code>title</code> column is of type <code>character varying</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">wiki=&gt; \\d wiki_posts</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                                          Table &quot;public.wiki_posts&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">   Column    |              Type              | Collation | Nullable |                Default</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">-------------+--------------------------------+-----------+----------+----------------------------------------</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> id          | bigint                         |           | not null | nextval(&#39;wiki_posts_id_seq&#39;::regclass)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> title       | character varying              |           |          |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> description | character varying              |           |          |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> author      | character varying              |           |          |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> created_at  | timestamp(6) without time zone |           | not null |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> updated_at  | timestamp(6) without time zone |           | not null |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Indexes:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;wiki_posts_pkey&quot; PRIMARY KEY, btree (id)</span></span></code></pre>\n<p class=\"markdown-para\">Now apply the migration that limits the <code>title</code> length to 10 characters:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">UpdateWikiPostTitle</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">6.1</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    change_column </span><span class=\"mtk4\">:wiki_posts</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:title</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:string</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:limit</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk4\">10</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">down</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    change_column </span><span class=\"mtk4\">:wiki_posts</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:title</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">And check the schema again using <code>psql</code>. Notice the <code>title</code> column now has a data type of <code>character varying(10)</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">hello=&gt; \\d wiki_posts</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                                          Table &quot;public.wiki_posts&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">   Column    |              Type              | Collation | Nullable |                Default</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">-------------+--------------------------------+-----------+----------+----------------------------------------</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> id          | bigint                         |           | not null | nextval(&#39;wiki_posts_id_seq&#39;::regclass)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> title       | character varying(10)          |           |          |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> description | character varying              |           |          |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> author      | character varying              |           |          |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> created_at  | timestamp(6) without time zone |           | not null |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> updated_at  | timestamp(6) without time zone |           | not null |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Indexes:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;wiki_posts_pkey&quot; PRIMARY KEY, btree (id)</span></span></code></pre>\n<p class=\"markdown-para\">Let's exercise the model in a Rails console. Remember, there are no ActiveRecord validations defined on the model.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Create a new post with a title of 11 characters</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">a_post </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">WikiPost</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">title:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;abcdefghijk&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Try to save it to the database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">a_post.save</span></span></span></code></pre>\n<p class=\"markdown-para\">Unlike with SQLite, the save fails when using Postgres. As shown in the output below, the transaction gets rolled back because the string title length violates the specified limit of 10:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">   (4.4ms)  BEGIN</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  WikiPost Create (7.4ms)  INSERT INTO &quot;wiki_posts&quot; (&quot;title&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) VALUES ($1, $2, $3) RETURNING &quot;id&quot;  [[&quot;title&quot;, &quot;abcdefghijk&quot;], [&quot;created_at&quot;, &quot;2022-06-15 11:11:05.725757&quot;], [&quot;updated_at&quot;, &quot;2022-06-15 11:11:05.725757&quot;]]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">   (1.9ms)  ROLLBACK</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Traceback (most recent call last):</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">        1: from (irb):4</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ActiveRecord::ValueTooLong (PG::StringDataRightTruncation: ERROR:  value too long for type character varying(10))</span></span></code></pre>\n<p class=\"markdown-para\">Much better (and less surprising!). This is the behaviour I would expect from a table column that has a length limit.</p>\n<h2 class=\"markdown-subtitle\" id=\"mysql-comparison\" style=\"position:relative;\"><a href=\"#mysql-comparison\" aria-label=\"mysql comparison permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MySQL Comparison</h2>\n<p class=\"markdown-para\">For completeness sake, I also did a quick check on how MySQL handles string column length limits. Just focusing on direct database access as we've already learned this is not an issue with Rails. I'm using the <a href=\"https://dev.mysql.com/doc/refman/8.0/en/mysql.html\" class=\"markdown-link\">MySQL Command-Line client</a>.</p>\n<p class=\"markdown-para\">Running the two migrations to create the <code>wiki_posts</code> table and modify the <code>title</code> column to have a length of 10 results in the following table schema created. Notice the <code>title</code> column has a data type of <code>varchar(10)</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">mysql -u root -D wiki</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">mysql&gt; DESCRIBE wiki_posts;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+-------------+--------------+------+-----+---------+----------------+</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">| Field       | Type         | Null | Key | Default | Extra          |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+-------------+--------------+------+-----+---------+----------------+</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">| id          | bigint(20)   | NO   | PRI | NULL    | auto_increment |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">| title       | varchar(10)  | YES  |     | NULL    |                |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">| description | varchar(255) | YES  |     | NULL    |                |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">| author      | varchar(255) | YES  |     | NULL    |                |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">| created_at  | datetime     | NO   |     | NULL    |                |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">| updated_at  | datetime     | NO   |     | NULL    |                |</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">+-------------+--------------+------+-----+---------+----------------+</span></span></code></pre>\n<p class=\"markdown-para\">And trying to insert a title that's greater than 10 characters long results in an error, which is what we would expect:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">mysql</span><span class=\"mtk7\">&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">INSERT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">INTO</span><span class=\"mtk1\"> wiki_posts(title, created_at, updated_at)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">VALUES</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;abcdefghijk&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk9\">CURRENT_TIMESTAMP</span><span class=\"mtk1\">(), </span><span class=\"mtk9\">CURRENT_TIMESTAMP</span><span class=\"mtk1\">());</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- ERROR 1406 (22001): Data too long for column &#39;title&#39; at row 1</span></span></span></code></pre>\n<aside class=\"markdown-aside\">\nThroughout this post, I've been using command line tools provided by the databases such as <a class=\"markdown-link\" href=\"https://www.sqlite.org/cli.html\">sqlite3</a>, <a class=\"markdown-link\" href=\"https://www.postgresql.org/docs/current/app-psql.html\">psql</a>, and <a class=\"markdown-link\" href=\"https://dev.mysql.com/doc/refman/8.0/en/mysql.html\">mysql</a>. This isn't usually part of Rails courses or tutorials as all access to the database is handled by ActiveRecord. However, I started my career before <a class=\"markdown-link\" href=\"https://stackoverflow.com/a/1279678/3991687\">ORMs</a> were a thing, and have developed the habit of always going one level deeper than the application to check what's going on directly in the database.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered some troubleshooting techniques you can use when getting an unexpected result from ActiveRecord by interacting directly with the database. SQLite may be an ok choice of database for a demo/learning app or for something where data integrity is not such a big concern. But otherwise consider something more robust such as Postgres or MySQL.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/sqlite-varchar-surprise/"}}}]}},"pageContext":{}},"staticQueryHashes":["163244226"]}