{"componentChunkName":"component---src-pages-index-js","path":"/","result":{"data":{"allMarkdownRemark":{"totalCount":62,"edges":[{"node":{"id":"7a565b39-3dd4-5740-82a2-867e3565078c","frontmatter":{"title":"Old Ruby and New Mac","date":"June 2023","category":"rails"},"excerpt":"Picture this scenario - you're a Rails developer that just got one of the new M1 or M2 Macs and are enjoying the performance boost andâ€¦","html":"<p class=\"markdown-para\">Picture this scenario - you're a Rails developer that just got one of the new M1 or M2 Macs and are enjoying the performance boost and energy efficiency that comes from the ARM-based architecture. You've installed and configured all your dev tooling (oh-my-zsh, homebrew, rbenv, etc.) and are ready to get to work. Everything is great.</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 500px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 97.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFLElEQVR42iXReVPTBwLG8d/fnWkRNHfCWSAIigEliUlMQu4ECCHIYQhBAhEjIiUi2iq1q0Bb6oKoCIhmC17gUa1YsVXbIr1Hp9vtPa09pp3OdKYzO/sGvjvaN/CZ7zyPIFZkIJFnIJKlI5IqEUuVSOXpyOQZpKSu4qmnU0hJFSGWKFiRJuaZlDQUcgVVnipC/lqOJvqIBoPI05VI5CoEiSITqSITkVT1BJPIVE/glDQRLpefjtgu/N5qCvLUlBvNxDsSnEte5+sHv/HVx7/w4cLn3Dk1j2lDCamrpH+DMmUWElk6Ulk64sewTMW+3kO8e+sb/v3xnzxc+oH3F5Z5+MEj/vPgv3y2/Bf3bv/C4o0fOTVyjZFdvRg0JaSulCFIlZko03NQKLOQPy6VKMjIVjOYeIF4QzPx6B5eO/Qv7i4+4u7t31m6+ye3Fx6x+OZPLN74lfmpW0z09lKyuoiVIjnCSqkKkViOXJaOUpmFTJHB0ytW4bXY6G4IUm/R0xnezty5hyTH32Z06BzzM+9z9JU5xl6e485bP/PRpQU2FBSQ9hh0VFRS17AFq81B6ioJIqmciopKlJnZeModHI53cHJoiisXP2dHaButm1u4c/UTRl46TjzUzuzJm5wdv4BK+ff+gre2mnv3lzg8/Ar7D/azq6eb8cmT5K9ZjUguQ5WRwdDAeRaufMnp4UlODYzxYtdBRvoGmOofIHn8DZJHTqFWP4tUpUIoNG7g1ROjTJ5NMnf1EqdnkkTjbRSVFaPIUyHOFLNv3zGmxi7T3biZnaEIuVlq6j3VRH0ejiT2MPrCbtJUInLyMxHkRXkUGsvQ2I2Uesw4a/3klxSRvTYXWZ6K/FI1w8MTDB54Ffv6AjTPZlOYk48mJ5fKsmIujp3h0uwVstQZ5OQrEdLXqVGsyUVWlINYk4usOAdJQRY5hblIs6V0P5fguy/+x4XZZXY2R/Dp9FjWGfFqjexr72B0cJr7t7+nLdrCCnkqwvoaExs3WzDV2dAGLRjqLWhrDegDFsyuMqanXufT5T+YO/+A4YFx4k0RHFoLfmcFvTt62f/ci09enzw2SX5xNoKuwYQlXI4pbMXcZMO+1Y1nexWb2pz42/zcnH+Hq/Ofcja5zImxyyTi3VTb3LTUhemL97J3+x4mRuZZvH6fYL0Dwd3uZXNnDe6YF0uLDUerg6bdTVTEqzBGrCQnZpgcX2Bs5DKvT7/D6MvTHNo7SH/PARKxHhIdfZwcucjDpW9pj4cQquLV+Lb5cLQ5sbc5sUbLcbQ7sEUd6Jv1vHRsgqHBWQYGT3N+ZpmZ6fcYfW2OraE2NpbpaAhs4dCB49y5vkRTewChriuIO2rH02rF1WrFEy3H2GzAGrHgarXQ1d9DYs8wnZ39XJ3/gtnkB5wYu8H22PMoFSIC1SGOj17h2tw9Dg88jxCI+QjtqsEd3UTNNheReAWurQaqY2asTaXUd/rZ/48TuD1BBg6e4djIdUb/+QYXZj8h3t5HrKGBlpadNPqbOLh7J0Jjq4fYjiCBqAdXxE5N2IKrTo+rcSPesBl32MrQ8Bmc3iBOi5O9PUMcPXKNcF2cUCBEoMpAqS4Pq0GD3rAawdxopD7mo7bdh6vFhaPJgitspqrVhafZga6mlLauLjaaygk1tBIJRvA5PGgKstFp89Ga1rJpUwkmcwkGYwmCpkaHsd6AdYuVskAZ67ylaDzrWesuRW1dg9qkRuPUUmTQYvMGqHRasduKqfTp0RmL0OoL0esLsZevp8Ku4//pQhunNTWbUAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"happy dog yay\"\n        title=\"happy dog yay\"\n        src=\"/static/fbbe9341fa6e7f64a1d29dbf2f0dae62/0b533/happy-dog-yay-cropped.png\"\n        srcset=\"/static/fbbe9341fa6e7f64a1d29dbf2f0dae62/772e8/happy-dog-yay-cropped.png 200w,\n/static/fbbe9341fa6e7f64a1d29dbf2f0dae62/e17e5/happy-dog-yay-cropped.png 400w,\n/static/fbbe9341fa6e7f64a1d29dbf2f0dae62/0b533/happy-dog-yay-cropped.png 500w\"\n        sizes=\"(max-width: 500px) 100vw, 500px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">Then you receive your next assignment, which is to perform some maintenance on an old Rails 4 project using Ruby 2.3.x (yes they still exist). So you get started by installing Ruby 2.3.3 and encounter the following error:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">$ rbenv install 2.3.3</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">To follow progress, use &#39;tail -f /var/folders/t7/6n5394/T/ruby-build.20230501063921.137.log&#39; or pass --verbose</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Downloading openssl-1.0.2u.tar.gz...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">-&gt; https://dqw8nmjcqpjn7.cloudfront.net/ecd0c6ffb493dd06707d38b...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Installing openssl-1.0.2u...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">BUILD FAILED (macOS 13.3.1 using ruby-build 20230330)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Inspect or clean up the working tree at /var/folders/t7/6n5394/T/ruby-build.20230501063921.137.TS6</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Results logged to /var/folders/t7/6n5394/T/ruby-build.20230501063921.137.log</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Last 10 log lines:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      _dgram_write in libcrypto.a(bss_dgram.o)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      _RAND_query_egd_bytes in libcrypto.a(rand_egd.o)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      ...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ld: symbol(s) not found for architecture i386</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">clang: error: linker command failed with exit code 1 (use -v to see invocation)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">make[4]: *** [link_a.darwin] Error 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">make[3]: *** [do_darwin-shared] Error 2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">make[2]: *** [libcrypto.1.0.0.dylib] Error 2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">make[1]: *** [shared] Error 2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">make: *** [build_crypto] Error 1</span></span></code></pre>\n<p class=\"markdown-para\">That feeling...</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 143.49999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAHEUlEQVR42m2SiVPTZx7G84/stDM7bXftdtddO45jt93RqUer67GuSoUqVAQvFFRUROQQkVtUTrmCJHIlEEhIIASSgIggVYEalFMFETyQHL8cRPzs5OfouuO+M8+877zzvp/3+33eR3J32k7fjJ2BZw4Gns7ROzZF99BjzHctDE69ZMLqZnLWwUvBy5Pnr7AMjWF3eZmzCdjtLhwOn5wIDheC4EJieebA8szO6JyHG/dGSb5wmZxiKRHHjmPuuctTm5sZq5PxJzMMWIbIv1KEw+nBanNitwlvYcJbmFNwIxl+4WDkhYMJ2zy9g2OkX8ymVF7JkcjjHAqPoMXYwfjkNAmJ57hWWUPYocPk5OThdHrwehfweLzvYU6HC8nDWYFHswJTVhdjT18QfSaO2IREUtLSybqUTY1SRd+AhZTUdNLSMsjMvEBeXj63bvUyNvaQR48mcLvmRZjL1/LkK4Epn2Yd2DxvqKhWUlQipefXu5jM1+kfsDA3Z6ewsIiOjk5MpnZu3uxGo2lErW6k68ZNvJ7XCHYnLl/LM3MCz60CL61OZq0CDvdrXJ4F7A43Ttc8nvnXOF0eXi8gyuVbe9+IWvC+EWFvq3O/Bc7aBGZtTl7ZnFjtLtFsq9WO4PSIILvVxuyzGawvXzAzPoIgzOMUPAh2QQR9CBOBc3YnNrtLlN0XAbsTzwLMPBymNj+D6txMHt02Y2nXUnIqlNF2FYLNjtvlFT37ECYC7e9ADqcot3seS283qSFbCVm9nNB/bWKos4VX4xakSafoLDjJqK4A6/PneNzej4HvMuSwC3hfQ393F35Lv2TfD//Af8UyNIXZXDoTRUFKEtdVcnqKoxhTpTLRo8Mzz/9U6XZ6kIj5EdwINgHf0NUqCfhmMYc3rGT1X/5AeUosp3b7s2LxIu7f6sTSrqOv7DRP+4x4PG/eA30wsUKnb8Nnrs87t5fpqWlO+q1n1Re/I3T7FhIPBnF0y0oSdq5msEvPAjD3/AVOx38hH7Xsg777Mbfby53e2+hrFdzttxCyYR3Htv5A4eEgjPn52Gdt/9e790Cn043rA7kFt5gx3xi5P8TpXQGkHj2ONCqS3zR1CHYX8758ujzMu70fSTI+NsH4+CSjo48ZGX/C0Ogk9+4/ZPjhNIZaJZfCf0FXdoUHN3RYJ+4xOfWc/uFJLGNTWEYmuTf0GMvwYx6MTop3JW36Dgx6M63NJsxtnRgN7RiaTZgM7dTnX6QgMgRl/mXuamSMGBU8GRtBr9Fh8KlBQ0uDBn29hpZ6Na0aLRJdjRJjg5rW+gaalSrafLNCQUtdPQ0FWZQdD6SutJTBNhV9NVm8mp6itUFNk0KJ726Lql48a1A10KbWIKmXydBV16C8KkNZUkzjNTnaqkpM2mZ0xdnIYg9hUNTwuK+Lblk60w/ucO9OH61qLTfazHSZOuhu76Sn44YoiVGtEV9rVihpqZZj1jTQZWynVd1I7tFfyD0SiE4m5X67luYLxxhoKmf0/jCdBiPdpg60ChUGTRMmvQmz3ohEr6jGrG3ielOLOPse6DSYMKobiQ/cREbYzzTJpPxm1mLMjeLX+mI6WlpF/6pLy1DJr6FV1FFfqRB9lehVGhqqajFp9TTWqGiqUdCm0dFUXcOZgPXEB29DVymn16BBeTaEQW0JveY2aqVl1F4tRyEtw6hWoyy7Sn1FNRJ5YRmVRSU0lpeglpWLBzVyGZrKKuJ3/ZPtyz7ndGgAqeG7ObF+Cf3KTAa7TVQU5NEgk1F6MQultBSTTo+sqBSJ8uo1ZDk5SNPOUp55nsLzcZSmJ1GWkURswDoiN/+d5Yu+YOPSv5Ea9CO3ZfF0N6uolsooz82jsqgIZXEhann521/WVVWhKLrC1cxk8s7FcSkhlqy4GNJPHCZiw7ck/ryWjcuX8ePXX1N2chcDNcloKipRXK3AUKeiVVWHtvIadaVF1BTmIynMyECaU0BuagbxUTEcD4tgh99Oog+EEr5pBeFr/8qXn/2eP376KemBq+ivu0xeYgxtDfX03bxJp74F6cUsspMSyU0+jyTu5GniIk+QFhtP8K49fL92C3t37hJhft8tITt0PV8t+pzPPvmE3CP+PDTKyY0JozDxFH0dJvq6e2isURIdcYTDwcFIUs+mkpqURWx0EvsOxhC4J5JNK75l5ZKvOBe0AXPaXtZ+t5Rlf/4TjSnhFCYeJeXYPmL3B1GRc4Fes4mB7ltUl1dw5GA4kujIaKKjkwkMiWKL/yE2bQ/l+zWb8d+6jegdaygIXsGONd+waulimuP86FNmEhdxgKiw/eQmnqG5Uo6+ugpVebmYR0lwwE6OhkWy+2ACG38KY/O/g9i2dSe7/fw4tecnzuzewp6t6zgUuJ1LEf7Ik8NJPbaX3LhIshNOkRFzgsgD+9gfGEh0eDj/AbCjFLrsoxOaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"uh oh dog\"\n        title=\"uh oh dog\"\n        src=\"/static/b64588996932e507183b781ea3c61c6d/e17e5/uh-oh-dog-text.png\"\n        srcset=\"/static/b64588996932e507183b781ea3c61c6d/772e8/uh-oh-dog-text.png 200w,\n/static/b64588996932e507183b781ea3c61c6d/e17e5/uh-oh-dog-text.png 400w\"\n        sizes=\"(max-width: 400px) 100vw, 400px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">The issue here is with OpenSSL linking against the i386 architecture, which is not compatible with the new Mac's ARM-based architecture, and so the build fails. There are some <a href=\"https://stackoverflow.com/questions/69012676/install-older-ruby-versions-on-a-m1-macbook\" class=\"markdown-link\">suggestions</a> related to uninstalling OpenSSL and re-installing with alternate compile flags. You can also attempt to uninstall all the dev tooling, setup for <a href=\"https://apple.stackexchange.com/questions/409746/run-everything-in-rosetta-2-on-silicon-mac\" class=\"markdown-link\">rosetta all the things</a>, then re-install.</p>\n<p class=\"markdown-para\">I tried a variety of these and was still getting errors. Keep in mind its not just Ruby that needs to be installed, its also all the older gems, some of which require native extensions and will run into compilation issues. I was also concerned that it would cause problems when switching to other projects that use newer Ruby versions (3.x and above are compiled for the newer Macs), as I frequently toggle between different projects. In this post I'll share an alternative solution using <a href=\"https://www.docker.com/\" class=\"markdown-link\">Docker</a> that I found easier to get working.</p>\n<p class=\"markdown-para\">The idea is to build a Docker image that comes with the older Ruby version needed for this project, mount the project code into this image, and install the project dependencies as part of the image. Then a container can be run from this image, and all the usual Rails commands such as starting a server, console, etc. can be run inside the container.</p>\n<aside class=\"markdown-aside\">\nThis post assumes familiarity with Docker concepts including images, containers, and use of Docker Compose to manage multi-container applications. If you need a refresher on Docker fundamentals, check out the <a class=\"markdown-link\" href=\"https://docs.docker.com/get-started/\">Getting Started</a> guide and <a class=\"markdown-link\" href=\"https://docs.docker.com/get-started/resources/\">Educational Resources</a>.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"docker-image\" style=\"position:relative;\"><a href=\"#docker-image\" aria-label=\"docker image permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Image</h2>\n<p class=\"markdown-para\">The first thing that's needed is to build the Docker image. When doing so, we need to select a base image from which to get started. I'm using a <a href=\"https://hub.docker.com/r/circleci/ruby\" class=\"markdown-link\">CircleCI Ruby image</a> as it comes with common dev tooling and a non-root user named <code>circleci</code>. Here is the Dockerfile that uses the Ruby 2.3.3.</p>\n<p class=\"markdown-para\">To use it, place the following file named <code>Dockerfile</code> in the root of your project. Replace <code>2.3.3</code> with your Ruby version, and <code>myapp</code> with your app name:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> circleci/ruby:2.3.3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Set path to the app as an environment variable</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># so it can be referenced again in this file as `$app`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ENV</span><span class=\"mtk1\"> app /usr/share/myapp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Create a directory for our app.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> sudo mkdir -p $app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Make the `circleci` user owner of our app dir.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> sudo chown circleci $app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Give `circleci` owner read/write/execute on app dir</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># and all dirs/files within it, and read/execute for other users.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> sudo chmod -R 0755 $app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Set the working directory to our app dir.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">WORKDIR</span><span class=\"mtk1\"> $app</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Copy files/dirs from build context to the current working directory in container,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># and sets the user/group ownership of copied files/dirs to circleci:circleci.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">COPY</span><span class=\"mtk1\"> --chown=circleci:circleci . .</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Replace with bundler version used by your old app.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> gem install bundler:1.17.3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Install app dependencies</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle install</span></span></span></code></pre>\n<aside class=\"markdown-aside\">\nThe CMD instruction in the base Circle CI image is: CMD [\"bin/bash\"]. This means that when you run a container from this image, the container will start with a Bash shell prompt. We'll be making use of this to run all our Rails commands soon. You can see the full definition <a class=\"markdown-link\" href=\"https://hub.docker.com/layers/circleci/ruby/2.3.3/images/sha256-d4ee971ae3f1c1eac1301c79e7d1a9b994b2d8b0f0ed899ffa4f7f11dd21d1ff?context=explore\">here</a>.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"docker-compose\" style=\"position:relative;\"><a href=\"#docker-compose\" aria-label=\"docker compose permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Compose</h2>\n<p class=\"markdown-para\">Add the following <code>docker-compose.yml</code> file to the root of the project. This will make it easy to run a container from the <code>Dockerfile</code> created in the previous step:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.9&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">myapp</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Use Dockerfile from current directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Mount the current directory `.` into container at `/user/share/myapp`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">.:/usr/share/myapp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Map port 3000 on the container to 3000 on the host</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;3000:3000&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Allow container to respond to Ctrl+C and to view container&#39;s output in real-time</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">tty</span><span class=\"mtk1\">: </span><span class=\"mtk4\">true</span></span></span></code></pre>\n<p class=\"markdown-para\">To build the image, run:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose build</span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"docker-container\" style=\"position:relative;\"><a href=\"#docker-container\" aria-label=\"docker container permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Container</h2>\n<p class=\"markdown-para\">To run a container from the image, run:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose up</span></span></code></pre>\n<p class=\"markdown-para\">This will run the container in the foreground, which attaches the terminal to the logs of the containers so that you can see its output. But then you can't use that terminal session for anything else, and have to open a new terminal tab to do other things.</p>\n<p class=\"markdown-para\">Alternatively, you can run the container in the background (aka detached mode), and the output will not be displayed in the terminal:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose up -d</span></span></code></pre>\n<p class=\"markdown-para\">If you run it in the background, you can always view the logs with the command below which will follow the logs in real time:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose logs -f</span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"rails-server\" style=\"position:relative;\"><a href=\"#rails-server\" aria-label=\"rails server permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rails Server</h2>\n<p class=\"markdown-para\">Now that you have a running container, it's time to start a Rails server. To do this, first run a shell in the container, using <code>exec</code> which is used to execute a command inside a running container:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose exec myapp bash</span></span></code></pre>\n<p class=\"markdown-para\">Then from the shell prompt in the container, start the Rails server:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">pwd</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Should be /usr/share/myapp because of WORKDIR setting in Dockerfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ls</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Should see contents of myapp such as models, views, controllers, lib, etc.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Start Rails server</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rails server</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Server should be listening on port 3000</span></span></span></code></pre>\n<p class=\"markdown-para\">At this point, you should be able to navigate to <code>http://localhost:3000</code> in a browser and view your app's home page.</p>\n<p class=\"markdown-para\">Note that if you shutdown your computer which will stop the container, or use <code>docker-compose stop</code> to stop the container, the Rails server process that's running in the container may not shut down cleanly because it's not running as PID 1 in the container. That means if you shell in again to run a Rails server, you may get the <a href=\"https://testsuite.io/a-server-is-already-running-pids\" class=\"markdown-link\">server is already running</a> error. We'll deal with this shortly.</p>\n<h2 class=\"markdown-subtitle\" id=\"other-commands\" style=\"position:relative;\"><a href=\"#other-commands\" aria-label=\"other commands permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Other Commands</h2>\n<p class=\"markdown-para\">To run any other commands in the container such as database migrations or a Rails console, open a new terminal tab, shell into the container (you can have multiple shells) and run your command. For example, to run database migrations:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose exec myapp bash</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">rake db:migrate</span></span></code></pre>\n<p class=\"markdown-para\">To run a Rails console:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose exec myapp bash</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">rails console</span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"combining-commands\" style=\"position:relative;\"><a href=\"#combining-commands\" aria-label=\"combining commands permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Combining Commands</h2>\n<p class=\"markdown-para\">One thing you may have noticed about running Rails dockerized is there's more typing to get things running. For example, to run a Rails console, requires three commands:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># 1. Start container</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># 2. Shell into container</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> myapp bash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># 3. Run Rails console from container shell</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rails console</span></span></span></code></pre>\n<p class=\"markdown-para\">The last two can be combined as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose exec myapp rails console</span></span></code></pre>\n<p class=\"markdown-para\">Starting a Rails server requires a little more effort to get it into one step, the following may not work:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose exec myapp rails server</span></span></code></pre>\n<p class=\"markdown-para\">This is because if the <code>./tmp/server.pid</code> file still exists from last time you ran a Rails server in the container, you'll get a <code>server is already running</code> error. To solve this, let's introduce a script that first removes this file, then runs the Rails server, then use docker-compose to execute this script.</p>\n<p class=\"markdown-para\">Place the following in <code>scripts/run_dev.sh</code> (I'm assuming you have a directory <code>scripts</code> in the root of your project, if not, create it):</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#!/bin/bash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">cd</span><span class=\"mtk1\"> /usr/share/myapp</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rm -f ./tmp/pids/server.pid</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">rails server</span></span></span></code></pre>\n<p class=\"markdown-para\">Make it executable with <code>chmod +x scripts/run_dev.sh</code>. Now you can start a Rails server by passing the <code>-c</code> flag to the <code>bash</code> command, which tells it to execute the script in the container:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose exec myapp bash -c &quot;./scripts/run_dev.sh&quot;</span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"even-less-typing\" style=\"position:relative;\"><a href=\"#even-less-typing\" aria-label=\"even less typing permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Even Less Typing</h2>\n<p class=\"markdown-para\">Combining commands with <code>exec</code> and <code>-c</code> flag saves some typing, but we can do even better. Let's introduce a <a href=\"https://opensource.com/article/18/8/what-how-makefile\" class=\"markdown-link\">Makefile</a> into the project. A Makefile is a text file containing a set of instructions (rules) that specify how to build the project. The rules specify the dependencies and the commands needed to build or update them. Traditionally used for C/C++ projects, a Makefile can also make life more convenient by reducing the amount of typing needed to run commonly used commands on any project.</p>\n<p class=\"markdown-para\">For example, in the previous section, we saw that to run a Rails server within the Docker container required:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose exec myapp bash -c &quot;./scripts/run_dev.sh&quot;</span></span></code></pre>\n<p class=\"markdown-para\">If you were to add the following <code>Makefile</code> in the project root:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"makefile\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">server</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose exec myapp bash -c &quot;./run_dev.sh&quot;</span></span></span></code></pre>\n<p class=\"markdown-para\">Then you could run this at the terminal to start the Rails server:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">make server</span></span></code></pre>\n<p class=\"markdown-para\">There's still a problem though, if you don't remember to first start the container, running <code>make server</code> will result in an error like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">service &quot;myapp&quot; is not running container #1</span></span></code></pre>\n<p class=\"markdown-para\">This can be solved with task dependencies. We can add a <code>start</code> task that will check if the container isn't already running, then start it, and then have the <code>server</code> task depend on the <code>start</code> task:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"makefile\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Start the container if it isn&#39;t already running</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">start</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ./scripts/start_dev_container.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Run the `start` task before the `server` task</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">server</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose exec myapp bash -c &quot;./run_dev.sh&quot;</span></span></span></code></pre>\n<p class=\"markdown-para\">Where the <code>start_dev_container.sh</code> script attempts to run an echo statement in the container, and then inspects the return code. If the container is not started, this would error and the return code will be non-zero. If we get a non-zero return code, then we start the container in the background. Place the following in the <code>scripts</code> directory of your project and run <code>chmod +x scripts/start_dev_container.sh</code> to make it executable:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#!/bin/bash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">docker-compose </span><span class=\"mtk9\">exec</span><span class=\"mtk1\"> myapp </span><span class=\"mtk9\">echo</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;dev container is running&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ret=$?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">[[ $ret </span><span class=\"mtk7\">-ne</span><span class=\"mtk1\"> 0 ]] </span><span class=\"mtk7\">&amp;&amp;</span><span class=\"mtk1\"> docker-compose up -d</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">exit</span><span class=\"mtk1\"> 0</span></span></span></code></pre>\n<aside class=\"markdown-aside\">\nMakefiles are primarily designed to work on *nix operating systems like Linux and macOS, which have a Unix-like shell environment that supports the make command. However, if you're using Windows, you can still use Makefiles by installing the <a class=\"markdown-link\" href=\"https://learn.microsoft.com/en-us/windows/wsl/install\">Windows Subsystem for Linux</a>, which allows you to run a Linux environment directly on top of Windows.\n</aside>\n<p class=\"markdown-para\">You can add the most common Rails commands to the Makefile, making each dependent on the <code>start</code> task. Here's what I use, feel free to add more as per your projects needs:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"makefile\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Start the dev container if it&#39;s not already running.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">start</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ./scripts/start_dev_container.sh</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Stop the dev container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">stop</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose stop</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Display dev container status.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">status</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose ps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Start a Rails server.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">server</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose exec myapp bash -c &quot;./run_dev.sh&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Launch a shell in container.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">shell</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose exec myapp bash</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Launch a Rails console.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">console</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose exec myapp rails c</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Migrate database.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">migrate_db</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">docker-compose</span><span class=\"mtk1\"> </span><span class=\"mtk5\">exec</span><span class=\"mtk1\"> </span><span class=\"mtk5\">myapp</span><span class=\"mtk1\"> </span><span class=\"mtk5\">rake</span><span class=\"mtk1\"> </span><span class=\"mtk5\">db</span><span class=\"mtk1\">:migrate</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Rollback database.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">rollback_db</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">docker-compose</span><span class=\"mtk1\"> </span><span class=\"mtk5\">exec</span><span class=\"mtk1\"> </span><span class=\"mtk5\">myapp</span><span class=\"mtk1\"> </span><span class=\"mtk5\">rake</span><span class=\"mtk1\"> </span><span class=\"mtk5\">db</span><span class=\"mtk1\">:rollback</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Drop db, create db, load schema, custom seeds.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">reset_db</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">docker-compose</span><span class=\"mtk1\"> </span><span class=\"mtk5\">exec</span><span class=\"mtk1\"> </span><span class=\"mtk5\">myapp</span><span class=\"mtk1\"> </span><span class=\"mtk5\">rake</span><span class=\"mtk1\"> </span><span class=\"mtk5\">db</span><span class=\"mtk1\">:reset</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Run all the RSpec tests: make test</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># To run a specific test: SPECS=&quot;path/to/the_spec.rb&quot; make test</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">test</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose exec myapp rspec </span><span class=\"mtk10\">$$</span><span class=\"mtk1\">SPECS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Run the linter.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">rubocop</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose exec myapp rubocop</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Display all available routes.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">routes</span><span class=\"mtk1\">: start</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose exec myapp rake routes</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"drawbacks\" style=\"position:relative;\"><a href=\"#drawbacks\" aria-label=\"drawbacks permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Drawbacks</h2>\n<p class=\"markdown-para\">There are some drawbacks with this approach. There's some increased complexity in having to learn new tooling for those not already familiar with Docker and docker-compose. Also the commands are slower to run within the container as compared to running directly on the laptop.</p>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered how to use Docker and docker-compose to run an old Ruby on Rails project that doesn't easily install on the newer ARM-based Macs. We've learned how to build an image, run a container from this image, and use <code>exec</code> to run commands in the container. Finally we covered how to use a Makefile with dependencies to save on some typing of lengthy commands.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk10 { color: #FD971F; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/old-ruby-new-mac/"}}},{"node":{"id":"4c832c08-70d8-509b-aa31-c22adc311fe5","frontmatter":{"title":"Distinct GraphQL Query with Gatsby 5","date":"May 2023","category":"gatsby"},"excerpt":"If you're building a website or web application with Gatsby, you might come across a situation where you need to perform a distinct queryâ€¦","html":"<p class=\"markdown-para\">If you're building a website or web application with Gatsby, you might come across a situation where you need to perform a distinct query. This is a query that only returns unique results, eliminating any duplicates. This post will show how to do a distinct query in Gatsby 5 (which is the latest version at the time of this writing) using GraphQL.</p>\n<aside class=\"markdown-aside\">\nThis post assumes that the reader has some basic knowledge of building websites with Gatsby, including familiarity with GraphQL queries. If you're new to Gatsby, or need a refresher on GraphQL, there are plenty of resources available to help you get up to speed. The official <a class=\"markdown-link\" href=\"https://www.gatsbyjs.com/docs/\">documentation</a> is a great place to start. Pluralsight also has some <a class=\"markdown-link\" href=\"https://www.pluralsight.com/paths/building-static-sites-with-gatsbyjs\">courses</a>, although at the time of this writing, they're mostly for an older Gatsby versions.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"example\" style=\"position:relative;\"><a href=\"#example\" aria-label=\"example permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example</h2>\n<p class=\"markdown-para\">A common use case for Gatsby is to generate a static site where the content for the pages comes from markdown files. The <a href=\"https://www.npmjs.com/package/gatsby-transformer-remark\" class=\"markdown-link\">gatsby-transformer-remark</a> plugin transforms markdown files into HTML and creates nodes for them in Gatsby's GraphQL data layer. For instance, suppose we're building a website to share health and fitness site information. The <code>src</code> directory contains markdown files for each workout routine as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">src</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”œâ”€â”€ components</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ footer.js</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ header.js</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ layout.js</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”œâ”€â”€ markdown</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ advanced-lifting-techniques.md</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ cardio-basics.md</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ strength-training-tips-for-beginners.md</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ yoga-for-flexibility.md</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ ...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”œâ”€â”€ pages</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ about.js</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â”‚Â Â  â”œâ”€â”€ index.js</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">â””â”€â”€ templates</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    â”œâ”€â”€ post.js</span></span></code></pre>\n<p class=\"markdown-para\">Here are some example markdown files with title, description, publish date, and category in the frontmatter, and a sample body content:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"markdown\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">---</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">title</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;Advanced Lifting Techniques&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">description</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;Learn some advanced techniques to take your lifting to the next level.&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">date</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;2023-01-15&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">category</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;strength&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">---</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">If you&#39;ve been lifting weights for a while and want to take your workout to the next level,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">you&#39;ll need to start incorporating some advanced techniques...</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"markdown\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">---</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">title</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;Cardio Basics&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">description</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;Get back to the basics with a beginner&#39;s guide to cardio workouts.&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">date</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;2023-03-22&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">category</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;cardio&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">---</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">If you&#39;re new to working out or just looking to get back into shape,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">cardio is a great place to start...</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"markdown\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">---</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">title</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;Strength Training Tips for Beginners&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">description</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;Get started with strength training and build a foundation for a healthier life.&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">date</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;2023-07-16&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">category</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;strength&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">---</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Strength training is an effective way to build muscle, increase bone density,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">and improve overall health...</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"markdown\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">---</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">title</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;Yoga for Flexibility&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">description</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;Improve your flexibility and reduce stress with this beginner&#39;s guide to yoga.&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">date</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;2023-09-02&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">category</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;yoga&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">---</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">Yoga is a good way to improve flexibility, reduce stress,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">and promote overall wellness...</span></span></span></code></pre>\n<p class=\"markdown-para\">Now we would like to get a list of all the categories, to generate a list of category tags that readers could click on to view articles for that category.</p>\n<h2 class=\"markdown-subtitle\" id=\"solution\" style=\"position:relative;\"><a href=\"#solution\" aria-label=\"solution permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Solution</h2>\n<p class=\"markdown-para\">Here is the GraphQL query to get a list of distinct categories. The key here is to use the <code>distinct</code> <em class=\"markdown-emphasis\">aggregation resolver</em>, and within that, specify the field to extract unique values for. The nesting of <code>category</code> within <code>frontmatter</code> matches how the nodes are structured when using the <a href=\"https://www.npmjs.com/package/gatsby-transformer-remark\" class=\"markdown-link\">gatsby-transformer-remark</a> plugin. The <code>SELECT</code> after specifying the <code>category</code> field seems a little odd, more on this later:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"graphql\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    distinct(</span><span class=\"mtk10 mtki\">field</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">frontmatter</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">category</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> SELECT</span><span class=\"mtk1\">} })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<aside class=\"markdown-aside\">\nAn aggregation resolver is a type of resolver function that aggregates data from multiple sources into a single field on a GraphQL node. In addition to the distinct aggregation, Gatsby also supports group, min, max, and sum. I couldn't find documentation about these built-in resolvers but here's a <a class=\"markdown-link\" href=\"https://github.com/gatsbyjs/gatsby/pull/30789\">PR</a> where some of them got introduced. It's also possible to create your own <a class=\"markdown-link\" href=\"https://www.gatsbyjs.com/docs/reference/graphql-data-layer/schema-customization/#createresolvers-api\">custom resolvers</a>.\n</aside>\n<p class=\"markdown-para\">Running the above query will produce output like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;data&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;allMarkdownRemark&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;distinct&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;strength&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;cardio&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">&quot;yoga&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;extensions&quot;</span><span class=\"mtk1\">: {}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">To have the categories sorted alphabetically in ascending order, pass in the <code>sort</code> option to the query field <code>allMarkdownRemark</code>. Use <code>DESC</code> instead of <code>ASC</code> for reverse alphabetic order:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"graphql\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">sort</span><span class=\"mtk1\">: {</span><span class=\"mtk6\">frontmatter</span><span class=\"mtk1\">: {</span><span class=\"mtk6\">category</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> ASC</span><span class=\"mtk1\">}}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    distinct(</span><span class=\"mtk10 mtki\">field</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">frontmatter</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">category</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> SELECT</span><span class=\"mtk1\">} })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">If the markdown files are located in different directories such as <code>/src/markdown/fitness</code> and <code>/src/markdown/recipes</code> and you only want the distinct categories for the <code>fitness</code> articles, pass the <code>filter</code> option to the query field. Within that, specify the field that should be filtered on, in this case, <code>fileAbsolutePath</code>, which is a field generated by the <code>gatsby-transformer-remark</code> plugin containing the absolute file path of the markdown files on the file system. Then use the <code>regex</code> filter operator to limit the results to only markdown files that are located in a certain directory:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"graphql\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">filter</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">fileAbsolutePath</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">regex</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;/src/markdown/fitness/&quot;</span><span class=\"mtk1\"> } }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">sort</span><span class=\"mtk1\">: {</span><span class=\"mtk6\">frontmatter</span><span class=\"mtk1\">: {</span><span class=\"mtk6\">category</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> ASC</span><span class=\"mtk1\">}}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    distinct(</span><span class=\"mtk10 mtki\">field</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">frontmatter</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">category</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> SELECT</span><span class=\"mtk1\">} })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">For more filter options and how they can be combined, see the <a href=\"https://www.gatsbyjs.com/docs/graphql-reference/#filter\" class=\"markdown-link\">Gatsby GraphQL</a> docs.</p>\n<p class=\"markdown-para\">Use the <a href=\"https://www.gatsbyjs.com/docs/graphql-reference/#group\" class=\"markdown-link\">group</a> function to get a list of categories and how frequently they appear:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"graphql\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">filter</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">fileAbsolutePath</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">regex</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;/src/learning/&quot;</span><span class=\"mtk1\"> } }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    group(</span><span class=\"mtk10 mtki\">field</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">frontmatter</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">category</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> SELECT</span><span class=\"mtk1\">} }) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      fieldValue</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      totalCount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">This will output:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;data&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;allMarkdownRemark&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;group&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;fieldValue&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;strength&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;totalCount&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;fieldValue&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;cardio&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;totalCount&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;fieldValue&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;yoga&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;totalCount&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;extensions&quot;</span><span class=\"mtk1\">: {}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">If you just needed to find the solution quickly, you can copy paste the above and move on. But if you're curious as to how I found it when regular searching failed, read on.</p>\n<h2 class=\"markdown-subtitle\" id=\"finding-the-solution\" style=\"position:relative;\"><a href=\"#finding-the-solution\" aria-label=\"finding the solution permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Finding The Solution</h2>\n<p class=\"markdown-para\">Although the query seems straightforward enough, finding the correct syntax was surprisingly difficult. The reason is the aggregation syntax has changed from Gatsby v4 to Gatsby v5. In my search for the correct syntax, I tried both Duck Duck Go (my default search engine) and Google (my fallback option), but both returned either invalid syntax or links to official Gatsby docs with no mention of the \"distinct\" keyword. Here is the query that was turning up from web search:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"graphql\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># OLD GATSBY V4 SYNTAX - DO NOT USE ON GATSBY V5</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    distinct(</span><span class=\"mtk10 mtki\">field</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> frontmatter___category</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">Running the above will result in an error:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;errors&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;message&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Expected value of type </span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">MarkdownRemarkFieldSelector!</span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">, found frontmatter___category.&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;locations&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;line&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">3</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;column&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">21</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<h3 class=\"markdown-sub-subtitle\" id=\"ai-to-the-rescue\" style=\"position:relative;\"><a href=\"#ai-to-the-rescue\" aria-label=\"ai to the rescue permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AI To The Rescue?</h3>\n<p class=\"markdown-para\">I also asked ChatGPT but it returned the same invalid syntax. When told about the error, ChatGPT suggested this variation which also does not work:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"graphql\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># ALSO INCORRECT - DO NOT USE!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    distinct(</span><span class=\"mtk10 mtki\">field</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> frontmatter</span><span class=\"mtk1\"> {</span><span class=\"mtk4\"> category</span><span class=\"mtk1\"> })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">Running the above results in a syntax error:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;errors&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;message&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Syntax Error: Expected Name, found </span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">{</span><span class=\"mtk4\">\\&quot;</span><span class=\"mtk12\">.&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9 mtki\">&quot;locations&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;line&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">3</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk9 mtki\">&quot;column&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">33</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">When I told ChatGPT this solution was also not working, it responded with \"I apologize, the correct syntax is...\", and then proceeded to provide the first \"solution\" that I had already told it was incorrect <code>distinct(field: frontmatter___category)</code>. When I pointed this out it apologized again and then gave me the second incorrect \"solution\" <code>distinct(field: frontmatter { category })</code>. It was literally stuck in a loop apologizing and alternating between incorrect solutions. So our engineering jobs are safe for now.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"dig-into-the-source\" style=\"position:relative;\"><a href=\"#dig-into-the-source\" aria-label=\"dig into the source permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dig Into The Source</h3>\n<p class=\"markdown-para\">A useful technique when web search fails is to search in the source code. Since Gatsby is open source and hosted on Github, the source is easily accessible. I started on the <a href=\"https://github.com/gatsbyjs/gatsby\" class=\"markdown-link\">Gatsby repo on Github</a> and entered <code>distinct</code> in the search box, then selected to search \"In this repository\" as shown in the screenshot below:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+ElEQVR42kWRS2sUQRSFWwXzmJnM9LOqu6sf1c/pnp5MZgJCUAhmIgjiRnEh4sqVP8KNSBIDLsWf+0mXoouPgrp1z7n3lPXk4pLz3ZZaxwzLgqHNaQtFlYUkoUsaOqSRT5ooEhWT55qmW1M1K0PdDv9ZDlir9Rn9/jPtm5/Iq28Ez28QVzeI/S3y+hb54h55+QW5eYvYvifsr1kOW4rlhqI9pe63/2iHc6zZwsM7+0D/7hf61Q+C/R3y+vtf7hDX98T7r+iLj+inn3DKZxxO5hzNPI5PPA6nDl6YodsBmZRYTpDgej6hcHAXU44eP2By+MhwfPDQnLPJAV4gCKMY15dGIEorFl6MH2WEUYlrJ8SqxrJdSRhr0nIgiEu8UGMHqUGoirmfMFkIprZk7sXMbIlUBVnVI1RBmneI05L05Qq5a7Emcx9XVZT9lrTsUHlLnDdEWU1e9cikwg8z/DDHEQm2HxNlDVm1QukleTmQnHdUr3cEmwprNvexdU/W72hXW3SzpmjW6GZA14MJvlyeUndnJEVHlJbGZGQUHs2Lak0UNnh+hjVdBIgop+k2OIEyIY9Tj4GP04yNQaQRcYFQf8TG/GTa4quGhRexMFPXZgMj6Ee5uUjLpRGd2cIwfphUpREMYm3ejav7UYGjOk7cmLF/NB7rdqD4DR3w+6Ly+GC0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gatsby repo search distinct\"\n        title=\"gatsby repo search distinct\"\n        src=\"/static/411c0db68623e95571081c9c61df87fd/5a190/gatsby-repo-search-distinct.png\"\n        srcset=\"/static/411c0db68623e95571081c9c61df87fd/772e8/gatsby-repo-search-distinct.png 200w,\n/static/411c0db68623e95571081c9c61df87fd/e17e5/gatsby-repo-search-distinct.png 400w,\n/static/411c0db68623e95571081c9c61df87fd/5a190/gatsby-repo-search-distinct.png 800w,\n/static/411c0db68623e95571081c9c61df87fd/6937a/gatsby-repo-search-distinct.png 1094w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">A number of results were returned. One of the results was for a test with the description being <code>returns list of distinct values in a field</code> as shown below:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCklEQVR42k2QSW7CUBAFfQAGD3/29G1jMwSwLVgEQqIsIuUGyf1PUlGAoCyeqvWkVqs6CHVNUg4IPyLrI6LsEX4gW47kXY8od0g/IKsB5Xt0uSdUBdNIMwnVlf8ThCJFuBpla7qup9kccH7DoR95PV9YPp1QWYtIFyhb4WyJTGsimTGLDbPEMovtnYZgnjik9YTCEsYaXXQ0yy0f70fadY8pVli/wlVrbLW+Lk4jxTyxhDK9Rdz42wWxdJisZhoZJqHENXu2xxe+vz4ZT2+k7Ujbn+nGC83umbTZXo8KVz20/3JVzn1OWi6IdYF0Hp01qLQhNjWJ8ShXYfLFva8Q1hPpgkjdlB//u88/r/OFRqYweC4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"gatsby repo search distinct result\"\n        title=\"gatsby repo search distinct result\"\n        src=\"/static/d045b7e65b1ed04c90f676499770858c/5a190/gatsby-repo-search-distinct-result.png\"\n        srcset=\"/static/d045b7e65b1ed04c90f676499770858c/772e8/gatsby-repo-search-distinct-result.png 200w,\n/static/d045b7e65b1ed04c90f676499770858c/e17e5/gatsby-repo-search-distinct-result.png 400w,\n/static/d045b7e65b1ed04c90f676499770858c/5a190/gatsby-repo-search-distinct-result.png 800w,\n/static/d045b7e65b1ed04c90f676499770858c/5b4a1/gatsby-repo-search-distinct-result.png 831w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">This seemed promising as that was exactly the problem I was trying to solve. Looking more closely at this <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/schema/__tests__/connection-input-fields.js#L177-L215\" class=\"markdown-link\">test</a>, it defines a query that extracts distinct values from a number of fields. One of them is a frontmatter field which is what I was looking for - notice the field <code>blue</code> in this test:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Copied from: packages/gatsby/src/schema/__tests__/connection-input-fields.js</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">it</span><span class=\"mtk1\">(</span><span class=\"mtk6\">`returns list of distinct values in a field`</span><span class=\"mtk1\">, </span><span class=\"mtk7\">async</span><span class=\"mtk1\"> () </span><span class=\"mtk9 mtki\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">const</span><span class=\"mtk1\"> result </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk7\">await</span><span class=\"mtk1\"> </span><span class=\"mtk5\">queryResult</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">makeNodes</span><span class=\"mtk1\">(),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk6\">`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">      {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">        allTest {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">          totalCount</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">          names: distinct(field: { name: SELECT })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">          array: distinct(field: { anArray: SELECT })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">          blue: distinct(field: { frontmatter: { blue: SELECT }})</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">          dates: distinct(field: { dateArray: SELECT })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">          # Only one node has this field</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">          circle: distinct(field: { frontmatter: { circle: SELECT }})</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">          nestedField: distinct(field: { anotherKey:{ withANested:{ nestedKey: SELECT }}})</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">    `</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.errors).not.</span><span class=\"mtk5\">toBeDefined</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.names.length).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk4\">2</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.names[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">]).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk6\">`The Mad Max`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.array.length).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk4\">5</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.array[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">]).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk6\">`1`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.blue.length).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk4\">2</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.blue[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">]).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk6\">`100`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.circle.length).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk4\">1</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.circle[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">]).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk6\">`happy`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.dates[</span><span class=\"mtk4\">2</span><span class=\"mtk1\">]).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk6\">`2006-07-04T22:39:53.000Z`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.dates.length).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk4\">4</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.nestedField.length).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk4\">2</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.nestedField[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">]).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk6\">`bar`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(result.data.allTest.nestedField[</span><span class=\"mtk4\">1</span><span class=\"mtk1\">]).</span><span class=\"mtk5\">toEqual</span><span class=\"mtk1\">(</span><span class=\"mtk6\">`foo`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">})</span></span></span></code></pre>\n<p class=\"markdown-para\">So to make the <code>distinct</code> query work requires specifying an object for the field rather than triple underscores, and the addition of <code>: SELECT</code> after specifying which field you want to extract distinct values for. Updating my query to the syntax shown in the test resolved the issue.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"but-why\" style=\"position:relative;\"><a href=\"#but-why\" aria-label=\"but why permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>But Why?</h3>\n<p class=\"markdown-para\">I could have left it at that but got curious as to what this special word <code>SELECT</code> was doing and whether there were any other special values that could be specified in the query. In GraphiQL, the in-browser GraphQL IDE that's running on <code>http://localhost:8000/___graphql</code> when you run Gatsby in development mode, you can <kbd class=\"markdown-kbd\">Cmd</kbd> + click on any text in the query to open the documentation. Doing this on the <code>SELECT</code> keyword revealed that its a <code>FieldSelectorEnum</code>:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVR42k1P206EMBTkM0y8cF1sgRahIpbl0oW4ItH4ZmLio///C2NOWXd5mMyctjNz6rBiAi8n7KRBnBuEWQePNwjS1uog2SNImpXT9sInHaYtbhONSS0w6g0OK0ZU/SfK9gNF8w6aXaZtGCFWM+JqQaRe4YsBrhzgUSlBDIjEAVdc47f7xs/+C04kDdjjbBvv4tpu51MzBdKW+QHhwwg/N/CzHm5u4Ine4kYMEPc1IqZxTT7ZwwmyDn7a2ZAtqIDY4xoe0yuT6QSas+oFShmU9RG8GLGTA5zV1JyD/jUFbs/P95t38ukI+TyjaBbwcrS/+gOy45xVsYNQQgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"graphiql select doc\"\n        title=\"graphiql select doc\"\n        src=\"/static/64c69cce00901f3c86541f75942b4b4f/5a190/graphiql-select-doc.png\"\n        srcset=\"/static/64c69cce00901f3c86541f75942b4b4f/772e8/graphiql-select-doc.png 200w,\n/static/64c69cce00901f3c86541f75942b4b4f/e17e5/graphiql-select-doc.png 400w,\n/static/64c69cce00901f3c86541f75942b4b4f/5a190/graphiql-select-doc.png 800w,\n/static/64c69cce00901f3c86541f75942b4b4f/cd536/graphiql-select-doc.png 1114w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">Unfortunately there was no additional description of what this is or what other values are possible. So I searched for <code>FieldSelectorEnum</code> in the Gatsby source (same technique as before, searching with Github UI) and found it defined <a href=\"https://github.com/gatsbyjs/gatsby/blob/master/packages/gatsby/src/schema/types/pagination.ts#L114-L125\" class=\"markdown-link\">here</a>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Copied from: packages/gatsby/src/schema/types/pagination.ts</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">leafInputComposer: schemaComposer.</span><span class=\"mtk5\">getOrCreateETC</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk6\">`FieldSelectorEnum`</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk10 mtki\">etc</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      etc.</span><span class=\"mtk5\">setFields</span><span class=\"mtk1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// GraphQL spec doesn&#39;t allow using &quot;true&quot; (or &quot;false&quot; or &quot;null&quot;) as enum values</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\">// so we &quot;SELECT&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        SELECT: { value: </span><span class=\"mtk6\">`SELECT`</span><span class=\"mtk1\"> },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  postfix: </span><span class=\"mtk6\">`FieldSelector`</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}).</span><span class=\"mtk5\">getTypeNonNull</span><span class=\"mtk1\">()</span></span></span></code></pre>\n<p class=\"markdown-para\">From the comment, it looks like it would have made more sense to have nothing specified, for example <code>distinct(field: frontmatter { category })</code> but the GraphQL spec doesn't allow this and that's why <code>SELECT</code> had to be added as in <code>distinct(field: frontmatter { category: SELECT })</code>. To see if I could get any more explanation about this, I clicked on the \"Blame\" button (in the Github UI, it shows up at the top of every source file) as shown in the screenshot below:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABIklEQVR42o2Ry26DMBBF2TcPQgBjgh+AHQghz3aRrvr/X3Uqk6SqKlXK4mjGln11504klcO4gZV0LEVLXLTEuWWRW2JRo+qeUjsSoYjTkvlKME8KFklBmghmK0GpPcbtSaUh2g5n+sM7qtnR9Ce0P6D9SNsdsdsjtjsjtSOVlkxa0sJMVWhPV1lsVZNrT+3HSThKC01pPKb2jMcrG7fDbgf6bk/bndi4PcuHoztyYrmWzNeSS5ZRpqEvp7so2DTTWH5yEUZLckWcVawCecW60H8wrIWe3rvtSOP3COXuI4dMTN1xuNwoVMvbMmMW5/esXmD24HmOwmfV9HzcvvC7M3lpEZt6WsBTONT/mP/ug2DYmDKO8fpJ1Qw/WT2FXnX6dPgNeEe0/LeFK68AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"github blame button\"\n        title=\"github blame button\"\n        src=\"/static/1817e6c02600c095caf1f3babd0f4478/5a190/github-blame-button.png\"\n        srcset=\"/static/1817e6c02600c095caf1f3babd0f4478/772e8/github-blame-button.png 200w,\n/static/1817e6c02600c095caf1f3babd0f4478/e17e5/github-blame-button.png 400w,\n/static/1817e6c02600c095caf1f3babd0f4478/5a190/github-blame-button.png 800w,\n/static/1817e6c02600c095caf1f3babd0f4478/c1b63/github-blame-button.png 1200w,\n/static/1817e6c02600c095caf1f3babd0f4478/29c1d/github-blame-button.png 1375w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">This shows the commit messages for every line in the source file. For the section of code that defined <code>FieldSelectorEnum</code>, the commit message was: <code>feat: [v5 breaking change] change sort and aggregation fields API #36708</code>. In Github the <code>#</code> before a number makes it link to either an issue or a PR, so I clicked on #36708 and it led to this <a href=\"https://github.com/gatsbyjs/gatsby/pull/36708\" class=\"markdown-link\">PR</a>. The description for this PR indicates that it implements changes from a discussion titled <a href=\"https://github.com/gatsbyjs/gatsby/discussions/36242\" class=\"markdown-link\">RFC: Change to sort and aggregation fields API #36242</a>. This discussion explains the syntax change from the triple underscore format to the object format for sorting and aggregation and provides some examples of old vs new syntax. This change was done to improve performance. The examples provided are:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"graphql\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># OLD SYNTAX FOR SORT</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark(</span><span class=\"mtk10 mtki\">sort</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">fields</span><span class=\"mtk1\">: [</span><span class=\"mtk4\">frontmatter___date</span><span class=\"mtk1\">], </span><span class=\"mtk6\">order</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> DESC</span><span class=\"mtk1\"> }) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    nodes {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">...</span><span class=\"mtk1\">fields</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># NEW SYNTAX FOR SORT</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark(</span><span class=\"mtk10 mtki\">sort</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">frontmatter</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">date</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> DESC</span><span class=\"mtk1\"> } }) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    nodes {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">...</span><span class=\"mtk1\">fields</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># OLD SYNTAX FOR AGGREGATION</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    distinct(</span><span class=\"mtk10 mtki\">field</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> frontmatter___category</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># NEW SYNTAX FOR AGGREGATION</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  allMarkdownRemark {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    distinct(</span><span class=\"mtk10 mtki\">field</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">frontmatter</span><span class=\"mtk1\">: { </span><span class=\"mtk6\">category</span><span class=\"mtk1\">:</span><span class=\"mtk4\"> SELECT</span><span class=\"mtk1\"> } })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">For sorting, it makes sense that you would have to specify ASC or DESC, for example, but for distinct, there's nothing that really fits but the GraphQL forces \"something\" to go there so that's why <code>SELECT</code> is used.</p>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered how to write a GraphQL query for Gatsby v5 to extract distinct values for a given field. It has also covered options for sorting and limiting results to a particular directory where markdown files are located. Finally, it also covered a useful technique for getting answers to questions about open source projects when a web search doesn't turn up the answer.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk10 { color: #FD971F; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk12 { color: #CFCFC2; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/gatsby5-distinct-query/"}}},{"node":{"id":"1415cf2c-484a-5280-88b9-5e30b7c3fb5a","frontmatter":{"title":"ActiveRecord JSON Column with MySQL and MariaDB","date":"April 2023","category":"rails"},"excerpt":"When using a relational database, it can be convenient to occasionally store some data as JSON in a table column. As of MySQL 5.7.8, theâ€¦","html":"<p class=\"markdown-para\">When using a relational database, it can be convenient to occasionally store some data as JSON in a table column. As of <a href=\"https://dev.mysql.com/doc/refman/5.7/en/json.html\" class=\"markdown-link\">MySQL 5.7.8</a>, the JSON column type is supported. It's also supported in <a href=\"https://mariadb.org/documentation/\" class=\"markdown-link\">MariaDB</a>. In theory, MySQL and MariaDB are 100% compatible, but it turns out, there's an important difference to be aware of when using the JSON column type in a Rails project with ActiveRecord.</p>\n<h2 class=\"markdown-subtitle\" id=\"background\" style=\"position:relative;\"><a href=\"#background\" aria-label=\"background permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Background</h2>\n<p class=\"markdown-para\">The Rails project I'm working on has developers using MySQL on their laptops. As part of a <a href=\"../nomad-tips-and-tricks\" class=\"markdown-link\">platform migration</a>, the database in all deployed environments was changed to MariaDB. There are a number of <a href=\"https://mariadb.com/resources/blog/why-should-you-migrate-from-mysql-to-mariadb/\" class=\"markdown-link\">benefits</a> to running MariaDB in production over MySQL. Given that it's fully compatible with MySQL, there didn't seem to be any need to change the local environment so our laptops remain using MySQL. That is, until I ran into a surprise dealing with a JSON column.</p>\n<h2 class=\"markdown-subtitle\" id=\"json-column\" style=\"position:relative;\"><a href=\"#json-column\" aria-label=\"json column permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JSON Column</h2>\n<p class=\"markdown-para\">Here's a migration that creates a table with a JSON column type. Just for an example, imagine we want to store a list of the user's favorite fruits as a JSON array in the <code>users</code> table:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">CreateUsers</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">6.1</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    create_table </span><span class=\"mtk4\">:users</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |t|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.string </span><span class=\"mtk4\">:username</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.json </span><span class=\"mtk4\">:fav_fruits</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.timestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">We can also validate that only arrays will be stored in the <code>fav_fruits</code> column with JSON schema as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// app/models/user/fav_fruits_schema.json</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;array&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;title&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;The root schema&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;default&quot;</span><span class=\"mtk1\">: [],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;examples&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">1</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  ],</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;additionalItems&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">&quot;items&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;$id&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;#/items&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">&quot;anyOf&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;$id&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;#/items/anyOf/0&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;type&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;integer&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;title&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;The first anyOf schema&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;default&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk4\">0</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;examples&quot;</span><span class=\"mtk1\">: [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">1</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">2</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">And use it in the User model with a custom validate method:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validate </span><span class=\"mtk4\">:validate_fav_fruits_against_json_schema</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">validate_fav_fruits_against_json_schema</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @schema </span><span class=\"mtk7\">||=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">File</span><span class=\"mtk1\">.read(</span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.root.join(</span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.root, </span><span class=\"mtk6\">&quot;app&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;models&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;user&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;fav_fruits_schema.json&quot;</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    fav_fruits_errors </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">JSON</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Validator</span><span class=\"mtk1\">.fully_validate(@schema, fav_fruits, </span><span class=\"mtk4\">strict:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">validate_schema:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    fav_fruits_errors.each </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |error|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      errors.add(</span><span class=\"mtk4\">:fav_fruits</span><span class=\"mtk1\">, error)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"the-problem\" style=\"position:relative;\"><a href=\"#the-problem\" aria-label=\"the problem permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Problem</h2>\n<p class=\"markdown-para\">Consider the code below that seeds a user with some data, then iterates over each of their favorite fruits:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">user </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">username:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;alice&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">fav_fruits:</span><span class=\"mtk1\"> [</span><span class=\"mtk6\">&quot;apple&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;orange&quot;</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">user.fav_fruits.each </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |fruit|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9\">puts</span><span class=\"mtk1\"> fruit</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># process fruit...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">When this code is run in a Rails project using MySQL, the code behaves as expected, outputting:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">apple</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">orange</span></span></code></pre>\n<p class=\"markdown-para\">But when the same code runs in a deployed environment that is using MariaDB, an error results:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">undefined method `each&#39; for &quot;[\\&quot;apple\\&quot;, \\&quot;orange\\&quot;]&quot;:String (NoMethodError)</span></span></code></pre>\n<p class=\"markdown-para\">If you would like to see the problem in action, clone this <a href=\"https://github.com/danielabar/maria\" class=\"markdown-link\">demo repo</a>, which runs a Rails 7 project using a MariaDB instance running in a Docker container, and try out the steps to reproduce.</p>\n<h2 class=\"markdown-subtitle\" id=\"table-contents\" style=\"position:relative;\"><a href=\"#table-contents\" aria-label=\"table contents permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table Contents</h2>\n<p class=\"markdown-para\">It looks like the problem is that in MariaDB, despite having defined the column as JSON, and having inserted an array, the value that got stored in the database is a String. We can see this by invoking the <code>class</code> method of the <code>fav_fruits</code> attribute in a project using MySQL, and then in a project using MariaDB:</p>\n<p class=\"markdown-para\">First, MySQL:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">user.fav_fruits.class</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Array</span></span></span></code></pre>\n<p class=\"markdown-para\">Then MariaDB:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">user.fav_fruits.class</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># String</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"table-schema\" style=\"position:relative;\"><a href=\"#table-schema\" aria-label=\"table schema permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table Schema</h2>\n<p class=\"markdown-para\">Looking at the schema that Rails generated when the migration was run confirms the <code>fav_fruits</code> column is indeed json:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- db/structure.sql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk1\"> </span><span class=\"mtk6\">`users`</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">`id`</span><span class=\"mtk1\"> </span><span class=\"mtk7\">bigint</span><span class=\"mtk1\">(</span><span class=\"mtk4\">20</span><span class=\"mtk1\">) </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\"> AUTO_INCREMENT,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">`username`</span><span class=\"mtk1\"> </span><span class=\"mtk7\">varchar</span><span class=\"mtk1\">(</span><span class=\"mtk4\">255</span><span class=\"mtk1\">) </span><span class=\"mtk7\">NOT</span><span class=\"mtk1\"> </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">`fav_fruits`</span><span class=\"mtk1\"> </span><span class=\"mtk7\">json</span><span class=\"mtk1\"> DEFAULT </span><span class=\"mtk7\">NULL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span></code></pre>\n<aside class=\"markdown-aside\">\nThis project is using the SQL format of the schema dump rather than the default Ruby format. This is useful if you ever need to use raw SQL in a migration to execute something that isn't supported by the migration DSL. See the Rails guide on <a class=\"markdown-link\" href=\"https://guides.rubyonrails.org/active_record_migrations.html#types-of-schema-dumps\">migrations</a> for more details.\n</aside>\n<p class=\"markdown-para\">But how does the schema look within each database? To check this, I'm using <a href=\"https://www.jetbrains.com/datagrip/\" class=\"markdown-link\">DataGrip</a>, which is a licensed tool but you could do the same with a command line tool or any database GUI that has a feature to show a table's schema.</p>\n<p class=\"markdown-para\">Here is the schema from MySQL, focusing only on the <code>fav_fruits</code> column:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">create</span><span class=\"mtk1\"> </span><span class=\"mtk7\">table</span><span class=\"mtk1\"> </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> </span><span class=\"mtk7\">not</span><span class=\"mtk1\"> </span><span class=\"mtk7\">exists</span><span class=\"mtk1\"> users</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">fav_fruits </span><span class=\"mtk7\">json</span><span class=\"mtk1\"> </span><span class=\"mtk7\">null</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- other columns...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">);</span></span></span></code></pre>\n<p class=\"markdown-para\">So far so good, this is what we expect. But look at the schema from MariaDB:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">create</span><span class=\"mtk1\"> </span><span class=\"mtk7\">or</span><span class=\"mtk1\"> </span><span class=\"mtk9\">replace</span><span class=\"mtk1\"> </span><span class=\"mtk7\">table</span><span class=\"mtk1\"> users</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">fav_fruits longtext collate utf8mb4_bin </span><span class=\"mtk7\">null</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- other columns...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">constraint</span><span class=\"mtk1\"> fav_fruits</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">check</span><span class=\"mtk1\"> (json_valid(</span><span class=\"mtk6\">`fav_fruits`</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span></code></pre>\n<p class=\"markdown-para\">With MariaDB, the <code>fav_fruits</code> column is not defined as json, rather it's defined as <code>longtext</code> with a check constraint to ensure that only valid json can be stored. This explains why a String is returned from ActiveRecord <code>user.fav_fruits</code>.</p>\n<p class=\"markdown-para\">According to the MariaDB docs for the <a href=\"https://mariadb.com/kb/en/json-data-type/\" class=\"markdown-link\">JSON Data Type</a>, this is a feature, not a bug:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">JSON is an alias for LONGTEXT introduced for compatibility reasons with MySQL's JSON data type. MariaDB implements this as a LONGTEXT rather, as the JSON data type contradicts the SQL standard... In order to ensure that a valid json document is inserted, the JSON_VALID function can be used as a CHECK constraint. This constraint is automatically included for types using the JSON alias from MariaDB 10.4.3.</p>\n</blockquote>\n<h2 class=\"markdown-subtitle\" id=\"solution\" style=\"position:relative;\"><a href=\"#solution\" aria-label=\"solution permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Solution</h2>\n<p class=\"markdown-para\">In the short term, we have a situation where developer's laptops are using MySQL which will return an Array from the JSON column (given that we're only inserting array values and an appropriate JSON validator is in place). But when the same code runs in production against a MariaDB database, a String is returned.</p>\n<p class=\"markdown-para\">Without changing any setup, a solution to this is to override the ActiveRecord attribute method for the JSON field <code>fav_fruits</code>, and  use the <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/AttributeMethods/Read.html#method-i-read_attribute\" class=\"markdown-link\">read_attribute</a> method from the <code>ActiveRecord::AttributeMethods::Read</code> module to retrieve the value, and convert as needed.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">fav_fruits</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Retrieve the typecast value of fav_fruits from the database, which could be:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">#   1. nil</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">#   2. String</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">#   3. Array</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    days </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> read_attribute(</span><span class=\"mtk4\">:fav_fruits</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># 1. Not allowed to have default not null value on json column, return empty array in this case.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> [] </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> days.blank?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># 2. MariaDB: If a String is found, convert to JSON.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">JSON</span><span class=\"mtk1\">.parse(days) </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> days.is_a?(String)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># 3. MySQL: Otherwise, return the original value.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    days</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Now, anywhere in the code that <code>user.fav_fruits</code> is used, it's guaranteed to always return an Array, whether the underlying database is MySQL or MariaDB.</p>\n<p class=\"markdown-para\">In the long term, a better approach is to update the local setup to use MariaDB instead of MySQL. This will avoid any future surprises of differences in implementation. With this in place, the solution is to modify the model to use ActiveRecord's <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/AttributeMethods/Serialization/ClassMethods.html#method-i-serialize\" class=\"markdown-link\">serialize</a> class method. This tells Rails that you want this column retrieved from the database as JSON:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  serialize </span><span class=\"mtk4\">:fav_fruits</span><span class=\"mtk1\">, JSON</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">With this change in place, we can again run a Rails console in the project that's using MariaDB and check the value of fav_fruits, this time its retrieved from the database as an Array rather than a String:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">u </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.find_by(</span><span class=\"mtk4\">username:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;alice&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">u.fav_fruits</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># =&gt; [&quot;apple&quot;, &quot;orange&quot;]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">u.fav_fruits.class</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># =&gt; Array</span></span></span></code></pre>\n<p class=\"markdown-para\">Overriding the <code>fav_fruits</code> method is no longer needed, unless you want to maintain the behaviour of having an empty array returned instead of nil, in which case, the User model would look like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&lt;</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtki mtku\">ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># solution to guarantee JSON when retrieving fav_fruits from MariaDB</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  serialize </span><span class=\"mtk4\">:fav_fruits</span><span class=\"mtk1\">, JSON</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># if want [] returned instead of nil</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">fav_fruits</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    days </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> read_attribute(</span><span class=\"mtk4\">:fav_fruits</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> [] </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> days.blank?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">super</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">WARNING:</strong> Do not use the <code>serialize</code> class method when running against a database that natively supports JSON such as MySQL or Postgres. Otherwise the following error will result when inserting data:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.create(</span><span class=\"mtk4\">username:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;alice&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">fav_fruits:</span><span class=\"mtk1\"> [</span><span class=\"mtk6\">&quot;apple&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;orange&quot;</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># activerecord-7.0.4/lib/active_record/attribute_methods/serialization.rb:117:in `block in serialize&#39;:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Column `fav_fruits` of type ActiveRecord::Type::Json does not support `serialize` feature.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># (ActiveRecord::AttributeMethods::Serialization::ColumnNotSerializableError)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Usually it means that you are trying to use `serialize`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># on a column that already implements serialization natively.</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered an important difference in JSON handling between MySQL and MariaDB. It showed a solution if both databases must be supported and another solution if all environments can be modified to use MariaDB. In general, it's better to have the local development environment mirror production as closely as possible to avoid surprising differences in behaviour.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk12 { color: #CFCFC2; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/activerecord-json-mysql-mariadb/"}}},{"node":{"id":"e43646a1-6a97-5a2d-8028-55f3716966d4","frontmatter":{"title":"When the Password Field Says No to Paste","date":"March 2023","category":"javascript"},"excerpt":"If you were affected by the LastPass breach at the end of 2022, you've probably found yourself on various websites changing passwords. Youâ€¦","html":"<p class=\"markdown-para\">If you were affected by the <a href=\"https://blog.lastpass.com/2022/12/notice-of-recent-security-incident/\" class=\"markdown-link\">LastPass breach</a> at the end of 2022, you've probably found yourself on various websites changing passwords. You may have also noticed that some websites block pasting in a password field. For some reason, the companies behind these seem to think that being able to paste in a password field is insecure. But it's actually the opposite, forcing users to manually type in a password one character at a time encourages the use of weak passwords - shorter and easier to type in. It can also interfere with password managers, although some of them may be able to work around it.</p>\n<p class=\"markdown-para\">My first reaction when encountering this behaviour was irritation at being blocked from performing a basic function. My second reaction was curiosity - how does this work and is there anything that can be done about it? The good news is yes! This post will show how to work around this frustrating user experience.</p>\n<h2 class=\"markdown-subtitle\" id=\"solution\" style=\"position:relative;\"><a href=\"#solution\" aria-label=\"solution permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Solution</h2>\n<p class=\"markdown-para\">Next time you encounter a website that won't let you paste into a password (or any other) field, open Developer Tools (<kbd class=\"markdown-kbd\">Cmd</kbd> + <kbd class=\"markdown-kbd\">Option</kbd> + <kbd class=\"markdown-kbd\">I</kbd> on a Mac if using Chrome), make sure you're in the Console tab, and paste in the following lines:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">var</span><span class=\"mtk1\"> </span><span class=\"mtk5\">allowPaste</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">function</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  e.</span><span class=\"mtk5\">stopImmediatePropagation</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">console</span><span class=\"mtk1\">.</span><span class=\"mtk9\">log</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;Free the paste!&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">document.</span><span class=\"mtk5\">addEventListener</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;paste&#39;</span><span class=\"mtk1\">, allowPaste, </span><span class=\"mtk4\">true</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p class=\"markdown-para\">Now, without refreshing the page, try to paste again in the field that wouldn't allow it before - you should now be able to paste, hurray!</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"snippet\" style=\"position:relative;\"><a href=\"#snippet\" aria-label=\"snippet permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Snippet</h3>\n<p class=\"markdown-para\">To avoid having to remember those lines and paste them in the console each time, they can be saved in a <a href=\"https://developer.chrome.com/docs/devtools/javascript/snippets/\" class=\"markdown-link\">Snippet</a> as follows:</p>\n<ol class=\"markdown-list-ordered\">\n<li class=\"markdown-list-item\">With Developer Tools open, click on the Sources tab.</li>\n<li class=\"markdown-list-item\">There should be another panel open on the left hand side with tabs like Page, Filesystem, Snippets. Click on Snippets.</li>\n<li class=\"markdown-list-item\">Click on \"+ New Snippet\" at the top of the Snippets tab.</li>\n<li class=\"markdown-list-item\">This will open up an editor in the middle panel - paste in the lines of JavaScript from above, and press <kbd class=\"markdown-kbd\">Cmd</kbd> + <kbd class=\"markdown-kbd\">S</kbd> to save it.</li>\n<li class=\"markdown-list-item\">Chrome will automatically assign the snippet a name, shown in the snippet listing in the left panel such as \"Script snippet #1\". Right-click on it, select Rename, and name it whatever you like. I name mine \"free_the_paste\".</li>\n</ol>\n<p class=\"markdown-para\">When you're finished, it should look something like this:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVR42j2Q3W6EIBCFfY+Nq6uAgCCCqOnPTdM22/T93+drYDe9OJm5Od+cM41fIkJO2Hmh7H5JxLRjZ8+kZ4Q0rOlATZa2vTJpyxozaTvqXEJiWTecXwlrosl5Z8sHxjq0mSuomKUypHMjpoVzS+x7ZpSa2yCrpNQc5yspnxjrn8CN5v51cv/55ePzmzVuhBCRShPCzsvbOzkvRGeIziKFQkjNIBT9IIjpqOnLcecjs1tpLm3Hpe3pekHXj1y7gf4mMMZjzIw2CjUpJqmQorwmoLRlVLpCSroCLLV9SDSzC/VX7fX2L/GsVsC3QT00KrT1aOMw8/KY1td9GCVC6er7A5rzld4nNFptAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"chrome snippet free paste\"\n        title=\"chrome snippet free paste\"\n        src=\"/static/58949b2489682591827b005f9a903cda/5a190/chrome-snippet-free-paste.png\"\n        srcset=\"/static/58949b2489682591827b005f9a903cda/772e8/chrome-snippet-free-paste.png 200w,\n/static/58949b2489682591827b005f9a903cda/e17e5/chrome-snippet-free-paste.png 400w,\n/static/58949b2489682591827b005f9a903cda/5a190/chrome-snippet-free-paste.png 800w,\n/static/58949b2489682591827b005f9a903cda/c1b63/chrome-snippet-free-paste.png 1200w,\n/static/58949b2489682591827b005f9a903cda/ffaa5/chrome-snippet-free-paste.png 1299w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">To use the snippet, next time you land on a page that is preventing pasting into a field, open dev tools, click on the snippet, then hit <kbd class=\"markdown-kbd\">Cmd</kbd> + <kbd class=\"markdown-kbd\">Enter</kbd> to run it. Then go ahead and paste to your hearts content.</p>\n<p class=\"markdown-para\">If you'd like to test this out, I've created an <a href=\"https://danielabar.github.io/messing_with_paste/\" class=\"markdown-link\">example page</a> with some input fields that block paste.</p>\n<aside class=\"markdown-aside\">\nThere are a number of browser extensions that solve this, saving the effort of maintaining and running a custom snippet of JavaScript. However, each extension you add increases the <a class=\"markdown-link\" href=\"https://krebsonsecurity.com/2018/09/browser-extensions-are-they-worth-the-risk/\">attack surface</a>, so I wouldn't recommend adding an extensions for something small like this.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"how-does-it-work\" style=\"position:relative;\"><a href=\"#how-does-it-work\" aria-label=\"how does it work permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How Does it Work?</h2>\n<p class=\"markdown-para\">In order to understand why the snippet works, we first need to understand how paste is blocked in the first place. If you inspect any input field that has paste blocked, it will most likely look like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"html\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;password&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;some_field&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;some_field&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">onpaste</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;</span><span class=\"mtk7\">return</span><span class=\"mtk6\"> </span><span class=\"mtk4\">false</span><span class=\"mtk6\">;&quot;</span><span class=\"mtk1\">&gt;</span></span></span></code></pre>\n<p class=\"markdown-para\">This makes use of the <code>paste</code> event. According to <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Element/paste_event\" class=\"markdown-link\">MDN</a>:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">The paste event fires when the user initiates a paste action through the browser's user interface.</p>\n</blockquote>\n<p class=\"markdown-para\">That bit in the markup <code>onpaste=\"return false;\"</code> overrides the default action, which is to insert the contents of the clipboard into the field at the cursor position. It's equivalent to the following, which adds an event handler to the field using the <code>onpaste</code> property of the field:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">const</span><span class=\"mtk1\"> some_field </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> document.</span><span class=\"mtk5\">querySelector</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;#some_field&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">some_field.</span><span class=\"mtk5\">onpaste</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> (</span><span class=\"mtk10 mtki\">event</span><span class=\"mtk1\">) </span><span class=\"mtk9 mtki\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">Alternatively, it could be implemented using the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener\" class=\"markdown-link\">addEventListener</a> method of the text field:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">const</span><span class=\"mtk1\"> some_field </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> document.</span><span class=\"mtk5\">querySelector</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;#some_field&quot;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">some_field.</span><span class=\"mtk5\">addEventListener</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;paste&quot;</span><span class=\"mtk1\">, (</span><span class=\"mtk10 mtki\">event</span><span class=\"mtk1\">) </span><span class=\"mtk9 mtki\">=&gt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  event.</span><span class=\"mtk5\">preventDefault</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">});</span></span></span></code></pre>\n<p class=\"markdown-para\">The end result of returning false from a <code>paste</code> event handler (or invoking <code>preventDefault()</code> on the event with <code>addEventListener</code>) is that nothing happens when the user attempts to pastes in content.</p>\n<p class=\"markdown-para\">Now let's take a closer look at the solution, which adds another event listener for the <code>paste</code> event on the document:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">var</span><span class=\"mtk1\"> </span><span class=\"mtk5\">allowPaste</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">function</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  e.</span><span class=\"mtk5\">stopImmediatePropagation</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">console</span><span class=\"mtk1\">.</span><span class=\"mtk9\">log</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;Free the paste!&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">document.</span><span class=\"mtk5\">addEventListener</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;paste&#39;</span><span class=\"mtk1\">, allowPaste, </span><span class=\"mtk4\">true</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p class=\"markdown-para\">There's two concepts to understand for why the above code has the effect of undoing the paste blocking code.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"element-nesting\" style=\"position:relative;\"><a href=\"#element-nesting\" aria-label=\"element nesting permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Element Nesting</h3>\n<p class=\"markdown-para\">The first concept is that when an event is fired on a DOM element (eg: by user clicking, pasting, etc), that element could be nested within other elements, which in turn are contained in the body tag, which is contained in the html tag, which is contained in the document. And all of these elements receive the event in turn. For example, given the following markup:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"html\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;!</span><span class=\"mtk7\">DOCTYPE</span><span class=\"mtk1\"> </span><span class=\"mtk5\">html</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">html</span><span class=\"mtk1\"> </span><span class=\"mtk5\">lang</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;en&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">head</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">title</span><span class=\"mtk1\">&gt;Messing with Paste&lt;/</span><span class=\"mtk7\">title</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk7\">head</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">body</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">div</span><span class=\"mtk1\"> </span><span class=\"mtk5\">class</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;container&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;password&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;some_field&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;some_field&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">onpaste</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;</span><span class=\"mtk7\">return</span><span class=\"mtk6\"> </span><span class=\"mtk4\">false</span><span class=\"mtk6\">;&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk7\">body</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk7\">html</span><span class=\"mtk1\">&gt;</span></span></span></code></pre>\n<p class=\"markdown-para\">When a user pastes into <code>some_field</code>, the paste event is first fired on the input element (which has a handler that prevents the actual paste from happening). But the execution doesn't end there, the <code>paste</code> event is then also fired in turn on:</p>\n<ol class=\"markdown-list-ordered\">\n<li class=\"markdown-list-item\">The <code>&#x3C;div class=\"container\"></code> element that the input field is contained in.</li>\n<li class=\"markdown-list-item\">The <code>&#x3C;body></code> element, which the container div is directly contained in.</li>\n<li class=\"markdown-list-item\">The <code>&#x3C;html></code> element that wraps the <code>body</code> and is the root of the DOM tree.</li>\n<li class=\"markdown-list-item\">The <code>document</code> object which represents the DOM for the current page.</li>\n<li class=\"markdown-list-item\">The <code>window</code> object which contains the entire DOM tree and all other browser-related objects.</li>\n</ol>\n<p class=\"markdown-para\">This is referred to as event bubbling, the event is first handled by the element that received the event, and then bubbles all the way up the DOM tree. This means the order matters. If you were to attempt to add an event listener via dev tools to a page with the above markup like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">document.</span><span class=\"mtk5\">addEventListener</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;paste&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk9 mtki\">function</span><span class=\"mtk1\"> (</span><span class=\"mtk10 mtki\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">console</span><span class=\"mtk1\">.</span><span class=\"mtk9\">log</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;Document pasted!&#39;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// Try to do something to unblock paste?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">});</span></span></span></code></pre>\n<p class=\"markdown-para\">It would be too late. Because the <code>input</code> element receives the <code>paste</code> event first, and has already returned false to block it. Your code would still run and would still see <code>Document pasted!</code> in the console, but it would be too late to do anything to undo the paste blocking.</p>\n<p class=\"markdown-para\">What's needed is a way to reverse the order of event handling so that the event listener being added to the <code>document</code> via our \"free the paste\" snippet can run <em class=\"markdown-emphasis\">before</em> the event is received by the input element. This leads to the second concept that's needed to understand the solution.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"bubbling-vs-capture\" style=\"position:relative;\"><a href=\"#bubbling-vs-capture\" aria-label=\"bubbling vs capture permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bubbling vs Capture</h3>\n<p class=\"markdown-para\">Let's take a closer look at the last line of the solution snippet that adds an event listener for the <code>paste</code> event. Specifically, notice the third argument <code>true</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">document.</span><span class=\"mtk5\">addEventListener</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;paste&#39;</span><span class=\"mtk1\">, allowPaste, </span><span class=\"mtk4\">true</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<p class=\"markdown-para\">If you've done any web development, you've probably used the version of the <code>addEventListener</code> method that accepts two parameters as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Listen for `someEvent` on document and perform</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// `someFunction` when the event is fired.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">document.</span><span class=\"mtk5\">addEventListener</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;someEvent&#39;</span><span class=\"mtk1\">, someFunction)</span></span></span></code></pre>\n<p class=\"markdown-para\">However, there's another version of this method that accepts three parameters:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">document.</span><span class=\"mtk5\">addEventListener</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;someEvent&#39;</span><span class=\"mtk1\">, someFunction, useCapture)</span></span></span></code></pre>\n<p class=\"markdown-para\">The third parameter is a boolean indicating whether the event should be handled in the capture or bubbling phase. It defaults to false which means if not specified, it will be handled during the bubbling phase. The bubbling phase is probably the most familiar to web developers. This is where the event bubbles up the DOM tree, starting from the element that received the event (for example, an input field with a listener for the paste event), then the form or whatever dom element the field is contained in, and so on up to the body, html, document, and window. This is also known as event propagation.</p>\n<p class=\"markdown-para\">But it turns out, <em class=\"markdown-emphasis\">before</em> the bubbling phase runs, there is a capturing phase for event handling that goes in the opposite direction. This is also event propagation, but it goes down the DOM tree. For our simple example, the order of event handling in the capture phase is:</p>\n<ol class=\"markdown-list-ordered\">\n<li class=\"markdown-list-item\">The <code>window</code> object which contains the entire DOM tree and all other browser-related objects.</li>\n<li class=\"markdown-list-item\">The <code>document</code> object which represents the DOM for the current page.</li>\n<li class=\"markdown-list-item\">The <code>html</code> element that wraps the <code>body</code> and is the root of the DOM tree.</li>\n<li class=\"markdown-list-item\">The <code>body</code> element, which the container div is directly contained in.</li>\n<li class=\"markdown-list-item\">The <code>container</code> div that the input field is contained in.</li>\n<li class=\"markdown-list-item\">The <code>input</code> field.</li>\n</ol>\n<p class=\"markdown-para\">Now we can see the usefulness of setting <code>useCapture</code> to <code>true</code> in an event handler. It gives you a chance to run some code <em class=\"markdown-emphasis\">before</em> other event handlers that are part of the website you're visiting.</p>\n<p class=\"markdown-para\">The last bit of this solution is to know that there's a method <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Event/stopImmediatePropagation\" class=\"markdown-link\">stopImmediatePropagation</a> available on the event that prevents other listeners of the same event from being called. So for example, if you've plugged into the capture phase (event going down from window to element) and were to call <code>stopImmediatePropagation</code>, any elements lower in the DOM tree would never receive the event.</p>\n<p class=\"markdown-para\">This is exactly what's needed to undo the paste blocking. Here's the solution snippet again with comments explaining what we've just learned:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"js\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">var</span><span class=\"mtk1\"> </span><span class=\"mtk5\">allowPaste</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">function</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">e</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">// Prevent any further event listeners from receiving event `e`.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  e.</span><span class=\"mtk5\">stopImmediatePropagation</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk9 mtki\">console</span><span class=\"mtk1\">.</span><span class=\"mtk9\">log</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;Free the paste!&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">};</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// Listen for the `paste` event during the capture phase,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">// i.e. as the event propagates down the DOM tree rather than up.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">document.</span><span class=\"mtk5\">addEventListener</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;paste&#39;</span><span class=\"mtk1\">, allowPaste, </span><span class=\"mtk4\">true</span><span class=\"mtk1\">);</span></span></span></code></pre>\n<aside class=\"markdown-aside\">\nNote that <a class=\"markdown-link\" href=\"https://developer.mozilla.org/en-US/docs/Web/API/Event/stopImmediatePropagation\">stopImmediatePropagation</a> is different from <a class=\"markdown-link\" href=\"https://developer.mozilla.org/en-US/docs/Web/API/Event/preventDefault\">preventDefault</a>, which stops the default action from occurring on the element that received the event, but does allow the event to bubble up or capture down the DOM tree as it normally would. Read this excellent post from Wes Bos for a <a class=\"markdown-link\" href=\"https://wesbos.com/javascript/05-events/targets-bubbling-propagation-and-capture\">deeper explanation</a> of event phases.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has demonstrated how to work around web sites that prevent pasting into input fields with a few lines of JavaScript. It also covered an explanation of bubbling vs capturing phases in event handling and how this can be used to run custom code from the dev tools before the existing web site code runs. Finally, if you're building web sites and have any say in how they're built, please try to avoid interfering with standard behaviour like this as it can frustrate users.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk10 { color: #FD971F; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","fields":{"slug":"/blog/password-field-no-paste/"}}},{"node":{"id":"0ea593a7-d033-5622-87b1-8aae9dc5b34f","frontmatter":{"title":"Reflections on Effective Teams","date":"February 2023","category":"career"},"excerpt":"I was inspired to write this post after listening to a Software Engineering Radio podcast with guest Jon Smart on the subject of Patternsâ€¦","html":"<p class=\"markdown-para\">I was inspired to write this post after listening to a Software Engineering Radio podcast with guest Jon Smart on the subject of <a href=\"https://www.se-radio.net/2022/12/episode-543-jon-smart-on-patterns-and-anti-patterns-for-successful-software-delivery-in-enterprises/\" class=\"markdown-link\">Patterns and Anti-Patterns for Successful Software Delivery</a>. Topics covered included why \"Agile Transformation\" is an anti-pattern, and avoiding one-size-fits-all solutions.</p>\n<p class=\"markdown-para\">Listening to this podcast made me reflect on my many years experience of software development on various project and product teams across different sized companies and industries in terms of what practices have made some teams more effective than others. In this post, I'll share practices I've experienced that have made teams effective, keeping in mind the majority of my experience has been in web development.</p>\n<h2 class=\"markdown-subtitle\" id=\"definition\" style=\"position:relative;\"><a href=\"#definition\" aria-label=\"definition permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Definition</h2>\n<p class=\"markdown-para\">But first, what do I mean by an effective team? My definition of this term is a team that can continuously deliver working software that solves their customers problems, and the customers are happy to keep on paying for the service. The delivery of each release introduces little to no <a href=\"https://en.wikipedia.org/wiki/Software_regression\" class=\"markdown-link\">regressions</a>. Equally important, an effective team consists of team members who communicate well with each other, feel satisfied and fulfilled in their work, and reasonably look forward to starting work each day.</p>\n<aside class=\"markdown-aside\">\nThere are of course, many more projects and teams in this world that I haven't worked on than those I have, so all the practices suggested in this post are based only on my experience. There could be other practices I've missed that are also effective, and some of my suggestions may not work for all teams. Your mileage may vary.\n</aside>\n<p class=\"markdown-para\">Now that the definition is out of the way, let's get into the practices.</p>\n<h2 class=\"markdown-subtitle\" id=\"product\" style=\"position:relative;\"><a href=\"#product\" aria-label=\"product permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Product</h2>\n<p class=\"markdown-para\">An effective team starts with good product direction. The role of the person(s) that define this has changed names over the years, from Business Analyst, to Product Manager or Product Owner. I'll just refer to it as PM.</p>\n<p class=\"markdown-para\">An effective team will have a PM that can express clearly how different areas of the product should work and why. These features should be driven by what will solve the customers problems, ultimately generating revenue. The PM should also expect clarifying questions from engineers and consistently update written requirements to reflect those clarifications (more on <a href=\"../reflections-on-effective-teams#culture-of-writing\" class=\"markdown-link\">writing</a> later in this post). This way all team members current <em class=\"markdown-emphasis\">and</em> future can gain an understanding of why the product works the way it does.</p>\n<p class=\"markdown-para\">Sometimes the product direction is not entirely clear. The company could be dealing with unknowns and engaging in research and experiments to determine market fit. A team can still be effective in this case if it's communicated clearly to all team members that they're dealing with unknowns. In this environment, people are encouraged to think creatively of potential solutions and to try things out, with the understanding that many features may not stick and have to be rolled back. i.e. no one is blamed if something doesn't work out because it all contributes to increased understanding.</p>\n<p class=\"markdown-para\">The only style of product I've seen be ineffective is when there are a lot of unknowns, but the PM (or key business decision makers) doesn't seem to be aware that they don't know. In this case, when developers ask clarifying questions, the answers are still vague. Then developers will make their best guess. When the feature is delivered, its not what anyone expected, but no one can exactly explain why. This leads to finger pointing where product blames developers for not meeting requirements and developers in turn saying the requirements weren't clear. This results in stress and frustration.</p>\n<h2 class=\"markdown-subtitle\" id=\"minimal-process\" style=\"position:relative;\"><a href=\"#minimal-process\" aria-label=\"minimal process permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Minimal Process</h2>\n<p class=\"markdown-para\">An effective team keeps the spirit of <a href=\"https://agilemanifesto.org/principles.html\" class=\"markdown-link\">agile</a> alive, while not burying themselves under needless ceremonies and process. This means keeping a focus on getting things done using a flow approach rather than a <s class=\"markdown-strikethrough\">religious</s> rigid methodology like <a href=\"https://en.wikipedia.org/wiki/Scrum_(software_development)\" class=\"markdown-link\">Scrum</a>.</p>\n<p class=\"markdown-para\">A small team (more on <a href=\"../reflections-on-effective-teams#small-ish-team-size\" class=\"markdown-link\">team size</a> later in this post) of intrinsically motivated people with solid written communication skills and autonomy over the entire stack can get a lot done with a minimum of process and meetings. There does need to be some process to avoid chaos, every day should not feel like a hack-a-thon. A lightweight process could include:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\">Breaking up large requirements into smaller items and entering these into a ticketing system to keep track of the work to be done, in priority order.</li>\n<li class=\"markdown-list-item\">Developers pick up tickets by assigning the next most important item in the list to themselves and starting a feature branch. Major change are discussed with <a href=\"../about-those-docs#architecture-decision-records\" class=\"markdown-link\">ADRs</a>.</li>\n<li class=\"markdown-list-item\">All code has automated tests at the appropriate level (from unit to end-to-end).</li>\n<li class=\"markdown-list-item\"><a href=\"../about-those-docs\" class=\"markdown-link\">Engineering documentation</a> is maintained as part of development.</li>\n<li class=\"markdown-list-item\">CI (Continuous Integration) runs on each commit to verify the build, lint rules, and tests.</li>\n<li class=\"markdown-list-item\">Developers submit PRs when their feature is ready for review, with <a href=\"../working-towards-asynchronous-future#pull-requests\" class=\"markdown-link\">instructions to reviewer</a> how to exercise the code.</li>\n<li class=\"markdown-list-item\">Developers address feedback on their PRs, and when approved merge.</li>\n<li class=\"markdown-list-item\">If CI passes on the merge commit, CD (Continuous Deployment) kicks in and automatically deploys the code to production.</li>\n<li class=\"markdown-list-item\">Developers pick up next most important item, rinse and repeat.</li>\n</ul>\n<aside class=\"markdown-aside\">\nThere's been a lot said about ticketing systems being four letter words and all that. It doesn't need to be this way. The ticketing system is simply a communication tool to keep track of what needs to be done and what's most important. Ideally it will be integrated with version control so that ticket status changes such as In Progress, In Review, and Done are applied automatically as developers start pushing to branches, submit PRs, and merge.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"traceability\" style=\"position:relative;\"><a href=\"#traceability\" aria-label=\"traceability permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Traceability</h2>\n<p class=\"markdown-para\">How often has it happened that you're looking at a particular section of code and wondering \"What does this even do?\" or \"How did this ever work?\". Since developers spend more of their time reading code others wrote rather than writing new code, traceability is needed for effectiveness. This is the ability to follow a path from every line of code, to the business requirements that necessitated it, <em class=\"markdown-emphasis\">and</em> to the pull request where this code got merged into the main branch for more technical context.</p>\n<p class=\"markdown-para\">In order to achieve this, the majority of changes to the code should be associated with a ticket number. The ticket should contain the business requirements in the case of a new feature, or for a bug, it should contain the steps to reproduce with actual vs expected results.</p>\n<p class=\"markdown-para\">When developers commit their code, the commit message includes the ticket number (eg: <code>git commit -m \"[ACME-1234] description of change\"</code>). Furthermore, the ticketing system should be integrated with the system where the code is hosted (eg: Github, Gitlab, etc.). This means that when a PR is created for this ticket, the ticketing system automatically updates the ticket with a link to the PR.</p>\n<p class=\"markdown-para\">When a developer is looking at any line of code, they can run <a href=\"https://www.git-scm.com/docs/git-blame\" class=\"markdown-link\">git blame</a> to see the commit message and associated ticket number. Then they can <a href=\"../find-jira-tickets-faster\" class=\"markdown-link\">open the ticket</a> to understand the business context around this code. From the ticket, they can follow through to the PR, and read the technical context in the PR description, and also the step by step instructions how to exercise the code (which is part of the PR description).</p>\n<h2 class=\"markdown-subtitle\" id=\"culture-of-writing\" style=\"position:relative;\"><a href=\"#culture-of-writing\" aria-label=\"culture of writing permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Culture of Writing</h2>\n<p class=\"markdown-para\">An effective team develops a culture of writing, both on the business and technical side.</p>\n<p class=\"markdown-para\">On the business side, writing is used to capture the requirements and business rules, and also the <em class=\"markdown-emphasis\">why</em> behind these. This could be tied to improved revenue generation or user experience. Its helpful for developers that are implementing the requirements to understand why a feature is being built a certain way. A team of genius developers that can solve every <a href=\"https://en.wikipedia.org/wiki/Competitive_programming\" class=\"markdown-link\">leetcode</a> interview question ever written could still be ineffective if they don't understand the requirements, or recognize when thereâ€™s additional clarifications to go to PM with.</p>\n<p class=\"markdown-para\">On the technical side, writing is used to share knowledge and expertise. This includes architectural proposals and decisions, project setup, common workflows through the application, troubleshooting tips, third party integrations, configuration, how to do deployments, how to exercise new code being added in a pull request, and anything else that helps developers understand how the project works.</p>\n<aside class=\"markdown-aside\">\nThe kind of documents I'm referring to are internal, that is, written by engineers for engineers working together on the same project. Not to be confused with external customer-facing documentation. That is best written by a specialist, especially if the customers are non-technical.\n</aside>\n<p class=\"markdown-para\">These written documents are not intended as <em class=\"markdown-emphasis\">contracts</em> where people can finger point later if something is not working. Rather, they are <em class=\"markdown-emphasis\">living</em> documents owned by the entire team. They support collaboration and team continuity, and are updated as questions and new information arises. Here is where I differ from one of the Agile Manifesto principles which states:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">The most efficient and effective method of conveying information to and within a development team is face-to-face conversation.</p>\n</blockquote>\n<p class=\"markdown-para\">The original manifesto was developed in <a href=\"https://agilemanifesto.org/history.html\" class=\"markdown-link\">2001</a>. Changes in team work since then include the prevalence of remote work, recognition of the importance of mental health and preventing burnout, DEI, neurodiversity, and psychology research on <a href=\"https://en.wikipedia.org/wiki/Flow_(psychology)\" class=\"markdown-link\">flow state</a>. Relying primarily on face-to-face conversations:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\">Results in a lot of scheduled or impromptu meetings that interrupt flow state.</li>\n<li class=\"markdown-list-item\">Requires co-incidence that everyone required to make a decision happens to be online at the same time. What if someone's out sick, vacation, appointment, has another commitment, works in a different timezone etc.</li>\n<li class=\"markdown-list-item\">Relies on people having perfect memories of what was discussed.</li>\n<li class=\"markdown-list-item\">Assumes that the best way to get people's input into decisions is via realtime conversation - this can result in \"off the cuff\" remarks that upon deeper technical analysis, may not turn out to be optimal.</li>\n<li class=\"markdown-list-item\">Can be prone to <a href=\"https://www.linkedin.com/pulse/loudest-voice-room-hisako-esaki/\" class=\"markdown-link\">loudest voice in the room</a> effect where the more dominant personalities assert their opinions, and the quieter types that may have differing opinions don't feel comfortable challenging it or can't get a word in.</li>\n<li class=\"markdown-list-item\">Results in a lot of knowledge that only lives in people's heads, and gets lost as people leave.</li>\n</ul>\n<p class=\"markdown-para\">Using written communication can improve team effectiveness by:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\">Minimizing interruptions - developers can review proposals or questions others may have when its an optimal time for them.</li>\n<li class=\"markdown-list-item\">Asynchronous nature of responding to written communication means the team can be distributed and can still function even when people have different schedules or personal matters to attend to. i.e. work can revolve around life rather than life needing to revolve around work.</li>\n<li class=\"markdown-list-item\">Leaves a written artifact of discussions and decisions. No more \"What was that we decided in the meeting last month?\" or \"Why was tool X over Y chosen?\".</li>\n<li class=\"markdown-list-item\">Captures everyone's feedback because everyone has an opportunity to contribute to shared documents with the results of deep, thoughtful analysis.</li>\n<li class=\"markdown-list-item\">Contributes to a shared understanding of business and technical decisions. Not only for the current team members, but future team members. i.e. as the usual churn of tech workers coming and going happens, the project can still continue smoothly because important information has been captured in writing.</li>\n</ul>\n<h2 class=\"markdown-subtitle\" id=\"meetings\" style=\"position:relative;\"><a href=\"#meetings\" aria-label=\"meetings permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Meetings</h2>\n<p class=\"markdown-para\">The previous section on writing is not to suggest that face-to-face conversations are never needed. There could be a tricky issue that's gone back and forth in comments in a document or PR and isn't getting resolved. Or some people think better \"out loud\" and sometimes need to bounce ideas off a few other people. An effective team will support all types of thinkers.</p>\n<p class=\"markdown-para\">If a meeting is needed, here's how to get the most out of the precious time:</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Keep it brief:</strong> Set the default meeting time to 30 minutes. If you think you'll need longer, bump it up to 45 minutes, but try not to go over an hour. People lose their focus beyond this, and if the issue hasn't been resolved in an hour, dragging it on any longer doesn't help.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Limit attendees:</strong> The entire team is not needed at every meeting. For example, if two people are having a strong difference of opinion over a technical proposal, only those two, plus maybe the team lead or manager should be required. Other team members can be marked as optional. It's not always the case that every team member has a strong opinion, for these folks, not interrupting them and letting them get on with their work may be best.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Have a goal:</strong> Include a goal in the meeting description. This is different from an agenda, which is just a list of items to be discussed. A goal on the other hand is very specific. For example: \"At the end of this meeting, we will have a decision on whether to use RabbitMQ or Kafka for messaging\". Or \"The purpose of this meeting is to finalize the design for the search results page\".</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Come prepared:</strong> The meeting description should include pointers to documents/discussion that has happened prior, so all attendees can be fully up to speed before the meeting starts. In the case of a technical decision, this could be a link to an <a href=\"../about-those-docs/#architecture-decision-records\" class=\"markdown-link\">ADR</a> and related PR comments. In the case of a UI/UX decision, it could be pointers to the current designs.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Update docs:</strong> Update the referenced documents during the meeting as decision(s) are being made. This way there's no issue of forgetting what was decided or someone having to be a secretary later transcribing what people said. At the conclusion of the meeting, share/publish the decision to make it visible to the entire team.</p>\n<aside class=\"markdown-aside\">\nShopify has gone as far as <a class=\"markdown-link\" href=\"https://www.forbes.com/sites/jenamcgregor/2023/01/03/shopify-is-canceling-all-meetings-with-more-than-two-people-from-workers-calendars-and-urging-few-to-be-added-back/?sh=61950fd6fe8a\">cancelling all recurring meetings involving two or more people</a>. Perhaps once a company gets to a large enough size, a top-down edict like this is needed. My suggestion is to consider what problem you're trying to solve by booking a meeting, and then see if there's an asynchronous/written approach that could solve it. If that's been tried and didn't work, then book the meeting, keeping the above guidelines in mind to maximize the time investment.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"small-ish-team-size\" style=\"position:relative;\"><a href=\"#small-ish-team-size\" aria-label=\"small ish team size permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Small-ish Team Size</h2>\n<p class=\"markdown-para\">Over the years, I have found the optimal team size to be on the small end, ranging from 2 - 4 developers, plus a PM and designer. Keeping the team size small limits the number of <a href=\"https://www.leadingagile.com/2018/02/lines-of-communication-team-size-applying-brooks-law/\" class=\"markdown-link\">lines of communication</a>. Here is a useful diagram from that blog post to illustrate the issue:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACYUlEQVR42k2UiYpqQQxE+/8/SRgdREXUN4rivu/7jPuueZyCiA2h7XRSqVT6GszMns+nHQ4H87Xf7+16vdrj8dDOmfV6vWy32yneF+fL5WLb7dbu97sFnPw4nU7vwPP5LCDOBGPEsAPg9yyAsL+/P7vdbhaoSjALhzPGvIgzw4ihm81mI8N3PB4Vu1wuLVCV1pwplfF9tsyZBRDJSEAR7h0YhjAPrheGgzNGRdg4AExXq5Xi1uv1u8jv768KcaeWSZhOp7pYLBZvlvgIchAAJpOJmOBzIvhgSD578Gm5yL6ohrm+tPips5/ZfWgsaUgLs9lM03IQGI5GI/kdBDa9Xk9+9ANsOBxatVq1VqsleaQhrTKt+XwuMOh7y+Px+P00SAK03WrrDu1qtZpAm82mCgXAYIg2sCEIQIB4BgShDYU7nY4Au92u4vGVy2Wd6/W6gPUOAcUIcl0AI5mdRYsUpGWKuQz4Go2G/MxBU/ZJkYwTH+1zZvd36T6MZ4WP1iHDjmyBSlzCwAfCDgg7Sfj88/R7jBzert+To2eDhlD2PwEWVdGFyr6QhInC9NNXLBaVr2eDBvl8XuKyUwWQdDpthUJBu3+ziURC53g8rraRJhqNWjKZtEgkouGEdrttlUrF+v2+AEgeDAaWy+X0FLLZrJ4QBhADSKVSmjhdfH19iSF3EApUBqhUKgmYb5bWf/79WCaTUZB/19lMVmxgSR4aUjAWi9l37FvSBcTkB28IdgRh+GCNRsRQiPeJVrRLAXw8eNj6FxX8n4ILQJga2tAOPkBgjLYMg98U8X9qcl1j/hz+A902oR1U+w67AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"lines of communication and team size\"\n        title=\"lines of communication and team size\"\n        src=\"/static/ce812dfb09d0601a9688d1e0638b35aa/5a190/lines-of-communication-teams-size.png\"\n        srcset=\"/static/ce812dfb09d0601a9688d1e0638b35aa/772e8/lines-of-communication-teams-size.png 200w,\n/static/ce812dfb09d0601a9688d1e0638b35aa/e17e5/lines-of-communication-teams-size.png 400w,\n/static/ce812dfb09d0601a9688d1e0638b35aa/5a190/lines-of-communication-teams-size.png 800w,\n/static/ce812dfb09d0601a9688d1e0638b35aa/0f246/lines-of-communication-teams-size.png 1118w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">If the team has 2 developers, a PM, and a designer, that's a total size of 4, resulting in 6 lines of communication, which is manageable. Bumping this up to 4 developers results in a total team size of 6, which leads to 15 lines of communication. That's pushing at the maximum of what a team can manage and still be effective.</p>\n<p class=\"markdown-para\">It can be tempting to add more developers to a project thinking that productivity will improve linearly. For example if one developer can complete one feature per week, then adding 9 more developers will result in 9 features completed per week. However, 9 developers plus a PM and designer makes 11 team members, which results in 55 lines of communication! What's more likely is people end up stepping on each other's toes attempting to modify the same area of the code for different reasons, or spending the majority of their time in meetings trying to co-ordinate rather than hands-on building software. This is explained by <a href=\"https://en.wikipedia.org/wiki/Brooks%27s_law\" class=\"markdown-link\">Brook's Law</a> which observes that adding people to a software project that is behind schedule delays it even longer.</p>\n<p class=\"markdown-para\">There's a little more nuance here in that it varies with the surface area of the project. A large project could potentially support a few more developers, if the areas that need to be developed are independent of each other, and there's up-to-date engineering documentation that allows developers to <a href=\"../about-those-docs#readmemd-project-setup\" class=\"markdown-link\">onboard</a> independently.</p>\n<h2 class=\"markdown-subtitle\" id=\"do-the-simplest-thing-that-works\" style=\"position:relative;\"><a href=\"#do-the-simplest-thing-that-works\" aria-label=\"do the simplest thing that works permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Do the Simplest Thing That Works</h2>\n<p class=\"markdown-para\">I learned this motto from a company I worked at earlier in my career and the advice has served me well.</p>\n<p class=\"markdown-para\">An effective team chooses relatively simple solutions that get the job done, while not painting themselves into a corner. The idea here is to value maintainability and ease of deployment over cleverness or attempting a \"big tech\" architecture from day one of the project. While its nice to think that in the future, the project will be so popular it needs to support millions, or even billions of simultaneous users, the reality is, most projects don't get to Meta/Alphabet/Amazon scale.</p>\n<p class=\"markdown-para\">This often means <a href=\"https://www.martinfowler.com/bliki/MonolithFirst.html\" class=\"markdown-link\">starting with a monolith</a> rather than microservices. It can be split up later if transaction volumes and revenue generated from these justifies that. Even then, it's beneficial to measure and identify where the performance bottlenecks are, and come up with solutions to address those directly. For example, if incoming requests are receiving errors due to running out of database connections, splitting up into microservices may not resolve the underlying issue. Instead investigate - Can the database max connections config be increased? Is connection pooling being used and properly configured? Is there a memory leak where some code is always opening, then forgetting to close a connection? Is there some work that could be moved to a background task runner to reduce the time needed to handle common requests? If many requests are read-only could increasing the number of database replicas help? For reads and writes, consider <a href=\"https://dzone.com/articles/how-to-horizontally-scale-your-postgres-database-using-citus\" class=\"markdown-link\">horizontal scaling</a> of database. Notice these investigations are going from simplest to more complex.</p>\n<p class=\"markdown-para\">Avoid over-engineering, i.e. building in abstractions and flexibility unless its known to be needed. Otherwise what can happen is this flexibility is never needed, but when future requirements come in, they need to \"flex\" in a different direction, resulting in overly complex code.</p>\n<p class=\"markdown-para\">Avoid premature optimization. For example, writing harder to understand code that shaves microseconds of performance over more straightforward code. Developers spend more of their time reading code others wrote rather than writing new code so legibility and avoiding second takes is often more valuable than a few microseconds that some obscurely written code saves. In my experience, performance issues have been caused more frequently by loading too much data from the server (eg: lack of pagination), missing database indices, N+1 queries, and loading too much JavaScript, such as trackers or non-minified code.</p>\n<p class=\"markdown-para\">There are exceptions - in some domains such as real-time systems or graphics processing, these microseconds matter. This is a good place to add <a href=\"../about-those-docs#code-comments\" class=\"markdown-link\">code comments</a> explaining what this code does, and more importantly <em class=\"markdown-emphasis\">why</em> this code is needed.</p>\n<h2 class=\"markdown-subtitle\" id=\"fullstack\" style=\"position:relative;\"><a href=\"#fullstack\" aria-label=\"fullstack permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fullstack</h2>\n<p class=\"markdown-para\">When I started my career, there were no separate titles for front and back end developers. The titles were just like \"software developer\" or \"programmer analyst\". These were fullstack roles before that term had been coined. Developers were responsible for building features end to end, including database schema design, back end services, APIs, and making the front end look and function as specified in the <a href=\"https://thedilldesign.com/web-design-comps-made/\" class=\"markdown-link\">design comps</a>.</p>\n<p class=\"markdown-para\">Then some years later, a trend emerged to have separate roles such as \"back end developer\" and \"front end developer\". The idea being that these are separate skills with often, separate languages, and that people should specialize in one area or another. I've had opportunities to work as fullstack, front-end only, and back-end only, and have found fullstack to be the most effective.</p>\n<p class=\"markdown-para\">It's true that there's a different kind of thinking involved in building the front end such as the declarative nature of HTML and CSS, weaving in JavaScript in an organized way (which could mean learning a number of <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/SPA\" class=\"markdown-link\">SPA</a> frameworks), a focus on the visual, animations, and accessibility, just to name a few items. Whereas on the back end a developer is focused on ensuring the database is normalized, efficient queries, building models that accurately represent the business domain, and services and APIs that implement the business rules.</p>\n<p class=\"markdown-para\">However, neither of these are how the business people (who are paying the developers to have this software built), nor the customers (who will use the product) actually think about it. They view the application as a single unit that either solves their problem or doesn't.</p>\n<p class=\"markdown-para\">Consider an example: When the PM specifies a new feature to be added to the product such as advanced search, the requirements will have the design comps showing the layout of the new fields, and specify the behaviour for what kind of results should be returned for various combinations of fields. The PM is not thinking about (nor should they) which parts of the logic will execute on the server and which on the client.</p>\n<p class=\"markdown-para\">When there are separate teams of developers doing front vs back end work, this feature gets split up into two tickets - one to implement the front end and another for the back end. Now there's a very tight dependency between the two people working on these tickets. They might collaborate to determine the path of the search API endpoint and what parameters it will support. Then the back end person will implement it and submit a PR for that work, which will get merged. In the meantime, the front end person can start building their part, perhaps with a mock API (which someone will have to implement) that mirrors the real API that was agreed to.</p>\n<p class=\"markdown-para\">But the front end person won't be able to finish their work until the back end developer's real API is merged. Then the front end developer can update their branch with the real API and start using it. Then they might realize there's an issue, perhaps some edge cases that the search endpoint isn't handling or a bug. Or when the PM views the front end with the real back end, they may want some changes. Who here hasn't had the experience of a conversation with a PM along the lines of \"I thought it should work this way, but now that I see it in action, I think it would be better if it behaved this other way...\"</p>\n<p class=\"markdown-para\">Now the front end developer has to reach out to the back end developer, who may have moved on to another ticket and either have to context switch or tell the front end developer to wait until they have time to fix it. So the front end developer will mark the ticket as blocked and move on to something else, hopefully remembering to return to the original ticket whenever the backend developer gets around to merging the fixes.</p>\n<p class=\"markdown-para\">The other thing that often happens is there's a deadline to get the feature complete. In this case the front end developer may have no choice but to implement some workarounds on the front end to make things seemingly work, when it would have been more efficient to have the back end do this.</p>\n<p class=\"markdown-para\">It's not the fault of the PM that is asking for changes, remember Agile tells us we're supposed to embrace change! But when the teams are structured as horizontal slices of the stack (database, back end, front end), it creates friction to get features complete that are vertical slices through the stack. It's more effective to give every developer autonomy over the entire stack so they can use the appropriate tools to get their job done.</p>\n<p class=\"markdown-para\">If some team members prefer to specialize in one area or another, this can still work. In this case, have those experts be on the PR reviews, and gradually document their specialized knowledge. To the extent that the best practices can be encoded as linting rules, bring those rules into the project linter (more on this in the next section). In this way, it's like everyone on the team has the expert sitting beside them as they code, levelling up everyone's knowledge. It's also beneficial to the company in case the expert(s) leave.</p>\n<h2 class=\"markdown-subtitle\" id=\"automation\" style=\"position:relative;\"><a href=\"#automation\" aria-label=\"automation permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Automation</h2>\n<p class=\"markdown-para\">An effective team establishes automated processes to minimize manual effort. This includes linting, automated testing, CI (Continuous Integration), and CD (Continuous Deployment) in place from the very early days of the project. <a href=\"../add-rubocop-to-legacy-project\" class=\"markdown-link\">Linting can be added later</a>, although that will be more effort. Unless it's a hack-a-thon or throw-away code, this is a must.</p>\n<p class=\"markdown-para\">A good set of linting rules suggests best practices, prevents common coding errors, and enforces code style/formatting to avoid <a href=\"https://en.wikipedia.org/wiki/Law_of_triviality\" class=\"markdown-link\">bike shedding</a> in PRs. Especially when it comes to code style, (eg: spacing, semi colons, etc.), it's less important to be \"right\" and more important for the team to be consistent.</p>\n<p class=\"markdown-para\">Getting in the habit of writing automated tests (unit, integration, and system/end-to-end) leads to better quality code. It also supports adding new features and refactoring without fear of causing regressions, and minimizes or eliminates entirely the need for manual QA.</p>\n<p class=\"markdown-para\">Linting and tests should be easy to run on each developers laptop, via CLI and/or editor plugins. These should also run as part of CI, which should be running on each commit pushed to feature branches and the main branch. A failure in CI should notify the developer that pushed the breaking commit. The main branch should be protected such that CI must be passing before any PR can be merged.</p>\n<p class=\"markdown-para\">Finally, where possible, continuous deployment should be setup to automatically deploy after code is merged to the main branch (given that CI is passing). This avoids manual effort of having a developer putting together a build, cutting a release branch, asking the team not to merge any PRs while the release is in progress, etc.</p>\n<h2 class=\"markdown-subtitle\" id=\"maintenance\" style=\"position:relative;\"><a href=\"#maintenance\" aria-label=\"maintenance permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Maintenance</h2>\n<p class=\"markdown-para\">As exciting as it is to work on new features, an effective team dedicates a certain percentage of time to maintenance. This could include dealing with dependabot PRs, alerts from monitoring systems, deprecation warnings, library upgrades, and bug fixes. Otherwise things can get stale or stop working altogether, and make it difficult to keep moving the project forward.</p>\n<p class=\"markdown-para\">Some teams will set aside a certain part of the year for these activities. Another way is to regularly add these items to the ticketing system with a tag such as <code>Maintenance</code>, and then let developers know for every 3 or so features they work on, pick up a maintenance task. This would work out to roughly 25% of time spent on maintenance. Adjust as per your teams needs, as long as its not 0.</p>\n<h2 class=\"markdown-subtitle\" id=\"rotate-assignments\" style=\"position:relative;\"><a href=\"#rotate-assignments\" aria-label=\"rotate assignments permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rotate Assignments</h2>\n<p class=\"markdown-para\">On many teams, developers tend to become experts on the area of the application that they've worked on most. It could be based on interest, or just by co-incidence of the initial task assignments. Then when new feature requests or bugs come up, they get assigned to the developer that's already most familiar with that area because it will be \"faster\" to get it done.</p>\n<p class=\"markdown-para\">However, this speed is an illusion, or a trade-off between the short term and long term viability of the project. When the expert goes on an extended vacation or leaves to pursue another opportunity, progress slows down when development is needed in the area that only the expert was familiar with.</p>\n<p class=\"markdown-para\">To mitigate this risk, an effective team will intentionally rotate task assignments so that all developers get opportunities to work on all areas of the project. It may feel slower at first, but the payoff is a more resilient team in the future.</p>\n<p class=\"markdown-para\">The purpose of this strategy is to lower the lottery count, i.e. how many team members would have to win the lottery in order for the project to be in trouble. This is also known as the <a href=\"https://www.agileadvice.com/2005/05/15/agilemanagement/truck-factor/\" class=\"markdown-link\">truck factor</a>, but it's nicer to visualize a lottery win rather than getting hit by a truck.</p>\n<p class=\"markdown-para\">This is also an opportunity to improve engineering documentation. As a developer works on an area of the project for the first time, they will naturally have questions that only the expert knows. The new developer can then update the related engineering docs and include it in the PR for the expert to review. This will improve speed of development for the next developer to work in this area.</p>\n<h2 class=\"markdown-subtitle\" id=\"psychological-safety\" style=\"position:relative;\"><a href=\"#psychological-safety\" aria-label=\"psychological safety permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Psychological Safety</h2>\n<p class=\"markdown-para\">Psychological safety is an absolute must in order for any team to work effectively. Here is the definition that was given on the <a href=\"https://www.se-radio.net/2022/12/episode-543-jon-smart-on-patterns-and-anti-patterns-for-successful-software-delivery-in-enterprises/\" class=\"markdown-link\">podcast</a> that inspired this post:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">Psychological safety is the ability to feel safe to ask questions, to challenge authority, to have your voice heard, to express your thoughts without fear of repercussion, without fear of being shot down or belittled. It's the ability to have open, vulnerable conversations with respect. Not having a blame culture. If something goes wrong, its not because someone did something wrong, it's because there was something in the system of work that enabled this thing to happen.</p>\n</blockquote>\n<p class=\"markdown-para\">To this I would add, not just feeling safe to ask questions and challenge authority, but for it to be <em class=\"markdown-emphasis\">encouraged</em> across the hierarchy. For example, it should be ok for a junior dev to question the architecture proposed by the CTO. This is necessary for new idea generation. Otherwise the team stagnates into a culture of \"we've always done things this way\", and stops innovating. Not every new idea that people suggest will work out, but they should never be censured for it because other people will look to that example and think \"I better keep my mouth shut\", and that other idea that never gets surfaced could have been amazing.</p>\n<p class=\"markdown-para\">Developers also need to feel safe suggesting accurate estimates (which are typically larger than business people like to hear) or indicating that something is going to take longer than the initial estimate. When this safety isn't present, people end up working long hours trying to reach unrealistic deadlines, quality suffers, and burn out ensues.</p>\n<aside class=\"markdown-aside\">\nThe topic of estimates is way too large to fully cover in this post, and somewhat out of scope so I've only touched on it. Give a listen to this podcast from Freakonomics on <a class=\"markdown-link\" href=\"https://freakonomics.com/podcast/heres-why-all-your-projects-are-always-late-and-what-to-do-about-it/\">why all your projects are always late</a> for an insightful and entertaining take.\n</aside>\n<p class=\"markdown-para\">Another aspect of psychological safety is what happens when someone makes a mistake that has a serious impact such as data loss? It's important to not assign blame to the individual but rather, look to how the system can be improved so no one else can ever make this mistake again. For example, is there some connection between the dev and production environments that shouldn't exist? Was some operational documentation out of date? Should every developers shell profile include logic to turn the prompt red when connecting to production? Every mistake is an opportunity to improve systems and documentation. On the other hand if an individual \"gets in trouble\" for admitting to a mistake, you can be sure that no one will ever admit to a mistake again, which makes the entire matter worse.</p>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered the definition of an effective software development team, and practices that lead to effectiveness. These practices include:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\">Lightweight process that lets developers get into flow state and supports traceability.</li>\n<li class=\"markdown-list-item\">Favoring written communication over frequent meetings.</li>\n<li class=\"markdown-list-item\">Maintaining a small team.</li>\n<li class=\"markdown-list-item\">Sticking to simple implementations where possible.</li>\n<li class=\"markdown-list-item\">Favoring fullstack where possible.</li>\n<li class=\"markdown-list-item\">Automate all the things.</li>\n<li class=\"markdown-list-item\">Dedicated time to maintenance.</li>\n<li class=\"markdown-list-item\">Giving all team members opportunities to work on all areas of the product, especially those in which they're less familiar.</li>\n<li class=\"markdown-list-item\">Ensuring a psychologically safe environment for everyone.</li>\n</ul>\n<p class=\"markdown-para\">For further reading on this topic, see this post on <a href=\"https://martinfowler.com/articles/developer-effectiveness.html\" class=\"markdown-link\">Developer Effectiveness</a> on Martin Fowler's blog.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","fields":{"slug":"/blog/reflections-on-effective-teams/"}}}]}},"pageContext":{}},"staticQueryHashes":["163244226"],"slicesMap":{}}