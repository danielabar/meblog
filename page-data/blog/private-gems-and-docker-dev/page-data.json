{"componentChunkName":"component---src-templates-post-js","path":"/blog/private-gems-and-docker-dev/","result":{"data":{"markdownRemark":{"html":"<p class=\"markdown-para\">If you're using Docker for development with a Rails application, and want to introduce a private gem registry hosted with <a href=\"https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-rubygems-registry\" class=\"markdown-link\">Github Packages</a>, you may encounter an authentication error when building the development Docker image, at the point where it tries to pull the private gem(s). This post will walk you through the steps to resolve this.</p>\n<p class=\"markdown-para\">An important note before moving on - the solution presented in this post is only suitable for a <em class=\"markdown-emphasis\">development</em> Docker image. That is, an image that remains on the developer's laptop and <em class=\"markdown-emphasis\">never</em> gets pushed to production or made public.</p>\n<h2 class=\"markdown-subtitle\" id=\"configure-bundler\" style=\"position:relative;\"><a href=\"#configure-bundler\" aria-label=\"configure bundler permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Configure Bundler</h2>\n<p class=\"markdown-para\">Given that your projects <code>Gemfile</code> is pulling some gems from Github Packages, for example:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">source &#39;https://rubygems.pkg.github.com/some-project/&#39; do</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  gem &#39;myprivate_gem&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">end</span></span></code></pre>\n<p class=\"markdown-para\">The Github documentation on configuring bundler so that you can pull private gems specifies that you must first run the following command:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">$ bundle config https://rubygems.pkg.github.com/OWNER USERNAME:TOKEN</span></span></code></pre>\n<p class=\"markdown-para\">Where:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\"><code>OWNER</code> is the user or organization account that owns the repository that contains the gem project source.</li>\n<li class=\"markdown-list-item\"><code>USERNAME</code> is in the individual user (Github account) that would like to pull the gem when building the Rails app that depends on it.</li>\n<li class=\"markdown-list-item\"><code>TOKEN</code> is a Github personal access token (aka <a href=\"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token\" class=\"markdown-link\">PAT</a>) that each user running the project needs to create.</li>\n</ul>\n<p class=\"markdown-para\">If everyone on your team was running the Rails project natively on their laptops, you would just update the <code>README.md</code> telling each developer to create their  PAT, run the <code>bundle config...</code> command locally, then run <code>bundle install</code> which will pull the new private gem(s) specified in <code>Gemfile</code>. You keep your <a href=\"../about-those-docs\" class=\"markdown-link\">project setup docs</a> up to date right?</p>\n<aside class=\"markdown-aside\">\nThe Github documentation on private gems also refers to creating or updating your ~/.gemrc file, including the Github credentials in this file. However, this is only required for publishing gems, and will not be covered in this post.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"dockerized-development\" style=\"position:relative;\"><a href=\"#dockerized-development\" aria-label=\"dockerized development permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerized Development</h2>\n<p class=\"markdown-para\">However, things are a little more complicated if using a <a href=\"../dockerize-rails-app-for-dev-debug-and-testing\" class=\"markdown-link\">Dockerized setup for development</a>. With this setup, it's the <code>Dockerfile</code> that runs <code>bundle install</code> when the image is being built. For example:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:whatever-version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle install</span></span></span></code></pre>\n<p class=\"markdown-para\">However, if any of the gems in the <code>Gemfile</code> are coming from a private registry, such as <a href=\"https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-rubygems-registry\" class=\"markdown-link\">Github Packages RubyGems</a>, trying to build this image will fail with the following authentication error:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Authentication is required for rubygems.pkg.github.com.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Please supply credentials for this source. You can do this by running:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">bundle config rubygems.pkg.github.com username:password</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">------</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">executor failed running [bundle install]: exit code: 17</span></span></code></pre>\n<p class=\"markdown-para\">This means the <code>bundle config...</code> needs to be run as part of the image building, before running <code>bundle install</code>, something like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:whatever-version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle config https://rubygems.pkg.github.com/OWNER USERNAME:TOKEN</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle install</span></span></span></code></pre>\n<p class=\"markdown-para\">The problem with the above is that the <code>Dockerfile</code> is committed in the project. You wouldn't  want to commit this line as is, because <code>USERNAME</code> will be different for each developer working on the project. <code>TOKEN</code> is a user-specific secret that provides some access to the developer's Github account so that definitely should not be committed.</p>\n<h2 class=\"markdown-subtitle\" id=\"dockerfile-arg\" style=\"position:relative;\"><a href=\"#dockerfile-arg\" aria-label=\"dockerfile arg permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerfile ARG</h2>\n<p class=\"markdown-para\">What we need to solve this problem is <em class=\"markdown-emphasis\">dynamic</em> values during the Docker build process. The <a href=\"https://docs.docker.com/engine/reference/builder/#arg\" class=\"markdown-link\">ARG</a> command in a Dockerfile can be used for exactly this. Specify the <code>ARG</code>s at beginning of the <code>Dockerfile</code>, just after the <code>FROM</code> command. Rather than <code>USERNAME</code> and <code>TOKEN</code> from the Github documentation, I'm going to name these to be more specific as to what they're used for:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:your-base-image</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ARG</span><span class=\"mtk1\"> GITHUB_USERNAME</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ARG</span><span class=\"mtk1\"> GITHUB_PAT_GEMS</span></span></span></code></pre>\n<p class=\"markdown-para\">Then later in Dockerfile, just before bundle install is run, add the <code>bundle config...</code> command from the Github documentation, but this time, using the <code>ARG</code> variables. Replace <code>project</code> with project name where the private gem source is located:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"dockerfile\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">FROM</span><span class=\"mtk1\"> ruby:whatever-version</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ARG</span><span class=\"mtk1\"> GITHUB_USERNAME</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">ARG</span><span class=\"mtk1\"> GITHUB_PAT_GEMS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle config https://rubygems.pkg.github.com/project GITHUB_USERNAME:GITHUB_PAT_GEMS</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">RUN</span><span class=\"mtk1\"> bundle install</span></span></span></code></pre>\n<p class=\"markdown-para\">Now if you were building the Docker image directly, you could run:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker build -t app-image:latest \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  --build-arg GITHUB_USERNAME=your-github-username \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  --build-arg GITHUB_PAT_GEMS=your-github-pat \\</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  .</span></span></code></pre>\n<p class=\"markdown-para\">To re-emphasize the note from the beginning of this post, using <code>ARG</code> in this way is only suitable for a development image that will never be made public. This is because the <code>ARG</code> values become part of the image and are viewable in the output of the <code>docker history</code> command. If you need build-time secrets for a production image, see the Docker documentation on <a href=\"https://docs.docker.com/develop/develop-images/build_enhancements/#new-docker-build-secret-information\" class=\"markdown-link\">BuildKit</a>.</p>\n<aside class=\"markdown-aside\">\nYou may be wondering why not use <a class=\"markdown-link\" href=\"https://docs.docker.com/engine/reference/builder/#env\">ENV</a>? The reason is Docker does not provide a way to dynamically set ENV values during the build process, and these values are only needed during the image build time, not container run time. Read this <a class=\"markdown-link\" href=\"https://www.baeldung.com/ops/dockerfile-env-variable\">blog post</a> for more on this topic.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"docker-compose\" style=\"position:relative;\"><a href=\"#docker-compose\" aria-label=\"docker compose permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker Compose</h2>\n<p class=\"markdown-para\">This project uses several other services including MySQL and Redis, therefore, <a href=\"https://docs.docker.com/compose/\" class=\"markdown-link\">Docker Compose</a> is used to build the image and run all the containers together. This means we need to be able to pass through the Docker <code>ARG</code>s from the <code>docker-compose.yml</code> file to the <code>Dockerfile</code>. Fortunately, docker compose provides the <a href=\"https://docs.docker.com/compose/compose-file/compose-file-v3/#args\" class=\"markdown-link\">args</a> keyword for the <code>build</code> command for just this purpose.</p>\n<p class=\"markdown-para\">Trying it out however poses a new problem as shown below:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># docker-compose.yml</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">app</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">args</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">GITHUB_USERNAME</span><span class=\"mtk1\">: </span><span class=\"mtk6\">uh oh, what to put here?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">GITHUB_PAT_GEMS</span><span class=\"mtk1\">: </span><span class=\"mtk6\">uh oh, what to put here?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">mysql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">redis</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">redis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span></code></pre>\n<p class=\"markdown-para\">Since the <code>docker-compose.yml</code> file is also committed into the project, we do not want to hard-code Github user names and tokens in this file either. Fortunately, docker compose supports the use of <a href=\"https://docs.docker.com/compose/environment-variables/\" class=\"markdown-link\">environment variables</a>. Here's how to specify the Github username and PAT as environment variables in the compose file:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># docker-compose.yml</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.3&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">app</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">args</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">GITHUB_USERNAME</span><span class=\"mtk1\">: </span><span class=\"mtk6\">${GITHUB_USERNAME}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">GITHUB_PAT_GEMS</span><span class=\"mtk1\">: </span><span class=\"mtk6\">${GITHUB_PAT_GEMS}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">context</span><span class=\"mtk1\">: </span><span class=\"mtk4\">.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">mysql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">redis</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">redis</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># ...</span></span></span></code></pre>\n<p class=\"markdown-para\">Next step is being able to pass the values of these environment variables to docker compose via the command line. This can be accomplished with the <code>--env-file</code> argument, passing in a path to a file containing the values:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">docker-compose --env-file .env.dockercompose.local build</span></span></code></pre>\n<p class=\"markdown-para\">Where <code>.env.dockercompose.local</code> is a gitignored file that specifies the secrets. You can name the .env file whatever you want, just make sure its in the <a href=\"https://git-scm.com/docs/gitignore\" class=\"markdown-link\">gitignore</a> so it doesn't get committed. Here's what the env file will look like:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">GITHUB_USERNAME=your-github-username</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">GITHUB_PAT_GEMS=your-github-pat</span></span></code></pre>\n<p class=\"markdown-para\">Now, when the docker-compose build command is run, it will have access to the values of <code>GITHUB_USERNAME</code> and <code>GITHUB_PAT_GEMS</code> from the .env file. Then these will get passed on to the <code>Dockerfile</code> as ARG's, where they can be used in building the image.</p>\n<h2 class=\"markdown-subtitle\" id=\"makefile\" style=\"position:relative;\"><a href=\"#makefile\" aria-label=\"makefile permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Makefile</h2>\n<p class=\"markdown-para\">To save yourself all that typing of the docker compose command with the env file, if your project uses a <code>Makefile</code>, you can add the following task:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"makefile\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk5\">build</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  docker-compose --env-file .env.dockercompose.local build</span></span></span></code></pre>\n<p class=\"markdown-para\">Now whenever you need to build the image (such as when new gems have been added to the project's <code>Gemfile</code>), simply run:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">make build</span></span></code></pre>\n<p class=\"markdown-para\">Remember to also update the project's <code>README.md</code> with the new setup instructions that everyone wanting to build the image on their laptop needs to create a <code>.env.dockercompose.local</code> file and populate it with their Github username and personal access token.</p>\n<aside class=\"markdown-aside\">\nI've mentioned a few times about keeping the README.md up to date when making changes to the setup process that impact all the other developers working on the project. Although almost no one likes writing engineering documentation, they certainly appreciate having good, up to date docs. See my post on <a class=\"markdown-link\" href=\"https://danielabaron.me/blog/about-those-docs/\">engineering documentation</a> for what kinds of things should get documented and how to get in a good frame of mind for writing it.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered how to authenticate to the Github Packages RubyGems private registry when using Docker for Rails development. The technique involves use of Docker <code>ARG</code>s to specify dynamic build time values, docker compose environment variables to pass them through to the build, and a gitignored env file to avoid committing the secrets. Again a reminder that this technique should only be used for a development image that will never leave the developer's laptop.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","timeToRead":5,"tableOfContents":"<ul>\n<li><a href=\"#configure-bundler\">Configure Bundler</a></li>\n<li><a href=\"#dockerized-development\">Dockerized Development</a></li>\n<li><a href=\"#dockerfile-arg\">Dockerfile ARG</a></li>\n<li><a href=\"#docker-compose\">Docker Compose</a></li>\n<li><a href=\"#makefile\">Makefile</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>","frontmatter":{"title":"Private Gems and Docker for Development","date":"01 Jan 2023","description":"Use a private gem registry with a Dockerized Rails application for development.","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/14da36a04e01f39b6b23d267aba79030/68998/private-gem-ilze-lucero-jLWLxX6i3R8-unsplash.jpg","srcSet":"/static/14da36a04e01f39b6b23d267aba79030/3a1fa/private-gem-ilze-lucero-jLWLxX6i3R8-unsplash.jpg 225w,\n/static/14da36a04e01f39b6b23d267aba79030/ca89c/private-gem-ilze-lucero-jLWLxX6i3R8-unsplash.jpg 450w,\n/static/14da36a04e01f39b6b23d267aba79030/68998/private-gem-ilze-lucero-jLWLxX6i3R8-unsplash.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/14da36a04e01f39b6b23d267aba79030/55987/private-gem-ilze-lucero-jLWLxX6i3R8-unsplash.webp 225w,\n/static/14da36a04e01f39b6b23d267aba79030/eaa2e/private-gem-ilze-lucero-jLWLxX6i3R8-unsplash.webp 450w,\n/static/14da36a04e01f39b6b23d267aba79030/29a9a/private-gem-ilze-lucero-jLWLxX6i3R8-unsplash.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":647}}}},"fields":{"slug":"/blog/private-gems-and-docker-dev/"}},"relatedP":{"edges":[{"node":{"id":"f173b5c7-e7ec-527a-917e-85c12f384e84","frontmatter":{"title":"Dependabot PRs Need Their Secrets","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#081818","images":{"fallback":{"src":"/static/531f78a10b24ce41d4cd17ae99f41f8f/26528/depbot-secrets-30daysreplay-social-media-marketing-ZEDvSzgS4FA-unsplash.jpg","srcSet":"/static/531f78a10b24ce41d4cd17ae99f41f8f/26528/depbot-secrets-30daysreplay-social-media-marketing-ZEDvSzgS4FA-unsplash.jpg 300w,\n/static/531f78a10b24ce41d4cd17ae99f41f8f/43429/depbot-secrets-30daysreplay-social-media-marketing-ZEDvSzgS4FA-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/531f78a10b24ce41d4cd17ae99f41f8f/5d6c3/depbot-secrets-30daysreplay-social-media-marketing-ZEDvSzgS4FA-unsplash.webp 300w,\n/static/531f78a10b24ce41d4cd17ae99f41f8f/68dbc/depbot-secrets-30daysreplay-social-media-marketing-ZEDvSzgS4FA-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/dependabot-secrets/"}}},{"node":{"id":"18a6d127-ce72-5612-bd26-5b4b9e5c0892","frontmatter":{"title":"Using Heroku's pg:pull with Docker","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#383848","images":{"fallback":{"src":"/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/26528/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.jpg","srcSet":"/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/26528/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.jpg 300w,\n/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/43429/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/5d6c3/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.webp 300w,\n/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/68dbc/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/heroku_pg_pull_and_docker/"}}},{"node":{"id":"46775b70-43f2-584d-8c65-327ac46ebbd7","frontmatter":{"title":"Dockerize a Rails Application for Development","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#d8c8d8","images":{"fallback":{"src":"/static/3281f20a27a3ba24dcc1ca78c639c25d/26528/docker-rails-shipping-containers.jpg","srcSet":"/static/3281f20a27a3ba24dcc1ca78c639c25d/26528/docker-rails-shipping-containers.jpg 300w,\n/static/3281f20a27a3ba24dcc1ca78c639c25d/43429/docker-rails-shipping-containers.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/3281f20a27a3ba24dcc1ca78c639c25d/5d6c3/docker-rails-shipping-containers.webp 300w,\n/static/3281f20a27a3ba24dcc1ca78c639c25d/68dbc/docker-rails-shipping-containers.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/dockerize-rails-app-for-dev-debug-and-testing/"}}}]}},"pageContext":{"slug":"/blog/private-gems-and-docker-dev/","relatedPosts":["Dockerize a Rails Application for Development","Dependabot PRs Need Their Secrets","Using Heroku's pg:pull with Docker"]}},"staticQueryHashes":["163244226"],"slicesMap":{}}