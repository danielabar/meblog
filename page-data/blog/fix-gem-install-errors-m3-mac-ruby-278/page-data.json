{"componentChunkName":"component---src-templates-post-js","path":"/blog/fix-gem-install-errors-m3-mac-ruby-278/","result":{"data":{"markdownRemark":{"html":"<p class=\"markdown-para\">Starting a new role always comes with exciting challenges, and one of my first tasks in a recent new role was setting up a 10-year-old legacy Rails project on an M3 MacBook. The project was running Rails 6.1 and Ruby 2.7.8, with several older versions of gems that errored on <code>bundle install</code>. In this post I'll share what caused the errors, and the steps to resolve them, so you can save time and headaches when faced with similar issues.</p>\n<aside class=\"markdown-aside\">\nWhile <a class=\"markdown-link\" href=\"https://endoflife.date/ruby\">Ruby 2.7.x is no longer officially supported</a>, it's still common to work with legacy systems that require older versions during maintenance or upgrades. I'm in the process of upgrading all the things but the first step is to get the older version working and tests running.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"nokogiri\" style=\"position:relative;\"><a href=\"#nokogiri\" aria-label=\"nokogiri permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nokogiri</h2>\n<p class=\"markdown-para\">Here are snippets of the error I encountered during <code>bundle install</code> for the <a href=\"https://rubygems.org/gems/nokogiri\" class=\"markdown-link\">nokogiri</a> gem:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Gem::Ext::BuildError: ERROR: Failed to build gem native extension.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Building nokogiri using packaged libraries.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for iconv... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Building Nokogiri with a packaged version of libxml2-2.11.7.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Running git apply with</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">/path/to/gems/nokogiri-1.15.6/patches/libxml2/0001-Remove-script-macro-support.patch...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">*** extconf.rb failed ***</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Could not create Makefile due to some reason,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">probably lack of necessary libraries and/or headers.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">/path/to/gems/mini_portile2-2.8.7/lib/mini_portile2/mini_portile.rb:589:in</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">`chdir&#39;: no implicit conversion of nil into String (TypeError)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">To see why this extension failed to compile, please check the mkmf.log which can be found here:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">/path/to/gems/2.7.0/extensions/arm64-darwin-23/2.7.0/nokogiri-1.15.6/mkmf.log</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">extconf failed, exit code 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">An error occurred while installing nokogiri (1.15.6), and Bundler cannot continue.</span></span></code></pre>\n<p class=\"markdown-para\">This error usually occurs when <code>nokogiri</code> fails to compile due to missing libraries or misconfigured compilation flags. On a Mac, it often involves issues with <code>libxml2</code> or <code>iconv</code>, which <code>nokogiri</code> depends on.</p>\n<p class=\"markdown-para\">Inspecting the <code>nokogiri-1.15.6/mkmf.log</code> file mentioned in the error message revealed a compilation error with <code>iconv</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">try_link_iconv: checking for iconv... -------------------- yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">&quot;clang -o conftest</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  -I/path/to/ruby/2.7.8/include/ruby-2.7.0/arm64-darwin23 -I/path/to/ruby/2.7.8/include/ruby-2.7.0/ruby/backward -I/path/to/ruby/2.7.8/include/ruby-2.7.0 -I. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe -std=c99 -Wno-declaration-after-statement -O2 -g -Winline -Wmissing-noreturn -Wshorten-64-to-32 -Wno-unknown-warning-option conftest.c  -L. -L/path/to/ruby/2.7.8/lib -L. -fstack-protector-strong  -m64   -lruby.2.7   &quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Undefined symbols for architecture arm64:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;_iconv&quot;, referenced from:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      _main in conftest-ea30a6.o</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;_iconv_open&quot;, referenced from:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">      _main in conftest-ea30a6.o</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ld: symbol(s) not found for architecture arm64</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">clang: error: linker command failed with exit code 1 (use -v to see invocation)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checked program was:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">/* begin */</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> 1: #include &quot;ruby.h&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> 2:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> 3: #include &lt;stdlib.h&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> 4: #include &lt;iconv.h&gt;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> 5: int main(void)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> 6: {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> 7:     iconv_t cd = iconv_open(&quot;&quot;, &quot;&quot;);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> 8:     iconv(cd, NULL, NULL, NULL, NULL);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> 9:     return EXIT_SUCCESS;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">10: }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">/* end */</span></span></code></pre>\n<p class=\"markdown-para\">The error occurs when trying to link against the <code>iconv</code> library. The linker is failing because it cannot find the <code>iconv</code> symbols (<code>_iconv</code> and <code>_iconv_open</code>) for the arm64 architecture.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Solution:</strong></p>\n<p class=\"markdown-para\">Newer Macs actually come with a compatible version of <code>iconv</code> but the default nokogiri install script isn't using it. You can configure bundler to use the system libraries when installing nokogiri as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle config build.nokogiri --use-system-libraries</span></span></span></code></pre>\n<p class=\"markdown-para\">This tells <code>nokogiri</code> to use the pre-installed libraries on your system.</p>\n<p class=\"markdown-para\">After running this, try running <code>bundle install</code> again, and the <code>nokogiri</code> gem should compile successfully.</p>\n<p class=\"markdown-para\">For more discussion on this topic, see <a href=\"https://stackoverflow.com/questions/5528839/why-does-installing-nokogiri-on-mac-os-fail-with-libiconv-is-missing\" class=\"markdown-link\">Why does installing Nokogiri on Mac OS fail with libiconv is missing?</a>. Also this question <a href=\"https://stackoverflow.com/questions/57734434/libiconv-or-iconv-undefined-symbol-on-mac-osx\" class=\"markdown-link\">_libiconv or _iconv undefined symbol on Mac OSX</a> provides further context.</p>\n<h2 class=\"markdown-subtitle\" id=\"postgresql-pg\" style=\"position:relative;\"><a href=\"#postgresql-pg\" aria-label=\"postgresql pg permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PostgreSQL pg</h2>\n<p class=\"markdown-para\">Here are snippets of the error I encountered during <code>bundle install</code> for the <a href=\"https://rubygems.org/gems/pg\" class=\"markdown-link\">pg</a> gem:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Gem::Ext::BuildError: ERROR: Failed to build gem native extension.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">current directory: /path/to/gems/2.7.0/gems/pg-1.2.3/ext</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for pg_config... no</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">No pg_config... trying anyway.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">If building fails, please try again with</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"> --with-pg-config=/path/to/pg_config</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for libpq-fe.h... no</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Can&#39;t find the &#39;libpq-fe.h header</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">*** extconf.rb failed ***</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Could not create Makefile due to some reason,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">probably lack of necessary libraries and/or headers.</span></span></code></pre>\n<p class=\"markdown-para\">This error occurs when the <code>pg</code> gem can’t find PostgreSQL’s development libraries (<code>libpq</code>). This often happens when PostgreSQL isn’t installed or its binaries aren’t properly set up in your <code>PATH</code>.</p>\n<p class=\"markdown-para\">The <code>pg</code> gem requires the PostgreSQL client libraries to be available during installation, and it uses <code>pg_config</code> to find the necessary files. Without this configuration, the gem cannot be built.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Solution:</strong></p>\n<p class=\"markdown-para\">Make sure PostgreSQL is installed via Homebrew, and then ensure the <code>pg_config</code> binary is available in your <code>PATH</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Or whatever version your project depends on</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">brew install postgresql@14</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">export</span><span class=\"mtk1\"> PATH=</span><span class=\"mtk6\">&quot;/opt/homebrew/opt/postgresql@14/bin:</span><span class=\"mtk1\">$PATH</span><span class=\"mtk6\">&quot;</span></span></span></code></pre>\n<p class=\"markdown-para\">After running this, try running <code>bundle install</code> again, and the <code>pg</code> gem should compile successfully.</p>\n<h2 class=\"markdown-subtitle\" id=\"msgpack-and-bootsnap\" style=\"position:relative;\"><a href=\"#msgpack-and-bootsnap\" aria-label=\"msgpack and bootsnap permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Msgpack and Bootsnap</h2>\n<p class=\"markdown-para\">Here are snippets of the error I encountered during <code>bundle install</code> for the <a href=\"https://rubygems.org/gems/msgpack\" class=\"markdown-link\">msgpack</a> gem:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Gem::Ext::BuildError: ERROR: Failed to build gem native extension.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    current directory: /Users/myuser/.rbenv/versions/2.7.8/lib/ruby/gems/2.7.0/gems/msgpack-1.3.1/ext/msgpack</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">/Users/myuser/.rbenv/versions/2.7.8/bin/ruby -I /Users/myuser/.rbenv/versions/2.7.8/lib/ruby/2.7.0 -r ./siteconf20240802-87419-1amtg6u.rb extconf.rb</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for ruby/st.h... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for st.h... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for rb_str_replace() in ruby.h... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for rb_intern_str() in ruby.h... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for rb_sym2str() in ruby.h... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for rb_str_intern() in ruby.h... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for rb_block_lambda() in ruby.h... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for rb_hash_dup() in ruby.h... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">checking for rb_hash_clear() in ruby.h... yes</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">creating Makefile</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">current directory: /Users/myuser/.rbenv/versions/2.7.8/lib/ruby/gems/2.7.0/gems/msgpack-1.3.1/ext/msgpack</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">make &quot;DESTDIR=&quot; clean</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">current directory: /Users/myuser/.rbenv/versions/2.7.8/lib/ruby/gems/2.7.0/gems/msgpack-1.3.1/ext/msgpack</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">make &quot;DESTDIR=&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">compiling buffer.c</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">compiling buffer_class.c</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">buffer_class.c:261:17: error: incompatible function pointer types passing &#39;VALUE (VALUE)&#39; (aka &#39;unsigned long (unsigned long)&#39;) to parameter of type &#39;VALUE (*)(VALUE, VALUE)&#39; (aka &#39;unsigned long (*)(unsigned long, unsigned long)&#39;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">[-Wincompatible-function-pointer-types]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                read_until_eof_error, (VALUE)(void*) args,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                ^~~~~~~~~~~~~~~~~~~~</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">/path/to/ruby/2.7.8/include/ruby-2.7.0/ruby/ruby.h:1990:47:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">note: passing argument to parameter here</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">VALUE rb_rescue2(VALUE(*)(VALUE),VALUE,VALUE(*)(VALUE,VALUE),VALUE,...);</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                                              ^</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">1 error generated.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">make: *** [buffer_class.o] Error 1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">make failed, exit code 2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">An error occurred while installing msgpack (1.3.1), and Bundler cannot continue.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">In Gemfile:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  bootsnap was resolved to 1.4.5, which depends on</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    msgpack</span></span></code></pre>\n<p class=\"markdown-para\">This error is caused by stricter function pointer checks when building C extensions on the ARM architecture of the M3 Mac.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Solution:</strong></p>\n<p class=\"markdown-para\">To bypass this issue, you can add a compiler flag that ignores these errors. Run the following commands to configure Bundler to use this flag when building the affected gems:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle config </span><span class=\"mtk9\">set</span><span class=\"mtk1\"> --global build.msgpack </span><span class=\"mtk6\">&quot;--with-cflags=-Wno-error=incompatible-function-pointer-types&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bundle config </span><span class=\"mtk9\">set</span><span class=\"mtk1\"> --global build.bootsnap </span><span class=\"mtk6\">&quot;--with-cflags=-Wno-error=incompatible-function-pointer-types&quot;</span></span></span></code></pre>\n<p class=\"markdown-para\">This will suppress the function pointer type warnings and allow the gems to install correctly. This discussion on a different GitHub project has more information on the <a href=\"https://github.com/grpc/grpc/issues/35148\" class=\"markdown-link\">incompatible function pointer type error on an M3 Mac</a>.</p>\n<aside class=\"markdown-aside\"> The <a class=\"markdown-link\" href=\"https://github.com/shopify/bootsnap\">bootsnap</a> gem, often used in Rails applications, speeds up boot times by caching and optimizing how code is loaded.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"alternative\" style=\"position:relative;\"><a href=\"#alternative\" aria-label=\"alternative permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Alternative</h2>\n<p class=\"markdown-para\">For teams encountering repeated issues with native installations, an alternative approach is to create a Docker image for development, or a <a href=\"https://code.visualstudio.com/docs/devcontainers/create-dev-container\" class=\"markdown-link\">Dev Container for VS Code</a>. These solutions can simplify setup by standardizing the environment across team members and isolating dependencies.</p>\n<p class=\"markdown-para\">However, a Dockerized development environment may introduce performance overhead and make debugging more complex. As for VS Code dev containers, not all of our team members are using VS Code, and we anticipated upgrading to newer Ruby and Rails versions soon, so we opted to stick with native installation for this project.</p>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">Setting up legacy Rails projects on modern hardware can be a challenge, but with some digging into logs and bundler configuration, it can be done. If you’re setting up a similar project, I hope this guide has been helpful.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","timeToRead":6,"tableOfContents":"<ul>\n<li><a href=\"#nokogiri\">Nokogiri</a></li>\n<li><a href=\"#postgresql-pg\">PostgreSQL pg</a></li>\n<li><a href=\"#msgpack-and-bootsnap\">Msgpack and Bootsnap</a></li>\n<li><a href=\"#alternative\">Alternative</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>","frontmatter":{"title":"Fixing Gem Install Errors on M3 Mac with Ruby 2.7","date":"03 Dec 2024","description":"A guide to resolving common gem installation errors such as `pg`, `nokogiri`, and `msgpack` when setting up a Rails project on an M3 Mac with Ruby 2.7.8, including solutions and troubleshooting steps.","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#484848","images":{"fallback":{"src":"/static/6c668aef728b7cb1cba13c59f7c41b97/fc2d4/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.jpg","srcSet":"/static/6c668aef728b7cb1cba13c59f7c41b97/b834a/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.jpg 225w,\n/static/6c668aef728b7cb1cba13c59f7c41b97/21c52/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.jpg 450w,\n/static/6c668aef728b7cb1cba13c59f7c41b97/fc2d4/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/6c668aef728b7cb1cba13c59f7c41b97/71a10/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.webp 225w,\n/static/6c668aef728b7cb1cba13c59f7c41b97/901f1/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.webp 450w,\n/static/6c668aef728b7cb1cba13c59f7c41b97/4ffff/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":600}}}},"fields":{"slug":"/blog/fix-gem-install-errors-m3-mac-ruby-278/"}},"relatedP":{"edges":[{"node":{"id":"46775b70-43f2-584d-8c65-327ac46ebbd7","frontmatter":{"title":"Dockerize a Rails Application for Development","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#d8c8d8","images":{"fallback":{"src":"/static/3281f20a27a3ba24dcc1ca78c639c25d/26528/docker-rails-shipping-containers.jpg","srcSet":"/static/3281f20a27a3ba24dcc1ca78c639c25d/26528/docker-rails-shipping-containers.jpg 300w,\n/static/3281f20a27a3ba24dcc1ca78c639c25d/43429/docker-rails-shipping-containers.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/3281f20a27a3ba24dcc1ca78c639c25d/5d6c3/docker-rails-shipping-containers.webp 300w,\n/static/3281f20a27a3ba24dcc1ca78c639c25d/68dbc/docker-rails-shipping-containers.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/dockerize-rails-app-for-dev-debug-and-testing/"}}},{"node":{"id":"dd0209de-ae67-5936-afc4-ef653de147a6","frontmatter":{"title":"Homebrew Postgresql Service not Starting Resolved","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#987858","images":{"fallback":{"src":"/static/09c9f0e696bef656672d612a338e22c6/26528/postgresql-homebrew-nam-anh-QJbyG6O0ick-unsplash.jpg","srcSet":"/static/09c9f0e696bef656672d612a338e22c6/26528/postgresql-homebrew-nam-anh-QJbyG6O0ick-unsplash.jpg 300w,\n/static/09c9f0e696bef656672d612a338e22c6/43429/postgresql-homebrew-nam-anh-QJbyG6O0ick-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/09c9f0e696bef656672d612a338e22c6/5d6c3/postgresql-homebrew-nam-anh-QJbyG6O0ick-unsplash.webp 300w,\n/static/09c9f0e696bef656672d612a338e22c6/68dbc/postgresql-homebrew-nam-anh-QJbyG6O0ick-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/homebrew-postgresql-service-not-starting-resolved/"}}},{"node":{"id":"7a565b39-3dd4-5740-82a2-867e3565078c","frontmatter":{"title":"Old Ruby and New Mac","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#a8b8a8","images":{"fallback":{"src":"/static/891a432040b9dec710096ad8bac91eed/ad250/ruby-in-box.png","srcSet":"/static/891a432040b9dec710096ad8bac91eed/ad250/ruby-in-box.png 300w,\n/static/891a432040b9dec710096ad8bac91eed/b64d1/ruby-in-box.png 600w","sizes":"300px"},"sources":[{"srcSet":"/static/891a432040b9dec710096ad8bac91eed/5d6c3/ruby-in-box.webp 300w,\n/static/891a432040b9dec710096ad8bac91eed/68dbc/ruby-in-box.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/old-ruby-new-mac/"}}}]}},"pageContext":{"slug":"/blog/fix-gem-install-errors-m3-mac-ruby-278/","relatedPosts":["Homebrew Postgresql Service not Starting Resolved","Dockerize a Rails Application for Development","Old Ruby and New Mac"]}},"staticQueryHashes":["163244226"],"slicesMap":{}}