{"componentChunkName":"component---src-templates-post-js","path":"/blog/rails-reject-nested-attributes/","result":{"data":{"markdownRemark":{"html":"<p class=\"markdown-para\">When building a web application for a  relational data model, handling nested models in a single form submission is a common requirement. Rails provides a powerful solution with the ActiveRecord method <code>accepts_nested_attributes_for</code>. This feature supports creation of forms that capture the main model and its associated model(s), streamlining the user experience. However, this can sometimes lead to issues with validation. In this post, you'll learn how the <code>reject_if</code> option comes to the rescue, enabling creation of a flexible form that can handle optional associated models.</p>\n<p class=\"markdown-para\">You can also follow along with a <a href=\"https://github.com/danielabar/nested_model_demo\" class=\"markdown-link\">demo project</a> on GitHub.</p>\n<h2 class=\"markdown-subtitle\" id=\"initial-setup\" style=\"position:relative;\"><a href=\"#initial-setup\" aria-label=\"initial setup permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initial Setup</h2>\n<p class=\"markdown-para\">Consider the following example: A <code>User</code> can have an <code>Address</code>, and the <code>Address</code> belongs to the <code>User</code> (i.e. the <code>user_id</code> foreign key is on the <code>addresses</code> table). Both models have some basic validation rules to ensure the required data is populated.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># == Schema Information</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Table name: users</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  id         :integer          not null, primary key</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  email      :string           not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  name       :string           not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  created_at :datetime         not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  updated_at :datetime         not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Indexes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  index_users_on_email  (email) UNIQUE</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  has_one </span><span class=\"mtk4\">:address</span><span class=\"mtk1\">, </span><span class=\"mtk4\">dependent:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:email</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">uniqueness:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># == Schema Information</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Table name: addresses</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  id             :integer          not null, primary key</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  city           :string           not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  country        :string           not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  state_province :string           not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  street         :string           not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  created_at     :datetime         not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  updated_at     :datetime         not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  user_id        :integer          not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Indexes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  index_addresses_on_user_id  (user_id)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Foreign Keys</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  user_id  (user_id =&gt; users.id)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">Address</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  belongs_to </span><span class=\"mtk4\">:user</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:street</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:city</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:state_province</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:country</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Here is the <code>UsersController</code>, which was generated by the Rails <a href=\"https://www.rubyguides.com/2020/03/rails-scaffolding/\" class=\"markdown-link\">scaffold</a> command <code>bin/rails g scaffold User name:string email:string:uniq</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">UsersController</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationController</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  before_action </span><span class=\"mtk4\">:set_user</span><span class=\"mtk1\">, </span><span class=\"mtk4\">only:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">%i[show edit update destroy]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># GET /users or /users.json</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">index</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @users </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.</span><span class=\"mtk5\">all</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># GET /users/1 or /users/1.json</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">show</span><span class=\"mtk1\">; </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># GET /users/new</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">new</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @user </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># GET /users/1/edit</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">edit</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># POST /users or /users.json</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">create</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @user </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(user_params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    respond_to </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |format|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> @user.</span><span class=\"mtk5\">save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">html</span><span class=\"mtk1\"> { redirect_to </span><span class=\"mtk5\">user_url</span><span class=\"mtk1\">(@user), </span><span class=\"mtk4\">notice:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;User was successfully created.&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">json</span><span class=\"mtk1\"> { render </span><span class=\"mtk4\">:show</span><span class=\"mtk1\">, </span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:created</span><span class=\"mtk1\">, </span><span class=\"mtk4\">location:</span><span class=\"mtk1\"> @user }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">else</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">html</span><span class=\"mtk1\"> { render </span><span class=\"mtk4\">:new</span><span class=\"mtk1\">, </span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:unprocessable_entity</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">json</span><span class=\"mtk1\"> { render </span><span class=\"mtk4\">json:</span><span class=\"mtk1\"> @user.</span><span class=\"mtk5\">errors</span><span class=\"mtk1\">, </span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:unprocessable_entity</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># PATCH/PUT /users/1 or /users/1.json</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">update</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    respond_to </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |format|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> @user.</span><span class=\"mtk5\">update</span><span class=\"mtk1\">(user_params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">html</span><span class=\"mtk1\"> { redirect_to </span><span class=\"mtk5\">user_url</span><span class=\"mtk1\">(@user), </span><span class=\"mtk4\">notice:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;User was successfully updated.&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">json</span><span class=\"mtk1\"> { render </span><span class=\"mtk4\">:show</span><span class=\"mtk1\">, </span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:ok</span><span class=\"mtk1\">, </span><span class=\"mtk4\">location:</span><span class=\"mtk1\"> @user }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">else</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">html</span><span class=\"mtk1\"> { render </span><span class=\"mtk4\">:edit</span><span class=\"mtk1\">, </span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:unprocessable_entity</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">json</span><span class=\"mtk1\"> { render </span><span class=\"mtk4\">json:</span><span class=\"mtk1\"> @user.</span><span class=\"mtk5\">errors</span><span class=\"mtk1\">, </span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:unprocessable_entity</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># DELETE /users/1 or /users/1.json</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @user.</span><span class=\"mtk5\">destroy!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    respond_to </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |format|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">html</span><span class=\"mtk1\"> { redirect_to users_url, </span><span class=\"mtk4\">notice:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;User was successfully destroyed.&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk9\">format</span><span class=\"mtk1\">.</span><span class=\"mtk5\">json</span><span class=\"mtk1\"> { head </span><span class=\"mtk4\">:no_content</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">private</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Use callbacks to share common setup or constraints between actions.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">set_user</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @user </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.</span><span class=\"mtk5\">find</span><span class=\"mtk1\">(params[</span><span class=\"mtk4\">:id</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Only allow a list of trusted parameters through.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">user_params</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    params.</span><span class=\"mtk5\">require</span><span class=\"mtk1\">(</span><span class=\"mtk4\">:user</span><span class=\"mtk1\">).</span><span class=\"mtk5\">permit</span><span class=\"mtk1\">(</span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:email</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Here is the users form partial <code>app/views/users/_form.html.erb</code> that handles both new User creation and editing existing Users. This was also generated by the scaffold command:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"erb\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">form_with</span><span class=\"mtk1\">(</span><span class=\"mtk4\">model:</span><span class=\"mtk1\"> user, </span><span class=\"mtk4\">class:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;contents&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |form| </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">&lt;%</span><span class=\"mtk1\"> </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> user.</span><span class=\"mtk5\">errors</span><span class=\"mtk1\">.</span><span class=\"mtk5\">any?</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;</span><span class=\"mtk7\">div</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;error_explanation&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">h2</span><span class=\"mtk1\">&gt;</span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">pluralize</span><span class=\"mtk1\">(user.</span><span class=\"mtk5\">errors</span><span class=\"mtk1\">.</span><span class=\"mtk5\">count</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;error&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk7\">%&gt;</span><span class=\"mtk1\"> prohibited this user from being saved:&lt;/</span><span class=\"mtk7\">h2</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;</span><span class=\"mtk7\">ul</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">&lt;%</span><span class=\"mtk1\"> user.</span><span class=\"mtk5\">errors</span><span class=\"mtk1\">.</span><span class=\"mtk5\">each</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |error| </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          &lt;</span><span class=\"mtk7\">li</span><span class=\"mtk1\">&gt;</span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> error.</span><span class=\"mtk5\">full_message</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span><span class=\"mtk1\">&lt;/</span><span class=\"mtk7\">li</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">&lt;%</span><span class=\"mtk1\"> </span><span class=\"mtk7\">end</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      &lt;/</span><span class=\"mtk7\">ul</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    &lt;/</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">&lt;%</span><span class=\"mtk1\"> </span><span class=\"mtk7\">end</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">label</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:name</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">text_field</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:name</span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">label</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:email</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">text_field</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:email</span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">submit</span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;/</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">&lt;%</span><span class=\"mtk1\"> </span><span class=\"mtk7\">end</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"introducing-accepts_nested_attributes_for\" style=\"position:relative;\"><a href=\"#introducing-accepts_nested_attributes_for\" aria-label=\"introducing accepts_nested_attributes_for permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introducing accepts_nested_attributes_for</h2>\n<p class=\"markdown-para\">Now suppose we want to enhance the User form, to also contain the Address fields, such that when the form is submitted, the address automatically gets associated with the user. Here are the changes to make this happen.</p>\n<p class=\"markdown-para\">Start by updating the <code>User</code> model, to declare that it accepts nested attributes for the address model:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  has_one </span><span class=\"mtk4\">:address</span><span class=\"mtk1\">, </span><span class=\"mtk4\">dependent:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === NEW ===</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  accepts_nested_attributes_for </span><span class=\"mtk4\">:address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:email</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">uniqueness:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">The <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html#method-i-accepts_nested_attributes_for\" class=\"markdown-link\">accepts_nested_attribute_for</a> method defines an attribute writer for the specified association. This enables a parent model to accept and update attributes for its associated child model. In the example above, we're declaring that from the <code>User</code> model, it can populate attributes for the <code>Address</code> model.</p>\n<p class=\"markdown-para\">Next the <code>new</code> method in the <code>UsersController</code> is modified to build a potential address for the user using the <code>build_address</code> method:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">UsersController</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationController</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">new</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @user </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># === NEW ===</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @user.</span><span class=\"mtk5\">build_address</span><span class=\"mtk1\"> </span><span class=\"mtk3\"># Build a new address for the user</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<aside class=\"markdown-aside\">\nThe `build_address` method is dynamically added by ActiveRecord based on the `has_one` association declaration. Earlier when we declared that a User has_one address, the `build_address` method became available on the User model. Calling it on a user model instance, returns a new empty Address model. If the user happened to already have an address, then the `build_address` method will first delete it, then return a new empty Address model. See the <a class=\"markdown-link\" href=\"https://guides.rubyonrails.org/association_basics.html#methods-added-by-belongs-to-build-association-attributes\">build_association</a> section of the Rails Guides for more details.\n</aside>\n<p class=\"markdown-para\">Now the user form partial <code>app/views/users/_form.html.erb</code> can be updated to use the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-fields_for\" class=\"markdown-link\">fields_for</a> view helper to render the address fields for the user:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"erb\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">form_with</span><span class=\"mtk1\">(</span><span class=\"mtk4\">model:</span><span class=\"mtk1\"> user, </span><span class=\"mtk4\">class:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;contents&quot;</span><span class=\"mtk1\">) </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |form| </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;%# Validation errors... %&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;%# === USER FIELDS === %&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">label</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:name</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">text_field</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:name</span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">label</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:email</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">text_field</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:email</span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;%# === NEW SECTION START === %&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">fields_for</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:address</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |address_fields| </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> address_fields.</span><span class=\"mtk5\">label</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:street</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> address_fields.</span><span class=\"mtk5\">text_field</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:street</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> address_fields.</span><span class=\"mtk5\">label</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:city</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> address_fields.</span><span class=\"mtk5\">text_field</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:city</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> address_fields.</span><span class=\"mtk5\">label</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:state_province</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> address_fields.</span><span class=\"mtk5\">text_field</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:state_province</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> address_fields.</span><span class=\"mtk5\">label</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:country</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> address_fields.</span><span class=\"mtk5\">text_field</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:country</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">&lt;%# === NEW SECTION END === %&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">&lt;%=</span><span class=\"mtk1\"> form.</span><span class=\"mtk5\">submit</span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">&lt;%</span><span class=\"mtk1\"> </span><span class=\"mtk7\">end</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">&lt;%</span><span class=\"mtk1\"> </span><span class=\"mtk7\">end</span><span class=\"mtk1\"> </span><span class=\"mtk7\">%&gt;</span></span></span></code></pre>\n<p class=\"markdown-para\">The <code>fields_for</code> helper yields a block, similar to <code>form_with</code>, but does not generate the <code>&#x3C;form>...&#x3C;/form></code> tags. This makes it suitable for specifying additional model objects in the same form.</p>\n<aside class=\"markdown-aside\">\nIn a real application, the \"state/province\" and \"country\" fields would typically be dropdowns to ensure data consistency and user convenience. However, to keep this blog post focused on nested attributes, we'll use text input fields instead.\n</aside>\n<p class=\"markdown-para\">At this point, starting a Rails server with <code>bin/rails s</code> and then navigating to the new user url at <code>http://localhost:3000/users/new</code> will show the form now has both user and address fields:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 664px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 124%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVR42qVVy27TQBTNr7HlA1ixZoHYs2OJxA4JPgB1RYW6oD/AppXYIhVRoDSJ7crOw4/YHs97DpprT6KkpWqCRydjz+PkXt1z7x1ZZ3Hf4/cdHM13nQ3r4dzIL9ZNjbPzM1z+vERyk+DqzxUuvl+gXJX9JWyIWM5QxRXKSUGzG0YgJcKmaXDy6QTHH49xfnaO08+nOPpwhGgaAQ7QWoPXHPnVkgi7sgMrGMFoA630mnjkf7q6Q5ZkUFwRAcFbJg1kJwmiEeArDi0UQQ2gfSYgmewtJMJVh7zIwSUn94wzMNbQu9sZdgdh8IbDWouRZ/Xs4fFEe8OZDaFnZyuGbJah4x2ZvS+hvyPqHcI0TYnQ7UjhQYCDaMU/XHbmAEJLKiBC0lbFEF1OsUyWaBcNmnmDdjnMw3e/1vbviwHzuj83q4nQuUHYbdEimkSoygpGGSipoKV+ADbnvKzudNkeNNzG5aBDxthhkjG9bNZBCVFOkmQtgf+Osv8AZVxIdLc36ZbL/oN1DFwI0qJUcm+X15lCUa5ajMdjxEmMKJqiKIutWnjfCGduuew15IYy413eL5d3XW441Ty/qc1hxWGtwxDlOI6pWnvCfQOy5XIIilASyigy34Qo47Y87FZt3FTMrfIlWw7bcWgmoBmH6TgU45BMQXUDmKJLHqxkBG+ITwpedzQPTcohKzSevS3x/F2JF+8rPH1T4OsPjiqfI05SZLM50nQGzgVd8q1idbPa0a7dEMZLjcevCjx5XRIevczx5ZvAYhbj1+9rTKYxrscTcNnnvG9SxXWOdtGimTWQrViTjvpe23cmbX21toN8bvfgYE2d1iijEnVWo5wW9AdBt38Bv46adrDIfUgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nested attributes new user form\"\n        title=\"nested attributes new user form\"\n        src=\"/static/5d26900611a570273c7235178eb6a9e7/31493/nested-attributes-new-user-form.png\"\n        srcset=\"/static/5d26900611a570273c7235178eb6a9e7/772e8/nested-attributes-new-user-form.png 200w,\n/static/5d26900611a570273c7235178eb6a9e7/e17e5/nested-attributes-new-user-form.png 400w,\n/static/5d26900611a570273c7235178eb6a9e7/31493/nested-attributes-new-user-form.png 664w\"\n        sizes=\"(max-width: 664px) 100vw, 664px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">The markup generated shows that the address fields are named differently to distinguish them from being direct attributes on the user model:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"htm\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">form</span><span class=\"mtk1\"> </span><span class=\"mtk5\">action</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;/users&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">method</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;post&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;hidden&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;authenticity_token&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;abc123...&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">autocomplete</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;off&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;!-- User attributes are named user[field] --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_name&quot;</span><span class=\"mtk1\">&gt;Name&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[name]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_name&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_email&quot;</span><span class=\"mtk1\">&gt;Email&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[email]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_email&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;!-- Address attributes are named user[address_attributes][field] --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_street&quot;</span><span class=\"mtk1\">&gt;Street&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[address_attributes][street]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_street&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_city&quot;</span><span class=\"mtk1\">&gt;City&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[address_attributes][city]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_city&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_state_province&quot;</span><span class=\"mtk1\">&gt;State province&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[address_attributes][state_province]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_state_province&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_country&quot;</span><span class=\"mtk1\">&gt;Country&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[address_attributes][country]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_country&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;submit&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;commit&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;Create User&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">data-disable-with</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;Create User&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk7\">form</span><span class=\"mtk1\">&gt;</span></span></span></code></pre>\n<p class=\"markdown-para\">However, trying to submit this form won't work as expected. The user will be saved, but the associated address will not. Here is some example output from the Rails server when submitting this form with some example values. I've formatted it and added some annotations:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"># === FORM SUBMITTED AND PROCESSED BY CONTROLLER ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Started POST &quot;/users&quot; for ::1 at 2024-05-19 09:17:51 -0400</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Processing by UsersController#create as TURBO_STREAM</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"># === ADDRESS_ATTRIBUTES ARE NESTED IN PARAMETERS ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Parameters: {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;authenticity_token&quot;=&gt;&quot;[FILTERED]&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;user&quot;=&gt;{&quot;name&quot;=&gt;&quot;Jane&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;email&quot;=&gt;&quot;jane@example.com&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;address_attributes&quot;=&gt;{</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;street&quot;=&gt;&quot;123 Main St.&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;city&quot;=&gt;&quot;Anytown&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;state_province&quot;=&gt;&quot;Ontario&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;country&quot;=&gt;&quot;Canada&quot;}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  },</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;commit&quot;=&gt;&quot;Create User&quot;}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"># === ERROR FROM CONTROLLER BECAUSE ADDRESS_ATTRIBUTES ARE NOT PERMITTED ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Unpermitted parameter: :address_attributes. Context: {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  controller: UsersController,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  action: create,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  ...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"># === CHECK IF EMAIL ALREADY EXISTS, AND IF NOT, CREATE USER ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TRANSACTION (0.0ms)  begin transaction</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  User Exists? (0.7ms)  SELECT 1 AS one FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;email&quot; = ? LIMIT ?  [[&quot;email&quot;, &quot;jane@example.com&quot;], [&quot;LIMIT&quot;, 1]]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  User Create (0.1ms)  INSERT INTO &quot;users&quot; (&quot;name&quot;, &quot;email&quot;, &quot;created_at&quot;, &quot;updated_at&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                       VALUES (?, ?, ?, ?)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                       RETURNING &quot;id&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                       [[&quot;name&quot;, &quot;Jane&quot;], [&quot;email&quot;, &quot;Smith&quot;], timestamps...]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TRANSACTION (0.1ms)  commit transaction</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"># === CREATED NEW USER WITH ID 14 BUT IT HAS NO ADDRESS ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Redirected to http://localhost:3000/users/14</span></span></code></pre>\n<p class=\"markdown-para\">The problem is that the <code>UsersController</code> generated from the scaffold command only knew about the user email and name attributes at the time:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">UsersController</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationController</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">private</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Only allows `name` and `email` to be passed on from form submission</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">user_params</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    params.</span><span class=\"mtk5\">require</span><span class=\"mtk1\">(</span><span class=\"mtk4\">:user</span><span class=\"mtk1\">).</span><span class=\"mtk5\">permit</span><span class=\"mtk1\">(</span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:email</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Since we're now also expecting <code>street</code>, <code>city</code>, etc from the address attributes, those need to be permitted as well. This is accomplished by adding <code>address_attributes</code> to the hash passed to the <a href=\"https://api.rubyonrails.org/classes/ActionController/Parameters.html#method-i-permit\" class=\"markdown-link\">permit method</a>, specifying an array of symbols containing the address attributes:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">UsersController</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationController</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === NO CHANGE REQUIRED TO CREATE METHOD ===</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># When user_params contains address_attributes,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Rails will create both the user and address models</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># in the same transaction.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">create</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @user </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(user_params)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    respond_to </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |format|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> @user.</span><span class=\"mtk5\">save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">private</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === MODIFIED TO ALLOW ADDRESS ATTRIBUTES ===</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">user_params</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    params.</span><span class=\"mtk5\">require</span><span class=\"mtk1\">(</span><span class=\"mtk4\">:user</span><span class=\"mtk1\">).</span><span class=\"mtk5\">permit</span><span class=\"mtk1\">(</span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:email</span><span class=\"mtk1\">, </span><span class=\"mtk4\">address_attributes:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">%i[id street city state_province country]</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Now we can again try to create a new user, and this time the transaction will create both a user and associated address. The Rails server output below shows the user and associated address record being created:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">TRANSACTION (0.1ms)  begin transaction</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  # === CHECK IF THIS EMAIL IS ALREADY TAKEN ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  User Exists? (1.1ms)  SELECT 1 AS one FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;email&quot; = ? LIMIT ?  [[&quot;email&quot;, &quot;sarah@example.com&quot;], [&quot;LIMIT&quot;, 1]]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  # === CREATE USER ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  User Create (0.2ms)  INSERT INTO &quot;users&quot; (&quot;name&quot;, &quot;email&quot;, &quot;created_at&quot;, &quot;updated_at&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                       VALUES (?, ?, ?, ?)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                       RETURNING &quot;id&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                       [[&quot;name&quot;, &quot;Sarah&quot;], [&quot;email&quot;, &quot;sarah@example.com&quot;], timestamps...]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  # === CREATE ADDRESS ASSOCIATED WITH THE USER ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  Address Create (0.1ms)  INSERT INTO &quot;addresses&quot; (&quot;street&quot;, &quot;city&quot;, &quot;state_province&quot;, &quot;country&quot;, &quot;user_id&quot;, ...)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                          VALUES (?, ?, ?, ?, ?, ?, ?, ?)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                          RETURNING &quot;id&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                          [</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                            [&quot;street&quot;, &quot;321 Main St.&quot;],</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                            [&quot;city&quot;, &quot;Somewhere&quot;],</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                            [&quot;state_province&quot;, &quot;Quebec&quot;],</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                            [&quot;country&quot;, &quot;Canada&quot;],</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                            [&quot;user_id&quot;, 15],</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                            timestamps...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">                          ]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TRANSACTION (0.2ms)  commit transaction</span></span></code></pre>\n<p class=\"markdown-para\">So now we're able to create both a User model, and associated Address model in a single form .</p>\n<h2 class=\"markdown-subtitle\" id=\"problem-validation\" style=\"position:relative;\"><a href=\"#problem-validation\" aria-label=\"problem validation permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Problem: Validation</h2>\n<p class=\"markdown-para\">However, there is a problem with the current solution. In this particular app, it should allow the user to be created without an address. However, trying to create a new user while intentionally leaving the address fields blank will result in a validation error.</p>\n<p class=\"markdown-para\">For example, when submitting the form below:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 641px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 127.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6UlEQVR42qVVy27aQBTl+yp1l27KLv8RdVNVShf9iqpfgBSQULoNgh3dQBNeNoYIY/PwYzyemVPdIZ5AeMR2bV0/ZM3xOfeee6cilcSlg76rAmeFFrXbbTSbTXQ6HfT/9vHQekCr1YK7dAuDasDuny7u6neoN+oavFarodFoYOktDWCe0IB0ieII22B7UXIeMLprhpvtBpZtI2YxhBRIRaqDnvOyO2BIL87MQRiFUEppoDJhchiEATzfO/nXvGCGIQGu1itMnSmEzEBkIalHkilfBNjr9/D49IjhaAjLsnSh6Pt7uSQCRjJdOOd6MVWbJUxHkiSmMIVzSH4jVjzl2ir7Ri0iV5Ft8kjKE4ahRlc7JkKUs0u2zkimnl24i0JtdlJyVhSWJGCMGeqlQKV8lfz2yPJaulMyY7vuAvP5bNeCBUEPOmW9WWP+PIfneTqXNCSKWOagU85LLmmbXVEYwjDU9/3RVVoyTZrBcICF60Iq9X/DIXvYm9GUvZOjK7fkVAgEMUcQpwhZipinkFIc5TanbRR+3kf4cOOheuvj6quPT998PDkMztTCeGLDth1YtgOWcFP9Uzvey56i8Ot3hI9fPFz/WOHzrY/q9xUGM4bpC+BoPMFobCHh/KKd9myjzsSxnS7tggT4D8Iw8FNE1xaNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nested attributes address blank\"\n        title=\"nested attributes address blank\"\n        src=\"/static/7cf6d4d5a5b9f059118cf7d9aa437b8a/c7dcc/nested-attributes-address-blank.png\"\n        srcset=\"/static/7cf6d4d5a5b9f059118cf7d9aa437b8a/772e8/nested-attributes-address-blank.png 200w,\n/static/7cf6d4d5a5b9f059118cf7d9aa437b8a/e17e5/nested-attributes-address-blank.png 400w,\n/static/7cf6d4d5a5b9f059118cf7d9aa437b8a/c7dcc/nested-attributes-address-blank.png 641w\"\n        sizes=\"(max-width: 641px) 100vw, 641px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">The server will render the new form with validation errors:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 645px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC2UlEQVR42qVWTVPaUBT1P3XZZXf9L11146adLvo7utDOdC/TsX/BzgBKVCqYgBKCYELggZDk3fdO590k8hVRNJmTl7yXnJxz782FPaUVtm1mXWvN4zr00sjn0NgzD9WsGg4OD1AqlXBycoLjP8c4Kh3B63lMStnNDD5Pr3U+l8GQMqHv38OyLNQsC81mE+VyGWdnpxBinKpUCxVGLY9EUEQ8MnKF5gAiwO0Ctx2g3QZsG3AcaNuBbDRAV1cg24as10GNJqjRgPID6MkUaiygDaRMCbVREEVIqlUk5QqSmoW4eorEOoesWZDlCpOZB1U4ggqGKQyJmKTzBlJyCPY4DnGcPmxQr0NeXIIu65Dn5wzV9aC8HpTnsSqGIRMTHhkLwkxhpQppcHEJWalA5goti+fp3xXotgM1GkONxEKZgbmWSUrIMVQKmJp4jBcQIgVfj6DjGFoSdBQVQ9GibMZiDOemjZiMbEAVIi8Z/SS4bIzMRCbo9/uYzR7S2jJvU2oVeguy9cekmH1wP4CYCF6QJBlEBFLPg+9VlBIay5PpBP1Bf+Oz09DblS1/htm9rDCKI3Q9D34QYBgOEY5CjMYjnt+VdC8/MUStdgvtmzbcroveXQ/ThymvpdZUAYiJcuuPlmfzGcIw5Ml1yy+JYU68Qui6Lo/Lb3yp1Q3Lr1G0QIHleTSHEOIVZE9YNsH3A3+njD6bZe7MWcUXZ7QYG1k2Bykl4iReqfo3WTbN4dq+RsftcC2Ol1r/zpbTzKqNzO1CROvNIY/Dcjx2gQnTimXTHJyWww3iLRl+bA6SCLE0kEiIkJAqCANtsUzLZfNUj6asmBYbE9Oz/VDj1Emw/0Pg+68Jvv0U+Hoo0LqLEYY+Bn7Abc0PhkiyX7atls2bf/+d490nHx+/DPFhP8D7zwHKzTk6Nzaa1y00mjZsp404WRDqtX0ly1Gi4AUSrp+iNzQ2VPEfpy2fpyH8D4WgHzYG4ZA0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"nested attributes address blank validation errors\"\n        title=\"nested attributes address blank validation errors\"\n        src=\"/static/75adfde20abac8a604b49e77848b060f/af192/nested-attributes-address-validation-errors.png\"\n        srcset=\"/static/75adfde20abac8a604b49e77848b060f/772e8/nested-attributes-address-validation-errors.png 200w,\n/static/75adfde20abac8a604b49e77848b060f/e17e5/nested-attributes-address-validation-errors.png 400w,\n/static/75adfde20abac8a604b49e77848b060f/af192/nested-attributes-address-validation-errors.png 645w\"\n        sizes=\"(max-width: 645px) 100vw, 645px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">The Rails server output shows that the transaction was rolled back:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"># === FORM SUBMITTED AND PROCESSED BY CONTROLLER ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Started POST &quot;/users&quot; for ::1 at 2024-05-19 09:55:59 -0400</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Processing by UsersController#create as TURBO_STREAM</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"># === THIS TIME ADDRESS ATTRIBUTES ARE ALL EMPTY ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Parameters: {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;authenticity_token&quot;=&gt;&quot;[FILTERED]&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;user&quot;=&gt;{</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;name&quot;=&gt;&quot;mary&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;email&quot;=&gt;&quot;mary@example.com&quot;,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    &quot;address_attributes&quot;=&gt;{&quot;street&quot;=&gt;&quot;&quot;, &quot;city&quot;=&gt;&quot;&quot;, &quot;state_province&quot;=&gt;&quot;&quot;, &quot;country&quot;=&gt;&quot;&quot;}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  },</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  &quot;commit&quot;=&gt;&quot;Create User&quot;}</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"># === NOTHING IS SAVED ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TRANSACTION (0.0ms)  begin transaction</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">User Exists? (1.9ms)  SELECT 1 AS one FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;email&quot; = ? LIMIT ?  [[&quot;email&quot;, &quot;mary@example.com&quot;], [&quot;LIMIT&quot;, 1]]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">TRANSACTION (0.0ms)  rollback transaction</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"># === RENDERS THE NEW FORM AGAIN BUT WITH VALIDATION ERRORS ===</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Completed 422 Unprocessable Entity in 16ms (Views: 7.7ms | ActiveRecord: 2.8ms | Allocations: 15878)</span></span></code></pre>\n<p class=\"markdown-para\">This problem occurs because of the existing validation rules on the Address model:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">Address</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  belongs_to </span><span class=\"mtk4\">:user</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:street</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:city</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:state_province</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:country</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">When the user form is submitted with empty values for all the address fields, Rails is trying to create a new Address for this User with blank values, which fails the validation. And since the entire operation (User and Address creation) occurs in a transaction, it gets rolled back if any error occurs, which results in nothing being saved.</p>\n<p class=\"markdown-para\">However, we can't remove these validation rules from the address, because then it would create an empty address associated with the user which is not the intention. Also when an address is actually being provided, then these validation rules are needed to ensure data integrity.</p>\n<h2 class=\"markdown-subtitle\" id=\"solution-reject_if-option\" style=\"position:relative;\"><a href=\"#solution-reject_if-option\" aria-label=\"solution reject_if option permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Solution: reject_if Option</h2>\n<p class=\"markdown-para\">What we'd like to tell Rails is to do the following:</p>\n<ol class=\"markdown-list-ordered\">\n<li class=\"markdown-list-item\">If <em class=\"markdown-emphasis\">any</em> of the address fields have been filled in, then go ahead and validate them, saving both a user and associated address.</li>\n<li class=\"markdown-list-item\">If <em class=\"markdown-emphasis\">no</em> address fields are filled, then do not create an address. In this case, only create the User model.</li>\n</ol>\n<p class=\"markdown-para\">Rails provides a technique to express the above logic with the <code>reject_if</code> option of the <code>accepts_nested_attributes_for</code> class method. According to the <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html#method-i-accepts_nested_attributes_for\" class=\"markdown-link\">documentation</a>, <code>reject_if</code>:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">Allows you to specify a Proc... that checks whether a record should be built for a certain attribute hash... Passing :all_blank instead of a Proc will create a proc that will reject a record where all the attributes are blank...</p>\n</blockquote>\n<p class=\"markdown-para\">Recall the User model currently has this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  has_one </span><span class=\"mtk4\">:address</span><span class=\"mtk1\">, </span><span class=\"mtk4\">dependent:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Requires the user to always enter an address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  accepts_nested_attributes_for </span><span class=\"mtk4\">:address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:email</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">uniqueness:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Let's try passing in the <code>:all_blank</code> symbol as a value to the <code>reject_if</code> option of the <code>accepts_nested_attributes_for</code> method:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  has_one </span><span class=\"mtk4\">:address</span><span class=\"mtk1\">, </span><span class=\"mtk4\">dependent:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === MODIFIED ===</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Give the user the option to leave address blank</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  accepts_nested_attributes_for </span><span class=\"mtk4\">:address</span><span class=\"mtk1\">, </span><span class=\"mtk4\">reject_if:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:all_blank</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:email</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">uniqueness:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Now if you only fill out the user name and email in the form and submit, Rails will ignore all the empty address fields and not attempt to save an invalid address. In this case, it will only save a new User model. However, if you specify all or any of the address fields, then Rails will attempt to create a new address and associate it to this user. Problem solved </p>\n<h2 class=\"markdown-subtitle\" id=\"variations\" style=\"position:relative;\"><a href=\"#variations\" aria-label=\"variations permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Variations</h2>\n<p class=\"markdown-para\">In addition to the <code>:all_blank</code> symbol, the <code>reject_if</code> option also accepts a Proc. If this proc returns <code>true</code>, then the nested attributes hash will be ignored. If it returns <code>false</code>, then the nested attributes will be accepted and Rails will try to create and associate the child model. This allows for even more flexibility.</p>\n<p class=\"markdown-para\">For example, suppose this application automatically populates the Country to <code>Canada</code> because the majority of the users are Canadian. In this case, the user might still choose to not fill in street, city, etc. if they don't want to provide an address. With the current option of <code>reject_if: :all_blank</code>, Rails will detect that <code>user[address_attributes][country]</code> has been provided, and attempt to associate an address, which will fail validation because none of the other address fields have been provided.</p>\n<p class=\"markdown-para\">We can specify a proc for the <code>reject_if</code> option to express the logic: Only consider address if street, city or state/province have been provided:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:email</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">uniqueness:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  has_one </span><span class=\"mtk4\">:address</span><span class=\"mtk1\">, </span><span class=\"mtk4\">dependent:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === MODIFIED ===</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Only associate address if user has filled in street, city, and state_province</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  accepts_nested_attributes_for </span><span class=\"mtk4\">:address</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                </span><span class=\"mtk4\">reject_if:</span><span class=\"mtk1\"> </span><span class=\"mtk9\">proc</span><span class=\"mtk1\"> { |addr|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                             addr[</span><span class=\"mtk4\">:street</span><span class=\"mtk1\">].</span><span class=\"mtk5\">blank?</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&amp;&amp;</span><span class=\"mtk1\"> addr[</span><span class=\"mtk4\">:city</span><span class=\"mtk1\">].</span><span class=\"mtk5\">blank?</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&amp;&amp;</span><span class=\"mtk1\"> addr[</span><span class=\"mtk4\">:state_province</span><span class=\"mtk1\">].</span><span class=\"mtk5\">blank?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                                           }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Now if the form is submitted with the country populated, but all the other address fields are blank, then the association will be ignored. On the other hand, if any of street, city or state_province are provided, then the proc would return false, and Rails will attempt to save an address for this user.</p>\n<p class=\"markdown-para\">If you don't like the <code>proc</code> syntax, or have some more complex logic, you can use a symbol that references a method instead. For example, the following is equivalent:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">User</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:email</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">uniqueness:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  has_one </span><span class=\"mtk4\">:address</span><span class=\"mtk1\">, </span><span class=\"mtk4\">dependent:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:destroy</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === MODIFIED TO REFERENCE METHOD ===</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  accepts_nested_attributes_for </span><span class=\"mtk4\">:address</span><span class=\"mtk1\">, </span><span class=\"mtk4\">reject_if:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:address_fields_all_blank?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">private</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Only associate address if user has filled in street, city, and state_province</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">address_fields_all_blank?</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">address_attributes</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    address_attributes[</span><span class=\"mtk4\">:street</span><span class=\"mtk1\">].</span><span class=\"mtk5\">blank?</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      address_attributes[</span><span class=\"mtk4\">:city</span><span class=\"mtk1\">].</span><span class=\"mtk5\">blank?</span><span class=\"mtk1\"> </span><span class=\"mtk7\">&amp;&amp;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      address_attributes[</span><span class=\"mtk4\">:state_province</span><span class=\"mtk1\">].</span><span class=\"mtk5\">blank?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"editing\" style=\"position:relative;\"><a href=\"#editing\" aria-label=\"editing permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Editing</h2>\n<p class=\"markdown-para\">One additional point of interest: When editing a user that has an associated address, Rails will maintain the association via a hidden field that contains the id of the child model. This behaviour is explained in the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/FormHelper.html#method-i-fields_for\" class=\"markdown-link\">fields_for</a> documentation. Recall that the <code>fields_for</code> helper is being used in the form partial to render the address fields:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\">fields_for will automatically generate a hidden field to store the ID of the record if it responds to persisted?.</p>\n</blockquote>\n<p class=\"markdown-para\">For example, given that a user with id of <code>19</code> that has been created with an address having an id of <code>9</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">user </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">User</span><span class=\"mtk1\">.</span><span class=\"mtk5\">last</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#&lt;User:0x000000010e8144d0&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">:id</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk4\">19</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">:name</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk6\">&quot;Sophia&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk4\">:email</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk6\">&quot;sophia@example.com&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">:created_at</span><span class=\"mtk1\"> =&gt; Mon, </span><span class=\"mtk4\">20</span><span class=\"mtk1\"> May </span><span class=\"mtk4\">2024</span><span class=\"mtk1\"> </span><span class=\"mtk4\">11</span><span class=\"mtk1\">:</span><span class=\"mtk4\">23</span><span class=\"mtk1\">:</span><span class=\"mtk4\">29.543718000</span><span class=\"mtk1\"> UTC </span><span class=\"mtk7\">+</span><span class=\"mtk4\">00</span><span class=\"mtk1\">:</span><span class=\"mtk4\">00</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">:updated_at</span><span class=\"mtk1\"> =&gt; Mon, </span><span class=\"mtk4\">20</span><span class=\"mtk1\"> May </span><span class=\"mtk4\">2024</span><span class=\"mtk1\"> </span><span class=\"mtk4\">11</span><span class=\"mtk1\">:</span><span class=\"mtk4\">23</span><span class=\"mtk1\">:</span><span class=\"mtk4\">29.543718000</span><span class=\"mtk1\"> UTC </span><span class=\"mtk7\">+</span><span class=\"mtk4\">00</span><span class=\"mtk1\">:</span><span class=\"mtk4\">00</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">user.</span><span class=\"mtk5\">address</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#&lt;Address:0x000000010ba92278&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">                </span><span class=\"mtk4\">:id</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk4\">9</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk4\">:street</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk6\">&quot;123 Somewhere St.&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">              </span><span class=\"mtk4\">:city</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk6\">&quot;Anytown&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">:state_province</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk6\">&quot;California&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">           </span><span class=\"mtk4\">:country</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk6\">&quot;US&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">           </span><span class=\"mtk4\">:user_id</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk4\">19</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">:created_at</span><span class=\"mtk1\"> =&gt; Mon, </span><span class=\"mtk4\">20</span><span class=\"mtk1\"> May </span><span class=\"mtk4\">2024</span><span class=\"mtk1\"> </span><span class=\"mtk4\">11</span><span class=\"mtk1\">:</span><span class=\"mtk4\">23</span><span class=\"mtk1\">:</span><span class=\"mtk4\">29.545345000</span><span class=\"mtk1\"> UTC </span><span class=\"mtk7\">+</span><span class=\"mtk4\">00</span><span class=\"mtk1\">:</span><span class=\"mtk4\">00</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">:updated_at</span><span class=\"mtk1\"> =&gt; Mon, </span><span class=\"mtk4\">20</span><span class=\"mtk1\"> May </span><span class=\"mtk4\">2024</span><span class=\"mtk1\"> </span><span class=\"mtk4\">11</span><span class=\"mtk1\">:</span><span class=\"mtk4\">23</span><span class=\"mtk1\">:</span><span class=\"mtk4\">29.545345000</span><span class=\"mtk1\"> UTC </span><span class=\"mtk7\">+</span><span class=\"mtk4\">00</span><span class=\"mtk1\">:</span><span class=\"mtk4\">00</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">:category</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk6\">&quot;home&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p class=\"markdown-para\">When this user is loaded in the edit view <code>http://localhost:3000/users/19/edit</code>, the form partial will display the user's address fields. But how does it know which address to update when the form is submitted? The answer is through a hidden field named <code>user[address_attributes][id]</code> that has the value of the address id <code>9</code> associated to the user.</p>\n<p class=\"markdown-para\">Here is the generated markup with explanatory comments:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"htm\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">form</span><span class=\"mtk1\"> </span><span class=\"mtk5\">action</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;/users/19&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">method</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;post&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;!-- Tells Rails to update rather than create --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;hidden&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;_method&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;patch&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;!-- Cross-Site Request Forgery protection --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;hidden&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;authenticity_token&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;abc123...&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;!-- User fields are pre-populated --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_name&quot;</span><span class=\"mtk1\">&gt;Name&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;Sophia&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[name]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_name&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_email&quot;</span><span class=\"mtk1\">&gt;Email&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;sophia@example.com&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[email]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_email&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;!-- User&#39;s address fields are pre-populated --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_street&quot;</span><span class=\"mtk1\">&gt;Street&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;123 Somewhere St.&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[address_attributes][street]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_street&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_city&quot;</span><span class=\"mtk1\">&gt;City&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;Anytown&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[address_attributes][city]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_city&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_state_province&quot;</span><span class=\"mtk1\">&gt;State province&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;California&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[address_attributes][state_province]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_state_province&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">label</span><span class=\"mtk1\"> </span><span class=\"mtk5\">for</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_country&quot;</span><span class=\"mtk1\">&gt;Country&lt;/</span><span class=\"mtk7\">label</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;text&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;US&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[address_attributes][country]&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_country&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;!-- === ADDRESS ID HERE SO RAILS WILL KNOW WHICH ADDRESS TO UPDATE --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">autocomplete</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;off&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;hidden&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;9&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user[address_attributes][id]&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">id</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;user_address_attributes_id&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">&lt;!-- Form submission --&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  &lt;</span><span class=\"mtk7\">input</span><span class=\"mtk1\"> </span><span class=\"mtk5\">type</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;submit&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">name</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;commit&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">value</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;Update User&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk5\">data-disable-with</span><span class=\"mtk1\">=</span><span class=\"mtk6\">&quot;Update User&quot;</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk7\">form</span><span class=\"mtk1\">&gt;</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered the useful combination of <code>accepts_nested_attributes_for</code> method that can be added to a model, the <code>reject_if</code> option, and <code>fields_for</code> view helper. Together, these enable creation of flexible forms to handle nested models with optional associations, making data entry easier for users. Now you can take the next step and make use of these features to enhance your Rails applications.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk10 { color: #FD971F; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","timeToRead":14,"tableOfContents":"<ul>\n<li><a href=\"#initial-setup\">Initial Setup</a></li>\n<li><a href=\"#introducing-accepts_nested_attributes_for\">Introducing accepts_nested_attributes_for</a></li>\n<li><a href=\"#problem-validation\">Problem: Validation</a></li>\n<li><a href=\"#solution-reject_if-option\">Solution: reject_if Option</a></li>\n<li><a href=\"#variations\">Variations</a></li>\n<li><a href=\"#editing\">Editing</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>","frontmatter":{"title":"Reject Nested Attributes in Rails","date":"04 Apr 2025","description":"Learn how to use Rails accepts_nested_attributes_for and reject_if options to create flexible forms that handle nested models with optional associations.","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#c8c8c8","images":{"fallback":{"src":"/static/41b1fa2e3f86f8c5036e2ff82ecea84d/d730f/reject-nested-attributespawel-czerwinski-rfkXGUbYnS8-unsplash.jpg","srcSet":"/static/41b1fa2e3f86f8c5036e2ff82ecea84d/b834a/reject-nested-attributespawel-czerwinski-rfkXGUbYnS8-unsplash.jpg 225w,\n/static/41b1fa2e3f86f8c5036e2ff82ecea84d/21c52/reject-nested-attributespawel-czerwinski-rfkXGUbYnS8-unsplash.jpg 450w,\n/static/41b1fa2e3f86f8c5036e2ff82ecea84d/d730f/reject-nested-attributespawel-czerwinski-rfkXGUbYnS8-unsplash.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/41b1fa2e3f86f8c5036e2ff82ecea84d/71a10/reject-nested-attributespawel-czerwinski-rfkXGUbYnS8-unsplash.webp 225w,\n/static/41b1fa2e3f86f8c5036e2ff82ecea84d/901f1/reject-nested-attributespawel-czerwinski-rfkXGUbYnS8-unsplash.webp 450w,\n/static/41b1fa2e3f86f8c5036e2ff82ecea84d/5acd1/reject-nested-attributespawel-czerwinski-rfkXGUbYnS8-unsplash.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":599}}}},"fields":{"slug":"/blog/rails-reject-nested-attributes/"}},"relatedP":{"edges":[{"node":{"id":"0c2e1691-4b14-536c-acee-4d0f120de743","frontmatter":{"title":"Rails Strong Params for GET Request","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/30de304c73a206886f15aeaf89655663/26528/strong-params-sigmund-f0dJjQMhfXo-unsplash.jpg","srcSet":"/static/30de304c73a206886f15aeaf89655663/26528/strong-params-sigmund-f0dJjQMhfXo-unsplash.jpg 300w,\n/static/30de304c73a206886f15aeaf89655663/43429/strong-params-sigmund-f0dJjQMhfXo-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/30de304c73a206886f15aeaf89655663/5d6c3/strong-params-sigmund-f0dJjQMhfXo-unsplash.webp 300w,\n/static/30de304c73a206886f15aeaf89655663/68dbc/strong-params-sigmund-f0dJjQMhfXo-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/rails-strong-params-get/"}}},{"node":{"id":"fff6ecc2-0dbb-59b1-80bb-97c0c24f82dd","frontmatter":{"title":"They Don't All Have To Be ActiveRecord Models","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#182828","images":{"fallback":{"src":"/static/f09c57681d2f9326aa60bbeee916a2c4/26528/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.jpg","srcSet":"/static/f09c57681d2f9326aa60bbeee916a2c4/26528/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.jpg 300w,\n/static/f09c57681d2f9326aa60bbeee916a2c4/43429/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/f09c57681d2f9326aa60bbeee916a2c4/5d6c3/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.webp 300w,\n/static/f09c57681d2f9326aa60bbeee916a2c4/68dbc/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/they-dont-all-have-to-be-activerecord-models/"}}},{"node":{"id":"d84ac79f-d860-544a-8abb-63add1da9214","frontmatter":{"title":"Understanding ActiveRecord Dependent Options","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#282828","images":{"fallback":{"src":"/static/b7f7064c193fa4dc20f20d253e1928fa/26528/activerecord-dep-gary-chan-YzSZN3qvHeo-unsplash.jpg","srcSet":"/static/b7f7064c193fa4dc20f20d253e1928fa/26528/activerecord-dep-gary-chan-YzSZN3qvHeo-unsplash.jpg 300w,\n/static/b7f7064c193fa4dc20f20d253e1928fa/43429/activerecord-dep-gary-chan-YzSZN3qvHeo-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/b7f7064c193fa4dc20f20d253e1928fa/5d6c3/activerecord-dep-gary-chan-YzSZN3qvHeo-unsplash.webp 300w,\n/static/b7f7064c193fa4dc20f20d253e1928fa/68dbc/activerecord-dep-gary-chan-YzSZN3qvHeo-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/activerecord-dependent-options/"}}}]}},"pageContext":{"slug":"/blog/rails-reject-nested-attributes/","relatedPosts":["They Don't All Have To Be ActiveRecord Models","Rails Strong Params for GET Request","Understanding ActiveRecord Dependent Options"]}},"staticQueryHashes":["163244226"],"slicesMap":{}}