{"componentChunkName":"component---src-templates-post-js","path":"/blog/ruby-upgrade-broke-ms-edge/","result":{"data":{"markdownRemark":{"html":"<p class=\"markdown-para\">Recently, I encountered a strange issue on a legacy Rails application I maintain: Customers using Microsoft Edge could no longer access the site. Instead, they were redirected to the <code>/unsupported_browser</code> page, which advises users to switch to Chrome, Firefox, or Safari. This wasnâ€™t just an inconvenience, it was a major blocker for some users who relied exclusively on Edge. This post will walk through the debugging steps and resolution.</p>\n<h2 class=\"markdown-subtitle\" id=\"the-issue\" style=\"position:relative;\"><a href=\"#the-issue\" aria-label=\"the issue permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Issue</h2>\n<p class=\"markdown-para\">A user reported that they were being redirected to the <code>/unsupported_browser</code> page on Edge, despite having used the app for years without issues. This behavior was unexpected because Microsoft Edge, being  <a href=\"https://support.microsoft.com/en-us/microsoft-edge/download-the-new-microsoft-edge-based-on-chromium-0f4a3dd7-55df-60f5-739f-00010dba52cf\" class=\"markdown-link\">Chromium-based since January 2020</a>, is a modern browser and fully compatible with this application.</p>\n<p class=\"markdown-para\">To understand why Edge users were being blocked, I started by identifying where the <code>/unsupported_browser</code> page was being rendered in the Rails app. The <code>bin/rails routes</code> command lists all routes defined in the application, and the <code>-g</code> (grep) flag filters the results to only those matching the given string or regular expression:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bin/rails routes -g </span><span class=\"mtk6\">&quot;unsupported_browser&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#              Prefix Verb URI Pattern                    Controller#Action</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># unsupported_browser GET  /unsupported_browser(.:format) pages#unsupported_browser</span></span></span></code></pre>\n<p class=\"markdown-para\">The results above indicated that the <code>/unsupported_browser</code> url is handled by the <code>unsupported_browser</code> method in the <code>PagesController</code>.</p>\n<p class=\"markdown-para\">I was curious to determine if this was an isolated issue affecting only one user, or if other users were experiencing the same problem, so I turned my attention to our observability tool to investigate traffic patterns.</p>\n<h2 class=\"markdown-subtitle\" id=\"one-user-or-many\" style=\"position:relative;\"><a href=\"#one-user-or-many\" aria-label=\"one user or many permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>One User or Many?</h2>\n<p class=\"markdown-para\">This app uses <a href=\"https://docs.datadoghq.com/tracing/\" class=\"markdown-link\">Datadog APM</a> for observability, with the <a href=\"https://github.com/DataDog/dd-trace-rb\" class=\"markdown-link\">datadog gem</a> and auto instrumentation enabled. This makes any Rails <code>Controller#action</code> available as a Resource in the Services section.</p>\n<p class=\"markdown-para\">The top of every resource page in Datadog shows some summary graphs, including the number of requests to this resource over a period of time. The resource page for <code>PagesController#unsupported_browser</code> in Datadog showed a sharp increase in the number of requests over the past week:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwElEQVR42n2Sy2oUQRSGZxMkEDHiTNJd96q+zaSn5+aIDgGD4gVxMQoiWShE3GSZR/AFXAg+g2/gA+iLfVKVSYyiWZz+T1Wf+ur83afnXcF0MmfcThi3Hd14SlU1aGWpyoamHiUtizrl1niUNOl91L+jZ41LhU09pK7Ow7sSrRxFqBIoarw45hEYYf+LXnxESFQpNDLeLjVamX92cB0sAWPRhRWtNModIMJdtA5o7a457DZhr6iNln3q0GiPFjLBbh59RoQ5eXEfaQ82xf5PmBCXTrRUm31DL36btu2wJmCEIK9W3Hj5nax5zK3DT+x1b/CDbYzI0iGjNDYfkA2fkNcPE0SGBSZB3bnl+BeNCagsIytXbK1/sP3sG1vrn+wuz+hP3zHo3qYuhZ8hzJCdoy/sPPrK/vA5txenqP0B6gJotSX4gq7tKJo5+eI9+fID8t4JzeEJanWKmB/jwwg/eUr74BVmtiZffkROXhNmL5hPZzgb6EX/wk2oRwvKosIog8372OxO0sJIXN7H5INkzypJ6SxWZKnG5Hs4JSlCjdFxbKRGmgbnh79HRfnLkNJucoeKubRptNL6yn4cuTjYvwDLVRrhbIIC2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"datadog-unsupported-browser-requests-spike\"\n        title=\"datadog-unsupported-browser-requests-spike\"\n        src=\"/static/1360ccf801d26a40784c4376bcadeafc/5a190/datadog-unsupported-browser-requests-spike.png\"\n        srcset=\"/static/1360ccf801d26a40784c4376bcadeafc/772e8/datadog-unsupported-browser-requests-spike.png 200w,\n/static/1360ccf801d26a40784c4376bcadeafc/e17e5/datadog-unsupported-browser-requests-spike.png 400w,\n/static/1360ccf801d26a40784c4376bcadeafc/5a190/datadog-unsupported-browser-requests-spike.png 800w,\n/static/1360ccf801d26a40784c4376bcadeafc/c946b/datadog-unsupported-browser-requests-spike.png 805w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">The resource page in Datadog also includes a list of traces it captured for this request. Since it's a <a href=\"https://www.writesoftwarewell.com/definitive-guide-to-rack/\" class=\"markdown-link\">rack</a> request, Datadog also captures the User Agent string. Here are a few examples of User Agent strings I found for the <code>/unsupported_browser</code> request:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36 Edg/129.0.0.0</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36 Edg/130.0.0.0</span></span></code></pre>\n<p class=\"markdown-para\">Using <a href=\"https://www.npmjs.com/package/ua-parser-js\" class=\"markdown-link\">ua-parser-js</a>, revealed that these were modern versions of Microsoft Edge. For example:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">npx ua-parser-js </span><span class=\"mtk6\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36 Edg/129.0.0.0&quot;</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"json\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">[</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;ua&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36 Edg/129.0.0.0&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;browser&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9 mtki\">&quot;name&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Edge&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9 mtki\">&quot;version&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;129.0.0.0&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9 mtki\">&quot;major&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;129&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;cpu&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9 mtki\">&quot;architecture&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;amd64&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;device&quot;</span><span class=\"mtk1\">: {},</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;engine&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9 mtki\">&quot;name&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Blink&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9 mtki\">&quot;version&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;129.0.0.0&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk9 mtki\">&quot;os&quot;</span><span class=\"mtk1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9 mtki\">&quot;name&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;Windows&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk9 mtki\">&quot;version&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk12\">&quot;10&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">]</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"reproducing-the-issue\" style=\"position:relative;\"><a href=\"#reproducing-the-issue\" aria-label=\"reproducing the issue permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reproducing the Issue</h2>\n<p class=\"markdown-para\">The next step was to see if I could reproduce the issue. From the User Agent string analysis, it appeared to only be affecting Microsoft Edge users on Windows 10. While it is possible to install the Microsoft Edge browser on a Mac, I was concerned that the User Agent string wouldn't be exactly the same from a Mac vs Windows.</p>\n<p class=\"markdown-para\">Fortunately, it's possible using Chrome (my default browser on Mac) to send an alternate User Agent string. With the Developer Tools open, select the Network tab, then click on the three vertical dots at the top right, and select More Tools, then Network Conditions as shown in the screenshot below:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACkUlEQVR42n2S7W6bSBSGCX96B5UsO1VqYmZgZvgexhgDBn/ESbNOtanalbLS7h2Uu3Z7Dci8FXS9pW3aH48OA3MevcwZbevaL/PM+WhxVjPb+mjbds0Yq6nVVV7PVVwnSVJnWdbjum4thKgZs2vBeW1RUtvErD3breXr8KXmkVlVFRmSNENWVCiKFdI0xarcIF9tUK63KIoCeZ7376WUkJGEUgmyfIVYpciWOTbpDvl1vtbGBi3jWLVSxk0UySYMw56oQ8aNUHkzn6tGxnGzzMomWWSN44VNrNJms7trkmXVqEXRrWHMSKGNTFGahMCyrPYMpfQ7CCEt46Ld3/3RqiRrvSBu1SJrq92+TZZ560dxq9IMxswstMmrq5JSioEAQyzL6ivjHPu7A5Z5CTeQWKVbvLv9C6XatR23+QFi5hXaZDwuCSE4J+meh3Qy0zTBGMduf49qfYMoXqBc7vD+4Qm74k27SrZtmezgmUGhTSaT/4XPJewgxAQXAtV2D18qOIGEG4ZwvADMcVsm3NYWDi6vrr4XnhN+lXxLeT27hsd9/H34F09v/8FD9Yi5s8Bsdg1KvvWNx+OfhWdZf26Mwfd9+IEPGcZ42D/i8fABh5s/EThRn3wwOEwmvxF2w+Cc90i1gFrkWN/cIivXCOQcTDgYHtUvEz73y+eh3OzvIVUKP1QQwvu9kBBy+hFKaY9pmifGxana7E+hTE5+ND9x4Z4IMU+E0PP+r8LLy8l6eN+eu4fdZs4F7u7fYr7IEURzCMcDpQR00NeF00ajUWIYxtEwjE//1Z+YTqdH0yTHvKiOQaSOTPhHQu2jMZ0O930ejUZK0zTtha7rhq7rRNd181dcXFyYmqb1nNeD712v0bm+AG3qkVNZ6pfKAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"chrome-devtools-network-more-tools-network-conditions\"\n        title=\"chrome-devtools-network-more-tools-network-conditions\"\n        src=\"/static/0d7e7589efc756c6952d1211c1fa72df/5a190/chrome-devtools-network-more-tools-network-conditions.png\"\n        srcset=\"/static/0d7e7589efc756c6952d1211c1fa72df/772e8/chrome-devtools-network-more-tools-network-conditions.png 200w,\n/static/0d7e7589efc756c6952d1211c1fa72df/e17e5/chrome-devtools-network-more-tools-network-conditions.png 400w,\n/static/0d7e7589efc756c6952d1211c1fa72df/5a190/chrome-devtools-network-more-tools-network-conditions.png 800w,\n/static/0d7e7589efc756c6952d1211c1fa72df/c1b63/chrome-devtools-network-more-tools-network-conditions.png 1200w,\n/static/0d7e7589efc756c6952d1211c1fa72df/bc3ae/chrome-devtools-network-more-tools-network-conditions.png 1268w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">This opens up the Network Conditions sub-panel. Here you can uncheck the \"Use browser default\" option in the \"User agent\" section. Then you can fill in any string you'd like. Here is where I filled in one of the example User Agent strings I had retrieved from Datadog for Microsoft Edge on Windows 10:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGElEQVR42pWQWW7dMAxFvZmnwRRlDZZkO00+uv89nUJ+aVoUQYJ+HJAgJV7yLsdx0Pugn29crz8Zx0XO+UtS3kg5fdpbUkqEELDWMvNSCsYYHuaBseauz2js484nm6kEGz/6f7Oc58kYAxGhTJWSiaKoVcQJq11Rm4g2463HOMNmE2LnEs+Bzjm893jvWGbyuzgH7/tO3jJ5zZRQqLFStbPrQdQNUaGHTtZMUCXGeF84/zvnWeZ5k1k4rxd+vL7dcVwv9OOi9UEbndoae+s3rY0n0/txUOqOiCJBWabCZF2FXCq9d2qtaEwETe/eONzEPfnXtz8n+6eHvTVWCdQ2GPfAqbji3h//Dx8nT6UggqrenoiET7f5jl9hAfO4/PE/TQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"chrome-devtools-custom-user-agent-string\"\n        title=\"chrome-devtools-custom-user-agent-string\"\n        src=\"/static/41e729dddd59a200fbd22ace65c120e4/5a190/chrome-devtools-custom-user-agent-string.png\"\n        srcset=\"/static/41e729dddd59a200fbd22ace65c120e4/772e8/chrome-devtools-custom-user-agent-string.png 200w,\n/static/41e729dddd59a200fbd22ace65c120e4/e17e5/chrome-devtools-custom-user-agent-string.png 400w,\n/static/41e729dddd59a200fbd22ace65c120e4/5a190/chrome-devtools-custom-user-agent-string.png 800w,\n/static/41e729dddd59a200fbd22ace65c120e4/c1b63/chrome-devtools-custom-user-agent-string.png 1200w,\n/static/41e729dddd59a200fbd22ace65c120e4/c425d/chrome-devtools-custom-user-agent-string.png 1279w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">For any network requests made while Developer Tools is open, the browser will now send your custom User Agent string to the server instead of the one normally associated with your browser or device.</p>\n<p class=\"markdown-para\">With this setup, refreshing the browser with the url at the application home page, redirected me to <code>/unsupported_browser</code>, confirming that I had successfully reproduced the issue our users were encountering. This was great news because having a reproducible issue makes troubleshooting significantly easier.</p>\n<h2 class=\"markdown-subtitle\" id=\"when-did-it-start\" style=\"position:relative;\"><a href=\"#when-did-it-start\" aria-label=\"when did it start permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>When Did it Start?</h2>\n<p class=\"markdown-para\">With the issue now reproducible, the next logical question was: Why were users only encountering this problem recently? i.e. this application has been running in production for years, why was this problem starting now?</p>\n<p class=\"markdown-para\">To answer that, I took a closer look at the Datadog requests over time graph, and noticed that there was a very distinct date when these requests started, as highlighted below:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/0lEQVR42lWSzU9TQRTFX+JaoC2lffP15r3XPvppqVBAxIXGGImGGGLExHSjLhCIYNQNRjcmutR/wZULE8PC+O/9zJ1ShMXJzNw799x7Zk7krKdotmg2FmnkRVizxOOMJUsbAanP8UkW9nLfaIc1SVglLpA7kotkM1xa5lp/iX5/iUF/QFYMqaqCPG3QafdYLNqhUbvVDcVCNoU0ybNmGCZxKdG0i1YWpRy1yizD3W/cfX1Kr9Mlrhu0diEvmE43hZwvIjImod3q4F2GdZ686ni7954fP08Zj19QW4hDZ5Ej+E/mz5BgL8QjuSSyvEupa8PI9OiP3lGyXZTrYG1+ufiMzGkTMDnb83wkbyBvJFNoaxgmK6Rbp9SKDSqrR9Q6D0lqMzitz4ucilH5CiobTmQnrfCJgVB0C6GOLTNzsyyWCiqbv4lWv3Bl6y+l4UvifI24eROrDdrm6Djm6uZXZm98JG6sUxmMMbV5jPFEwppYx9poncdPnjLeec7Oq1/cOf5Dc/s7duOQ+u3P1NcPSfMufvCA5ugRam2PhVsfUNef4ZZ36bVFZUbkjKMaZ9y7v83JySf2Do7Z3z/gzdExG6sjcp+SOYNTKkzgfSPYJzEmSBeFmZ/8Q/ChyFDpAJ93qZTKlOcqlEtVSnPz1MUySuyQYM4tYlGxuRQTW01ijn8ifiZ120VyqgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"datadog-unsupported-browser-requests-spike\"\n        title=\"datadog-unsupported-browser-requests-spike\"\n        src=\"/static/9d8b989ac9b7040ca2219e47d982385e/5a190/datadog-unsupported-browser-requests-spike-highlight-date.png\"\n        srcset=\"/static/9d8b989ac9b7040ca2219e47d982385e/772e8/datadog-unsupported-browser-requests-spike-highlight-date.png 200w,\n/static/9d8b989ac9b7040ca2219e47d982385e/e17e5/datadog-unsupported-browser-requests-spike-highlight-date.png 400w,\n/static/9d8b989ac9b7040ca2219e47d982385e/5a190/datadog-unsupported-browser-requests-spike-highlight-date.png 800w,\n/static/9d8b989ac9b7040ca2219e47d982385e/764be/datadog-unsupported-browser-requests-spike-highlight-date.png 806w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">This just happened to be the exact same date we had released a major Ruby upgrade from 2.x to 3.x!</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 552px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDAf/EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAGiRaa0mM//xAAZEAADAQEBAAAAAAAAAAAAAAAAAQIREiL/2gAIAQEAAQUC0mjUOJVeOksn/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFhEAAwAAAAAAAAAAAAAAAAAAEBEh/9oACAECAQE/Aax//8QAGhABAAEFAAAAAAAAAAAAAAAAAAECESIxQf/aAAgBAQAGPwJZxFWmMof/xAAbEAEAAgIDAAAAAAAAAAAAAAABABEhkTFRYf/aAAgBAQABPyGgoVfURFG6mIjYzKGS3zllQ8n/2gAMAwEAAgADAAAAEMvf/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/EAMn/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAERcf/aAAgBAgEBPxBvAp//xAAcEAEBAAIDAQEAAAAAAAAAAAABEQAhMUFxgVH/2gAIAQEAAT8QNgM4SvxxMGrxTHwwoUCd41yBKCr93+4xG96BfNBkpbO2f//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ruby-upgrade-msedge-coincidence-i-think-not\"\n        title=\"ruby-upgrade-msedge-coincidence-i-think-not\"\n        src=\"/static/535884735e66e78883da229c20ce130c/25044/ruby-upgrade-msedge-coincidence-i-think-not.jpg\"\n        srcset=\"/static/535884735e66e78883da229c20ce130c/e07e9/ruby-upgrade-msedge-coincidence-i-think-not.jpg 200w,\n/static/535884735e66e78883da229c20ce130c/066f9/ruby-upgrade-msedge-coincidence-i-think-not.jpg 400w,\n/static/535884735e66e78883da229c20ce130c/25044/ruby-upgrade-msedge-coincidence-i-think-not.jpg 552w\"\n        sizes=\"(max-width: 552px) 100vw, 552px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">Armed with steps to reproduce, and an idea of the most recent change that might have broken things, I could start digging into the code to find the root cause.</p>\n<h2 class=\"markdown-subtitle\" id=\"digging-into-the-code\" style=\"position:relative;\"><a href=\"#digging-into-the-code\" aria-label=\"digging into the code permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Digging Into the Code</h2>\n<p class=\"markdown-para\">I started by looking into the code that renders the <code>/unsupported_browser</code> path, including the router, controller, and view:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># config/routes.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">application</span><span class=\"mtk1\">.</span><span class=\"mtk5\">routes</span><span class=\"mtk1\">.</span><span class=\"mtk5\">draw</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  get </span><span class=\"mtk6\">&quot;/unsupported_browser&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">to:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;pages#unsupported_browser&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># app/controllers/pages_controller.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">PagesController</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationController</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># no logic here means this will render: app/views/pages/unsupported_browser.html.erb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">unsupported_browser</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"erb\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">&lt;%# app/views/pages/unsupported_browser.html.erb %&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  Content to display please use one of the browsers below...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">&lt;/</span><span class=\"mtk7\">div</span><span class=\"mtk1\">&gt;</span></span></span></code></pre>\n<p class=\"markdown-para\">But there was nothing remarkable in any of the above code: No recent changes as a result of the Ruby upgrade, and not even any logic, just static display. I also checked the base <code>ApplicationController</code> but nothing relevant there either.</p>\n<p class=\"markdown-para\">So the next question was, what was directing some requests to the <code>/unsupported_browser</code> path? In absence of any obvious logic in the application code, the answer could be in <a href=\"https://stackoverflow.com/questions/2256569/what-is-rack-middleware\" class=\"markdown-link\">rack middleware</a>, which can filter and modify http requests and responses.</p>\n<p class=\"markdown-para\">To view the list of middleware currently configured for a Rails app, you can run <code>bin/rails middleware</code>. I ran this looking for anything that wasn't out-of-the-box Rails like <code>ActionDispatch::...</code> or <code>Rack::...</code>, and possibly related to browser detection.</p>\n<p class=\"markdown-para\">I found this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">bin/rails middleware</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># usual Rails things...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># use Browsernizer::Router</span></span></span></code></pre>\n<p class=\"markdown-para\">The <code>Browsernizer::Router</code> middleware comes from the <a href=\"https://github.com/assembler/browsernizer\" class=\"markdown-link\">browsernizer</a> gem (which depends on the <a href=\"https://github.com/fnando/browser\" class=\"markdown-link\">browser</a> gem). This gem is used to detect browsers and redirect unsupported ones. Looking at the <code>Gemfile</code>, I discovered our app does indeed use this gem.</p>\n<p class=\"markdown-para\">And reviewing the <code>Gemfile.lock</code> changes from the Ruby upgrade revealed that while <code>browsernizer</code> hadnâ€™t changed, its dependency, <code>browser</code>, was updated from version 2.2.0 to 2.7.1. This can be viewed in the snippet of the git diff below:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAvUlEQVR42jWL0U6DMABFedfpOpS2q6VQoIMxyhbYnNPszcT//6FjJPHhJifn5CatrTnvZqYQue8HwjanzAxeGrwylKmmiYHuZ2bTWFw8sJsu+PdIcz+xqe3i/5e0NnDtP7nsjtz2I7UpcC+aIjMU0uBSTT0Euu/zcq7GE938QXU9YqceUb0hKrO0P06Urji0XzRlJPcD2nW8as+TUDwLxWotSaVFuZoHkeGKSNfeKHyPCSNZHljLnEchWaWKXy7aU8Ll5lcAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ruby upgrade gem diffs\"\n        title=\"ruby upgrade gem diffs\"\n        src=\"/static/04dcf71a82680f3b033053fb6b6c4129/5a190/ruby-upgrade-gem-diffs.png\"\n        srcset=\"/static/04dcf71a82680f3b033053fb6b6c4129/772e8/ruby-upgrade-gem-diffs.png 200w,\n/static/04dcf71a82680f3b033053fb6b6c4129/e17e5/ruby-upgrade-gem-diffs.png 400w,\n/static/04dcf71a82680f3b033053fb6b6c4129/5a190/ruby-upgrade-gem-diffs.png 800w,\n/static/04dcf71a82680f3b033053fb6b6c4129/c1b63/ruby-upgrade-gem-diffs.png 1200w,\n/static/04dcf71a82680f3b033053fb6b6c4129/29007/ruby-upgrade-gem-diffs.png 1600w,\n/static/04dcf71a82680f3b033053fb6b6c4129/b4472/ruby-upgrade-gem-diffs.png 2468w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">Definitely getting closer...</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC7ElEQVR42h2S20/bdRxAP9/fr1d6W21py+ivpdCUAhEa0umkTlY2Iy2jLaVMpFDppAyQcJkwcGRb5uJ0YS8ajYmaSTI1mPig7MlMjfGCl0hClvj3HHUP5/XkPBwp+B3kogHKkZPk2gzGEjHK/qeY7exgrLeHmZ5uah0xLqXiXM6kqSfamUvEqA/0sdgbYiMdoXEqxsVWF5WTbmQhIGwNpjn64zf+/ukR97fmefjgEw6Pjnj81+/88+chvx58w9fLFQ4P9vl2/wsO9j7jl+8f8fMPP3J8fMztkRHqRpjXusPIhEeY6w5xa/oiN8t5ttMGtyovsnNpit0LWXYy/byVy7KUDHFnepwbc3WuDJ1j+YVBtkcLXCuVWBkY4PLAafItHqTo1nnFK5yzC/mQm0rIyXTYTcmtUb8wwvraBlWblQmXi835OncqWTbjGptJG8WghbxdyDmEcaeibniRbZ/iul9R9ZjJmTQqujAjQsPv5OrdD1l7812WRPggEOXu3nc8PHzM/mArn/ZZ2Ui1suW1ctVjYckqrJoFqYVt1NtcLPeHme0O8mrSx0S7ly6HianUM5xxnWBYhHui835/hr3a6+za7VwzTlCKBhi2CFW3jcmAh5fDAaRqFWacwrxDWPQoVv0akw5FUgRDhEERMkrjOVFkRJ7IN0RYFaEmwqJFWLEJK0poKEFyRohcJMRwxM9LLS4m273UeyOcbfGREEVR05kVRV0UBV2nIDrrThuT8SCjARfltiBTnS0sdBnMxsOIYTXTYTXT3mShy2Fh1Gmm5NaZ9umkLOpJWVUpakoxLoqGXfF52sT+WTNfnrfxUdbJzpkoB+UYX40ZiIigieBWioTFREYXis0OGtEmCj6N86KxoBRvKMV1EW56dD4+ZeVBxsr95228k7Kx3Bdgt8/Nvc4mRInwP15do8tiokcJ+WAz4x2tDIW9PCvCFaWxphQ3lKIiQvXpZt7Oxrg9lOS9Ypqd03HW+9uY+2/sfwEE1nPRwCucMwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ruby-upgrade-msedge-issue-getting-closer\"\n        title=\"ruby-upgrade-msedge-issue-getting-closer\"\n        src=\"/static/b7d8a878f15ed3d8bf0b92f7b1e63f49/0a47e/ruby-upgrade-msedge-issue-getting-closer.png\"\n        srcset=\"/static/b7d8a878f15ed3d8bf0b92f7b1e63f49/772e8/ruby-upgrade-msedge-issue-getting-closer.png 200w,\n/static/b7d8a878f15ed3d8bf0b92f7b1e63f49/e17e5/ruby-upgrade-msedge-issue-getting-closer.png 400w,\n/static/b7d8a878f15ed3d8bf0b92f7b1e63f49/0a47e/ruby-upgrade-msedge-issue-getting-closer.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">The browsernizer middleware is configured in an initializer as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># config/initializers/browsernizer.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">application</span><span class=\"mtk1\">.</span><span class=\"mtk5\">config</span><span class=\"mtk1\">.</span><span class=\"mtk5\">middleware</span><span class=\"mtk1\">.</span><span class=\"mtk5\">use</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Browsernizer</span><span class=\"mtk1\">::Router </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">supported</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Internet Explorer&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">supported</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Microsoft Edge&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">location</span><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;/unsupported_browser&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">exclude</span><span class=\"mtk1\">   </span><span class=\"mtk6\">%r{^/assets}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">At first glance, it appeared that Microsoft Edge was intentionally marked as unsupported. However, this configuration was introduced eight years ago, back when Microsoft Edge was more like Internet Explorer. At the time, this rule made sense for this particular app.</p>\n<aside class=\"markdown-aside\">\nThis app's front end is built with Backbone and Marionette, which historically had compatibility issues with older browsers like IE8, prompting the decision to block both Internet Explorer and Edge in the initial configuration. Browser support was improved in Marionette around 2019, but this app is over 8 years old, and at that time support for older browsers was not the case. This <a class=\"markdown-link\" href=\"https://github.com/marionettejs/backbone.marionette/issues/3658\">GitHub issue</a> and <a class=\"markdown-link\" href=\"https://github.com/marionettejs/backbone.marionette/blob/master/test/rollup.config.js#L24-L30\">test configuration</a> have more details.\n</aside>\n<p class=\"markdown-para\">In January 2020, Microsoft modified their Edge browser to be Chromium based, which would have also modified the User Agent string that browser was sending. However, this app had remained on an older version of the <code>browser</code> gem (v2.2.0) during this transition.</p>\n<h2 class=\"markdown-subtitle\" id=\"identify-root-cause\" style=\"position:relative;\"><a href=\"#identify-root-cause\" aria-label=\"identify root cause permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Identify Root Cause</h2>\n<p class=\"markdown-para\">With the older <code>browser</code> gem (v2.2.0), Chromium-based Edge wasnâ€™t recognized as \"Microsoft Edge\" due to differences in User-Agent parsing. This version of the gem was released 8 years ago, prior to the existence of Chromium-based Edge, so it couldn't have been detected as such.</p>\n<p class=\"markdown-para\">This unintentional gap allowed Chromium-based Edge users to bypass the block because the v2.2.0 version of <code>browser</code> incorrectly identified Chromium-based Edge as \"Chrome\". After the Ruby upgrade, the newer <code>browser</code> gem (v2.7.1) correctly identified <em class=\"markdown-emphasis\">all</em> Edge browsers - Chromium-based or not as \"Edge\". This started triggering the block for all versions of Edge, which was not intended.</p>\n<p class=\"markdown-para\">To verify this, I setup a Ruby project with the older 2.2.0 version of the <code>browser</code> gem as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Gemfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">source </span><span class=\"mtk6\">&quot;https://rubygems.org&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">gem </span><span class=\"mtk6\">&quot;browser&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;2.2.0&quot;</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># main.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;browser&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Modern (i.e. Chromium-based) MS Edge</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">user_agent </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36 Edg/130.0.0.0&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Let&#39;s see what the older browser gem makes of Chromium-based Edge:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">browser </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Browser</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(user_agent, </span><span class=\"mtk4\">accept_language:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;en-us&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">puts</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Browser name: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">browser.</span><span class=\"mtk5\">name</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Browser name: Chrome</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">puts</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Is this Edge? </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">browser.</span><span class=\"mtk5\">edge?</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Is this Edge? (no further output so must be nil)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">puts</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Is this Chrome? </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">browser.</span><span class=\"mtk5\">chrome?</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Is this Chrome? true</span></span></span></code></pre>\n<p class=\"markdown-para\">As shown from the above output, v2.2.0 of <code>browser</code> gem was identifying Chromium-based Edge as Chrome. This is what had allowed Chromium-based Edge users to bypass the block setup in <code>config/initializers/browsernizer.rb</code> for all these years.</p>\n<p class=\"markdown-para\">Then I setup another Ruby project, this time with the v2.7.1 version of the <code>browser</code> gem that the project had been updated to as part of the upgrade:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Gemfile</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">source </span><span class=\"mtk6\">&quot;https://rubygems.org&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">gem </span><span class=\"mtk6\">&quot;browser&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;2.7.1&quot;</span></span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># main.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;browser&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Modern (i.e. Chromium-based) MS Edge</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">user_agent </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Safari/537.36 Edg/130.0.0.0&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Let&#39;s see what the newer browser gem makes of Chromium-based Edge:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">browser </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Browser</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(user_agent, </span><span class=\"mtk4\">accept_language:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;en-us&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">puts</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Browser name: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">browser.</span><span class=\"mtk5\">name</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Browser name: Microsoft Edge</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">puts</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Is this Edge? </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">browser.</span><span class=\"mtk5\">edge?</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Is this Edge? true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9\">puts</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Is this Chrome? </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">browser.</span><span class=\"mtk5\">chrome?</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Is this Chrome? false</span></span></span></code></pre>\n<p class=\"markdown-para\">As shown from the above output, v2.7.1 of the <code>browser</code> gem was now identifying Chromium-based Edge as Microsoft Edge, which was then getting blocked by <code>config/initializers/browsernizer.rb</code>.</p>\n<h2 class=\"markdown-subtitle\" id=\"implementing-the-fix\" style=\"position:relative;\"><a href=\"#implementing-the-fix\" aria-label=\"implementing the fix permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Implementing the Fix</h2>\n<p class=\"markdown-para\">The intention of the browser detection middleware was to:</p>\n<ol class=\"markdown-list-ordered\">\n<li class=\"markdown-list-item\">Block Internet Explorer.</li>\n<li class=\"markdown-list-item\">Block non-Chromium-based Edge.</li>\n<li class=\"markdown-list-item\">Allow all Chromium-based browsers, including modern Edge.</li>\n</ol>\n<p class=\"markdown-para\">Unfortunately, the <code>browsernizer</code> gem hasnâ€™t been updated to support the latest <code>browser</code> gem versions, where a convenient <code>chromium_based?</code> method exists. To work around this, I implemented a custom check for Chromium-based Edge in our browsernizer configuration, based on the most recent version of <code>browser</code> gem:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># config/initializers/browsernizer.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">application</span><span class=\"mtk1\">.</span><span class=\"mtk5\">config</span><span class=\"mtk1\">.</span><span class=\"mtk5\">middleware</span><span class=\"mtk1\">.</span><span class=\"mtk5\">use</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Browsernizer</span><span class=\"mtk1\">::Router </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Block IE</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">supported</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Internet Explorer&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Dynamic check for all other browsers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">supported</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |browser|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> browser.</span><span class=\"mtk5\">edge?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      browser.</span><span class=\"mtk5\">ua</span><span class=\"mtk1\">.</span><span class=\"mtk5\">match?</span><span class=\"mtk1\">(</span><span class=\"mtk6\">/</span><span class=\"mtk4\">\\b</span><span class=\"mtk6\">Edg</span><span class=\"mtk4\">\\b</span><span class=\"mtk6\">/</span><span class=\"mtk1\">) </span><span class=\"mtk3\"># Allow Chromium-based Edge</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">else</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">location</span><span class=\"mtk1\">  </span><span class=\"mtk6\">&quot;/unsupported_browser&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">exclude</span><span class=\"mtk1\">   </span><span class=\"mtk6\">%r{^/assets}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">With this fix in place, I repeated the manual testing I had been doing with Chrome dev tools and sending the Chromium-based Edge User Agent string, and this time I was allowed to get into the app.</p>\n<aside class=\"markdown-aside\">\nLonger term we may consider replacing the `browsernizer` gem with a custom solution since it's no longer maintained. We could instead use the `browser` gem directly and implement our own middleware, since the `browser` gem is actively maintained.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"ensuring-the-bug-stays-fixed\" style=\"position:relative;\"><a href=\"#ensuring-the-bug-stays-fixed\" aria-label=\"ensuring the bug stays fixed permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ensuring the Bug Stays Fixed</h2>\n<p class=\"markdown-para\">But it's not enough to only deliver a code fix. We also need some tests to ensure this stays fixed.</p>\n<p class=\"markdown-para\">This project has system test coverage with <a href=\"https://github.com/teamcapybara/capybara\" class=\"markdown-link\">Capybara</a> and <a href=\"https://github.com/rubycdp/cuprite\" class=\"markdown-link\">Cuprite</a>, which is a pure Ruby driver for Capybara. But Cuprite is Chrome only, so at first glance, it seems like it wouldn't be possible to have an automated test to verify other browsers.</p>\n<p class=\"markdown-para\">However, remembering my earlier <a href=\"../ruby-upgrade-broke-ms-edge#reproducing-the-issue\" class=\"markdown-link\">experiment with Chrome developer tools</a> to simulate the error condition by sending a different User Agent string, I had an idea that maybe the same thing could be done with a feature test.</p>\n<p class=\"markdown-para\">It turns out, Cuprite supports <a href=\"https://github.com/rubycdp/cuprite?tab=readme-ov-file#request-headers\" class=\"markdown-link\">modifying request headers</a>. The documentation includes an example for changing the User Agent string, which is exactly what I wanted to do:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># From Cuprite README.md -&gt; Request headers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">page.</span><span class=\"mtk5\">driver</span><span class=\"mtk1\">.</span><span class=\"mtk5\">headers</span><span class=\"mtk1\"> </span><span class=\"mtk3\"># =&gt; {}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">page.</span><span class=\"mtk5\">driver</span><span class=\"mtk1\">.</span><span class=\"mtk5\">headers</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> { </span><span class=\"mtk6\">&quot;User-Agent&quot;</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk6\">&quot;Cuprite&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">page.</span><span class=\"mtk5\">driver</span><span class=\"mtk1\">.</span><span class=\"mtk5\">add_headers</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;Referer&quot;</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk6\">&quot;https://example.com&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">page.</span><span class=\"mtk5\">driver</span><span class=\"mtk1\">.</span><span class=\"mtk5\">headers</span><span class=\"mtk1\"> </span><span class=\"mtk3\"># =&gt; { &quot;User-Agent&quot; =&gt; &quot;Cuprite&quot;, &quot;Referer&quot; =&gt; &quot;https://example.com&quot; }</span></span></span></code></pre>\n<p class=\"markdown-para\">This allowed me to write a system test to simulate a user visiting the root path <code>\"/\"</code> from any number of different browsers, differentiated only by the User Agent string. If a browser is supported, then the test expects that the user should be redirected to <code>\"/login\"</code>, otherwise, <code>\"/unsupported_browser\"</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># spec/features/user_agent_spec.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;rails_helper&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">feature </span><span class=\"mtk6\">&quot;Browser support based on User Agent&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:js</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">visit_with_user_agent</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">user_agent</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    page.</span><span class=\"mtk5\">driver</span><span class=\"mtk1\">.</span><span class=\"mtk5\">headers</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> { </span><span class=\"mtk6\">&quot;User-Agent&quot;</span><span class=\"mtk1\"> =&gt; user_agent }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    visit </span><span class=\"mtk6\">&quot;/&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  scenario </span><span class=\"mtk6\">&quot;Old Edge (non-Chromium) should not be allowed&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    old_edge_ua </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Edge/16.16299&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">visit_with_user_agent</span><span class=\"mtk1\">(old_edge_ua)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(page).</span><span class=\"mtk5\">to</span><span class=\"mtk1\"> </span><span class=\"mtk5\">have_current_path</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;/unsupported_browser&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  scenario </span><span class=\"mtk6\">&quot;New Edge (Chromium-based) should be allowed&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    new_edge_ua </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36 Edg/126.0.0.0&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">visit_with_user_agent</span><span class=\"mtk1\">(new_edge_ua)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(page).</span><span class=\"mtk5\">to</span><span class=\"mtk1\"> </span><span class=\"mtk5\">have_current_path</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;/login&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  scenario </span><span class=\"mtk6\">&quot;Chrome should be allowed&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    chrome_ua </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">visit_with_user_agent</span><span class=\"mtk1\">(chrome_ua)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(page).</span><span class=\"mtk5\">to</span><span class=\"mtk1\"> </span><span class=\"mtk5\">have_current_path</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;/login&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  scenario </span><span class=\"mtk6\">&quot;Firefox should be allowed&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    firefox_ua </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:90.0) Gecko/20100101 Firefox/90.0&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">visit_with_user_agent</span><span class=\"mtk1\">(firefox_ua)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(page).</span><span class=\"mtk5\">to</span><span class=\"mtk1\"> </span><span class=\"mtk5\">have_current_path</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;/login&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  scenario </span><span class=\"mtk6\">&quot;Safari should be allowed&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    safari_ua </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.1 Safari/605.1.15&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">visit_with_user_agent</span><span class=\"mtk1\">(safari_ua)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(page).</span><span class=\"mtk5\">to</span><span class=\"mtk1\"> </span><span class=\"mtk5\">have_current_path</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;/login&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  scenario </span><span class=\"mtk6\">&quot;Internet Explorer should not be allowed&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ie_ua </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.1; Trident/6.0)&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">visit_with_user_agent</span><span class=\"mtk1\">(ie_ua)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">expect</span><span class=\"mtk1\">(page).</span><span class=\"mtk5\">to</span><span class=\"mtk1\"> </span><span class=\"mtk5\">have_current_path</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;/unsupported_browser&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">These tests ensure that future updates wonâ€™t reintroduce the bug.</p>\n<h2 class=\"markdown-subtitle\" id=\"lessons-learned\" style=\"position:relative;\"><a href=\"#lessons-learned\" aria-label=\"lessons learned permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Lessons Learned</h2>\n<p class=\"markdown-para\">Technically, it wasn't the Ruby upgrade itself that introduced the bug, but rather, one of the accompanying gem updates.</p>\n<ol class=\"markdown-list-ordered\">\n<li class=\"markdown-list-item\">If an app is using browser detection, periodically revisit the configuration as new browsers become available to ensure it still works as intended.</li>\n<li class=\"markdown-list-item\">If using a gem for browser detection, keep this dependency up to date.</li>\n<li class=\"markdown-list-item\">If a gem is no longer receiving updates, consider replacing it with something that is maintained, or if the logic is relatively simple, with a custom solution.</li>\n<li class=\"markdown-list-item\">Include automated tests for browser detection.</li>\n<li class=\"markdown-list-item\">A good APM tool is your friend in diagnosing production issues.</li>\n</ol>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk12 { color: #CFCFC2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk10 { color: #FD971F; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","timeToRead":10,"tableOfContents":"<ul>\n<li><a href=\"#the-issue\">The Issue</a></li>\n<li><a href=\"#one-user-or-many\">One User or Many?</a></li>\n<li><a href=\"#reproducing-the-issue\">Reproducing the Issue</a></li>\n<li><a href=\"#when-did-it-start\">When Did it Start?</a></li>\n<li><a href=\"#digging-into-the-code\">Digging Into the Code</a></li>\n<li><a href=\"#identify-root-cause\">Identify Root Cause</a></li>\n<li><a href=\"#implementing-the-fix\">Implementing the Fix</a></li>\n<li><a href=\"#ensuring-the-bug-stays-fixed\">Ensuring the Bug Stays Fixed</a></li>\n<li><a href=\"#lessons-learned\">Lessons Learned</a></li>\n</ul>","frontmatter":{"title":"How a Ruby Upgrade Broke MS Edge Support in a Rails App","date":"01 Feb 2025","description":"Discover how upgrading Ruby unexpectedly caused compatibility issues with Microsoft Edge in our Rails app, and learn the debugging steps we took to resolve it.","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#8898a8","images":{"fallback":{"src":"/static/f9c0e9e0ff59ac2c305412edfa4eb42c/d730f/ruby-upgrade-broke-ms-edge-support-rails-david-vives-plzP_gAmSog-unsplash.jpg","srcSet":"/static/f9c0e9e0ff59ac2c305412edfa4eb42c/b834a/ruby-upgrade-broke-ms-edge-support-rails-david-vives-plzP_gAmSog-unsplash.jpg 225w,\n/static/f9c0e9e0ff59ac2c305412edfa4eb42c/21c52/ruby-upgrade-broke-ms-edge-support-rails-david-vives-plzP_gAmSog-unsplash.jpg 450w,\n/static/f9c0e9e0ff59ac2c305412edfa4eb42c/d730f/ruby-upgrade-broke-ms-edge-support-rails-david-vives-plzP_gAmSog-unsplash.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/f9c0e9e0ff59ac2c305412edfa4eb42c/71a10/ruby-upgrade-broke-ms-edge-support-rails-david-vives-plzP_gAmSog-unsplash.webp 225w,\n/static/f9c0e9e0ff59ac2c305412edfa4eb42c/901f1/ruby-upgrade-broke-ms-edge-support-rails-david-vives-plzP_gAmSog-unsplash.webp 450w,\n/static/f9c0e9e0ff59ac2c305412edfa4eb42c/5acd1/ruby-upgrade-broke-ms-edge-support-rails-david-vives-plzP_gAmSog-unsplash.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":599}}}},"fields":{"slug":"/blog/ruby-upgrade-broke-ms-edge/"}},"relatedP":{"edges":[{"node":{"id":"677a6c17-0cf3-5b4d-9599-d73009d93f25","frontmatter":{"title":"Datadog APM for Rails on Heroku","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#788878","images":{"fallback":{"src":"/static/fc31ba5a8579d623b268d0270180a635/26528/datadog-heroku-rails-chewy-EV9_vVMZTcg-unsplash.jpg","srcSet":"/static/fc31ba5a8579d623b268d0270180a635/26528/datadog-heroku-rails-chewy-EV9_vVMZTcg-unsplash.jpg 300w,\n/static/fc31ba5a8579d623b268d0270180a635/43429/datadog-heroku-rails-chewy-EV9_vVMZTcg-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/fc31ba5a8579d623b268d0270180a635/5d6c3/datadog-heroku-rails-chewy-EV9_vVMZTcg-unsplash.webp 300w,\n/static/fc31ba5a8579d623b268d0270180a635/68dbc/datadog-heroku-rails-chewy-EV9_vVMZTcg-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/datadog-heroku-rails/"}}},{"node":{"id":"105dd1cf-bc5f-584b-b97d-591090200361","frontmatter":{"title":"Fixing Gem Install Errors on M3 Mac with Ruby 2.7","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#484848","images":{"fallback":{"src":"/static/6c668aef728b7cb1cba13c59f7c41b97/26528/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.jpg","srcSet":"/static/6c668aef728b7cb1cba13c59f7c41b97/26528/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.jpg 300w,\n/static/6c668aef728b7cb1cba13c59f7c41b97/43429/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/6c668aef728b7cb1cba13c59f7c41b97/5d6c3/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.webp 300w,\n/static/6c668aef728b7cb1cba13c59f7c41b97/68dbc/fix-gem-install-issues-julien-pier-belanger-SoFNVdiJQgc-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/fix-gem-install-errors-m3-mac-ruby-278/"}}},{"node":{"id":"7a565b39-3dd4-5740-82a2-867e3565078c","frontmatter":{"title":"Old Ruby and New Mac","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#a8b8a8","images":{"fallback":{"src":"/static/891a432040b9dec710096ad8bac91eed/ad250/ruby-in-box.png","srcSet":"/static/891a432040b9dec710096ad8bac91eed/ad250/ruby-in-box.png 300w,\n/static/891a432040b9dec710096ad8bac91eed/b64d1/ruby-in-box.png 600w","sizes":"300px"},"sources":[{"srcSet":"/static/891a432040b9dec710096ad8bac91eed/5d6c3/ruby-in-box.webp 300w,\n/static/891a432040b9dec710096ad8bac91eed/68dbc/ruby-in-box.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/old-ruby-new-mac/"}}}]}},"pageContext":{"slug":"/blog/ruby-upgrade-broke-ms-edge/","relatedPosts":["Fixing Gem Install Errors on M3 Mac with Ruby 2.7","Old Ruby and New Mac","Datadog APM for Rails on Heroku"]}},"staticQueryHashes":["163244226"],"slicesMap":{}}