{"componentChunkName":"component---src-templates-post-js","path":"/blog/rails-enum-mysql-postgres/","result":{"data":{"markdownRemark":{"html":"<p class=\"markdown-para\">This post will walk you through the steps to add an enum to a Rails model, backed by either a MySQL or Postgres database. If you're not familiar with enums, an example will be more illuminating than the official definition.</p>\n<p class=\"markdown-para\">Suppose you're building a recurring subscription service. This will need a <code>Plan</code> model that each subscription is associated with. The plan will have a column <code>recurring_interval</code> to indicate how frequently the plan renews. Specifically, the service offers yearly, monthly, weekly and daily plans. When a customer purchases a subscription, the code must calculate the renewal date based on the Plan's <code>recurring_interval</code>. Imagine some conditional logic checking the value of this column, if it's <code>year</code>, add a year to the purchase date, if it's <code>month</code>, add a month and so on.</p>\n<p class=\"markdown-para\">In this case, it's important that the <code>recurring_interval</code> only contain one of a specific list of values: <code>year</code>, <code>month</code>, <code>week</code>, or <code>day</code>. If an unexpected value such as <code>foo</code> or <code>fortnight</code> was persisted in the <code>Plans</code> table, then the code wouldn't know how to calculate the subscriptions' renewal date. This is a perfect use case for enums. On the database side, enums provide data integrity to restrict a column to one of a list of values. See the <a href=\"https://dev.mysql.com/doc/refman/5.7/en/enum.html\" class=\"markdown-link\">MySQL</a> and <a href=\"https://www.postgresql.org/docs/14/datatype-enum.html\" class=\"markdown-link\">PostgreSQL</a> docs for a more formal definition.</p>\n<p class=\"markdown-para\">I'm assuming the <code>Plan</code> table and model already exist as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># db/migrate/20220406145959_create_plans.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">CreatePlans</span><span class=\"mtk5 mtki mtku\"> &lt; ActiveRecord::Migration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    create_table </span><span class=\"mtk4\">:plans</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |t|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.</span><span class=\"mtk5\">string</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:name</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.</span><span class=\"mtk5\">boolean</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:active</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">, </span><span class=\"mtk4\">default:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.</span><span class=\"mtk5\">string</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:currency</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">, </span><span class=\"mtk4\">default:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;USD&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.</span><span class=\"mtk5\">integer</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:unit_amount_cents</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span><span class=\"mtk1\">, </span><span class=\"mtk4\">default:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">0</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.</span><span class=\"mtk5\">timestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"database-migration\" style=\"position:relative;\"><a href=\"#database-migration\" aria-label=\"database migration permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Database Migration</h2>\n<p class=\"markdown-para\">The first step to implement an enum in your Rails project will be to generate a migration to add the column. Start from a terminal and enter the following command to generate a migration to add the <code>recurring_interval</code> column to the <code>Plans</code> table:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">bin/rails generate migration AddRecurringIntervalToPlans</span></span></code></pre>\n<p class=\"markdown-para\">This will generate a file similar to the following:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># db/migrate/20220407103112_add_recurring_interval_to_plans.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">AddRecurringIntervalToPlans</span><span class=\"mtk5 mtki mtku\"> &lt; ActiveRecord::Migration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">The syntax required to use enums is not supported by the Ruby migration DSL, therefore, it requires use of <code>execute</code> to run raw SQL. We also have to explicitly define the <code>up</code> and <code>down</code> methods since Rails won't automatically know how to reverse the raw SQL in the <code>execute</code> block.</p>\n<p class=\"markdown-para\">Update the generated migration as follows for MySQL:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># db/migrate/20220407103112_add_recurring_interval_to_plans.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># MySQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">AddRecurringIntervalToPlans</span><span class=\"mtk5 mtki mtku\"> &lt; ActiveRecord::Migration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    execute </span><span class=\"mtk6\">&lt;&lt;-SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">      </span><span class=\"mtk7\">ALTER</span><span class=\"mtk6\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk6\"> plans ADD recurring_interval ENUM(&#39;year&#39;, &#39;month&#39;, &#39;week&#39;, &#39;day&#39;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">    SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">down</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    remove_column </span><span class=\"mtk4\">:plans</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:recurring_interval</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">The syntax for PostgreSQL is a little different as it first requires creating a custom <a href=\"https://www.postgresql.org/docs/14/sql-createtype.html\" class=\"markdown-link\">data type</a> to define the enum, and then it can be added as a column to the table. Just like with MySQL, <code>execute</code> and explicit <code>up/down</code> methods are required:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># db/migrate/20220407103112_add_recurring_interval_to_plans.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># PostgreSQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">AddRecurringIntervalToPlans</span><span class=\"mtk5 mtki mtku\"> &lt; ActiveRecord::Migration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    execute </span><span class=\"mtk6\">&lt;&lt;-SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">      </span><span class=\"mtk7\">CREATE</span><span class=\"mtk6\"> </span><span class=\"mtk7\">TYPE</span><span class=\"mtk6\"> </span><span class=\"mtk5\">plan_recurring_interval</span><span class=\"mtk6\"> </span><span class=\"mtk7\">AS</span><span class=\"mtk6\"> ENUM (&#39;year&#39;, &#39;month&#39;, &#39;week&#39;, &#39;day&#39;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">    SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    add_column </span><span class=\"mtk4\">:plans</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:recurring_interval</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:plan_recurring_interval</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">down</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    remove_column </span><span class=\"mtk4\">:plans</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:recurring_interval</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    execute </span><span class=\"mtk6\">&lt;&lt;-SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">      </span><span class=\"mtk7\">DROP</span><span class=\"mtk6\"> </span><span class=\"mtk7\">TYPE</span><span class=\"mtk6\"> plan_recurring_interval;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">    SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<aside class=\"markdown-aside\">\nIf you're using the <a href=\"https://docs.rubocop.org/rubocop-rails/\" class=\"markdown-link\">rubocop-rails</a> gem with the default settings, you may encounter a lint error <a href=\"https://docs.rubocop.org/rubocop-rails/cops_rails.html#railssquishedsqlheredocs\" class=\"markdown-link\">Rails/SquishedSQLHeredocs</a>, because the SQL heredoc is not using the squish method. In this case, you can go ahead and append \".squish\" to the SQL heredocs in the migration as suggested by the linter to. Just be aware that some PostgreSQL syntax such as comments and functions do require newlines to be preserved so you may not always want this, but that's not an issue for the simple syntax used in this migration. See the Ruby <a href=\"https://www.rubydoc.info/github/rubyworks/facets/String%3Asquish\" class=\"markdown-link\">String docs</a> for more details about the squish method.\n</aside>\n<p class=\"markdown-para\">One last thing to know before running the migration, is that you must set the <code>schema_format</code> to be <code>:sql</code> in your application config in order for the enum definition to be captured in the schema file:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># config/application.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">config.</span><span class=\"mtk5\">active_record</span><span class=\"mtk1\">.</span><span class=\"mtk5\">schema_format</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:sql</span></span></span></code></pre>\n<p class=\"markdown-para\">This will generate file <code>db/structure.sql</code> instead of the default <code>db/schema.rb</code> file, which should be committed. This has to do with the use of raw SQL in the migration. The <a href=\"https://edgeguides.rubyonrails.org/active_record_migrations.html\" class=\"markdown-link\">Active Record Migrations Guide</a> has a great explanation:</p>\n<blockquote class=\"markdown-blockquote\">\n<p class=\"markdown-para\"><code>db/schema.rb</code> cannot express everything your database may support such as triggers, sequences, stored procedures, etc. While migrations may use execute to create database constructs that are not supported by the Ruby migration DSL, these constructs may not be able to be reconstituted by the schema dumper. If you are using features like these, you should set the schema format to :sql in order to get an accurate schema file that is useful to create new database instances.</p>\n</blockquote>\n<p class=\"markdown-para\">At this point, you should be able to run the migration (and optionally roll it back) with:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">bundle exec rails db:migrate</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">bundle exec rails db:rollback</span></span></code></pre>\n<p class=\"markdown-para\">After running the migration, the generated <code>db/structure.sql</code> file should specify the newly added enum column for the <code>plans</code> table.</p>\n<p class=\"markdown-para\">If you're using MySQL:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- db/structure.sql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk1\"> </span><span class=\"mtk6\">`plans`</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">-- other columns...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk6\">`recurring_interval`</span><span class=\"mtk1\"> enum(</span><span class=\"mtk6\">&#39;year&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;month&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;week&#39;</span><span class=\"mtk1\">,</span><span class=\"mtk6\">&#39;day&#39;</span><span class=\"mtk1\">) DEFAULT </span><span class=\"mtk7\">NULL</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...</span></span></span></code></pre>\n<p class=\"markdown-para\">And PostgreSQL - note the <code>CREATE</code> statement to first create the custom type, and then it can be used as a table column:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"sql\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">-- db/structure.sql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TYPE</span><span class=\"mtk1\"> </span><span class=\"mtk4\">public</span><span class=\"mtk1\">.</span><span class=\"mtk4\">plan_recurring_interval</span><span class=\"mtk1\"> </span><span class=\"mtk7\">AS</span><span class=\"mtk1\"> ENUM (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk6\">&#39;year&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk6\">&#39;month&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk6\">&#39;week&#39;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk6\">&#39;day&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">CREATE</span><span class=\"mtk1\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk1\"> </span><span class=\"mtk4\">public</span><span class=\"mtk1\">.</span><span class=\"mtk4\">plans</span><span class=\"mtk1\"> (</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">-- other columns...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    recurring_interval </span><span class=\"mtk4\">public</span><span class=\"mtk1\">.</span><span class=\"mtk4\">plan_recurring_interval</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">);</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"data-integrity\" style=\"position:relative;\"><a href=\"#data-integrity\" aria-label=\"data integrity permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Integrity</h2>\n<p class=\"markdown-para\">Ok, now that the enum is defined in the database, let's see the effect on model creation in the Rails console. Launch a Rails console and enter the following to create a new Plan model, set a few attributes, check for validity and save to the database:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan.</span><span class=\"mtk5\">name</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;My Test Plan&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan.</span><span class=\"mtk5\">recurring_interval</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;week&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan.</span><span class=\"mtk5\">valid?</span><span class=\"mtk1\"> </span><span class=\"mtk3\"># =&gt; true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan.</span><span class=\"mtk5\">save!</span><span class=\"mtk1\">  </span><span class=\"mtk3\"># =&gt; plan saved successfully to database</span></span></span></code></pre>\n<p class=\"markdown-para\">So far so good, we created a new plan with an allowed <code>recurring_interval</code> of <code>week</code>, and it was successfully saved to the database. But what happens if we try to save an unknown <code>recurring_interval</code>, for example <code>fortnight</code>? Back in the Rails console, let's try this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_2 </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_2.</span><span class=\"mtk5\">name</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Another Plan&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_2.</span><span class=\"mtk5\">recurring_interval</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;fortnight&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_2.</span><span class=\"mtk5\">valid?</span><span class=\"mtk1\"> </span><span class=\"mtk3\"># =&gt; true, hmmm... that&#39;s not right</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_2.</span><span class=\"mtk5\">save!</span><span class=\"mtk1\"> </span><span class=\"mtk3\"># =&gt; error</span></span></span></code></pre>\n<p class=\"markdown-para\">This time, our experience is not so great. We intentionally set an invalid value in the <code>recurring_interval</code> property of the Plan model, ActiveRecord tells us its valid when checking the <code>plan_2.valid?</code> method, but then the transaction is rolled back when trying to save the model to the database with the following error message:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">ROLLBACK</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">Traceback (most recent call last):</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">ActiveRecord::StatementInvalid (Mysql2::Error: Data truncated for column &#39;recurring_interval&#39; at row 1:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">INSERT INTO `plans` (`name`, `created_at`, `updated_at`, `recurring_interval`)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">VALUES (&#39;Another plan&#39;, &#39;2022-04-10 12:03:11&#39;, &#39;2022-04-10 12:03:11&#39;, &#39;fortnight&#39;))</span></span></code></pre>\n<p class=\"markdown-para\">What's happening here is we've achieved data integrity at the database level with the use of the <code>enum</code> column type. However, ActiveRecord is not aware of the existence of the enum and so it's allowing a model to be created with invalid data. For complete validation, we also need <em class=\"markdown-emphasis\">application</em> level data integrity, i.e. we want ActiveRecord to tell us the model is invalid with a useful error message rather than having to catch a MySQL (or PostgreSQL) exception. This is what we'll cover in the next section.</p>\n<h2 class=\"markdown-subtitle\" id=\"model-validation\" style=\"position:relative;\"><a href=\"#model-validation\" aria-label=\"model validation permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Model Validation</h2>\n<p class=\"markdown-para\">To get ActiveRecord support, the <a href=\"https://edgeapi.rubyonrails.org/classes/ActiveRecord/Enum.html\" class=\"markdown-link\">enum</a> macro (class level declaration) must be added to the model. Since we want these mapped as strings (rather than the default integer), we'll pass in a hash to map the enum attribute values to strings. Add the following to the <code>Plan</code> model:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># app/models/plan.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">Plan</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  enum </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">year:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;year&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">month:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">week:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;week&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">day:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;day&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Now let's try to create a plan in the Rails console as before, with an invalid <code>recurring_interval</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_2 </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_2.</span><span class=\"mtk5\">name</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Another Plan&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_2.</span><span class=\"mtk5\">recurring_interval</span><span class=\"mtk1\"> </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;fortnight&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Traceback (most recent call last):</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># ArgumentError (&#39;fortnight&#39; is not a valid recurring_interval)</span></span></span></code></pre>\n<p class=\"markdown-para\">Much better, this time we get an error from ActiveRecord when trying to set an invalid value for the <code>recurring_interval</code> field. ActiveRecord can tell us this value is invalid with a useful error message, without having to try to save to the database and waiting for a SQL error.</p>\n<h2 class=\"markdown-subtitle\" id=\"enum-methods\" style=\"position:relative;\"><a href=\"#enum-methods\" aria-label=\"enum methods permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enum Methods</h2>\n<p class=\"markdown-para\">In addition to validation, the enum macro also exposes a few convenience instance methods to check and modify values. For example, given a monthly plan has been created:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.</span><span class=\"mtk5\">create</span><span class=\"mtk1\">(</span><span class=\"mtk4\">name:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;A Plan&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<p class=\"markdown-para\">The <code>plan</code> instance now has boolean methods for each possible value of the <code>recurring_interval</code> enum: <code>year?</code>, <code>month?</code>, <code>week?</code>, and <code>day?</code>. Usage is as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan.</span><span class=\"mtk5\">month?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">=&gt; </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan.</span><span class=\"mtk5\">year?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">=&gt; </span><span class=\"mtk4\">false</span></span></span></code></pre>\n<p class=\"markdown-para\">The <code>plan</code> instance now also has bang methods to update the value of <code>recurring_interval</code>: <code>year!</code>, <code>month!</code>, <code>week!</code>, and <code>day!</code> and save to the database. For example:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Update the monthly plan to be a weekly plan</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan.</span><span class=\"mtk5\">week!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Plan Update (0.3ms) UPDATE `plans` SET `updated_at` = &#39;2022-04-11 11:31:38&#39;, `recurring_interval` = &#39;week&#39; WHERE `plans`.`id` = 3</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">=&gt; </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan.</span><span class=\"mtk5\">week?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">=&gt; </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan.</span><span class=\"mtk5\">month?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">=&gt; </span><span class=\"mtk4\">false</span></span></span></code></pre>\n<p class=\"markdown-para\">Note that if you call an update method when the model instance already has that value, no database update will run and the method will still return true. For example, calling <code>plan.week!</code> again will not result in an error.</p>\n<h2 class=\"markdown-subtitle\" id=\"enum-scopes\" style=\"position:relative;\"><a href=\"#enum-scopes\" aria-label=\"enum scopes permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enum Scopes</h2>\n<p class=\"markdown-para\">The enum macro also adds <a href=\"https://www.rubyguides.com/2019/10/scopes-in-ruby-on-rails/\" class=\"markdown-link\">scopes</a> to the model class, one for each possible value of the enum. So the <code>Plan</code> class will have: <code>Plan.year</code>, <code>Plan.month</code>, <code>Plan.week</code>, and <code>Plan.day</code>. This allows for easy querying, such as retrieving all the monthly plans. Note that these generated scopes, like all scopes, return an <a href=\"https://edgeapi.rubyonrails.org/classes/ActiveRecord/Relation.html\" class=\"markdown-link\">ActiveRecord::Relation</a> object.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"17\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_1 </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.</span><span class=\"mtk5\">create</span><span class=\"mtk1\">(</span><span class=\"mtk4\">name:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Plan 1&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">plan_2 </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.</span><span class=\"mtk5\">create</span><span class=\"mtk1\">(</span><span class=\"mtk4\">name:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Plan 2&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">monthly_plans </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Plan</span><span class=\"mtk1\">.</span><span class=\"mtk5\">month</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Plan Load (0.6ms) SELECT `plans`.* FROM `plans` WHERE `plans`.`recurring_interval` = `month` LIMIT 11</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">=&gt; </span><span class=\"mtk3\">#&lt;ActiveRecord::Relation&gt; [...plans...]</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"testing\" style=\"position:relative;\"><a href=\"#testing\" aria-label=\"testing permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Testing</h2>\n<p class=\"markdown-para\">At this point, we have a fully functioning model with both database and application level validation of the <code>recurring_interval</code> value. But we're not done yet, let's add some tests to verify this feature. I'm using <a href=\"https://rspec.info/\" class=\"markdown-link\">RSpec</a> and the <a href=\"https://matchers.shoulda.io/\" class=\"markdown-link\">Shoulda Matchers</a> gem, which contains a lot of convenient matchers to express common validations in Rails.</p>\n<p class=\"markdown-para\">The test uses the <a href=\"https://github.com/thoughtbot/shoulda-matchers/blob/main/lib/shoulda/matchers/active_record/define_enum_for_matcher.rb\" class=\"markdown-link\">define enum for</a> matcher, together with the <code>with_values</code> qualifier to pass in a hash of the expected allowed values for the <code>recurring_interval</code> column. Finally, <code>backed_by_column_of_type</code> is appended to the matcher to assert that the column type is a string (rather than the default integer).</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"18\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># spec/models/plan_spec</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">describe Plan, </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:model</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  describe </span><span class=\"mtk6\">&quot;validations&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    it </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      should </span><span class=\"mtk5\">define_enum_for</span><span class=\"mtk1\">(</span><span class=\"mtk4\">:recurring_interval</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        .</span><span class=\"mtk5\">with_values</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">year:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;year&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">month:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">week:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;week&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">day:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;day&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        ).</span><span class=\"mtk5\">backed_by_column_of_type</span><span class=\"mtk1\">(</span><span class=\"mtk4\">:string</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Note that if using MySQL, the test will pass with <code>.backed_by_column_of_type(:string)</code>, however, for PostgreSQL, use <code>.backed_by_column_of_type(:enum)</code>.</p>\n<aside class=\"markdown-aside\">\nFor the TDD purists in the crowd, of course you could write this test before adding the migration and enum macro to the model class, run the test, it will fail, then add the migration and update the model class, run the test again and it will pass. If you're interested in TDD, I've written about a few examples where its useful including <a class=\"markdown-link\" href=\"https://danielabaron.me/blog/tdd-by-example/\">Adding a New Feature</a> and <a class=\"markdown-link\" href=\"https://danielabaron.me/blog/tdd-by-example-bugfix/\">Fixing a Bug</a>.\n</aside>\n<h2 class=\"markdown-subtitle\" id=\"add-a-new-value\" style=\"position:relative;\"><a href=\"#add-a-new-value\" aria-label=\"add a new value permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Add a New Value</h2>\n<p class=\"markdown-para\">One last consideration with enums is future maintenance. What happens if a new value needs to be supported? In our Plans case, suppose there's a new business requirement to support \"fortnight\" (every two weeks) as a valid <code>recurring_interval</code>. This can be implemented with another migration. The new value should be added to the end of the list (for MySQL):</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"19\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">bin/rails generate migration ModifyRecurringIntervalForPlans</span></span></code></pre>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"20\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># MySQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">ModifyRecurringIntervalForPlans</span><span class=\"mtk5 mtki mtku\"> &lt; ActiveRecord::Migration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    execute </span><span class=\"mtk6\">&lt;&lt;-SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">        </span><span class=\"mtk7\">ALTER</span><span class=\"mtk6\"> </span><span class=\"mtk7\">TABLE</span><span class=\"mtk6\"> plans </span><span class=\"mtk7\">MODIFY</span><span class=\"mtk6\"> recurring_interval ENUM(&#39;year&#39;, &#39;month&#39;, &#39;week&#39;, &#39;day&#39;, &#39;fortnight&#39;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">    SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">down</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    change_column </span><span class=\"mtk4\">:plans</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:recurring_interval</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:string</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">PostgreSQL enum's can be modified through the use of <a href=\"https://www.postgresql.org/docs/14/sql-altertype.html\" class=\"markdown-link\">ALTER TYPE</a>, which supports specifying the position of the new enum value. There is no support for removing a value, therefore the catalog tables must be used for the <code>down</code> migration:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"21\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># PostgreSQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">ModifyRecurringIntervalForPlans</span><span class=\"mtk5 mtki mtku\"> &lt; ActiveRecord::Migration</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    execute </span><span class=\"mtk6\">&lt;&lt;-SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">        </span><span class=\"mtk7\">ALTER</span><span class=\"mtk6\"> </span><span class=\"mtk7\">TYPE</span><span class=\"mtk6\"> plan_recurring_interval ADD </span><span class=\"mtk7\">VALUE</span><span class=\"mtk6\"> &#39;fortnight&#39; </span><span class=\"mtk7\">AFTER</span><span class=\"mtk6\"> &#39;day&#39;;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">    SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">down</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    execute </span><span class=\"mtk6\">&lt;&lt;-SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">      </span><span class=\"mtk7\">DELETE</span><span class=\"mtk6\"> </span><span class=\"mtk7\">FROM</span><span class=\"mtk6\"> pg_enum </span><span class=\"mtk7\">WHERE</span><span class=\"mtk6\"> enumlabel </span><span class=\"mtk7\">=</span><span class=\"mtk6\"> &#39;fortnight&#39; </span><span class=\"mtk7\">AND</span><span class=\"mtk6\"> enumtypid </span><span class=\"mtk7\">=</span><span class=\"mtk6\"> (</span><span class=\"mtk7\">SELECT</span><span class=\"mtk6\"> </span><span class=\"mtk9 mtki\">oid</span><span class=\"mtk6\"> </span><span class=\"mtk7\">FROM</span><span class=\"mtk6\"> pg_type </span><span class=\"mtk7\">WHERE</span><span class=\"mtk6\"> typname </span><span class=\"mtk7\">=</span><span class=\"mtk6\"> &#39;plan_recurring_interval&#39;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">    SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">The model class must be modified to tell ActiveRecord that the new value should be considered valid:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"22\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># app/models/plan.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">Plan</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  enum </span><span class=\"mtk4\">recurring_interval:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">year:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;year&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">month:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;month&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">week:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;week&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">day:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;day&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">fortnight:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;fortnight&quot;</span><span class=\"mtk1\">   </span><span class=\"mtk3\"># new value</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">And of course, don't forget to maintain the test. This is left as an exercise for the reader!</p>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">This post has covered working with enums on a Rails project, backed by either a MySQL or PostgreSQL database. We've learned what enums are, why they're useful, how to achieve data integrity from both the database and application via ActiveRecord support, how to test, and maintain enum values. Here's another useful <a href=\"https://sipsandbits.com/2018/04/30/using-database-native-enums-with-rails/\" class=\"markdown-link\">blog post</a> on working with enums in Rails. Finally, if you're working with PostgreSQL and would prefer to stick with <code>db/schema.rb</code>, you might like to give the <a href=\"https://github.com/bibendi/activerecord-postgres_enum\" class=\"markdown-link\">activerecord-postgres_enum</a> gem a try. It enhances the Ruby migration DSL to support PostgreSQL enum types.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","timeToRead":9,"tableOfContents":"<ul>\n<li><a href=\"#database-migration\">Database Migration</a></li>\n<li><a href=\"#data-integrity\">Data Integrity</a></li>\n<li><a href=\"#model-validation\">Model Validation</a></li>\n<li><a href=\"#enum-methods\">Enum Methods</a></li>\n<li><a href=\"#enum-scopes\">Enum Scopes</a></li>\n<li><a href=\"#testing\">Testing</a></li>\n<li><a href=\"#add-a-new-value\">Add a New Value</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>","frontmatter":{"title":"Rails Enums with MySQL or Postgres","date":"01 May 2022","description":"Learn how to add enums to a Rails model backed by either MySQL or Postgres.","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/44e499371e6e83708de5e52b055c6d08/d730f/enum-jake-hills-0hgiQQEi4ic-unsplash.jpg","srcSet":"/static/44e499371e6e83708de5e52b055c6d08/b834a/enum-jake-hills-0hgiQQEi4ic-unsplash.jpg 225w,\n/static/44e499371e6e83708de5e52b055c6d08/21c52/enum-jake-hills-0hgiQQEi4ic-unsplash.jpg 450w,\n/static/44e499371e6e83708de5e52b055c6d08/d730f/enum-jake-hills-0hgiQQEi4ic-unsplash.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/44e499371e6e83708de5e52b055c6d08/71a10/enum-jake-hills-0hgiQQEi4ic-unsplash.webp 225w,\n/static/44e499371e6e83708de5e52b055c6d08/901f1/enum-jake-hills-0hgiQQEi4ic-unsplash.webp 450w,\n/static/44e499371e6e83708de5e52b055c6d08/5acd1/enum-jake-hills-0hgiQQEi4ic-unsplash.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":599}}}},"fields":{"slug":"/blog/rails-enum-mysql-postgres/"}},"relatedP":{"edges":[{"node":{"id":"848d2c81-d508-5776-ac83-fb1e50ef5848","frontmatter":{"title":"Fix Rails Blocked Host Error with Docker","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/648daf1a5b7bca42ff3729828586b2dc/26528/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.jpg","srcSet":"/static/648daf1a5b7bca42ff3729828586b2dc/26528/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.jpg 300w,\n/static/648daf1a5b7bca42ff3729828586b2dc/43429/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/648daf1a5b7bca42ff3729828586b2dc/5d6c3/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.webp 300w,\n/static/648daf1a5b7bca42ff3729828586b2dc/68dbc/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/rails-blocked-host-docker-fix/"}}},{"node":{"id":"d300ca38-a569-5f95-b2a5-0bf6c30486cc","frontmatter":{"title":"Use UUID for primary key with Rails and Postgres","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/30bb7a61cc87a3edc43f8af6d89fa013/26528/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.jpg","srcSet":"/static/30bb7a61cc87a3edc43f8af6d89fa013/26528/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.jpg 300w,\n/static/30bb7a61cc87a3edc43f8af6d89fa013/43429/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/30bb7a61cc87a3edc43f8af6d89fa013/5d6c3/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.webp 300w,\n/static/30bb7a61cc87a3edc43f8af6d89fa013/68dbc/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/rails-uuid-primary-key-postgres/"}}},{"node":{"id":"bb0af7b8-9d5f-597f-90cb-a4da75c3c9a9","frontmatter":{"title":"Roll Your Own Search with Rails and Postgres: Search Engine","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#d8c8a8","images":{"fallback":{"src":"/static/86310660995a38a9254ece85739c237f/26528/roll-search-3.jpg","srcSet":"/static/86310660995a38a9254ece85739c237f/26528/roll-search-3.jpg 300w,\n/static/86310660995a38a9254ece85739c237f/43429/roll-search-3.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/86310660995a38a9254ece85739c237f/5d6c3/roll-search-3.webp 300w,\n/static/86310660995a38a9254ece85739c237f/68dbc/roll-search-3.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/roll-your-own-search-service-for-gatsby-part3/"}}}]}},"pageContext":{"slug":"/blog/rails-enum-mysql-postgres/","relatedPosts":["Use UUID for primary key with Rails and Postgres","Fix Rails Blocked Host Error with Docker","Roll Your Own Search with Rails and Postgres: Search Engine"]}},"staticQueryHashes":["163244226"],"slicesMap":{}}