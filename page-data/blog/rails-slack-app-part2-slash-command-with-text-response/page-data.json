{"componentChunkName":"component---src-templates-post-js","path":"/blog/rails-slack-app-part2-slash-command-with-text-response/","result":{"data":{"markdownRemark":{"html":"<p class=\"markdown-para\">Welcome to the second installment of this multi-part series on building a Slack application with Rails. This series will guide you through the process of creating a Slack application with Rails and is structured as follows:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\"><a href=\"../rails-slack-app-part1-oauth\" class=\"markdown-link\">Part 1: Rails new, Slack, and OAuth</a></li>\n<li class=\"markdown-list-item\">Part 2: Slack Slash Command with Text Response === YOU ARE HERE ===</li>\n<li class=\"markdown-list-item\"><a href=\"../rails-slack-app-part3-slash-command-with-modal-response\" class=\"markdown-link\">Part 3: Slack Slash Command with Modal Response</a></li>\n<li class=\"markdown-list-item\"><a href=\"../rails-slack-app-part4-action-modal-submission\" class=\"markdown-link\">Part 4: Slack Action Modal Submission</a></li>\n<li class=\"markdown-list-item\"><a href=\"../rails-slack-app-part5-slash-block-kit-response\" class=\"markdown-link\">Part 5: Slack Slash Command with Block Kit Response</a></li>\n</ul>\n<p class=\"markdown-para\">Feel free to jump to a specific part of interest using the links above or follow along sequentially. You can also checkout the <a href=\"https://github.com/danielabar/retro-pulse\" class=\"markdown-link\">source code on Github</a> for the application we'll be building.</p>\n<p class=\"markdown-para\">This post assumes the reader has at least a beginner level familiarity with Ruby on Rails. It's also assumed the reader has used <a href=\"https://slack.com/\" class=\"markdown-link\">Slack</a> as an end user with basic interactions such as joining channels, sending messages, and participating in conversations.</p>\n<p class=\"markdown-para\">Part 1 of this series introduced <a href=\"../rails-slack-app-part1-oauth#introducing-retro-pulse\" class=\"markdown-link\">Retro Pulse</a>, a Slack app built with Rails for agile teams to manage their retrospectives with Slack. Part 2 (this post) will explain how to implement the Slack slash command to open a retrospective and return a markdown text response to the same Slack channel that initiated the request, confirming the retrospective has been opened.</p>\n<p class=\"markdown-para\">The interaction proceeds as follows:</p>\n<p class=\"markdown-para\">In a Slack workspace with the Retro Pulse app installed (<a href=\"../rails-slack-app-part1-oauth#run-the-oauth-flow\" class=\"markdown-link\">installation was covered in Part 1</a>), a user can enter a slash command <code>/retro-open</code>, followed by a project name:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6ElEQVR42p1Tya7UMBDMV7wh+zZOJnucOMksEhwQhychwRHBBXHhyv9fClXPZPR4hDlwKLXttnupLlt+mGKfV4IgVrC96L/g+LHAKuoe7z884/njJ/TDjJ0T3J3rxUcBVv8bNxRrZUWNqh3Q9COabkSnJ7TaoBtmNL1B2xs5r7tR1oM5Qo8zOm3QjwuOl7dyn925QXKtcJxP4uRlM5/FDhPPZmiziCXMcoYeF/TzBWU7SiFE3Q5gHD/aw0qzUg6zokHZaHEcylagDrWAPjmrOuHayVrYQYon2xOKVkjLjMrW6m5AqydEaY4n28fODYUXgns5c4IrV24A5xWP96FskUyQD/e2ZpIwyTYD/BUwTBSiNJMHXphKoJeTZUVsOc2K+yQfScf68fUzfn7/gt6cUDVaOOPESMVqmcQLE1mHsZLkd8RK7hES0Ewj5uOCqh2FR06b0uGkKRfy2w2T8MtJcziJKsBh0u6z8r4W2dheDD9SiPcH4YpWkOayfwlWxCofwWKLlAszkSvKgnaVDJHfJMRE6a2i1+B7+kWHbFFa05P8EPkpbHGYUTb9n5VvYO2AXVnqUAlf5I4gj6suyRcr/ldVSVYgjhSy8wner2/YXaarsBPFTPnm5LbAN6xo/VWq7RG/u8AvK/wGu+ixF+mMKOsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app demo retro open slash command\"\n        title=\"slack app demo retro open slash command\"\n        src=\"/static/eb61741b909993db2bd7f44225630fff/5a190/slack-app-demo-retro-open-slash-command.png\"\n        srcset=\"/static/eb61741b909993db2bd7f44225630fff/772e8/slack-app-demo-retro-open-slash-command.png 200w,\n/static/eb61741b909993db2bd7f44225630fff/e17e5/slack-app-demo-retro-open-slash-command.png 400w,\n/static/eb61741b909993db2bd7f44225630fff/5a190/slack-app-demo-retro-open-slash-command.png 800w,\n/static/eb61741b909993db2bd7f44225630fff/b4098/slack-app-demo-retro-open-slash-command.png 816w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">After hitting <kbd class=\"markdown-kbd\">Enter</kbd>, the app responds with a confirmation that the retrospective has been opened:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVR42oWQSU7EMBBFfYxukniIyy5P7YQQiXVLcAKEuP9JPrI77FBn8eTp15OrhJQzpCJoCjAUMGnCoCyuo+lcBg3iDG0Z11HjZTJPEXvd8fP1jfvHJ9a3d+TbihwDiAhkLRwRhknjMqguPENIw1i3HalUGIogTgghgg9CTDDEkMZBzf/zePMYlYVwIcPHG4hLX61PsFxgfYblDHfczS6e0sYiWji1NusrQl4eQp/6T1vIHLN9Rsu1mi5sh7JsyHVDzEuXcqp9/yc9w/oIF0pv+xce06uYhmoT8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app demo retro open success\"\n        title=\"slack app demo retro open success\"\n        src=\"/static/f500572bb4744e3ffa16963b8cb1df85/5a190/slack-app-demo-retro-open-success.png\"\n        srcset=\"/static/f500572bb4744e3ffa16963b8cb1df85/772e8/slack-app-demo-retro-open-success.png 200w,\n/static/f500572bb4744e3ffa16963b8cb1df85/e17e5/slack-app-demo-retro-open-success.png 400w,\n/static/f500572bb4744e3ffa16963b8cb1df85/5a190/slack-app-demo-retro-open-success.png 800w,\n/static/f500572bb4744e3ffa16963b8cb1df85/31aff/slack-app-demo-retro-open-success.png 823w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">In the Rails console <code>bin/rails c</code> of the Rails application backing the Slack app, the Retrospective has been created:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">Retrospective</span><span class=\"mtk1\">.</span><span class=\"mtk5\">last</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Retrospective Load (1.1ms)  SELECT &quot;retrospectives&quot;.* FROM &quot;retrospectives&quot; ORDER BY &quot;retrospectives&quot;.&quot;id&quot; DESC LIMIT $1  [[&quot;LIMIT&quot;, 1]]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># &lt;Retrospective:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#   id: 31,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#   title: &quot;Quantum Canvas Sprint 3&quot;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#   created_at: ...,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#   updated_at: ...,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#   status: &quot;open&quot;&gt;</span></span></span></code></pre>\n<h2 class=\"markdown-subtitle\" id=\"create-slash-command-in-slack\" style=\"position:relative;\"><a href=\"#create-slash-command-in-slack\" aria-label=\"create slash command in slack permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create Slash Command in Slack</h2>\n<p class=\"markdown-para\">The first step in implementing this is to navigate to <a href=\"https://api.slack.com/apps\" class=\"markdown-link\">Your Apps</a> on Slack, select the \"Retro Pulse\" app you created in <a href=\"../rails-slack-app-part1-oauth#create-slack-app\" class=\"markdown-link\">Part 1 of this series</a>, and then select \"Slash Commands\" from the Features section:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 249px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 247.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAyCAYAAABcfPsmAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGmUlEQVR42o1XSW9bVRT2n2DPHrGABRISsENCrBASgnUlEENFQYBUARKIBQiJDYgyttDQ0qpVR0BASNIkHhO/2PF7tmPHcZzE8ZQ4iafYfoOfP/Sd5DlOaqdxdHwHv3fud+75zndvXIZuQG/rsAwTlmmi3Wqj1WyJ9fedsd7Soe+3HMtcW4fjx8UvXdexXa1ha6eCLrpwPv19fizLgmEaME0ThmHAtjuwbRvt9oFTV8eyUCiV8emrp/D522cQXUhC01SkUinkC3lE1AiSi0mkllLQDV0c211b2mqtikq1gk6nI0h7DkulTbzz+hmcffdDJBJJ+Pw+BINBxONxaFFN+j6fD7V67ZDDYqkoi3Lcc+iEXN6uoLy1IyEcBDwgZOMg5G7XlmcOhex0Dn26QNfuyryTDGfz+82ZN9rGQVKY3cpOFaOjY3C7vbh9+y6mptxQlDkUixswDBPNZhutlj7U2v1ZZqdr6lB8bvin7omN/f0nbl69jMZ2eR+yvQdb2gHWsQ5CJsL42hamExvwpcoILNG24EluYCpewLiaxYS2jnF1HVOxHHyJArwLeTH2p2M5LBcq6BjmHkJ6f+GrMTx+9hae/PgOHj59FY+8fwPPfPIHHv3gBh47ewtPf/InnvjoLh567Xe4XvwJrpd+3rOXz8P1/Dm8/rNXkDJ8FywLn90M49QPbrx3aRanfvTitfN+vPWLH29c8OP0r368ed4j9srXE3j283/w3Bf/ij3/5Sie+vQvfDcaA2xyUYfLJNRWC2vZHJbSGWSWM8hkVpDPF5HJrCKbzaFe35XVuUe2ZcI277deUuiwUd9FeimN+fA85pQ5sVRyEaG5EBLxBdRrNal1ocoR6vSbJIVf5FKj3thbZX9MKvEh8tBZXX+Asx5tmrtNBGeDCPgDmAnMIDIfwezMLDxuD3xeH3YbuzD3EfL548zleD5aCawUB2E/gv52oEOuXK/VEQ6F4ff54fV4ZS8n700itZhCx+oMLL1hjnsIGTYdcy/5crFQlD4LxO7YgpjG/nEo97PcQGIhgcXkIpbTy9KuZ9cFNfuaqsnv8VhcfnekaihCoiP/kokkolpUQs7n8liIL8g8Q+dvbDk+NmROEuWwT3+4JwrZMi1UK1WhzNrqmqDKrmUltFKxBIenRxMzFCEd7mzvYPTfUfw2MoLLly7j1s1bGLk4gumpaUHUf7I9kIfHhtzFiR0dSgrJy2xyw1cyK1LXNCbGqZCTkPqQQ2aQ5cf9o/NYNIbVlVUJmU5P4uyQOHAfWbPkJGnEPpO1Vd5CZadyH/f6UQ8kNiWLgkAORubnRSTUiIqpySkowaA8c5Lwe6XHmmWfWeeLjjgQrZO4/heHIe2JAxFSULmPlCwlqAjKifEJuKfdMqacEbWjQIOc7t0cWnsyxbCcfeT+cc4RDUc4OGY0TNYgp66O3UHLaCEajSIWjSKTychFiYLATHOcTqehqipisRgSiYSM2Zq2CavvTBaHtWIV2jUV/gs+jH87BvdP05j+YVLaye/vwXfBi5mLAXjPe/DfN6O4d25Cnps4Ny7v8X3TOlBzl3o5gpyWw3JyGSvJFWSXssgt57CWWuvZ6uIKMolltKtt6DUd7UobZtNEKVqEdlXtoRSE2hUVeTWHSDACz5gH8VAcyUgSQXcQkZkIwv4QFI+C2elZbOe3Ud+so1aqYndnFwU1j+g1DZbd57BRbgj02QszstrcxaD049diCP82h9CIgti1KOLXY4he1aBdichzbGPXo6iX64dDljtf10BIDSEwF4AyryAYDiKshZFeTSOgBOAP+rFeXBe96KADe/+Pd0PeFe+/Yzd1tHll223JXY/9ZqOJVqMJUzdlni2tY3RgtPaeod1HG4fYJDRLj0JL8lJo2WcpkvAkNlsWwEZpQypq6BHADgldq9ZECByCk9jOeHtruycWBDDs4BeEdMQTjRpI6eeBRIQ86aiRJDjHS6kllDfLUilDzxTn1Mut53qiSnNElscpHVF46ZzhHlWdgQLLlYmUYdF5IV+QcJ0wNzc2ZXxUbQaGzP3SVBVziiIoWMdUcF6amBRJWCCAkKIc0sWhh5SDkgrClgs4W8GXaS3DQqNtos1/ISRc43iEpAgvSERHPeSYau33+bBTqWIyuYE74Sw2ai1YhvFghDTuIflF45iLyVnC/1Wo3iT9A06/HrFJWmaTtCGF2HcuT0wGr8TGSe6Hzl4xCXRAyjAx7HOOxhPxpOdzL2TnMuTIe/8F6aTXYTr8H0nyhFd402zRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app feature slash\"\n        title=\"slack app feature slash\"\n        src=\"/static/24f495ea8719540544c9138d6c4729db/6a5fb/slack-app-feature-slash.png\"\n        srcset=\"/static/24f495ea8719540544c9138d6c4729db/772e8/slack-app-feature-slash.png 200w,\n/static/24f495ea8719540544c9138d6c4729db/6a5fb/slack-app-feature-slash.png 249w\"\n        sizes=\"(max-width: 249px) 100vw, 249px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">Then click on the \"Create New Command\" button, and fill in the form as follows:</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Command:</strong> <code>/retro-open</code>. This is what the user will type into a Slack message to initiate an interaction with the Retro Pulse Rails app.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Request URL:</strong> For example: <code>https://12e4-203-0-113-42.ngrok-free.app/api/slack/command</code>. This is where Slack will send an HTTP POST request when the user submits this slash command from Slack. The hostname is your ngrok forwarding address that you got from starting <a href=\"../rails-slack-app-part1-oauth#ngrok\" class=\"markdown-link\">ngrok in part 1 of this series</a>. The route <code>/api/slack/command</code> is defined in the <code>slack-ruby-bot-server</code> gem that we included as part of our <a href=\"../rails-slack-app-part1-oauth#create-rails-app\" class=\"markdown-link\">Rails app in part 1 of this series</a>.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Short Description:</strong> <code>Open a new retrospective for comments</code>. This will be displayed as the user types in the slash command.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Usage Hint:</strong> <code>title</code>. Since this particular slash command requires a parameter, which will be used to create the retrospective, the usage hint is also shown to the user as they type in the slash command.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Escape Channels:</strong> Leave this unchecked. Turning this on will modify the parameters sent with a command by a user such as wrapping URLs in angle brackets and translating channel or user mentions into their correlated IDs. It's not necessary for this app. See the Slack <a href=\"https://api.slack.com/interactivity/slash-commands\" class=\"markdown-link\">documentation</a> if your app needs this option.</p>\n<p class=\"markdown-para\">The filled out form will look something like this:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 623px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAAsTAAALEwEAmpwYAAACmklEQVR42oVVi5KiMBD0//9tz72tWnG1an0LAvJWkgDOVo9MNoB1F6srCYTOPHrG2YOGv+7REYYf+PT2540+Pv7S/H1O3tLjeT6f08Jb8Dk5734/a7uWGG1DTdvwuutaqlVNeZFTWZZUViVVt4qKsmBgLefaEWa4QazCwC14gVn2MstZvDeNsWDy/t1MCOI4prN/ZgseDnGSJhTHEV2TK2mj2QuQNL1HWKdZymt2WWJwu98oyzMyxlhrQIjncB0XCYkLEOKMeGUtxEOllf1Qnld9/BBHIRZgj1jf6/uU0Pd9Op1PPONWDA7FNaYoiigMQ4riiJIkYffDKKQgCKxnE5flh9H1QQYh4jYGPJE1LMQ8sfB4OtJuv+N5u9vyIbz73nzTavVl4XkLWi49Wq9XtFqv6HPxyRaLYTNXDkKutba6ggVwC3G08+1m1wDOTAgRK8QE8WC3e5chG7goe5kF2EMZNoZCCC1drzHfKLfhEPSJDEs2Aaxlr5Sy+hwk5dXAO7g2dtGVkWvAoFJcbXG9Qn9VRVmW8ccASPEOFrlDym+Q5cPxQJvthjO8P+x5D+2hHINLQJfwwjrEviwL64GEZkDIgW0MB59va1s+9K8hynAVMnAZ2RQg4wCsQkW4WXY7yytSayHEiRIDIUi41KKIiUXksLztXsMSysJoTXmWU5ZmVOTPGUiTlMJLyLNWmup7Tap2ofhZO9Yh9ISsokOzTHpwpy6KZzV03dNKF2i2Y2E/ekLEDBmFRCYNo0/csB8a6/KkUhAnSAJyQRt7du7fvwNUBVpXUeSsTcQcKJ3GOyTsW5JhGG4QStVsOZcXJIWWpbVzTvfn1K8OJSlSn2gOcBsixq3jZvAquy8tlP8HaaBAg5g1zX+B70Q2P8K/mgDkI57EAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack create new command\"\n        title=\"slack create new command\"\n        src=\"/static/7a21d4eaf611063470c5f7bf74f823c9/6114d/slack-create-new-command.png\"\n        srcset=\"/static/7a21d4eaf611063470c5f7bf74f823c9/772e8/slack-create-new-command.png 200w,\n/static/7a21d4eaf611063470c5f7bf74f823c9/e17e5/slack-create-new-command.png 400w,\n/static/7a21d4eaf611063470c5f7bf74f823c9/6114d/slack-create-new-command.png 623w\"\n        sizes=\"(max-width: 623px) 100vw, 623px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">Click the \"Save\" button, which at the time of this writing, appears all the way at the bottom right-hand corner of the screen.</p>\n<h2 class=\"markdown-subtitle\" id=\"receive-slash-command-in-rails\" style=\"position:relative;\"><a href=\"#receive-slash-command-in-rails\" aria-label=\"receive slash command in rails permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Receive Slash Command in Rails</h2>\n<p class=\"markdown-para\">The next step is to update the Rails app to handle the HTTP POST to <code>/api/slack/command</code> that Slack will send whenever a user submits the <code>/retro-pulse something</code> Slash command. Recall that we're using the <a href=\"https://github.com/slack-ruby/slack-ruby-bot-server-events\" class=\"markdown-link\">slack-ruby-bot-server-events</a> gem, which takes care of a lot of the boilerplate including providing a controller to parse the body, and logic to verify the <code>X-Slack-Signature</code> HTTP header.</p>\n<p class=\"markdown-para\">Start by creating a <code>bot</code> directory in the root of the Rails project as shown below. The <code>bot</code> directory is a sibling to the Rails <code>app</code> directory:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># from root of Rails project</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">mkdir bot</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">touch bot/slash_commands.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">mkdir bot/slash_commands</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">touch bot/slash_commands/retro_open.rb</span></span></span></code></pre>\n<p class=\"markdown-para\">You should have the following structure:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">.</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">├── app</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">└── bot</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    ├── slash_commands</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    │   └── retro_open.rb</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    └── slash_commands.rb</span></span></code></pre>\n<p class=\"markdown-para\">Add the following in <code>bot/slash_commands.rb</code> to load all the slash commands, there's only one for now:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require_relative</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;slash_commands/retro_open&quot;</span></span></span></code></pre>\n<p class=\"markdown-para\">Fill in the implementation for the retro open command handler. For now, it will only log out the text it received, as well as the team name and Slack channel ID the command was called from. The team will be fetched by the <code>team_id</code> that is available from the <code>command</code> object exposed by the <code>slack-ruby-bot-server-events</code> gem. The <code>channel_id</code> and <code>text</code> are also available from the <code>command</code> object. The Team model got populated in Part 1 of this series when we ran the <a href=\"../rails-slack-app-part1-oauth#run-the-oauth-flow\" class=\"markdown-link\">OAuth flow to add this app to a Slack workspace</a>.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands/retro_open.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">SlackRubyBotServer</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Events</span><span class=\"mtk1\">.</span><span class=\"mtk5\">configure</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Essentially this is saying to the SlackRubyBotServer,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># If a &quot;/retro-open&quot; slash command is received from Slack,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># then execute this block.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">on</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:command</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;/retro-open&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |command|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    team </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Team</span><span class=\"mtk1\">.</span><span class=\"mtk5\">find_by</span><span class=\"mtk1\">(</span><span class=\"mtk4\">team_id:</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:team_id</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    channel_id </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:channel_id</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># If user entered /retro-open foo</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># in Slack, then command_text will be: foo</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command_text </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:text</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command.</span><span class=\"mtk5\">logger</span><span class=\"mtk1\">.</span><span class=\"mtk5\">info</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;=== COMMAND: retro-open, Team: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">team.</span><span class=\"mtk5\">name</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Channel: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">channel_id</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Title: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">command_text</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Return `nil`, otherwise the slack-ruby-bot-server-events gem</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># replies to the channel with a message &quot;true&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">nil</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Then update <code>config.ru</code> file in the root of the Rails app to load the command handlers in the <code>bot</code> directory. This will ensure the the Slack bot code is loaded when Rails starts:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># This file is used by Rack-based servers to start the application.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require_relative</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;config/environment&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># === ADD THIS LINE TO LOAD THE SLASH COMMAND HANDLERS ===</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require_relative</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;bot/slash_commands&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># We added this line previously in Part 1 of this series:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">SlackRubyBotServer</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">App</span><span class=\"mtk1\">.</span><span class=\"mtk5\">instance</span><span class=\"mtk1\">.</span><span class=\"mtk5\">prepare!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">run </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">application</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">application</span><span class=\"mtk1\">.</span><span class=\"mtk5\">load_server</span></span></span></code></pre>\n<p class=\"markdown-para\">Now we're ready to see this in action. Start the Rails server with <code>bin/dev</code>. Then go to your Slack app, and enter the following in any channel:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"># Enter whatever title text you want after the slash command</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">/retro-open My Project Sprint 1</span></span></code></pre>\n<p class=\"markdown-para\">After hitting <kbd class=\"markdown-kbd\">Enter</kbd> in Slack to submit the slash command, the Rails server output will show that the HTTP POST to <code>/api/slack/command</code> has been received and processed. Notice it runs a SQL SELECT to find the team, this is as a result of <code>Team.find_by(team_id: command[:team_id])</code> in the command handler:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Started POST &quot;/api/slack/command&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  Team Load (2.1ms)  SELECT &quot;teams&quot;.* FROM &quot;teams&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    WHERE &quot;teams&quot;.&quot;team_id&quot; = $1 LIMIT $2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    [[&quot;team_id&quot;, &quot;the-team-id-from-slack&quot;], [&quot;LIMIT&quot;, 1]]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">I, INFO -- : === COMMAND: retro-open,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  Team: YourTeamName,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  Channel: the-channel-from-slack,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  Title: My Project Sprint 1</span></span></code></pre>\n<p class=\"markdown-para\">The <code>Title</code> displayed in the logger INFO should match whatever you typed in as the text following <code>/retro-open</code> in Slack.</p>\n<p class=\"markdown-para\">You may be wondering how it is that the code we wrote in <code>bot/slash_commands/retro_open.rb</code> is being executed when the HTTP POST is received. This is where the combined functionality of the <a href=\"https://github.com/slack-ruby/slack-ruby-bot-server\" class=\"markdown-link\">slack-ruby-bot-server</a> and <a href=\"https://github.com/slack-ruby/slack-ruby-bot-server-events\" class=\"markdown-link\">slack-ruby-bot-server-events</a> gems comes into play.</p>\n<p class=\"markdown-para\">When we specified <code>config.on</code> in the <code>SlackRubyBotServer::Events.configure</code> block, this added the handler as a <a href=\"https://github.com/slack-ruby/slack-ruby-bot-server-events?tab=readme-ov-file#implement-callbacks\" class=\"markdown-link\">callback</a>. Then, the endpoint provided by the <code>slack-ruby-bot-server</code> gem, which handles the HTTP POST for <code>/api/slack/command</code>, parses out the specific command name and executes all callbacks that are registered for that command. This integration between the two gems allows for the automatic execution of the appropriate code when Slack sends a request to our Rails application's endpoint.</p>\n<h2 class=\"markdown-subtitle\" id=\"inspect-request\" style=\"position:relative;\"><a href=\"#inspect-request\" aria-label=\"inspect request permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Inspect Request</h2>\n<p class=\"markdown-para\">One thing that can seem a little \"magical\" at this point, is that we didn't write a Rails controller to handle the <code>/api/slack/command</code> HTTP Request. This is being handled by the <code>slack-ruby-bot-server-events</code> gem. Unlike Rails controllers that we write, it doesn't log out the parameters it was called with. However, we can still view the entire HTTP POST request and body using <a href=\"../rails-slack-app-part1-oauth#ngrok\" class=\"markdown-link\">ngrok</a>.</p>\n<p class=\"markdown-para\">In the terminal tab where ngrok is running, it includes an address for the Web Interface:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">ngrok http 3000</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Output will look something like this, your details will vary:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Region                        United States (us)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Latency                       35ms</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Web Interface                 http://127.0.0.1:4040</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Forwarding                    https://12e4-203-0-113-42.ngrok-free.app -&gt; http://localhost:3000</span></span></span></code></pre>\n<p class=\"markdown-para\">Enter <code>http://127.0.0.1:4040</code> in a browser. This will allow you to inspect all HTTP requests that were received by ngrok and the corresponding HTTP responses that were sent by the Rails app. At this point, you should have one request for <code>POST /api/slack/command</code>. It will look something like this. Your specific Slack details will vary:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSElEQVR42pWTX0vDMBTF+/1fJ2zCKqybLdT5NcoE3wRfBF/0wTZb0rXN1j9JjpyMgihiTTncmzb5NedeEqyiFcIwRHqXIo5jcL7erJGmKeIkxnw+R5ZlaHQDqSRUqXCQB9RNDWsNHBwMo2kB2yPY3m+RJImHLcMlZlczLK4X2NxuEEURwpsQu4cdymOJQhT4KArspUQuBNq+A+AwWIPsReDpTSHAxKGUhCwVykajajROXQ/rnAf2xuDxdY/nd4WgH3r8pcEMyIvc26S9Y3WEPjU+5zfGcQQOvz/WWS/mtOvr5hzEXnixpqwnfzAYA2PtdCAB3Nx2Laq6+uGCp+TayUA2hSBu5EkpfdLQWvs4GThGAs/t2ee0SjjzETRqMpB1GgFCCD//7mQycKxh13cXIJsiLk35avdfQN4UAvmOeV3X/pQUmzKu/wTW30pRn6e8EwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack ngrok inspect\"\n        title=\"slack ngrok inspect\"\n        src=\"/static/c74062702d2d14c99ec745eba6209d78/5a190/slack-ngrok-inspect.png\"\n        srcset=\"/static/c74062702d2d14c99ec745eba6209d78/772e8/slack-ngrok-inspect.png 200w,\n/static/c74062702d2d14c99ec745eba6209d78/e17e5/slack-ngrok-inspect.png 400w,\n/static/c74062702d2d14c99ec745eba6209d78/5a190/slack-ngrok-inspect.png 800w,\n/static/c74062702d2d14c99ec745eba6209d78/c1b63/slack-ngrok-inspect.png 1200w,\n/static/c74062702d2d14c99ec745eba6209d78/8733b/slack-ngrok-inspect.png 1495w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">This shows all the form parameters that Slack sent in the HTTP <code>POST /api/slack/command</code>. Notice these include <code>team_id</code> and <code>channel_id</code>. These get parsed out by the <code>slack-ruby-bot-server-events</code> gem and are available on the <code>command</code> object in the block of the slash command handler.</p>\n<p class=\"markdown-para\">You can also view the HTTP headers. These include the <code>X-Slack-Request-Timestamp</code> and <code>X-Slack-Signature</code> headers that are verified by the <code>slack-ruby-bot-server-events</code> gem. If you weren't using a gem for this, you'd have to write this verification code yourself:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkUlEQVR42o1SPW/bMBDVX/eUeEsRZU+XdPHiIVYGdUzXomgKdOkHEtS2JOqDlERK/PAL7mKpSdEAOeKBvCP59B510Xq9xmq1QvoxRXKT4HpzjSRJkKYpNpsNrj5c4e7bHXrdQyqJtmtRNzXnh+Nw3sGNPYIfEV2+v0Qcx4gvYiyXSywWC5ycnuA8PsfZuzOu3X66hVQKu/0O290WuSiQ5TkTgQhDwJf7Gr+KFhHeGGWjMFgLYzQG59API6xzOCBgdA7p1y0+/y4RWWfxHKMd8W+NlFRVCW00WwyHgLquOKc1YYqIkunQa6D9qq5QViXnPnh+Q5oJVHPBM6KJjOYpDs8GjvuFKNgu1YhElAJ5kSPLM/4YuaBzs0JvPaqfLZqHHta4JwwezgZ457HP93xxUkhqpZSMRjZMSDx/CZ2H2mrIPxqdMOjLAc1Di+J7BSNHJsuybCak9jGD4XekeVb4P8s4rqnWiw7lDwFRCLanWsWE1JPDODz14JHsheXXfgiFNRZKKchWzpe11uj6blY48TwCep/5XNwVx+4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack ngrok inspect headers\"\n        title=\"slack ngrok inspect headers\"\n        src=\"/static/4ae64e41c8983bec6c3fc5d7033360be/5a190/slack-ngrok-inspect-headers.png\"\n        srcset=\"/static/4ae64e41c8983bec6c3fc5d7033360be/772e8/slack-ngrok-inspect-headers.png 200w,\n/static/4ae64e41c8983bec6c3fc5d7033360be/e17e5/slack-ngrok-inspect-headers.png 400w,\n/static/4ae64e41c8983bec6c3fc5d7033360be/5a190/slack-ngrok-inspect-headers.png 800w,\n/static/4ae64e41c8983bec6c3fc5d7033360be/c1b63/slack-ngrok-inspect-headers.png 1200w,\n/static/4ae64e41c8983bec6c3fc5d7033360be/7e881/slack-ngrok-inspect-headers.png 1521w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 class=\"markdown-subtitle\" id=\"implement-slash-command\" style=\"position:relative;\"><a href=\"#implement-slash-command\" aria-label=\"implement slash command permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Implement Slash Command</h2>\n<p class=\"markdown-para\">Now that we can see the communication between Slack and Rails working, the <code>/retro-open</code> slash command handler can be enhanced to do the real work of opening a new retrospective, with the title populated from the slash command text.</p>\n<p class=\"markdown-para\">In order to create a Retrospective, we need to first define a database table to persist <code>retrospectives</code> with migrations, and a <code>Retrospective</code> model. A retrospective must have a unique title (eg: \"Some Project Sprint 3\"), a status (either <code>open</code> or <code>closed</code>), and there should only be one open retrospective at a time.</p>\n<p class=\"markdown-para\">Here is the migration to create a <code>retrospectives</code> table with a required and unique <code>title</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">CreateRetrospectives</span><span class=\"mtk5 mtki mtku\"> &lt; ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">7.0</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">change</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    create_table </span><span class=\"mtk4\">:retrospectives</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |t|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.</span><span class=\"mtk5\">string</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:title</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      t.</span><span class=\"mtk5\">timestamps</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    add_index </span><span class=\"mtk4\">:retrospectives</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:title</span><span class=\"mtk1\">, </span><span class=\"mtk4\">unique:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Here is the migration to add a <code>status</code> column to the <code>retrospectives</code> table, implemented as a PostgreSQL <a href=\"../rails-enum-mysql-postgres\" class=\"markdown-link\">enum type</a> to restrict it to only values <code>open</code> and <code>closed</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">AddStatusToRetrospectives</span><span class=\"mtk5 mtki mtku\"> &lt; ActiveRecord::Migration</span><span class=\"mtk1\">[</span><span class=\"mtk4\">7.0</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">up</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    execute </span><span class=\"mtk6\">&lt;&lt;-SQL.squish</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">      </span><span class=\"mtk7\">CREATE</span><span class=\"mtk6\"> </span><span class=\"mtk7\">TYPE</span><span class=\"mtk6\"> </span><span class=\"mtk5\">retrospective_status</span><span class=\"mtk6\"> </span><span class=\"mtk7\">AS</span><span class=\"mtk6\"> ENUM (&#39;open&#39;, &#39;closed&#39;);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">    SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    add_column </span><span class=\"mtk4\">:retrospectives</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:status</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:retrospective_status</span><span class=\"mtk1\">, </span><span class=\"mtk4\">default:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;open&quot;</span><span class=\"mtk1\">, </span><span class=\"mtk4\">null:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">false</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">down</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    remove_column </span><span class=\"mtk4\">:retrospectives</span><span class=\"mtk1\">, </span><span class=\"mtk4\">:status</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    execute </span><span class=\"mtk6\">&lt;&lt;-SQL.squish</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">      </span><span class=\"mtk7\">DROP</span><span class=\"mtk6\"> </span><span class=\"mtk7\">TYPE</span><span class=\"mtk6\"> retrospective_status;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk6\">    SQL</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Here is the <code>Retrospective</code> model with <a href=\"https://github.com/ctran/annotate_models\" class=\"markdown-link\">schema annotations</a> and validations:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># == Schema Information</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Table name: retrospectives</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  id         :bigint           not null, primary key</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  status     :enum             default(&quot;open&quot;), not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  title      :string           not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  created_at :datetime         not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  updated_at :datetime         not null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># Indexes</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#  index_retrospectives_on_title  (title) UNIQUE</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">Retrospective</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  enum </span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">open:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;open&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">closed:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;closed&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:title</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">, </span><span class=\"mtk4\">uniqueness:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validates </span><span class=\"mtk4\">:status</span><span class=\"mtk1\">, </span><span class=\"mtk4\">presence:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  validate </span><span class=\"mtk4\">:only_one_open_retrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">private</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">only_one_open_retrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> </span><span class=\"mtk7\">unless</span><span class=\"mtk1\"> open? </span><span class=\"mtk7\">&amp;&amp;</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Retrospective</span><span class=\"mtk1\">.</span><span class=\"mtk5\">exists?</span><span class=\"mtk1\">(</span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;open&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    errors.</span><span class=\"mtk5\">add</span><span class=\"mtk1\">(</span><span class=\"mtk4\">:status</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;There can only be one open retrospective at a time.&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Now let's return our attention to the <code>retro_open.rb</code> slash command handler. After it has extracted the command text, which is to be the title of the retrospective, it needs to create a new retrospective. If the new retrospective can be successfully saved, then it should post a success message back to the channel from which it was called. Otherwise, it should post an error message.</p>\n<p class=\"markdown-para\">To post messages to Slack, we'll use an instance of <code>Slack::Web::Client</code>, instantiating it with the team's token, that got persisted earlier in the OAuth flow. The <a href=\"https://github.com/slack-ruby/slack-ruby-client?tab=readme-ov-file#web-client\" class=\"markdown-link\">Slack web client</a> is provided from the <code>slack-ruby-client</code> gem that is included with this project. Note that emoji's and markdown can be included in the message sent back to Slack.</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands/retro_open.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">SlackRubyBotServer</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Events</span><span class=\"mtk1\">.</span><span class=\"mtk5\">configure</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Essentially this is saying to the SlackRubyBotServer,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># If a &quot;/retro-open&quot; slash command is received from Slack,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># then execute this block.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">on</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:command</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;/retro-open&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |command|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Use `command[:team_id]` from request parameters sent to us</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># by Slack to find the Team model persisted in the database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    team </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Team</span><span class=\"mtk1\">.</span><span class=\"mtk5\">find_by</span><span class=\"mtk1\">(</span><span class=\"mtk4\">team_id:</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:team_id</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># This is the Slack channel we need to respond back to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    channel_id </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:channel_id</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># If user entered /retro-open foo</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># in Slack, then command_text will be: foo</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command_text </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:text</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command.</span><span class=\"mtk5\">logger</span><span class=\"mtk1\">.</span><span class=\"mtk5\">info</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;=== COMMAND: retro-open, Team: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">team.</span><span class=\"mtk5\">name</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Channel: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">channel_id</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Title: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">command_text</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Instantiate a slack client with the team token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># so we can communicate back to the channel</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    slack_client </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Slack</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Web</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Client</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">token:</span><span class=\"mtk1\"> team.</span><span class=\"mtk5\">token</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Create a new retrospective with title from Slack</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Status will default to `open`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    retrospective </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Retrospective</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">title:</span><span class=\"mtk1\"> command_text)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Try to save it</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> retrospective.</span><span class=\"mtk5\">save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If save worked, post a success message to the channel</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      slack_client.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> channel_id,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">mrkdwn:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:memo: Opened retro `</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">retrospective.</span><span class=\"mtk5\">title</span><span class=\"mtk7\">}</span><span class=\"mtk6\">`&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">else</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># If save failed, post the error messages from the model</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      slack_client.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> channel_id,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">mrkdwn:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:warning: Could not create retro `</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">command_text</span><span class=\"mtk7\">}</span><span class=\"mtk6\">`, error: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">retrospective.</span><span class=\"mtk5\">errors</span><span class=\"mtk1\">.</span><span class=\"mtk5\">full_messages</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Return `nil`, otherwise the slack-ruby-bot-server-events gem</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># replies to the channel with a message &quot;true&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">nil</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<aside class=\"markdown-aside\">\nThe `chat_postMessage` method is just one of many Web API methods offered by Slack. If you're curious to explore more functionalities, check out the comprehensive <a class=\"markdown-link\" href=\"https://api.slack.com/methods\">Slack API documentation</a> for a complete list.\n</aside>\n<p class=\"markdown-para\">Restart the Rails server <code>bin/dev</code> after making these changes. Now you should be able to enter something like <code>/retro-open My Project Sprint 1</code> in the Slack workspace and have the app respond with a success message:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.499999999999996%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABG0lEQVR42mXPy07CUBDG8T6EQOmN9rRQ7QFKOfQC5SIooMYdezHGrQ9gXPgaLnwOH8AX+xuKwYWLX2YmmXyZ0WqGg2620A2Hum5Vag2Ls7pBo2mfGJZ72muaLUzb++ewo2XdAaGIiLoJKs3pD0YU4xmzxQrZSxiqnERluF6bdijphBJXdDCsFqblViHmryrw4+WZx/WG+eqO17d3rq5vGJcLtrf3TKaLKrA/UIjgHNkfEicpfkeimx6mIypNW2DYAssRaLvdHqVWPOyf+P76pMgnFOWcrJiSqJy8mFKUl6RJzFyFZHFIObxgXUjSOGKmJMtMUg4jRrFEMyyB3mzR6w/YbpZ4flhdc3B47cQLaAdBVQP/r/f9I08c5x+b2JfeOzISXwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app retro open success\"\n        title=\"slack app retro open success\"\n        src=\"/static/0d78f06f066b0610acaa85108027a208/5a190/slack-app-retro-open-success.png\"\n        srcset=\"/static/0d78f06f066b0610acaa85108027a208/772e8/slack-app-retro-open-success.png 200w,\n/static/0d78f06f066b0610acaa85108027a208/e17e5/slack-app-retro-open-success.png 400w,\n/static/0d78f06f066b0610acaa85108027a208/5a190/slack-app-retro-open-success.png 800w,\n/static/0d78f06f066b0610acaa85108027a208/b4098/slack-app-retro-open-success.png 816w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">The Rails server output shows that a new record is inserted in the <code>retrospectives</code> table:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Retrospective Create (3.1ms)  INSERT INTO &quot;retrospectives&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  (&quot;title&quot;, &quot;created_at&quot;, &quot;updated_at&quot;, &quot;status&quot;)</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  VALUES ($1, $2, $3, $4) RETURNING &quot;id&quot;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  [</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    [&quot;title&quot;, &quot;My Project Sprint 1&quot;],</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    [&quot;created_at&quot;, &quot;2024-01-03 14:10:19.285310&quot;],</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    [&quot;updated_at&quot;, &quot;2024-01-03 14:10:19.285310&quot;],</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">    [&quot;status&quot;, &quot;open&quot;]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">  ]</span></span></code></pre>\n<p class=\"markdown-para\">If you try to open another retrospective, for example <code>/retro-open My Project Sprint 2</code>, then an error message should be posted back to Slack with an explanation of why the retrospective could not be created:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwklEQVR42o3P0UrDMBSH8T7GtnZN2iYnbZqla92sQ2RSVKYivv/TfGIGeiV48fHj3Bz4Z6MfeDkvPJwfuTmeCLuRtusxRlC6QuuaoqzIt/8r613k/fLJ5fWNuD+kh75t8U5wYhErFGXNKtesc8Vqo/6wZFNosmOc+VjueH665XS/MB1m9tNM5yPOGjqxKSeCEY/rdrguJK3rk9Je3aqGbF00WCdM04APIz4MhDjRmDbNraomqXRNqQ2qsj/93le/l3wBmsV0IddLxZwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app retro open fail\"\n        title=\"slack app retro open fail\"\n        src=\"/static/2b69acab93c6d959a5abcffa6e993263/5a190/slack-app-retro-open-fail.png\"\n        srcset=\"/static/2b69acab93c6d959a5abcffa6e993263/772e8/slack-app-retro-open-fail.png 200w,\n/static/2b69acab93c6d959a5abcffa6e993263/e17e5/slack-app-retro-open-fail.png 400w,\n/static/2b69acab93c6d959a5abcffa6e993263/5a190/slack-app-retro-open-fail.png 800w,\n/static/2b69acab93c6d959a5abcffa6e993263/c1b63/slack-app-retro-open-fail.png 1200w,\n/static/2b69acab93c6d959a5abcffa6e993263/29007/slack-app-retro-open-fail.png 1600w,\n/static/2b69acab93c6d959a5abcffa6e993263/e7aec/slack-app-retro-open-fail.png 1726w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h2 class=\"markdown-subtitle\" id=\"refactor\" style=\"position:relative;\"><a href=\"#refactor\" aria-label=\"refactor permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Refactor</h2>\n<p class=\"markdown-para\">While the <code>retro_open.rb</code> slash command handler works, there are some issues to consider:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\">The code is getting long and difficult to read.</li>\n<li class=\"markdown-list-item\">It might be a good idea to sanitize the title text from the user before saving it to the database, although adding this will make the code even longer.</li>\n<li class=\"markdown-list-item\">There's some code duplication in the multiple calls to <code>slack_client.chat_postMessage(...)</code> where the only thing that varies is the message text.</li>\n<li class=\"markdown-list-item\">There's no way to test all this logic in an automated fashion, and this problem will compound over time as more requirements are added and the logic grows in complexity.</li>\n</ul>\n<p class=\"markdown-para\">Comparing the command handler framework provided by the <code>slack-ruby-bot-server-events</code> gem to a Rails controller, what we have here is the same problem that can affect any Rails application: Where to put the <a href=\"https://en.wikipedia.org/wiki/Business_logic\" class=\"markdown-link\">business logic</a>?</p>\n<p class=\"markdown-para\">In the case of a Slack application, the command handlers can be thought of as a type of \"Slack controller\". We would like to have these only focused on extracting the necessary data from the Slack command, and then have the business logic live somewhere else, where it's easier to test.</p>\n<p class=\"markdown-para\">There are a number of different options for organizing business logic in Rails applications:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\">Leave it in the controller and test it with <a href=\"https://rspec.info/features/6-0/rspec-rails/request-specs/request-spec/\" class=\"markdown-link\">request</a> (aka integration) tests. This isn't an option in this case as I couldn't find any documentation about testing the command handler callbacks with the <a href=\"https://github.com/slack-ruby/slack-ruby-bot-server-events\" class=\"markdown-link\">slack-ruby-bot-server-events</a> gem.</li>\n<li class=\"markdown-list-item\">Put it in ActiveRecord model methods.</li>\n<li class=\"markdown-list-item\">Use ActiveSupport <a href=\"https://www.writesoftwarewell.com/how-rails-concerns-work-and-how-to-use-them/\" class=\"markdown-link\">concerns</a>.</li>\n<li class=\"markdown-list-item\">Use ActiveRecord <a href=\"https://guides.rubyonrails.org/active_record_callbacks.html\" class=\"markdown-link\">callbacks</a> to distribute the logic across the lifecycle of the ActiveRecord model.</li>\n<li class=\"markdown-list-item\">Introduce POROs (Plain Old Ruby Objects) in the <code>/app/models</code> directory and put the business logic in these model methods.</li>\n<li class=\"markdown-list-item\">Use <a href=\"https://www.rubyvideo.dev/talks/railsconf-2022-your-service-layer-needn-t-be-fancy-it-just-needs-to-exist-by-david-copeland\" class=\"markdown-link\">services</a> (video link).</li>\n<li class=\"markdown-list-item\">Use interactors, which are simple, single-purpose objects.</li>\n</ul>\n<p class=\"markdown-para\">All of these have their pros and cons, and a full discussion of the tradeoffs is outside the scope of this post. For this project, I chose to use interactors, implemented with the <a href=\"https://github.com/collectiveidea/interactor\" class=\"markdown-link\">interactor</a> gem. The advantage of this approach is it provides a well documented, easy to test, and consistent pattern for implementing business logic and error handling.</p>\n<h2 class=\"markdown-subtitle\" id=\"openretrospective-interactor\" style=\"position:relative;\"><a href=\"#openretrospective-interactor\" aria-label=\"openretrospective interactor permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OpenRetrospective Interactor</h2>\n<p class=\"markdown-para\">An interactor is a single purpose object with a <code>call</code> method that's given all the information it needs to do its work via a <a href=\"https://github.com/collectiveidea/interactor?tab=readme-ov-file#context\" class=\"markdown-link\">context</a> object. If something goes wrong, the interactor can flag this with <code>context.fail!</code>.</p>\n<p class=\"markdown-para\">Interactors are typically named for the business action they perform. In this example, we'll create an interactor named <code>OpenRetrospective</code> to contain the business logic of creating a retrospective in open status, and posting messages to Slack about the success or failure of this action. Notice it is <em class=\"markdown-emphasis\">not</em> named <code>CreateRetrospective</code> as this sounds more like a simple CRUD (Create, Read, Update, Delete) operation. The idea with an interactor is that it encapsulates more complex business logic than simple CRUD. In this case, we need to do more than just create the retrospective, we also need to inform the Slack channel about it. The interactor documentation has more information about <a href=\"https://github.com/collectiveidea/interactor?tab=readme-ov-file#clarity\" class=\"markdown-link\">naming</a>.</p>\n<p class=\"markdown-para\">After adding <code>gem \"interactor\"</code> to the <code>Gemfile</code> and running <code>bundle install</code>, create a directory <code>app/interactors</code> and add the following:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># app/interactors/open_retrospective.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">OpenRetrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">include</span><span class=\"mtk1\"> Interactor</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">include</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">ActionView</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Helpers</span><span class=\"mtk1\">::SanitizeHelper</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">call</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    title </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">strip_tags</span><span class=\"mtk1\">(context.</span><span class=\"mtk5\">title</span><span class=\"mtk1\">).</span><span class=\"mtk5\">strip</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    retrospective </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Retrospective</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">title:</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> retrospective.</span><span class=\"mtk5\">save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      message </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:memo: Opened retro `</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">retrospective.</span><span class=\"mtk5\">title</span><span class=\"mtk7\">}</span><span class=\"mtk6\">`&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      context.</span><span class=\"mtk5\">slack_client</span><span class=\"mtk1\">.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> context.</span><span class=\"mtk5\">channel_id</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">mrkdwn:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> message</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">else</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      error_message </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:warning: Could not create retro `</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">title</span><span class=\"mtk7\">}</span><span class=\"mtk6\">`, error: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">retrospective.</span><span class=\"mtk5\">errors</span><span class=\"mtk1\">.</span><span class=\"mtk5\">full_messages</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      context.</span><span class=\"mtk5\">slack_client</span><span class=\"mtk1\">.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> context.</span><span class=\"mtk5\">channel_id</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">mrkdwn:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> error_message</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">rescue</span><span class=\"mtk1\"> StandardError =&gt; e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    error_message </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Error in OpenRetrospective: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">e.</span><span class=\"mtk5\">message</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    backtrace </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> e.</span><span class=\"mtk5\">backtrace</span><span class=\"mtk1\">.</span><span class=\"mtk5\">join</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">\\n</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">logger</span><span class=\"mtk1\">.</span><span class=\"mtk5\">error</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">error_message</span><span class=\"mtk7\">}</span><span class=\"mtk4\">\\n</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">backtrace</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    context.</span><span class=\"mtk5\">fail!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">What's going on:</strong></p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\">There is just one public method <code>call</code> that encapsulates all the business logic to open a new retrospective.</li>\n<li class=\"markdown-list-item\">Any reference to <code>context.something</code> means that the caller must provide this value when invoking the interactor. This interactor expects to be provided a <code>title</code> to initialize the retrospective model, and a <code>slack_client</code> and <code>channel_id</code> to communicate success or failure to the channel.</li>\n<li class=\"markdown-list-item\">The <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/SanitizeHelper.html#method-i-strip_tags\" class=\"markdown-link\">strip_tags</a> method from <code>ActionView::Helpers::SanitizeHelper</code> has been brought in to sanitize the user content before saving it to the database.</li>\n<li class=\"markdown-list-item\">If you're using Rubocop, the <code>call</code> method may be lighting up with method length and complexity warnings, this will be addressed shortly.</li>\n<li class=\"markdown-list-item\">Error handling has been added for any unexpected error that may occur.</li>\n</ul>\n<p class=\"markdown-para\">Now the slash command handler can be simplified by removing the business logic, which is now delegated by calling the interactor. The <code>command_text</code> for the retrospective title, and the <code>slack_client</code> and <code>channel_id</code> are passed as inputs to the interactor context:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands/retro_open.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">SlackRubyBotServer</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Events</span><span class=\"mtk1\">.</span><span class=\"mtk5\">configure</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">on</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:command</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;/retro-open&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |command|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    team </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Team</span><span class=\"mtk1\">.</span><span class=\"mtk5\">find_by</span><span class=\"mtk1\">(</span><span class=\"mtk4\">team_id:</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:team_id</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    slack_client </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Slack</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Web</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Client</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">token:</span><span class=\"mtk1\"> team.</span><span class=\"mtk5\">token</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    channel_id </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:channel_id</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command_text </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:text</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command.</span><span class=\"mtk5\">logger</span><span class=\"mtk1\">.</span><span class=\"mtk5\">info</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;=== COMMAND: retro-open, Team: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">team.</span><span class=\"mtk5\">name</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Channel: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">channel_id</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Title: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">command_text</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Delegate business logic to an interactor.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Anything passed in the `call` method becomes available as</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># context.something in the interactor.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">OpenRetrospective</span><span class=\"mtk1\">.</span><span class=\"mtk5\">call</span><span class=\"mtk1\">(</span><span class=\"mtk4\">title:</span><span class=\"mtk1\"> command_text, </span><span class=\"mtk4\">channel_id:</span><span class=\"mtk1\">, </span><span class=\"mtk4\">slack_client:</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">nil</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">If you restart the Rails server <code>bin/dev</code>, then try the slash command again in Slack, the behaviour is the same. You may first have to launch a Rails console <code>bin/rails c</code> and destroy all the existing retrospectives to get a clean start.</p>\n<p class=\"markdown-para\">One of many benefits of interactors is that they're <a href=\"https://github.com/collectiveidea/interactor?tab=readme-ov-file#testing-interactors\" class=\"markdown-link\">easy to unit test</a>. Once the tests are in place, the <code>call</code> method can be further refactored to eliminate the Rubocop warnings about method length and complexity. This post is already fairly lengthy so the tests aren't included, but they can be accessed in the GitHub <a href=\"https://github.com/danielabar/retro-pulse/blob/main/spec/interactors/open_retrospective_spec.rb\" class=\"markdown-link\">repo</a>.</p>\n<p class=\"markdown-para\">In the version below, the logic is split up into into smaller methods, there's now re-use for the call to <code>chat_postMessage</code>, and documentation has been added for the public <code>call</code> method:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"16\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">OpenRetrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">include</span><span class=\"mtk1\"> Interactor</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">include</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">ActionView</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Helpers</span><span class=\"mtk1\">::SanitizeHelper</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Create a new retrospective in +open+ status with the given text,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># and reply back in the Slack channel with with a confirmation message.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># HTML tags and leading/trailing whitespace will be removed from text.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === Example:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">#   OpenRetrospective.call(title: &quot;New Retro&quot;, channel_id: &quot;123&quot;, slack_client: Slack::Web::Client.new)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === Parameters:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># - +title+: The title for the retrospective.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># - +channel_id+: The ID of the Slack channel where the command was issued.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># - +slack_client+: An instance of the Slack client for communication.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\">#</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === Return:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># [void]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">call</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    initialize_retrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    process_retrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">rescue</span><span class=\"mtk1\"> StandardError =&gt; e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">log_error</span><span class=\"mtk1\">(e)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    context.</span><span class=\"mtk5\">fail!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">private</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">initialize_retrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @title </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">strip_tags</span><span class=\"mtk1\">(context.</span><span class=\"mtk5\">title</span><span class=\"mtk1\">).</span><span class=\"mtk5\">strip</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    @retrospective </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Retrospective</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">title:</span><span class=\"mtk1\"> @title)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">process_retrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> @retrospective.</span><span class=\"mtk5\">save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      handle_successful_save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">else</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      handle_failed_save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">handle_successful_save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    message </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:memo: Opened retro `</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">@retrospective.</span><span class=\"mtk5\">title</span><span class=\"mtk7\">}</span><span class=\"mtk6\">`&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">post_message</span><span class=\"mtk1\">(message)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">handle_failed_save</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    error_message </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:warning: Could not create retro `</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">@title</span><span class=\"mtk7\">}</span><span class=\"mtk6\">`, error: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">@retrospective.</span><span class=\"mtk5\">errors</span><span class=\"mtk1\">.</span><span class=\"mtk5\">full_messages</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">post_message</span><span class=\"mtk1\">(error_message)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">post_message</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">message</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    context.</span><span class=\"mtk5\">slack_client</span><span class=\"mtk1\">.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> context.</span><span class=\"mtk5\">channel_id</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">mrkdwn:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> message</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">log_error</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">error</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    error_message </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Error in OpenRetrospective: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">error.</span><span class=\"mtk5\">message</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    backtrace </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> error.</span><span class=\"mtk5\">backtrace</span><span class=\"mtk1\">.</span><span class=\"mtk5\">join</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">\\n</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">logger</span><span class=\"mtk1\">.</span><span class=\"mtk5\">error</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">error_message</span><span class=\"mtk7\">}</span><span class=\"mtk4\">\\n</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">backtrace</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">This post is already pretty lengthy so I'm not including the interactor tests here, but you can <a href=\"https://github.com/danielabar/retro-pulse/blob/main/spec/interactors/open_retrospective_spec.rb\" class=\"markdown-link\">check them out on Github</a> as part of the completed project.</p>\n<h2 class=\"markdown-subtitle\" id=\"next-steps\" style=\"position:relative;\"><a href=\"#next-steps\" aria-label=\"next steps permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Next Steps</h2>\n<p class=\"markdown-para\">At this point, we have an authenticated Slack app added to our workspace from <a href=\"../rails-slack-app-part1-oauth\" class=\"markdown-link\">Part 1 of this series</a>. And now in Part 2 we've added the ability to open a new retrospective with a user provided title from a slash command in Slack, and to respond with a markdown message indicating whether the retrospective was opened successfully or if a validation error occurred.</p>\n<p class=\"markdown-para\">The next step will be to add another slash command <code>/retro-feedback</code> that rather than responding with a simple text message, will respond with a modal form where the user can fill in a comment on how the sprint is going. It will look like this:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABxUlEQVR42pVU21KjQBDNJ/hgDGGAAYb7JRAguGvtxuuul639BJ/8CR/9CP/3aDcOpWWMycOhi6H7TJ8zPUwM08G6WSGPC6RFhSRbIE5LJFmJNK84ZkWFrKgRJwVsqWBaLoTtcbQcH64fQXoh5sLBZC4k/p3eolmscH51jfPLv/hzfceR8Ht9we83d/+xPruCpyJQjSakDagBP0hgWnIg9MIUKso4cTa3QV1T1DgiGDZmpvOhOw2qo0h1E2Ktlyt0/U94Kh53JymbQN82wx8kG6bN7UZJzv5VdcfEVExyPoHWNaTiPMcNuMYUEhN6JGmJvKgRRBl/pMSvO9kMquEOSXuxaFA3PcI4Zx+0T9slfgTljpJVmCJKCgaNx6JqEUQpTGu/DgfJljvK1J7o+P4kvwPnM6ET7F28lXAuPs/Vew93BankwabiZduj6Y7RtMfIyyXycjhxTbwr+FCE5fL8ERHdx9HPXW0gdZpQ3xQikV6wUfZWkHfChS2GOP4ctIe7z5tkWNLHLAhxqBSMIOS1kXAg/QZv89b1J2iXPY7SBIdPD8ifH3HweI+p9TbYYo/xoI3Ja0mn6ilMf3Uwzn5getLCeJX8AizC1yOXk40AAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app demo modal form\"\n        title=\"slack app demo modal form\"\n        src=\"/static/84d30a15310c2ae1ffd70a81f96ca957/5a190/slack-app-demo-modal-form.png\"\n        srcset=\"/static/84d30a15310c2ae1ffd70a81f96ca957/772e8/slack-app-demo-modal-form.png 200w,\n/static/84d30a15310c2ae1ffd70a81f96ca957/e17e5/slack-app-demo-modal-form.png 400w,\n/static/84d30a15310c2ae1ffd70a81f96ca957/5a190/slack-app-demo-modal-form.png 800w,\n/static/84d30a15310c2ae1ffd70a81f96ca957/c1b63/slack-app-demo-modal-form.png 1200w,\n/static/84d30a15310c2ae1ffd70a81f96ca957/bb072/slack-app-demo-modal-form.png 1318w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p class=\"markdown-para\">Read on to <a href=\"../rails-slack-app-part3-slash-command-with-modal-response\" class=\"markdown-link\">Part 3: Slack Slash Command with Modal Response</a> to learn how to do this.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk10 { color: #FD971F; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","timeToRead":15,"tableOfContents":"<ul>\n<li><a href=\"#create-slash-command-in-slack\">Create Slash Command in Slack</a></li>\n<li><a href=\"#receive-slash-command-in-rails\">Receive Slash Command in Rails</a></li>\n<li><a href=\"#inspect-request\">Inspect Request</a></li>\n<li><a href=\"#implement-slash-command\">Implement Slash Command</a></li>\n<li><a href=\"#refactor\">Refactor</a></li>\n<li><a href=\"#openretrospective-interactor\">OpenRetrospective Interactor</a></li>\n<li><a href=\"#next-steps\">Next Steps</a></li>\n</ul>","frontmatter":{"title":"Build a Rails App with Slack Part 2: Slash Command with Text Response","date":"02 Jul 2024","description":"Learn how to build a Slack application with Rails in this comprehensive multi-part series. Part 2 covers configuring and handling a Slack Slash Command to perform a business action and responding with a markdown text response in the channel.","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#88a8b8","images":{"fallback":{"src":"/static/d35463402f792edde37a8e9b4e11de7b/d730f/slack-feat-img-2-jonathan-borba-ovEjbhIriXs-unsplash.jpg","srcSet":"/static/d35463402f792edde37a8e9b4e11de7b/b834a/slack-feat-img-2-jonathan-borba-ovEjbhIriXs-unsplash.jpg 225w,\n/static/d35463402f792edde37a8e9b4e11de7b/21c52/slack-feat-img-2-jonathan-borba-ovEjbhIriXs-unsplash.jpg 450w,\n/static/d35463402f792edde37a8e9b4e11de7b/d730f/slack-feat-img-2-jonathan-borba-ovEjbhIriXs-unsplash.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/d35463402f792edde37a8e9b4e11de7b/71a10/slack-feat-img-2-jonathan-borba-ovEjbhIriXs-unsplash.webp 225w,\n/static/d35463402f792edde37a8e9b4e11de7b/901f1/slack-feat-img-2-jonathan-borba-ovEjbhIriXs-unsplash.webp 450w,\n/static/d35463402f792edde37a8e9b4e11de7b/5acd1/slack-feat-img-2-jonathan-borba-ovEjbhIriXs-unsplash.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":599}}}},"fields":{"slug":"/blog/rails-slack-app-part2-slash-command-with-text-response/"}},"relatedP":{"edges":[{"node":{"id":"40da9b16-4faf-592a-b9c0-49d94a2304f9","frontmatter":{"title":"Rails Enums with MySQL or Postgres","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/44e499371e6e83708de5e52b055c6d08/26528/enum-jake-hills-0hgiQQEi4ic-unsplash.jpg","srcSet":"/static/44e499371e6e83708de5e52b055c6d08/26528/enum-jake-hills-0hgiQQEi4ic-unsplash.jpg 300w,\n/static/44e499371e6e83708de5e52b055c6d08/43429/enum-jake-hills-0hgiQQEi4ic-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/44e499371e6e83708de5e52b055c6d08/5d6c3/enum-jake-hills-0hgiQQEi4ic-unsplash.webp 300w,\n/static/44e499371e6e83708de5e52b055c6d08/68dbc/enum-jake-hills-0hgiQQEi4ic-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/rails-enum-mysql-postgres/"}}},{"node":{"id":"fff6ecc2-0dbb-59b1-80bb-97c0c24f82dd","frontmatter":{"title":"They Don't All Have To Be ActiveRecord Models","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#182828","images":{"fallback":{"src":"/static/f09c57681d2f9326aa60bbeee916a2c4/26528/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.jpg","srcSet":"/static/f09c57681d2f9326aa60bbeee916a2c4/26528/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.jpg 300w,\n/static/f09c57681d2f9326aa60bbeee916a2c4/43429/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/f09c57681d2f9326aa60bbeee916a2c4/5d6c3/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.webp 300w,\n/static/f09c57681d2f9326aa60bbeee916a2c4/68dbc/not-ar-model-vandan-patel-C63NHsUUR1A-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/they-dont-all-have-to-be-activerecord-models/"}}},{"node":{"id":"41a3cfc2-1062-525c-b57b-3f04d6b73b8a","frontmatter":{"title":"When RSpec Doesn't Rollback","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#885828","images":{"fallback":{"src":"/static/17aadb690ca81dfbfd637f00bbeffc28/26528/rspec-rollback-mihaly-koles-Ec_WHv4aAno-unsplash.jpg","srcSet":"/static/17aadb690ca81dfbfd637f00bbeffc28/26528/rspec-rollback-mihaly-koles-Ec_WHv4aAno-unsplash.jpg 300w,\n/static/17aadb690ca81dfbfd637f00bbeffc28/43429/rspec-rollback-mihaly-koles-Ec_WHv4aAno-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/17aadb690ca81dfbfd637f00bbeffc28/5d6c3/rspec-rollback-mihaly-koles-Ec_WHv4aAno-unsplash.webp 300w,\n/static/17aadb690ca81dfbfd637f00bbeffc28/68dbc/rspec-rollback-mihaly-koles-Ec_WHv4aAno-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/when-rspec-doesnt-rollback/"}}}]}},"pageContext":{"slug":"/blog/rails-slack-app-part2-slash-command-with-text-response/","relatedPosts":["They Don't All Have To Be ActiveRecord Models","When RSpec Doesn't Rollback","Rails Enums with MySQL or Postgres"]}},"staticQueryHashes":["163244226"],"slicesMap":{}}