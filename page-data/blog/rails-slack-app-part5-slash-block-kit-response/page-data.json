{"componentChunkName":"component---src-templates-post-js","path":"/blog/rails-slack-app-part5-slash-block-kit-response/","result":{"data":{"markdownRemark":{"html":"<p class=\"markdown-para\">Welcome to the fifth installment of this multi-part series on building a Slack application with Rails. This series will guide you through the process of creating a Slack application with Rails and is structured as follows:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\"><a href=\"../rails-slack-app-part1-oauth\" class=\"markdown-link\">Part 1: Rails new, Slack, and OAuth</a></li>\n<li class=\"markdown-list-item\"><a href=\"../rails-slack-app-part2-slash-command-with-text-response\" class=\"markdown-link\">Part 2: Slack Slash Command with Text Response</a></li>\n<li class=\"markdown-list-item\"><a href=\"../rails-slack-app-part3-slash-command-with-modal-response\" class=\"markdown-link\">Part 3: Slack Slash Command with Modal Response</a></li>\n<li class=\"markdown-list-item\"><a href=\"../rails-slack-app-part4-action-modal-submission\" class=\"markdown-link\">Part 4: Slack Action Modal Submission</a></li>\n<li class=\"markdown-list-item\">Part 5: Slack Slash Command with Block Kit Response  === YOU ARE HERE ===</li>\n</ul>\n<p class=\"markdown-para\">Feel free to jump to a specific part of interest using the links above or follow along sequentially. You can also checkout the <a href=\"https://github.com/danielabar/retro-pulse\" class=\"markdown-link\">source code on Github</a> for the application we'll be building.</p>\n<p class=\"markdown-para\">This post assumes the reader has at least a beginner level familiarity with Ruby on Rails. It's also assumed the reader has used <a href=\"https://slack.com/\" class=\"markdown-link\">Slack</a> as an end user with basic interactions such as joining channels, sending messages, and participating in conversations.</p>\n<p class=\"markdown-para\">Part 1 of this series introduced <a href=\"../rails-slack-app-part1-oauth#introducing-retro-pulse\" class=\"markdown-link\">Retro Pulse</a>, a Slack app built with Rails for agile teams to manage their retrospectives with Slack. <a href=\"../rails-slack-app-part2-slash-command-with-text-response\" class=\"markdown-link\">Part 2</a> explained how to implement a Slack slash command to open a retrospective and return a markdown text response to the same Slack channel that initiated the request. <a href=\"../rails-slack-app-part3-slash-command-with-modal-response\" class=\"markdown-link\">Part 3</a> covered how to implement a slash command that responds with a modal form, allowing the user to enter feedback for the retrospective. In <a href=\"../rails-slack-app-part4-action-modal-submission\" class=\"markdown-link\">Part 4</a>, we learned how to handle the modal form submission to save the user's feedback in the database, and reply back with a direct message to let the user know their feedback was saved.</p>\n<p class=\"markdown-para\">Now in Part 5, we'll be implementing the last part of the application, which is to display the feedback when the team is ready to have their retrospective meeting. The interaction looks like this:</p>\n<p class=\"markdown-para\">Given that the team has started their retrospective meeting, someone who is screen sharing their Slack workspace enters the <code>/retro-discuss</code> slash command. This command accepts one argument to specify the category: keep, stop, or try:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bc8e94fb4ee41d2ea935921e2ba03395/e548f/slack-app-demo-retro-discuss-slash.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaUlEQVR42n3S2UrDQBQG4DyFbWqbzCSTmcneaJpWWymKKC4XRfAh3JUWRZ/GKzdwecNf5rRiBfXiYzj/JIczk1jF4Rj+aAIxGkOMJpAHEzj7V7B3LtAglzMXaOxOV3tvDKd/ACEkhIoR6AReoNFyBazg6B7l3QeK61eUt+9o37xBXr6AnT4RfvYM5+SRmNo5fkDz/A329hnqtRrqTY76oovaoguHBbDavXV01jbRHW4jLgfw4mXIrILOKygj+yazDu0ZTCZoNBkaLU7sFps2zLMCZbWCTrWCvL0MpWPoKIEKE+gondXpXDbFPAl7vmGTTY9cLHXR6w9JUfag4hzaSNoI04LqKC3onpivwIQmXITgQlHGZxnzFCwVZRS4nqSL9YKQ+DL64Sv/FZfwHQHua1j5UkUTmKlkmBLz5f5tMIdzCT5cxcLhFtwghGVeNnwZ0qTmIXMMM/HfAlpllCIwv023grMxgOMrfAKk0/rZ1LdnZwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app demo retro discuss slash\"\n        title=\"slack app demo retro discuss slash\"\n        src=\"/static/bc8e94fb4ee41d2ea935921e2ba03395/5a190/slack-app-demo-retro-discuss-slash.png\"\n        srcset=\"/static/bc8e94fb4ee41d2ea935921e2ba03395/772e8/slack-app-demo-retro-discuss-slash.png 200w,\n/static/bc8e94fb4ee41d2ea935921e2ba03395/e17e5/slack-app-demo-retro-discuss-slash.png 400w,\n/static/bc8e94fb4ee41d2ea935921e2ba03395/5a190/slack-app-demo-retro-discuss-slash.png 800w,\n/static/bc8e94fb4ee41d2ea935921e2ba03395/e548f/slack-app-demo-retro-discuss-slash.png 975w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">Usually the meeting starts with a discussion of what the team should keep on doing, in this case, the slash command would be entered as <code>/retro-discuss keep</code>:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b4430a2587bdaacb9281fb4bb19e5275/a0b80/slack-app-demo-retro-discuss-slash-keep.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgElEQVR42o2OTQrCMBBGc5BCjZOfSdLEtlIV3HkDj+D9D/GVCYTSRaWLx7cYePMUuQhtuEI2gFzA1W7I/UL+HIahwjDCx1JxIcP4tMPysHtwiAT1Fuo2PzDen5iXF0TeqmRb+V9ERgzNCd3nDRXzhFSmKpPCtk16CvLQuaD/fbECvo50TzmmvZQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app demo retro discuss slash keep\"\n        title=\"slack app demo retro discuss slash keep\"\n        src=\"/static/b4430a2587bdaacb9281fb4bb19e5275/5a190/slack-app-demo-retro-discuss-slash-keep.png\"\n        srcset=\"/static/b4430a2587bdaacb9281fb4bb19e5275/772e8/slack-app-demo-retro-discuss-slash-keep.png 200w,\n/static/b4430a2587bdaacb9281fb4bb19e5275/e17e5/slack-app-demo-retro-discuss-slash-keep.png 400w,\n/static/b4430a2587bdaacb9281fb4bb19e5275/5a190/slack-app-demo-retro-discuss-slash-keep.png 800w,\n/static/b4430a2587bdaacb9281fb4bb19e5275/a0b80/slack-app-demo-retro-discuss-slash-keep.png 955w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">The app responds with all the comments that have been collected in that category. It also displays a header and a count of how many comments were entered. Below each comment section, it shows the date the comment was entered on and either the Slack username or \"anonymous\" if the person who entered this comment had selected to remain anonymous:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/551e3c50c949d590fc293d74c86ba7ef/72aae/slack-app-demo-keep-comments.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQElEQVR42m1SWXbCMAzkFG0hZDOxszo4cVaSttz/UtMngXkB+jHRWIqskeSdqQyuyxXdtMAOM+qmQ1m3OKkCKtfwowT7Y4SDH/8Lirk42Z3nC8i04suaboQdLszb/oYglvjywkfilm8LOb4j4gUCQuYQMkN0ShEKxWeyx/DEKgl0OfmcJd/bhVSR2uunBW0/obUjGjvC2AHndmDFxClm+xlpUfP/Mqu4+Lbdh0JfZBCy4KpaN1BZydy16Nok+7H3NwjeZ0ifQCheAFUlBTKvoBiaz2lBsRJprtmXV4ZtVtZIVMFjeWo5SUvM6y/6aYUdLxjmlfkwf7P/FlvuWDlO7U/LD7TpXlr2QsSy4KdCFY3poM8WhTZ3dTXKuuElURKpoSU6uGf1NMNjrBCdbhsuyjPiJOVEN7/PQ/g0p1dsFf4BUV0CN5GxZP4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app demo keep comments\"\n        title=\"slack app demo keep comments\"\n        src=\"/static/551e3c50c949d590fc293d74c86ba7ef/5a190/slack-app-demo-keep-comments.png\"\n        srcset=\"/static/551e3c50c949d590fc293d74c86ba7ef/772e8/slack-app-demo-keep-comments.png 200w,\n/static/551e3c50c949d590fc293d74c86ba7ef/e17e5/slack-app-demo-keep-comments.png 400w,\n/static/551e3c50c949d590fc293d74c86ba7ef/5a190/slack-app-demo-keep-comments.png 800w,\n/static/551e3c50c949d590fc293d74c86ba7ef/72aae/slack-app-demo-keep-comments.png 964w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">Finally, when the retrospective meeting is over, it can be closed with another slash command:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2b8bcf588a819cd9a252fabf883c92b7/d4c13/slack-app-demo-slash-close.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzElEQVR42n2Sy24TMRSG8wjAhjZNZsb22J5bJnNL24QWFLW0gKjULauWiovoBugKJCQeB6FKFMSCx/uQHTI7uvj0n2ONf//H40EQxQhlEXGC1AmhNIyjuCcQ2hMp61n3jlGo2BxFnuFYeAbaZMy2F+w+eMRif0nV7qCTgiSfkhYV2aQmLaZebVYiddrjQqwP7g2VTinKhknVMalar2Xd+c3KZN48trnH9c5kzco4wXlsBdInHSidUbe7zOb7zHb3vLY7e+TTjqSoSVzKssFkU2zuEjd+3eZThE7Z2Ao9fUITG9qqYTabsZjPmeQ5sVQkxpBYu8LVHovVBvuvF0L1Rr1h2B5RPL2gPn3H5OQt6ugCcXiOPDz3qh6/9LVThzg4Qx6coY5fMe6OGY4ChmPpzfzIw5NP5FfXbH/9Q/n5N+rqJ8H7H0QfbpAfb7h/ec3dN9977jlef+PO5S82Tr8ghUTEqR8/kIZBWD1EzZ8zqpaMmwOi9pCwXWnUufo/dEdE5QK5/kFBjBCGgTGWpq7Js5w0SbHunowlVhol1a1IpRHSIoqSzRfP2GwqBqG06HSCyUripEC552ELP0akEsJbcN9rm6OLKfLJklFR8Be77zTAHc36DQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app demo slash close\"\n        title=\"slack app demo slash close\"\n        src=\"/static/2b8bcf588a819cd9a252fabf883c92b7/5a190/slack-app-demo-slash-close.png\"\n        srcset=\"/static/2b8bcf588a819cd9a252fabf883c92b7/772e8/slack-app-demo-slash-close.png 200w,\n/static/2b8bcf588a819cd9a252fabf883c92b7/e17e5/slack-app-demo-slash-close.png 400w,\n/static/2b8bcf588a819cd9a252fabf883c92b7/5a190/slack-app-demo-slash-close.png 800w,\n/static/2b8bcf588a819cd9a252fabf883c92b7/d4c13/slack-app-demo-slash-close.png 825w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">Which the app responds to with a confirmation message that the retrospective has been closed:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/97fca194181c9b0264d37e20db45cad2/c946b/slack-app-demo-close-response.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.500000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVR42o3QWw7CIBQEULbhswXK414oTfnQqPHH/e9pTEvbaIzWj5MJryEgHucbrtc78umCmDJ86KCNQ1Ur1FIvDpXCZl+vEjcXkGMHShkUO3Dbg4jA3oC9BbmSWhtsDxK7o/pJSBegLENbRuPCJEK7OKblDnVDkA1BW4IyJV8Nc2WeITwnDBynZaHw0wFexrJZJ0LKKHoYH2GpXXLe9H7Rd8PrxsLh73xIY5Hjz8J/zIVPD/SstlXXpJMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack-app-demo-close-response\"\n        title=\"slack-app-demo-close-response\"\n        src=\"/static/97fca194181c9b0264d37e20db45cad2/5a190/slack-app-demo-close-response.png\"\n        srcset=\"/static/97fca194181c9b0264d37e20db45cad2/772e8/slack-app-demo-close-response.png 200w,\n/static/97fca194181c9b0264d37e20db45cad2/e17e5/slack-app-demo-close-response.png 400w,\n/static/97fca194181c9b0264d37e20db45cad2/5a190/slack-app-demo-close-response.png 800w,\n/static/97fca194181c9b0264d37e20db45cad2/c946b/slack-app-demo-close-response.png 805w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">Closing the retrospective is a very similar interaction to opening a retrospective, that was already covered in <a href=\"../rails-slack-app-part2-slash-command-with-text-response\" class=\"markdown-link\">Part 2 of this series</a>, so it won't be covered here.</p>\n<h2 class=\"markdown-subtitle\" id=\"add-slash-command-in-slack\" style=\"position:relative;\"><a href=\"#add-slash-command-in-slack\" aria-label=\"add slash command in slack permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Add Slash Command in Slack</h2>\n<p class=\"markdown-para\">The first thing we need to do to implement this interaction is to configure another slash command in the Retro Pulse app. Navigate to <a href=\"https://api.slack.com/apps\" class=\"markdown-link\">Your Apps</a> on Slack, select the \"Retro Pulse\" app you created in <a href=\"../rails-slack-app-part1-oauth#create-slack-app\" class=\"markdown-link\">Part 1 of this series</a>, and then select \"Slash Commands\" from the Features section:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 249px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/24f495ea8719540544c9138d6c4729db/6a5fb/slack-app-feature-slash.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 247.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAyCAYAAABcfPsmAAAACXBIWXMAAAsTAAALEwEAmpwYAAAGmUlEQVR42o1XSW9bVRT2n2DPHrGABRISsENCrBASgnUlEENFQYBUARKIBQiJDYgyttDQ0qpVR0BASNIkHhO/2PF7tmPHcZzE8ZQ4iafYfoOfP/Sd5DlOaqdxdHwHv3fud+75zndvXIZuQG/rsAwTlmmi3Wqj1WyJ9fedsd7Soe+3HMtcW4fjx8UvXdexXa1ha6eCLrpwPv19fizLgmEaME0ThmHAtjuwbRvt9oFTV8eyUCiV8emrp/D522cQXUhC01SkUinkC3lE1AiSi0mkllLQDV0c211b2mqtikq1gk6nI0h7DkulTbzz+hmcffdDJBJJ+Pw+BINBxONxaFFN+j6fD7V67ZDDYqkoi3Lcc+iEXN6uoLy1IyEcBDwgZOMg5G7XlmcOhex0Dn26QNfuyryTDGfz+82ZN9rGQVKY3cpOFaOjY3C7vbh9+y6mptxQlDkUixswDBPNZhutlj7U2v1ZZqdr6lB8bvin7omN/f0nbl69jMZ2eR+yvQdb2gHWsQ5CJsL42hamExvwpcoILNG24EluYCpewLiaxYS2jnF1HVOxHHyJArwLeTH2p2M5LBcq6BjmHkJ6f+GrMTx+9hae/PgOHj59FY+8fwPPfPIHHv3gBh47ewtPf/InnvjoLh567Xe4XvwJrpd+3rOXz8P1/Dm8/rNXkDJ8FywLn90M49QPbrx3aRanfvTitfN+vPWLH29c8OP0r368ed4j9srXE3j283/w3Bf/ij3/5Sie+vQvfDcaA2xyUYfLJNRWC2vZHJbSGWSWM8hkVpDPF5HJrCKbzaFe35XVuUe2ZcI277deUuiwUd9FeimN+fA85pQ5sVRyEaG5EBLxBdRrNal1ocoR6vSbJIVf5FKj3thbZX9MKvEh8tBZXX+Asx5tmrtNBGeDCPgDmAnMIDIfwezMLDxuD3xeH3YbuzD3EfL548zleD5aCawUB2E/gv52oEOuXK/VEQ6F4ff54fV4ZS8n700itZhCx+oMLL1hjnsIGTYdcy/5crFQlD4LxO7YgpjG/nEo97PcQGIhgcXkIpbTy9KuZ9cFNfuaqsnv8VhcfnekaihCoiP/kokkolpUQs7n8liIL8g8Q+dvbDk+NmROEuWwT3+4JwrZMi1UK1WhzNrqmqDKrmUltFKxBIenRxMzFCEd7mzvYPTfUfw2MoLLly7j1s1bGLk4gumpaUHUf7I9kIfHhtzFiR0dSgrJy2xyw1cyK1LXNCbGqZCTkPqQQ2aQ5cf9o/NYNIbVlVUJmU5P4uyQOHAfWbPkJGnEPpO1Vd5CZadyH/f6UQ8kNiWLgkAORubnRSTUiIqpySkowaA8c5Lwe6XHmmWfWeeLjjgQrZO4/heHIe2JAxFSULmPlCwlqAjKifEJuKfdMqacEbWjQIOc7t0cWnsyxbCcfeT+cc4RDUc4OGY0TNYgp66O3UHLaCEajSIWjSKTychFiYLATHOcTqehqipisRgSiYSM2Zq2CavvTBaHtWIV2jUV/gs+jH87BvdP05j+YVLaye/vwXfBi5mLAXjPe/DfN6O4d25Cnps4Ny7v8X3TOlBzl3o5gpyWw3JyGSvJFWSXssgt57CWWuvZ6uIKMolltKtt6DUd7UobZtNEKVqEdlXtoRSE2hUVeTWHSDACz5gH8VAcyUgSQXcQkZkIwv4QFI+C2elZbOe3Ud+so1aqYndnFwU1j+g1DZbd57BRbgj02QszstrcxaD049diCP82h9CIgti1KOLXY4he1aBdichzbGPXo6iX64dDljtf10BIDSEwF4AyryAYDiKshZFeTSOgBOAP+rFeXBe96KADe/+Pd0PeFe+/Yzd1tHll223JXY/9ZqOJVqMJUzdlni2tY3RgtPaeod1HG4fYJDRLj0JL8lJo2WcpkvAkNlsWwEZpQypq6BHADgldq9ZECByCk9jOeHtruycWBDDs4BeEdMQTjRpI6eeBRIQ86aiRJDjHS6kllDfLUilDzxTn1Mut53qiSnNElscpHVF46ZzhHlWdgQLLlYmUYdF5IV+QcJ0wNzc2ZXxUbQaGzP3SVBVziiIoWMdUcF6amBRJWCCAkKIc0sWhh5SDkgrClgs4W8GXaS3DQqNtos1/ISRc43iEpAgvSERHPeSYau33+bBTqWIyuYE74Sw2ai1YhvFghDTuIflF45iLyVnC/1Wo3iT9A06/HrFJWmaTtCGF2HcuT0wGr8TGSe6Hzl4xCXRAyjAx7HOOxhPxpOdzL2TnMuTIe/8F6aTXYTr8H0nyhFd402zRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app feature slash\"\n        title=\"slack app feature slash\"\n        src=\"/static/24f495ea8719540544c9138d6c4729db/6a5fb/slack-app-feature-slash.png\"\n        srcset=\"/static/24f495ea8719540544c9138d6c4729db/772e8/slack-app-feature-slash.png 200w,\n/static/24f495ea8719540544c9138d6c4729db/6a5fb/slack-app-feature-slash.png 249w\"\n        sizes=\"(max-width: 249px) 100vw, 249px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">Then click on the \"Create New Command\" button, and fill in the form as follows:</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Command:</strong> <code>/retro-discuss</code>. This is what the user will type into a Slack message to initiate an interaction with the Retro Pulse Rails app.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Request URL:</strong> For example: <code>https://12e4-203-0-113-42.ngrok-free.app/api/slack/command</code>. This is where Slack will send an HTTP POST request when the user submits this slash command from Slack. The hostname is your ngrok forwarding address that you got from starting <a href=\"../rails-slack-app-part1-oauth#ngrok\" class=\"markdown-link\">ngrok in Part 1 of this series</a>. The route <code>/api/slack/command</code> is defined in the <a href=\"https://github.com/slack-ruby/slack-ruby-bot-server\" class=\"markdown-link\">slack-ruby-bot-server</a> gem that's included in the Retro Pulse Rails app.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Short Description:</strong> <code>Discuss retrospective feedback</code>. This will be displayed as the user types in the slash command.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Usage Hint:</strong> <code>keep stop try</code>. Since this particular slash command requires a parameter, which will be used to retrieve the comments for that category, the usage hint is also shown to the user as they type in the slash command.</p>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">Escape Channels:</strong> Leave this unchecked. Turning this on will modify the parameters sent with a command by a user such as wrapping URLs in angle brackets and translating channel or user mentions into their correlated IDs. It's not necessary for this app. See the Slack <a href=\"https://api.slack.com/interactivity/slash-commands\" class=\"markdown-link\">documentation</a> if your app needs this option.</p>\n<p class=\"markdown-para\">After filling out the slash command form, click the \"Save\" button which appears all the way at the bottom right hand corner.</p>\n<h2 class=\"markdown-subtitle\" id=\"receive-slash-command-in-rails\" style=\"position:relative;\"><a href=\"#receive-slash-command-in-rails\" aria-label=\"receive slash command in rails permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Receive Slash Command in Rails</h2>\n<p class=\"markdown-para\">In Part 2 of this series, we learned how to add a <a href=\"../rails-slack-app-part2-slash-command-with-text-response#receive-slash-command-in-rails\" class=\"markdown-link\">handler to receive slash commands</a> using the <a href=\"https://github.com/slack-ruby/slack-ruby-bot-server-events\" class=\"markdown-link\">slack-ruby-bot-server-events</a> gem. Let's add another one to handle the <code>/retro-discuss</code> command.</p>\n<p class=\"markdown-para\">Create a new file in the <code>bot/slash_commands</code> directory that will get triggered whenever a user submits the <code>/retro-discuss</code> command. The <code>command</code> object exposed by the <code>slack-ruby-bot-server-events</code> gem contains many of the request parameters sent by Slack including the <code>team_id</code>, <code>channel_id</code>, and <code>text</code> that user entered.</p>\n<p class=\"markdown-para\">This first attempt retrieves the comments by category for the open retrospective, concatenates their <code>content</code> attributes, and sends back a simple text response to the channel:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands/retro_discuss.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">SlackRubyBotServer</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Events</span><span class=\"mtk1\">.</span><span class=\"mtk5\">configure</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Essentially this is saying to the SlackRubyBotServer,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># If a &quot;/retro-discuss&quot; slash command is received from Slack,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># then execute this block.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">on</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:command</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;/retro-discuss&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |command|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Use `command[:team_id]` from request parameters sent to us</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># by Slack to find the Team model persisted in the database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    team </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Team</span><span class=\"mtk1\">.</span><span class=\"mtk5\">find_by</span><span class=\"mtk1\">(</span><span class=\"mtk4\">team_id:</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:team_id</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># This is the Slack channel we need to respond back to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    channel_id </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:channel_id</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># If user entered /retro-discuss keep</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># in Slack, then command_text will be: keep</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command_text </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:text</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command.</span><span class=\"mtk5\">logger</span><span class=\"mtk1\">.</span><span class=\"mtk5\">info</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;=== COMMAND: retro-discuss, Team: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">team.</span><span class=\"mtk5\">name</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Channel: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">channel_id</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Text: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">command_text</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Instantiate a slack client with the team token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># so we can communicate back to the channel</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    slack_client </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Slack</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Web</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Client</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">token:</span><span class=\"mtk1\"> team.</span><span class=\"mtk5\">token</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Find the one and only open Retrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    retrospective </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Retrospective</span><span class=\"mtk1\">.</span><span class=\"mtk5\">find_by</span><span class=\"mtk1\">(</span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Retrospective</span><span class=\"mtk1\">.</span><span class=\"mtk5\">statuses</span><span class=\"mtk1\">[</span><span class=\"mtk4\">:open</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Retrieve the comments for the open Retrospective, for this category</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    category </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command_text</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    comments </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> retrospective.</span><span class=\"mtk5\">comments</span><span class=\"mtk1\">.</span><span class=\"mtk5\">where</span><span class=\"mtk1\">(</span><span class=\"mtk4\">category:</span><span class=\"mtk1\"> category)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Concatenate all the comments.content into a single comma separated text</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    comments_text </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> comments.</span><span class=\"mtk5\">map</span><span class=\"mtk1\">(</span><span class=\"mtk7\">&amp;</span><span class=\"mtk4\">:content</span><span class=\"mtk1\">).</span><span class=\"mtk5\">join</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;, &quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Reply to the channel with all the comments text</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    slack_client.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> channel_id,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> comments_text</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Return `nil`, otherwise the slack-ruby-bot-server-events gem</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># replies to the channel with a message &quot;true&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">nil</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">The <code>Comment</code> model was introduced in Part 4 of this series, <a href=\"../rails-slack-app-part4-action-modal-submission#comment-model\" class=\"markdown-link\">have a quick read there</a> if you need a refresher of what it looks like. The <code>Retrospective</code> model was introduced in <a href=\"../rails-slack-app-part2-slash-command-with-text-response#implement-slash-command\" class=\"markdown-link\">Part 2</a>.</p>\n<p class=\"markdown-para\">Use <code>require_relative</code> to load this new command in the <code>bot/slash_commands.rb</code> file. We <a href=\"../rails-slack-app-part2-slash-command-with-text-response#receive-slash-command-in-rails\" class=\"markdown-link\">created this file in Part 2</a> when introducing slash commands:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># This line was added in Part 2 of this series</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require_relative</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;slash_commands/retro_open&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># This line was added in Part 3 of this series</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require_relative</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;slash_commands/retro_feedback&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># === NEW ===</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">require_relative</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;slash_commands/retro_discuss&quot;</span></span></span></code></pre>\n<p class=\"markdown-para\">This file is loaded by <code>config.ru</code> to ensure that all the Slack handlers are loaded when Rails starts.</p>\n<p class=\"markdown-para\">After restarting the Rails server <code>bin/dev</code>, and entering <code>/retro-discuss keep</code> in a Slack workspace that has the Retro Pulse app installed, it will respond with something like this. In the example below, there are two comments, each having several sentences, separated by a comma:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0c511b53a96bdd2a795658959c9bc6c9/9b1e2/slack-app-retro-feedback-comma-separated.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA80lEQVR42kWQa3KEIBCEvUWyKoLu6voCFZGHbrnJ/Q/VKSYV8+OrZoamB0huGcdHynDLCiJjAmnOibiOvfrZ4163yPMKnNVEzkqkjF/+qHlRIpHtgG93YlkcZm3QdiMdLsQdjFdkKsoHSt6g4SMaofAUCpw/aC96/nwxNBFVDat2HOELmwvYbIA2DmbzpKv1WLWH0wcWY6E3i0mvNNzYQDh/QM0rBSefKUNbSRz7mwL244R1O1x4wfodfn9Rbay/+uvmaXA4TgpcjcOj6X5vmOUCddlDKo22l+hHBTktGOSMblCkkX6cLmI9qplC6EvE/5N/AOSplOybWATIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app retro feedback comma separated\"\n        title=\"slack app retro feedback comma separated\"\n        src=\"/static/0c511b53a96bdd2a795658959c9bc6c9/5a190/slack-app-retro-feedback-comma-separated.png\"\n        srcset=\"/static/0c511b53a96bdd2a795658959c9bc6c9/772e8/slack-app-retro-feedback-comma-separated.png 200w,\n/static/0c511b53a96bdd2a795658959c9bc6c9/e17e5/slack-app-retro-feedback-comma-separated.png 400w,\n/static/0c511b53a96bdd2a795658959c9bc6c9/5a190/slack-app-retro-feedback-comma-separated.png 800w,\n/static/0c511b53a96bdd2a795658959c9bc6c9/c1b63/slack-app-retro-feedback-comma-separated.png 1200w,\n/static/0c511b53a96bdd2a795658959c9bc6c9/29007/slack-app-retro-feedback-comma-separated.png 1600w,\n/static/0c511b53a96bdd2a795658959c9bc6c9/9b1e2/slack-app-retro-feedback-comma-separated.png 1880w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">Technically this works, but it's difficult to determine where one comment ends and the next begins. We'd also like to see who posted it and when. The next section covers how to make the response more visually appealing.</p>\n<h2 class=\"markdown-subtitle\" id=\"using-block-kit-to-format-the-response\" style=\"position:relative;\"><a href=\"#using-block-kit-to-format-the-response\" aria-label=\"using block kit to format the response permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using Block Kit to Format the Response</h2>\n<p class=\"markdown-para\">Part 3 of this series <a href=\"../rails-slack-app-part3-slash-command-with-modal-response#respond-with-example-modal\" class=\"markdown-link\">introduced Slack's Block Kit</a> for building the interactive modal to collect user feedback. Block Kit can also be used to compose a message that is sent via Slack's <a href=\"https://api.slack.com/methods/chat.postMessage\" class=\"markdown-link\">chat_postMessage</a> API.</p>\n<p class=\"markdown-para\">We've already been using the <code>chat_postMessage</code> API throughout this series to send simple messages. For example, in Part 2 it was used to reply to the channel that a retrospective had been created:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">slack_client </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Slack</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Web</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Client</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">token:</span><span class=\"mtk1\"> team.</span><span class=\"mtk5\">token</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">slack_client.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> channel_id,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">mrkdwn:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:memo: Opened retro `</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">retrospective.</span><span class=\"mtk5\">title</span><span class=\"mtk7\">}</span><span class=\"mtk6\">`&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">)</span></span></span></code></pre>\n<p class=\"markdown-para\">Which looks like this:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f500572bb4744e3ffa16963b8cb1df85/31aff/slack-app-demo-retro-open-success.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA00lEQVR42oWQSU7EMBBFfYxukniIyy5P7YQQiXVLcAKEuP9JPrI77FBn8eTp15OrhJQzpCJoCjAUMGnCoCyuo+lcBg3iDG0Z11HjZTJPEXvd8fP1jfvHJ9a3d+TbihwDiAhkLRwRhknjMqguPENIw1i3HalUGIogTgghgg9CTDDEkMZBzf/zePMYlYVwIcPHG4hLX61PsFxgfYblDHfczS6e0sYiWji1NusrQl4eQp/6T1vIHLN9Rsu1mi5sh7JsyHVDzEuXcqp9/yc9w/oIF0pv+xce06uYhmoT8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app demo retro open success\"\n        title=\"slack app demo retro open success\"\n        src=\"/static/f500572bb4744e3ffa16963b8cb1df85/5a190/slack-app-demo-retro-open-success.png\"\n        srcset=\"/static/f500572bb4744e3ffa16963b8cb1df85/772e8/slack-app-demo-retro-open-success.png 200w,\n/static/f500572bb4744e3ffa16963b8cb1df85/e17e5/slack-app-demo-retro-open-success.png 400w,\n/static/f500572bb4744e3ffa16963b8cb1df85/5a190/slack-app-demo-retro-open-success.png 800w,\n/static/f500572bb4744e3ffa16963b8cb1df85/31aff/slack-app-demo-retro-open-success.png 823w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">Instead of <code>text</code>, the <code>chat_postMessage</code> API can accept a <code>blocks</code> attribute, which is a JSON array. Each element in the array must be a valid <a href=\"https://api.slack.com/reference/block-kit/blocks\" class=\"markdown-link\">block</a>. If all this sounds a little abstract, an example should help to clear things up.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"section-and-divider\" style=\"position:relative;\"><a href=\"#section-and-divider\" aria-label=\"section and divider permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Section and Divider</h3>\n<p class=\"markdown-para\">In the version of <code>bot/slash_commands/retro_discuss.rb</code> shown below, the <code>text: comments_text</code> has been removed and instead an array of blocks is built. For each comment, there a <code>section</code> block is created for rendering the content of the comment, followed by a <code>divider</code> block to visually distinguish one comment from the other:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands/retro_discuss.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">SlackRubyBotServer</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Events</span><span class=\"mtk1\">.</span><span class=\"mtk5\">configure</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Retrieve the comments for the open Retrospective, for this category</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  category </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command_text</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> retrospective.</span><span class=\"mtk5\">comments</span><span class=\"mtk1\">.</span><span class=\"mtk5\">where</span><span class=\"mtk1\">(</span><span class=\"mtk4\">category:</span><span class=\"mtk1\"> category)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Initialize an array of comment blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments_blocks </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> []</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Add the comment content</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments.</span><span class=\"mtk5\">each</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |comment|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    comments_blocks </span><span class=\"mtk7\">&lt;&lt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;section&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;mrkdwn&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> comment.</span><span class=\"mtk5\">content</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Add a divider after each comment</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    comments_blocks </span><span class=\"mtk7\">&lt;&lt;</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;divider&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Send `blocks` instead of `text`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  slack_client.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> channel_id,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">blocks:</span><span class=\"mtk1\"> comments_blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Notice that each block must have a <code>type</code> attribute. See the Slack documentation on <a href=\"https://api.slack.com/reference/block-kit/blocks\" class=\"markdown-link\">Reference Blocks</a> for the full list of block types and how to use them.</p>\n<p class=\"markdown-para\">Restarting the Rails server <code>bin/dev</code> and entering <code>/retro-discuss keep</code> again in the Slack workspace will result in this response:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ef4d78835ddff34fc2095b58484425a/019a6/slack-app-comment-block-section-divider.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.000000000000004%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA5klEQVR42l2RW7KCMBBEWYeKIUQEYoCQFw9L97+rvjWDcEs/TnWHYjo9kL3SChsSfJigzYCq1pDqjlxI5KL84looCHljdn/Oiy+y4GfMzxeW5xshLfBxhgsTRh9ZQ5ox+vTxy3Epca81ThfBUBhpdsoFNyLKWw2pKhRlxf6Xrfl/48tVbo0LdYRmqmq4wTAGVusCe2pK5zitrLunljEtm04rv0cZRyDdHHg4oreelUKti+gGx+EuJJh+RPvoYTrLStD69Jw2OgKpcqM7/iZ1a9Bow8o0DzSt4WFal4ZoTebzE/bzHvgHl8iw0uJq7XQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack-app-comment-block-section-divider\"\n        title=\"slack-app-comment-block-section-divider\"\n        src=\"/static/4ef4d78835ddff34fc2095b58484425a/5a190/slack-app-comment-block-section-divider.png\"\n        srcset=\"/static/4ef4d78835ddff34fc2095b58484425a/772e8/slack-app-comment-block-section-divider.png 200w,\n/static/4ef4d78835ddff34fc2095b58484425a/e17e5/slack-app-comment-block-section-divider.png 400w,\n/static/4ef4d78835ddff34fc2095b58484425a/5a190/slack-app-comment-block-section-divider.png 800w,\n/static/4ef4d78835ddff34fc2095b58484425a/c1b63/slack-app-comment-block-section-divider.png 1200w,\n/static/4ef4d78835ddff34fc2095b58484425a/29007/slack-app-comment-block-section-divider.png 1600w,\n/static/4ef4d78835ddff34fc2095b58484425a/019a6/slack-app-comment-block-section-divider.png 1818w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">This time the response is easier to read because each comment is rendered in its own <code>section</code> block, which is similar to a <code>&#x3C;div></code> in HTML, and followed by a <code>divider</code> block, which is similar to an <code>&#x3C;hr></code> element in HTML.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"contextual-information\" style=\"position:relative;\"><a href=\"#contextual-information\" aria-label=\"contextual information permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Contextual Information</h3>\n<p class=\"markdown-para\">We'd also like to see the user that posted the comment and when it was posted. Since this information is not as visually important as the content of the comment itself, it can go in a <a href=\"https://api.slack.com/reference/block-kit/blocks#context\" class=\"markdown-link\">context</a> block, which is used to display contextual information.</p>\n<p class=\"markdown-para\">The <code>context</code> block functions as a \"parent\" block. It accepts a list of \"children\" <code>elements</code>, each of which must be a valid block. So we'll have one element to show the user information, and another element to show the date. The <code>emoji: true</code> attribute is set on the elements so we can render emoji's as well. This helps with the visual cues to indicate what kind of information this is.</p>\n<p class=\"markdown-para\">Here is the updated version of the code that adds contextual information about each comment. Note the check for \"anonymous\" comment when rendering the user name. For the posted date, the comment model's <code>created_at</code> timestamp is formatted to display in <code>YYYY-MM-DD</code> format:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands/retro_discuss.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">SlackRubyBotServer</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Events</span><span class=\"mtk1\">.</span><span class=\"mtk5\">configure</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Retrieve the comments for the open Retrospective, for this category</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  category </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command_text</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> retrospective.</span><span class=\"mtk5\">comments</span><span class=\"mtk1\">.</span><span class=\"mtk5\">where</span><span class=\"mtk1\">(</span><span class=\"mtk4\">category:</span><span class=\"mtk1\"> category)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Initialize an array of comment blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments_blocks </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> []</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments.</span><span class=\"mtk5\">each</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |comment|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Add the comment content</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    comments_blocks </span><span class=\"mtk7\">&lt;&lt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;section&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;mrkdwn&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> comment.</span><span class=\"mtk5\">content</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Add the user and date as contextual info</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    comments_blocks </span><span class=\"mtk7\">&lt;&lt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;context&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">elements:</span><span class=\"mtk1\"> [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;plain_text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">emoji:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:bust_in_silhouette: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">comment.</span><span class=\"mtk5\">anonymous</span><span class=\"mtk1\"> </span><span class=\"mtk7\">?</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;anonymous&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">:</span><span class=\"mtk1\"> comment.</span><span class=\"mtk5\">slack_username</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;plain_text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">emoji:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">          </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:calendar: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">comment.</span><span class=\"mtk5\">created_at</span><span class=\"mtk1\">.</span><span class=\"mtk5\">strftime</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;%Y-%m-%d&#39;</span><span class=\"mtk1\">)</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Add a divider after each comment</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    comments_blocks </span><span class=\"mtk7\">&lt;&lt;</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;divider&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  slack_client.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> channel_id,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">blocks:</span><span class=\"mtk1\"> comments_blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">The above code results in the following response to the <code>/retro-discuss keep</code> slash command:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1bbee15b2424c3377a1f4b7dfd70ca01/ca3c3/slack-app-comment-blocks-context.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABEklEQVR42l1R2ZKDMAzjL3aBcqRcgXCVFgiU7f7/V2lHHujQfVCs2DO2LDtTd8fLbhhGi/tooU2DrKigkhzxNROoJEOkUonMn+EHMbxLJJFwojhD3Q6w64bJrhinBfdxxmOyGB6zcA7qh1HqdXtDkmmkeSmDL6H6bOh6AQKV45pqhCpBbVpobRCqFK4f4tsLBOTEl3v5AHNseMDhc01yVHUHXTXvePC67WGaXnhp2vf/APNUfKh0OL0oa6zbC5N94jEtsv68POVv1x+s2y/mZRM7GJkf51XAOhu6/t6QkrkuvaGqpr3B7Go4iCCnX4cK+ibH2PnZR8fzQ0RpiSQv5Wp9d0OhjVz3uODZ9P9XPdfp4R9YxstcyVQE2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack-app-comment-blocks-context\"\n        title=\"slack-app-comment-blocks-context\"\n        src=\"/static/1bbee15b2424c3377a1f4b7dfd70ca01/5a190/slack-app-comment-blocks-context.png\"\n        srcset=\"/static/1bbee15b2424c3377a1f4b7dfd70ca01/772e8/slack-app-comment-blocks-context.png 200w,\n/static/1bbee15b2424c3377a1f4b7dfd70ca01/e17e5/slack-app-comment-blocks-context.png 400w,\n/static/1bbee15b2424c3377a1f4b7dfd70ca01/5a190/slack-app-comment-blocks-context.png 800w,\n/static/1bbee15b2424c3377a1f4b7dfd70ca01/c1b63/slack-app-comment-blocks-context.png 1200w,\n/static/1bbee15b2424c3377a1f4b7dfd70ca01/29007/slack-app-comment-blocks-context.png 1600w,\n/static/1bbee15b2424c3377a1f4b7dfd70ca01/ca3c3/slack-app-comment-blocks-context.png 1850w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">This is looking much better.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"header\" style=\"position:relative;\"><a href=\"#header\" aria-label=\"header permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Header</h3>\n<p class=\"markdown-para\">The last thing to add is a header showing the category of the feedback, and a smaller sub-section just below the header to display how many comments were found for that category. The category is defined as an enum in the <code>Comment</code> model. Rather than just displaying the word \"keep\" or \"stop\", a <code>header</code> method can be added to convert it to an phrase for display as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># app/models/comment.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">Comment</span><span class=\"mtk5 mtki mtku\"> &lt; ApplicationRecord</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  belongs_to </span><span class=\"mtk4\">:retrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  enum </span><span class=\"mtk4\">category:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">keep:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;keep&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">stop:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;stop&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">try:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;try&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># === NEW: Convert category enum to phrase</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">self.header</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">category</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">case</span><span class=\"mtk1\"> category.</span><span class=\"mtk5\">to_sym</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">when</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:keep</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk6\">&quot;What we should keep on doing&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">when</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:stop</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk6\">&quot;What we should stop doing&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">when</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:try</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk6\">&quot;Something to try for next time&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">else</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk6\">&quot;Unknown category&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Now the <code>Comment.header()</code> method can be used in building the header in the <code>/retro_discuss</code> handler as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands/retro_discuss.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">SlackRubyBotServer</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Events</span><span class=\"mtk1\">.</span><span class=\"mtk5\">configure</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Retrieve the comments for the open Retrospective, for this category</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  category </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command_text</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> retrospective.</span><span class=\"mtk5\">comments</span><span class=\"mtk1\">.</span><span class=\"mtk5\">where</span><span class=\"mtk1\">(</span><span class=\"mtk4\">category:</span><span class=\"mtk1\"> category)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Initialize an array of comment blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments_blocks </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> []</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Add the header block</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments_blocks </span><span class=\"mtk7\">&lt;&lt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;header&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;plain_text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Comment</span><span class=\"mtk1\">.</span><span class=\"mtk5\">header</span><span class=\"mtk1\">(category)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Add a sub-header as a section</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Use markdown to bold the number of comments</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments_blocks </span><span class=\"mtk7\">&lt;&lt;</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;section&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;mrkdwn&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Found *</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">comments.</span><span class=\"mtk5\">size</span><span class=\"mtk7\">}</span><span class=\"mtk6\">* comments in this category:&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Add a divider to separate the sub-header from the comments</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments_blocks </span><span class=\"mtk7\">&lt;&lt;</span><span class=\"mtk1\"> { </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;divider&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  comments.</span><span class=\"mtk5\">each</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |comment|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># comment content...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  slack_client.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> channel_id,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">blocks:</span><span class=\"mtk1\"> comments_blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Note that the <code>text</code> attribute of the <code>section</code> type can set to <code>mrkdwn</code>. In this case the <code>comments.size</code> value is wrapped in <code>*</code> so that it renders as bold in the Slack response.</p>\n<p class=\"markdown-para\">Putting this all together, the app responds with a fully formatted list of comments as shown below:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0feae9606db7c4168c6c0cbf98be86f4/9b1e2/slack-app-comment-blocks-with-header.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABMklEQVR42n1S2XKDMBDLV7ThvjHG2OYwhCYPnf7/R6mzm0BJ0+mDZjXLei3JnPrW4uv6iXm9Yb5c0Y8ztB1RiRZCKmRFDT9MEETpv9hmTnFSoJEGbvlAPzquhGFauJa1xNmP+ADBC+InbP19oR/GCOOMFW0oqmbn9C3JSkRJjiQtkOYVg3ppXr4qJJKXgtWMboEdHOwwsXVSOc3rrpgi2eI4XviyMMpqFPU9r04ZKGVYBQ38tvbuhXg7B1wJFIcX/GTMC+mwVAZSaSjdo1UGTasZ8sGF7Bhbj2a3Pjl8sTzNF7ZHVkd351TJ5rLe4OaVe8yXdX88AjkjFweFNUw/QWkLbQdoM3BtO8tqKTdSFafF4zEq5gRaRg/2pDDOBURrkFcC0+jQ6Z45DR5x/EX+Ai38BmOoA1cxE9PzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack-app-comment-blocks-with-header.png\"\n        title=\"slack-app-comment-blocks-with-header.png\"\n        src=\"/static/0feae9606db7c4168c6c0cbf98be86f4/5a190/slack-app-comment-blocks-with-header.png\"\n        srcset=\"/static/0feae9606db7c4168c6c0cbf98be86f4/772e8/slack-app-comment-blocks-with-header.png 200w,\n/static/0feae9606db7c4168c6c0cbf98be86f4/e17e5/slack-app-comment-blocks-with-header.png 400w,\n/static/0feae9606db7c4168c6c0cbf98be86f4/5a190/slack-app-comment-blocks-with-header.png 800w,\n/static/0feae9606db7c4168c6c0cbf98be86f4/c1b63/slack-app-comment-blocks-with-header.png 1200w,\n/static/0feae9606db7c4168c6c0cbf98be86f4/29007/slack-app-comment-blocks-with-header.png 1600w,\n/static/0feae9606db7c4168c6c0cbf98be86f4/9b1e2/slack-app-comment-blocks-with-header.png 1880w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 class=\"markdown-subtitle\" id=\"refactor\" style=\"position:relative;\"><a href=\"#refactor\" aria-label=\"refactor permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Refactor</h2>\n<p class=\"markdown-para\">While the current version of the code in the <code>/retro-discuss</code> handler works, there are several issues:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\">It's too long, triggering the Rubocop <code>Metrics/BlockLength</code> rule.</li>\n<li class=\"markdown-list-item\">The verbose syntax of the Slack blocks mixed in with the business logic makes it difficult to understand what this code is actually doing.</li>\n<li class=\"markdown-list-item\">There's no validation - for example, what if the user types in <code>/retro-discuss foo</code> or doesn't provide a category at all? In this case the app should reply with a helpful message letting the user know to provide a valid category.</li>\n</ul>\n<p class=\"markdown-para\">This will be resolved in a similar way to what was done in Part 2 of this series, which is to <a href=\"../rails-slack-app-part2-slash-command-with-text-response#openretrospective-interactor\" class=\"markdown-link\">introduce an interactor</a> <code>DiscussRetrospective</code> to handle the validation and business logic. We'll also introduce a <code>SlackCommentBuilder</code> module for the responsibility of building the Slack blocks array.</p>\n<p class=\"markdown-para\">Starting with the <code>SlackCommentBuilder</code> module. This contains smaller methods to build each type of block and some methods to put them all together:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># lib/slack_comment_builder.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">module</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">SlackCommentBuilder</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">module_function</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_header_block</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">comments</span><span class=\"mtk1\">, </span><span class=\"mtk10 mtki\">category_display</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk5\">build_header</span><span class=\"mtk1\">(category_display),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk5\">build_section</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;Found *</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">comments.</span><span class=\"mtk5\">size</span><span class=\"mtk7\">}</span><span class=\"mtk6\">* comments in this category:&quot;</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      build_divider</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_comment_blocks</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">comments</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    comments.</span><span class=\"mtk5\">flat_map</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |comment|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk5\">build_comment_content</span><span class=\"mtk1\">(comment),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk5\">build_comment_context</span><span class=\"mtk1\">(comment),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        build_divider</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_header</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">category_display</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;header&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;plain_text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> category_display</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_section</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">text</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;section&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;mrkdwn&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk4\">text:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_comment_content</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">comment</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">build_section</span><span class=\"mtk1\">(comment.</span><span class=\"mtk5\">content</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_comment_context</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">comment</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;context&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">elements:</span><span class=\"mtk1\"> [</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk5\">build_context_element</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;:bust_in_silhouette: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">comment.</span><span class=\"mtk5\">user_info</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk5\">build_context_element</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;:calendar: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">comment.</span><span class=\"mtk5\">created_at</span><span class=\"mtk1\">.</span><span class=\"mtk5\">strftime</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;%Y-%m-%d&#39;</span><span class=\"mtk1\">)</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      ]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_context_element</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">text</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;plain_text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">emoji:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_divider</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    { </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;divider&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">And here is the <code>DiscussRetrospective</code> interactor:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">DiscussRetrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">include</span><span class=\"mtk1\"> Interactor</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">include</span><span class=\"mtk1\"> SlackCommentBuilder</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">call</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    retrospective </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Retrospective</span><span class=\"mtk1\">.</span><span class=\"mtk5\">find_by</span><span class=\"mtk1\">(</span><span class=\"mtk4\">status:</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Retrospective</span><span class=\"mtk1\">.</span><span class=\"mtk5\">statuses</span><span class=\"mtk1\">[</span><span class=\"mtk4\">:open</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> no_open_retrospective_message </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> retrospective.</span><span class=\"mtk5\">nil?</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    category </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> extract_valid_category</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> invalid_category_message </span><span class=\"mtk7\">unless</span><span class=\"mtk1\"> category</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    comments </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> retrospective.</span><span class=\"mtk5\">comments_by_category</span><span class=\"mtk1\">(</span><span class=\"mtk4\">category:</span><span class=\"mtk1\"> context.</span><span class=\"mtk5\">category</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">post_message</span><span class=\"mtk1\">(comments)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">rescue</span><span class=\"mtk1\"> StandardError =&gt; e</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">log_error</span><span class=\"mtk1\">(e)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    context.</span><span class=\"mtk5\">fail!</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">private</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">no_open_retrospective_message</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    message </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;There is no open retrospective. Please run `/retro-open` to open one.&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">send_error_message</span><span class=\"mtk1\">(message)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">extract_valid_category</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    category </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> context.</span><span class=\"mtk5\">category</span><span class=\"mtk7\">&amp;.</span><span class=\"mtk5\">to_sym</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">return</span><span class=\"mtk1\"> category </span><span class=\"mtk7\">if</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Comment</span><span class=\"mtk1\">.</span><span class=\"mtk5\">categories</span><span class=\"mtk1\">.</span><span class=\"mtk5\">key?</span><span class=\"mtk1\">(category)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">nil</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">invalid_category_message</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    valid_categories </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Comment</span><span class=\"mtk1\">.</span><span class=\"mtk5\">categories</span><span class=\"mtk1\">.</span><span class=\"mtk5\">keys</span><span class=\"mtk1\">.</span><span class=\"mtk5\">map</span><span class=\"mtk1\">(</span><span class=\"mtk7\">&amp;</span><span class=\"mtk4\">:to_s</span><span class=\"mtk1\">).</span><span class=\"mtk5\">join</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;, &quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    message </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Invalid discussion category. Please provide a valid category (</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">valid_categories</span><span class=\"mtk7\">}</span><span class=\"mtk6\">).&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">send_error_message</span><span class=\"mtk1\">(message)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">post_message</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">comments</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    blocks </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_header_block</span><span class=\"mtk1\">(comments, </span><span class=\"mtk9 mtki\">Comment</span><span class=\"mtk1\">.</span><span class=\"mtk5\">header</span><span class=\"mtk1\">(context.</span><span class=\"mtk5\">category</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    blocks </span><span class=\"mtk7\">+=</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_comment_blocks</span><span class=\"mtk1\">(comments)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk5\">send_message</span><span class=\"mtk1\">(blocks)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">send_message</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">blocks</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    context.</span><span class=\"mtk5\">slack_client</span><span class=\"mtk1\">.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> context.</span><span class=\"mtk5\">channel_id</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;fallback TBD&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">blocks:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">send_error_message</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">text</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    warning_icon </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;:warning:&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    context.</span><span class=\"mtk5\">slack_client</span><span class=\"mtk1\">.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> context.</span><span class=\"mtk5\">channel_id</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">warning_icon</span><span class=\"mtk7\">}</span><span class=\"mtk6\"> </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">text</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">log_error</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">error</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    error_message </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;Error in DiscussRetrospective: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">error.</span><span class=\"mtk5\">message</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    backtrace </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> error.</span><span class=\"mtk5\">backtrace</span><span class=\"mtk1\">.</span><span class=\"mtk5\">join</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;</span><span class=\"mtk4\">\\n</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">logger</span><span class=\"mtk1\">.</span><span class=\"mtk5\">error</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&quot;</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">error_message</span><span class=\"mtk7\">}</span><span class=\"mtk4\">\\n</span><span class=\"mtk7\">#{</span><span class=\"mtk1\">backtrace</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\"><strong class=\"markdown-strong\">What's going on:</strong></p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\">The inputs <code>category</code>, <code>channel_id</code>, and <code>slack_client</code> are provided via the <a href=\"https://github.com/collectiveidea/interactor?tab=readme-ov-file#context\" class=\"markdown-link\">context</a> object, which contains everything the interactor needs to do its work.</li>\n<li class=\"markdown-list-item\">Validation is performed on <code>category</code>, if its <code>nil</code> or an unknown category, an error message is sent back to the channel.</li>\n<li class=\"markdown-list-item\">Given that <code>category</code> is valid, the comments for this category are retrieved from the open <code>Retrospective</code></li>\n<li class=\"markdown-list-item\">The <code>comments</code> are then passed to the methods of <code>SlackCommentBuilder</code> to build the blocks array.</li>\n<li class=\"markdown-list-item\">The resulting <code>blocks</code> are sent back to the channel.</li>\n</ul>\n<p class=\"markdown-para\">Finally, the <code>/retro-discuss</code> handler is updated, removing all the previous business logic, and instead it delegates to the <code>DiscussRetrospective</code> interactor, passing it the inputs it needs:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># bot/slash_commands/retro_discuss.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk9 mtki\">SlackRubyBotServer</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Events</span><span class=\"mtk1\">.</span><span class=\"mtk5\">configure</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |config|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># Essentially this is saying to the SlackRubyBotServer,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># If a &quot;/retro-discuss&quot; slash command is received from Slack,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># then execute this block.</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  config.</span><span class=\"mtk5\">on</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:command</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&quot;/retro-discuss&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |command|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Use `command[:team_id]` from request parameters sent to us</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># by Slack to find the Team model persisted in the database</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    team </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Team</span><span class=\"mtk1\">.</span><span class=\"mtk5\">find_by</span><span class=\"mtk1\">(</span><span class=\"mtk4\">team_id:</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:team_id</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Instantiate a slack client with the team token</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># so we can communicate back to the channel</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    slack_client </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">Slack</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Web</span><span class=\"mtk1\">::</span><span class=\"mtk9 mtki\">Client</span><span class=\"mtk1\">.</span><span class=\"mtk7\">new</span><span class=\"mtk1\">(</span><span class=\"mtk4\">token:</span><span class=\"mtk1\"> team.</span><span class=\"mtk5\">token</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># This is the Slack channel we need to respond back to</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    channel_id </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:channel_id</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># If user entered /retro-discuss keep</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># in Slack, then command_text will be: keep</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command_text </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> command[</span><span class=\"mtk4\">:text</span><span class=\"mtk1\">]</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    command.</span><span class=\"mtk5\">logger</span><span class=\"mtk1\">.</span><span class=\"mtk5\">info</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;=== COMMAND: retro-discuss, Team: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">team.</span><span class=\"mtk5\">name</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Channel: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">channel_id</span><span class=\"mtk7\">}</span><span class=\"mtk6\">, Text: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">command_text</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Delegate to the interactor passing in `command_text` as the category, and channel_id and slack_client</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">DiscussRetrospective</span><span class=\"mtk1\">.</span><span class=\"mtk5\">call</span><span class=\"mtk1\">(</span><span class=\"mtk4\">category:</span><span class=\"mtk1\"> command_text, </span><span class=\"mtk4\">channel_id:</span><span class=\"mtk1\">, </span><span class=\"mtk4\">slack_client:</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Return `nil`, otherwise the slack-ruby-bot-server-events gem</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># replies to the channel with a message &quot;true&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">nil</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">At this point, we have a functioning Slack application built with Rails. There's just a few more topics to cover before wrapping up.</p>\n<h2 class=\"markdown-subtitle\" id=\"debugging-blocks\" style=\"position:relative;\"><a href=\"#debugging-blocks\" aria-label=\"debugging blocks permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Debugging Blocks</h2>\n<p class=\"markdown-para\">A common issue that can occur when working with the block kit UI is that you accidentally put together the blocks in an invalid way or specify some attribute value that's not allowed. For example, suppose in <code>SlackCommentBuilder</code> module, we had specified a <code>type: \"button\"</code> instead of <code>type: \"plain_text\"</code> for the context element:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># lib/slack_comment_builder.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">module</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">SlackCommentBuilder</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">build_context_element</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">text</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk3\"># type: &quot;plain_text&quot;,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">type:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;button&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">emoji:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">In this case, when the message is sent to Slack using the <code>slack_client</code>:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"11\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># app/interactors/discuss_retrospective.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">DiscussRetrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk3\"># ...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">send_message</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">blocks</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    context.</span><span class=\"mtk5\">slack_client</span><span class=\"mtk1\">.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;some_channel_id&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;some_fallback_text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">blocks:</span><span class=\"mtk1\"> blocks </span><span class=\"mtk3\"># Invalid due to bug in SlackCommentBuilder</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">Slack will return an <code>invalid blocks</code> error. When working with the <a href=\"https://github.com/slack-ruby/slack-ruby-bot-server-events\" class=\"markdown-link\">slack-ruby-bot-server-events</a> gem, it uses the <a href=\"https://github.com/slack-ruby/slack-ruby-client\" class=\"markdown-link\">slack-ruby-client</a> gem, which in turn uses <a href=\"https://github.com/lostisland/faraday\" class=\"markdown-link\">faraday</a> to communicate with the Slack API via HTTP. Here's what this error looks like in the Rails server output:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"12\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">Error in DiscussRetrospective: invalid_blocks</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">slack-ruby-client-2.2.0/lib/slack/web/faraday/response/raise_error.rb:19:in `on_complete&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">faraday-2.7.11/lib/faraday/middleware.rb:18:in `block in call&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">...</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">retro-pulse/app/interactors/discuss_retrospective.rb:54:in `post_message&#39;</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">retro-pulse/app/interactors/discuss_retrospective.rb:25:in `call&#39;</span></span></code></pre>\n<p class=\"markdown-para\">Unfortunately, the error doesn't include specify <em class=\"markdown-emphasis\">what</em> is wrong with the blocks. To resolve these kinds of errors, add a debug statement that outputs the json value of the blocks, just before the blocks get sent to Slack:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"13\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># app/interactors/discuss_retrospective.rb</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">class</span><span class=\"mtk1\"> </span><span class=\"mtk5 mtku\">DiscussRetrospective</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">def</span><span class=\"mtk1\"> </span><span class=\"mtk5\">send_message</span><span class=\"mtk1\">(</span><span class=\"mtk10 mtki\">blocks</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">logger</span><span class=\"mtk1\">.</span><span class=\"mtk5\">debug</span><span class=\"mtk1\"> { </span><span class=\"mtk6\">&quot;=== BLOCKS: </span><span class=\"mtk7\">#{</span><span class=\"mtk1\">blocks.</span><span class=\"mtk5\">to_json</span><span class=\"mtk7\">}</span><span class=\"mtk6\">&quot;</span><span class=\"mtk1\"> }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    context.</span><span class=\"mtk5\">slack_client</span><span class=\"mtk1\">.</span><span class=\"mtk5\">chat_postMessage</span><span class=\"mtk1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">channel:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;some_channel_id&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">text:</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&quot;some_fallback_text&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">blocks:</span><span class=\"mtk1\"> blocks</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">When this code runs, the Rails server output will include a debug line like this:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"14\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">=== BLOCKS: [{&quot;type&quot;:&quot;header&quot;,&quot;text&quot;:{&quot;type&quot;:&quot;plain_text&quot;,&quot;text&quot;:&quot;What we should keep on doing&quot;}}...]</span></span></code></pre>\n<p class=\"markdown-para\">Highlight and copy the entire blocks array from the Rails server output: <code>[...]</code>.</p>\n<p class=\"markdown-para\">Then open a browser tab to Slack's <a href=\"https://api.slack.com/tools/block-kit-builder\" class=\"markdown-link\">Block Kit Builder</a>. You need to be signed in to a Slack workspace to use this feature.\nThis renders a split screen view where on the right hand side you can enter any blocks JSON, and on the left hand side it will show you the rendered result. If invalid blocks JSON is entered, then Slack will show a red X mark beside the invalid line. Hovering over it will display what's wrong with this line.</p>\n<p class=\"markdown-para\">For example, pasting in the blocks JSON from the buggy version of our code and hovering over the red X shows that <code>button</code> is in invalid type for the <code>context</code> block. The message helpfully lists the valid values which are: <code>\"image\", \"plain_text\", \"mrkdwn\"</code>:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/96842a20774d8af832db68d155bf2f7e/a13c9/slack-block-kit-builder-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqUlEQVR42p2TTW7bMBCFdf9Nb9Eb5AJF110VQVoUCOCksqw/DsnhDCk6fQUZK7FjFxC6+MAfScP3HkdNUEFMsbLkjHy85ng8IkaFtRYiAuccgjKGqYcGwcEZfPpyh8/fvqIZpwnTTJhnQlJFiglR4xVJE5a01Od11ISccl0XkF/wZzmiURGoRFiOmIyDNfRa4PTiytUh8XKtJ5rAAVEUIorRMoZ+qFiyIENQ+bfqWzQlDwkCzwLnGez5osC5wo+qb9GUoIvtIBG9YRy6A8xs4KyrFKVrsS1Fm/JRsV1UFttFYZkXqytb7VbLRBYSAjwrnGME5rfb/B+q5eAZ1gvawWDftvDO1xiq6hNF6a35+V5VyOUyLFcMMbpuwDwRvAuw9J5jOaSM63zdX7Mu1ILj/glD94hhfEbf7+DdHlEnBO6h4rGkfNHQ53F8XFfLw9MPdN0DxvEXdr8f8Lj7jra9xzj+hKWhNn3U7RfT2JkQY0ZOLwiSQU5Bs4N3Au8YZEzNaHPblBxK2ywxgrygn23tRUv0un+ytL2xid5vThQhKJjDW2+e/zFbFP4FDsqIO0dtKiIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack block kit builder error\"\n        title=\"slack block kit builder error\"\n        src=\"/static/96842a20774d8af832db68d155bf2f7e/5a190/slack-block-kit-builder-error.png\"\n        srcset=\"/static/96842a20774d8af832db68d155bf2f7e/772e8/slack-block-kit-builder-error.png 200w,\n/static/96842a20774d8af832db68d155bf2f7e/e17e5/slack-block-kit-builder-error.png 400w,\n/static/96842a20774d8af832db68d155bf2f7e/5a190/slack-block-kit-builder-error.png 800w,\n/static/96842a20774d8af832db68d155bf2f7e/a13c9/slack-block-kit-builder-error.png 1178w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 class=\"markdown-subtitle\" id=\"app-manifest\" style=\"position:relative;\"><a href=\"#app-manifest\" aria-label=\"app manifest permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>App Manifest</h2>\n<p class=\"markdown-para\">Throughout this series, we've been using Slack's web UI to build up the application. This has involved opening a browser tab to <a href=\"https://api.slack.com/apps\" class=\"markdown-link\">Your Slack Apps</a> (need to be signed in to Slack workspace), then using the Settings and Features sections to tell Slack what this app supports. For example, to enable receiving a modal form submission in Part 4, we had to enable interactivity by filling out the URL that Slack should POST to:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 727px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/79d4da9a6e444a22b68322055bb86f09/c54b3/slack-app-interactivity-enter-url.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.50000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABj0lEQVR42o2SbXKbMBCGuf8hcoReoX8zaTINdkwct3GQZD5EjMApICRhvRkttutpZzqFeebdXcGutKvo4f4BySrB4/dHLOIF1s/ri716WuFl/YJRjzDakF4TYlpr6EFf/Gi73UJwgTRNSRljCLHA2/aN4pRgPPGHjckDR8CMc8HIw6PrO4xmRD/0+N/HnzQuGG75Bu44wRiDqGkbxIsYyXOC5dMSspLQo8aghwvBD8XOGmJzcY8vqzvc3H+FnRxsSBgWS1mieq8gpUSWZxBCgHMGxhnEToALTuR5Ti3Ish2tV6qFdfN2PY507KjvOxRlQQnD0a2zhLGGOPtucjPO0k4J6/AReurmrJQw3yt8WyaI1xtsUgFR1RByD1a+gxUVuJw1LaqTv0fdDVCdJm16Ddl2qH8NmKxFpLoBr1lJH7+KHD95RhoIBX6wHenZDuT7BkXdIq+bGXVA22u4kHAcNWpVoz20xOHjAKUUaZi8MeGKaNKzra8GFobjJvv7yKEv9KM1f6n/53t9hTyOfh7KJ2cN+UYDzHzdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app interactivity enter url\"\n        title=\"slack app interactivity enter url\"\n        src=\"/static/79d4da9a6e444a22b68322055bb86f09/c54b3/slack-app-interactivity-enter-url.png\"\n        srcset=\"/static/79d4da9a6e444a22b68322055bb86f09/772e8/slack-app-interactivity-enter-url.png 200w,\n/static/79d4da9a6e444a22b68322055bb86f09/e17e5/slack-app-interactivity-enter-url.png 400w,\n/static/79d4da9a6e444a22b68322055bb86f09/c54b3/slack-app-interactivity-enter-url.png 727w\"\n        sizes=\"(max-width: 727px) 100vw, 727px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">That URL is an <a href=\"../rails-slack-app-part1-oauth#ngrok\" class=\"markdown-link\">ngrok</a> address that's forwarding requests from Slack to the Rails app running on localhost. We setup ngrok in Part 1 of this series. An issue to be aware of with the free ngrok version is that every time you restart it, it assigns a new url. That means going back into the Slack app configuration and updating all url's such as the OAuth redirect, interactivity, and slash commands sections. This is tedious and error prone.</p>\n<p class=\"markdown-para\">To save yourself this manual effort, there is an easier way. Under the Features section of your Slack app, select \"App Manifest\". This provides a text representation of the Slack app in either YAML or JSON format. Click on the JSON format, it will look something like this:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bc32e3c9ebd2b3be8a7d83329f2e8a34/bb051/slack-app-manifest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 157%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAYAAADnTu3OAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEd0lEQVR42o1WyY7kRBCtX+eMOHOZO+KK4NQ3EGIkJDSAZhE9vbi6q7wvuW+2H4rIck0VPRphK2RXlv3yvcgXkd49FXsURYFxHBFigLMOzjm0bYuyLDFOI9Z1xbIuF7FiXhfQcddX+ObnH/Ht6xscxx678ljiw/sPGIcR1lo4kwEPxwOK4hFNU8MHf44QHKyzMNYgxYi75ohXv93guz9+Qasm7IZ+QPFYoG1aZmeNhfceVV2hrEoG3u/3OZ4P2B9KHKuaAWmCZU7YjnVZsOvaDh9vP0JMAt55BiSGkxjRdy2UErBWQ2sF6wMGoTAKgRA9j2mjYZyF1JKJ7PquZ4ZVWTGosx7GGCil0IoJwhgYH+BCQJojrDOQSjKIUDLf2zzmncOurmrc/nObmZ0kE2gMAW5e0ZrAE9m+Q/IOSwxYoseSItaZImEJHlhmpDnlHD4/PWMaJwQfTpI9vJJwRqMyAZ1L0MbCHJ/hhh5BTIhaISiZQ0wISjCJcw4pmrphlt4HeCnhxYSx6zFUNVTbwjUVTFXCdQ1sXfHVlIc8UdsgkGQCfHx4xOH5ACkkjDaIaeYXTPEAW9zDHp74JQKjcQ6+L2GrI/ThCb5vkVLCrqNFKfY4Ho5QUmfbkGRaGClhlOK8reuCdZmzsSlvFPT7FPR/JMCx6/D0cI/HuztYKTjZWulsXACViai1h/IBRkpEZxl0vTi3XzFF7H76/Q5fff8ar27+xtc/vMHNmwIrecwYflH6iJ4WJSZm8AkMGexUjmfA232FX//8iLf3Jf56aFBUI7y17EN6yIaA3gZYJZHkBD+NbB+2EEk9AZ8B6+MRt+/foj4egBQxB88+dFojaYmoJfpuwNT18GKEJ9sQ8DggOYtEqQk+A8aIHVnl3bv3eLh/hBSKwSiHUkquzzjPaExE4xcoqbgsidkcA+YUkYLj6xmQbELmphIkIPIhjVH5ZcAEk2b4GHhBglaYqUJY6nWwZJqVWFK3IU8SGIMKgaQVV0zTDhirmr1mnvfZf03F1ZK8RbQac/SZIbEiIGLIkrjBelghEKn8pgFinDApA5tmhJQ9SDI5YuAc0hgDEkjfZjAyNAFyDpXKkpcZcl5hY4Jnxiqb+so+F5J1P8H2Eyf73HEoKFc+54wah+5aRFrdvsvNQE7sCPbhuVJi7jYU7tRcc8cOMF3HdUqAYhhZdhAjwjTA9S1c18L1HfuSrpQebl+Uu6qqLnrhJ4ZUw2meMbiI0eWStEJy3jbJLxgSCK3sxu5FDucEGWfYEOG1hjf6U1PYQC8rhVf1MjaWSiEZzZJHymHbsmTOoaQcirOhr2p5Y3bJkBgrKYAlIQaPXlm0xkPzRBrJqGyVzzWHjdkLQK0RlwWRNvWTLZZTvKyS9fOA2/3G0ISIehDo2w6WmoHViGYLlYPslXIpsrH/C7jtelQp5De60t5CneWqQi4it7EvSN5WmWYdQ4KeRszBXcn73PlFyfRVkD8v5ryzVccs7eqjafl/i5IZSn4opYhoTe4s1lwZ+rynXAD+C06pWFawqjEuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app manifest\"\n        title=\"slack app manifest\"\n        src=\"/static/bc32e3c9ebd2b3be8a7d83329f2e8a34/5a190/slack-app-manifest.png\"\n        srcset=\"/static/bc32e3c9ebd2b3be8a7d83329f2e8a34/772e8/slack-app-manifest.png 200w,\n/static/bc32e3c9ebd2b3be8a7d83329f2e8a34/e17e5/slack-app-manifest.png 400w,\n/static/bc32e3c9ebd2b3be8a7d83329f2e8a34/5a190/slack-app-manifest.png 800w,\n/static/bc32e3c9ebd2b3be8a7d83329f2e8a34/c1b63/slack-app-manifest.png 1200w,\n/static/bc32e3c9ebd2b3be8a7d83329f2e8a34/bb051/slack-app-manifest.png 1212w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">Notice all the url's and Slack client id are in this file.</p>\n<p class=\"markdown-para\">Make a copy of the JSON contents, and paste it into a new file in the Rails project root named <code>app_manifest_template.json</code>. Update this file, making the following replacements:</p>\n<ol class=\"markdown-list-ordered\">\n<li class=\"markdown-list-item\">Update all occurrences of the ngrok IP address with <code>SERVER_HOST_NAME</code></li>\n<li class=\"markdown-list-item\">Update all occurrences of your slack client id with <code>SLACK_CLIENT_ID</code></li>\n</ol>\n<p class=\"markdown-para\">Here's an example of <a href=\"https://github.com/danielabar/retro-pulse/blob/main/app_manifest_template.json\" class=\"markdown-link\">app_manifest_template.json</a> from the complete source of the Retro Pulse application on Github.</p>\n<p class=\"markdown-para\"><code>SERVER_HOST_NAME</code> and <code>SLACK_CLIENT_ID</code> were configured as environment variables in <a href=\"../rails-slack-app-part1-oauth#rails-blocked-host\" class=\"markdown-link\">Part 1</a> of this series.\nAdd the following rake task to generate the real manifest file from the template, replacing the environment variables with their actual values from the <code>.env</code> file:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"ruby\" data-index=\"15\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"># lib/tasks/app_manifest.rake</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">namespace </span><span class=\"mtk4\">:manifest</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  desc </span><span class=\"mtk6\">&#39;Generate and update app_manifest.json from app_manifest_template.json&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  task </span><span class=\"mtk4\">generate:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">:environment</span><span class=\"mtk1\"> </span><span class=\"mtk7\">do</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">require</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;json&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">require</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;dotenv&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Load environment variables from .env file in the project root directory</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">Dotenv</span><span class=\"mtk1\">.</span><span class=\"mtk9\">load</span><span class=\"mtk1\">(</span><span class=\"mtk9 mtki\">File</span><span class=\"mtk1\">.</span><span class=\"mtk5\">join</span><span class=\"mtk1\">(</span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">root</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&#39;.env&#39;</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Read the template JSON file from the project root</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    template_file </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> </span><span class=\"mtk9 mtki\">File</span><span class=\"mtk1\">.</span><span class=\"mtk5\">read</span><span class=\"mtk1\">(</span><span class=\"mtk9 mtki\">File</span><span class=\"mtk1\">.</span><span class=\"mtk5\">join</span><span class=\"mtk1\">(</span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">root</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&#39;app_manifest_template.json&#39;</span><span class=\"mtk1\">))</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Perform global replacements for SERVER_HOST_NAME and SLACK_CLIENT_ID</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    updated_content </span><span class=\"mtk7\">=</span><span class=\"mtk1\"> template_file</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      .</span><span class=\"mtk9\">gsub</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;SERVER_HOST_NAME&#39;</span><span class=\"mtk1\">, ENV[</span><span class=\"mtk6\">&#39;SERVER_HOST_NAME&#39;</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      .</span><span class=\"mtk9\">gsub</span><span class=\"mtk1\">(</span><span class=\"mtk6\">&#39;SLACK_CLIENT_ID&#39;</span><span class=\"mtk1\">, ENV[</span><span class=\"mtk6\">&#39;SLACK_CLIENT_ID&#39;</span><span class=\"mtk1\">])</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\"># Write the updated JSON to app_manifest.json in the project root</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9 mtki\">File</span><span class=\"mtk1\">.</span><span class=\"mtk9\">open</span><span class=\"mtk1\">(</span><span class=\"mtk9 mtki\">File</span><span class=\"mtk1\">.</span><span class=\"mtk5\">join</span><span class=\"mtk1\">(</span><span class=\"mtk9 mtki\">Rails</span><span class=\"mtk1\">.</span><span class=\"mtk5\">root</span><span class=\"mtk1\">, </span><span class=\"mtk6\">&#39;app_manifest.json&#39;</span><span class=\"mtk1\">), </span><span class=\"mtk6\">&#39;w&#39;</span><span class=\"mtk1\">) </span><span class=\"mtk7\">do</span><span class=\"mtk1\"> |file|</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      file.</span><span class=\"mtk5\">write</span><span class=\"mtk1\">(updated_content)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk9\">puts</span><span class=\"mtk1\"> </span><span class=\"mtk6\">&#39;app_manifest.json has been generated and updated.&#39;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">end</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">end</span></span></span></code></pre>\n<p class=\"markdown-para\">This will generate the real manifest file <code>app_manifest.json</code>. Make sure this is in <code>.gitignore</code> as it's a generated file and contains a secret.</p>\n<p class=\"markdown-para\">Now, every time you restart ngrok, you'll do the following:</p>\n<ol class=\"markdown-list-ordered\">\n<li class=\"markdown-list-item\">Update the new ngrok IP address in <code>.env</code></li>\n<li class=\"markdown-list-item\">Run the rake task: <code>bundle exec rake manifest:generate</code></li>\n<li class=\"markdown-list-item\">Copy the contents of <code>app_manifest.json</code> into the <a href=\"https://api.slack.com/apps\" class=\"markdown-link\">Your Slack App</a> Features: Manifest section, and save the changes.</li>\n</ol>\n<p class=\"markdown-para\">Then you can restart the Rails server with <code>bin/dev</code> and it will receive requests from Slack via the new ngrok forwarding address.</p>\n<h2 class=\"markdown-subtitle\" id=\"deployment\" style=\"position:relative;\"><a href=\"#deployment\" aria-label=\"deployment permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deployment</h2>\n<p class=\"markdown-para\">A full discussion of how to deploy Rails apps to production is out of scope for this post. But here's a few things to note for this app.</p>\n<p class=\"markdown-para\">Up until now, the Rails app has been running on a laptop, with ngrok forwarding traffic from Slack to <code>localhost</code>. For production use, you'll need to deploy your Rails application to a publicly accessible host, eg: <code>https://yourcompany-retropulse.com</code>. Then update all the url's in the Slack app to point to where the Rails app is running. You'll also need to make sure all the Slack environment variables (<code>SLACK_CLIENT_ID</code>, <code>SLACK_CLIENT_SECRET</code>, <code>SLACK_SIGNING_SECRET</code>, and <code>SLACK_VERIFICATION_TOKEN</code>) are populated in production.</p>\n<p class=\"markdown-para\">By default, the Slack app is <em class=\"markdown-emphasis\">not</em> available for public distribution. The Retro Pulse app described in this series is intended for just one team so this is fine, essentially it would only be installed in your workspace, which is the same one you've been developing it under.</p>\n<p class=\"markdown-para\">However, if you have a different kind of application and want to distribute it more widely, it requires activating public distribution. To do this, select the \"Manage Distribution\" option under Settings when logged into <a href=\"https://api.slack.com/apps\" class=\"markdown-link\">Your Slack App</a>:</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 313px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1303f6247d354739d794646185e95df4/80977/slack-app-settings-manage-distribution.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 109.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsTAAALEwEAmpwYAAADHklEQVR42pVUS08TURSuS/+BLoyJMSExLvwFujdx4VYXujAGYiRKMMaAaELiP0CDNCoWKVAe7tgqFFqmLQVbLOWhQym0pS3gPDrv+cy55ZZHBOptvpx7p/ec833nnBlPRa1Aq2ggqyoq+Pl/wf08Bw+27cDQDRaYgydS5er+OPA4tYCSJGF1aQXlchmu64J+juvANE04jgNahmFA0zRo+h40jT1T1X1lHspODgvJFO5ev4FBnx+xeAzBYBCpxRSisSgEYQahcAhqRWWBKRkt27EhKzJ0Q98PSBuSmcvl4fV+wfx8EltbBaTTaWQyGRRLRYiiiHR6EYqqMPaWbbFgZA3TYGwP1ZBYmoZRze66MA0Tlmkxq2t67UxOiqxAUfZBvmQPMSSn4lYR5VIZhVwBu9u74ImOFv60TldraDsIh8Lo8/Wh91MvxkbH4O3xYnpqGpZlMVYndfhgQg/fSH8kyJLMnGm/kd1ge0pmWzaTzGWfxJIxpIvLS8sITYeQ+JHAyvIK5uJziM/GkUwkEY1EEREi7A6XdlzgWg2pfuJvEbnNHErFEmNIyOfyWBPXav/VHXBneweFfAHZ9SxzZA3KFxhIOsmmbp8qmc9hZi3DGjPxfQJTwSkml6RSY4jdQWYnMuQXieXeC8AWsXGd6oN6mnGIITlQI4QZgbEkZrFojLEjxsSQy61LMh8bGm4+4DRCZKmmVF9SUH9ATUe+UIS4tl6FSMggm92EqmpQVA2SpEKS/w1ZPvK1cS0LcjGH1YV5iKkE1pd+sv3CrEAVBOCcAnv/1bMNA782y+gciaNzbB4dgTjaA7PoCMzizdc5tA1E8HIggja/gLYBAS/6Z9A+IKBjMIJXQxF27hpPQOMM4VoYj4k4e68X156P4sIjP662juBcYz8uPh7EldYRNLQM4/KTAC41D6Hh6TDO3PkAz6138NzuhudmF843+aEoFegU0DENpNdLaOyZRMvnEFp9YZadbPPHaTzzhdlzsq2+qm3yBvGgewIP30/i/ttveD0UPfxxMHWaQQtwLMA2afCqlp+55aC7sAHXrlrHqtXwL57eUilkQlXeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app settings manage distribution\"\n        title=\"slack app settings manage distribution\"\n        src=\"/static/1303f6247d354739d794646185e95df4/80977/slack-app-settings-manage-distribution.png\"\n        srcset=\"/static/1303f6247d354739d794646185e95df4/772e8/slack-app-settings-manage-distribution.png 200w,\n/static/1303f6247d354739d794646185e95df4/80977/slack-app-settings-manage-distribution.png 313w\"\n        sizes=\"(max-width: 313px) 100vw, 313px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p class=\"markdown-para\">Then Make sure all the required steps are checked off as shown below, then click on Activate Public Distribution (only if you want <em class=\"markdown-emphasis\">any</em> company/team/workspace to be able to install the app):</p>\n<p class=\"markdown-para\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a2df189ee20cf4901025a837efd14e06/ee455/slack-app-public-distribution.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 94%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACsElEQVR42oVUy47TQBD0P+4V+BC+Ak57QUhwWQnlwh0tcCUghcOKZBM/4vjtscfx+5lC3Y6XbJQIR6WeiWdqeqqrraRZiiiOIBP5BBEJuJ4Lx3UQhAE834MQArGM0XYthsOAfug5nkOhDfP5HMvlEovfCywWCzyuH7E1txyN7Rbr9Rqr1QqbzYYJrz0HHKBQRrRB0zXepOs6mrbh1+OSAYeTjOqmRlVXqOtjbOqnMa1RsjzjbCzbws7a8Vg3LaxNF6rlYbNz4fgh4jjCPt0j2ScMKSVLkJBMUrJslL1SlAVPkiThSIgTiSTLINMUSZpin6bIixx0OGlO46tXppSJlBZNkVCWBaM4+z/Px/lpUbqhR9k2LI1C6ZN+uqHD2BqwHZuvT/PlasnaTKefPhMZPXlbYeVbIyGdSvaYbOIHPtuEYtPU6Pruoj0m0EFV18DZRyMh6WLuTAYVxbbHDIn0PJtLoNzLtoYe+SMhVY6yCwKfox8EsKyR0DAMNvo56eH4m65ctDVU4WIg25RVyd1AFogigTgWECLgcRSFKMscw+FfAagYjL4bCzMMaPoWSV1wtgqZ2PU8hGEANwhh+wJuKOC4LkfbDxkkA2nsOA6PJ99SEelmeZaNtqmqEpqmQtc1rPUtlqoBfefAME2sHQnVDmBYDjRNg6qpzxxBoDnpT9JxL9dtBz+MIGV8BFWrZ4Gp7cCt1z/pdslCz4xddEBUDCjysa3oJCoEdc705SGNQxGylciXU0FY02ORpsIpeZGxNjvSyHPh+h5rQhrRAaebr9qma2BMtmmqClkssRcRcpmgSPaMRIiLlrlGuJPhSHivPeDm7g1ezG7xcnaLV7Nb3Ny9xesvn5isu/IhPSfFqDaUP76Fdz/u8fHXd3z4+Y3j+/lXfH6Y88Ju8t1/0PVj/Au+AKgr+PNwNgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"slack app public distribution\"\n        title=\"slack app public distribution\"\n        src=\"/static/a2df189ee20cf4901025a837efd14e06/5a190/slack-app-public-distribution.png\"\n        srcset=\"/static/a2df189ee20cf4901025a837efd14e06/772e8/slack-app-public-distribution.png 200w,\n/static/a2df189ee20cf4901025a837efd14e06/e17e5/slack-app-public-distribution.png 400w,\n/static/a2df189ee20cf4901025a837efd14e06/5a190/slack-app-public-distribution.png 800w,\n/static/a2df189ee20cf4901025a837efd14e06/ee455/slack-app-public-distribution.png 863w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 class=\"markdown-subtitle\" id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p class=\"markdown-para\">Congratulations on making it to the end of this series on building a Slack application with Rails! I hope you've found it helpful. Throughout this series, we've covered many aspects of Slack integration, from OAuth authentication to implementing slash commands and interactive modals using Block Kit. In this final installment, we explored how to display feedback collected during retrospective meetings, bringing our app to completion.</p>\n<p class=\"markdown-para\">There are many further enhancements that could be made. For example, to support public distribution and multiple teams, the Retrospective model could be associated to the Team model. Then all searches for an open retrospective would have to be scoped by <code>team_id</code>. It might also be nice to let users list the feedback they've submitted so far and allow them to edit it. For further exploration and reference, here are some useful resources:</p>\n<ul class=\"markdown-list-unordered\">\n<li class=\"markdown-list-item\"><a href=\"https://github.com/danielabar/retro-pulse\" class=\"markdown-link\">Retro Pulse GitHub Repository</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://github.com/slack-ruby/slack-ruby-client\" class=\"markdown-link\">Slack Ruby Client Gem</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://github.com/slack-ruby/slack-ruby-bot-server\" class=\"markdown-link\">Slack Ruby Bot Server Gem</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://github.com/slack-ruby/slack-ruby-bot-server-events\" class=\"markdown-link\">Slack Ruby Bot Server Events Gem</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://api.slack.com/authentication/oauth-v2\" class=\"markdown-link\">Slack OAuth Documentation</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://ngrok.com/\" class=\"markdown-link\">ngrok - Secure Tunnels to Localhost</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://api.slack.com/apps\" class=\"markdown-link\">Your Slack Apps</a> (requires login)</li>\n<li class=\"markdown-list-item\"><a href=\"https://github.com/collectiveidea/interactor\" class=\"markdown-link\">Interactor Gem</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://api.slack.com/surfaces/modals\" class=\"markdown-link\">Slack Modals Documentation</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://api.slack.com/reference/block-kit/blocks\" class=\"markdown-link\">Slack Block Kit Documentation</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://api.slack.com/messaging/interactivity\" class=\"markdown-link\">Slack Interactivity Documentation</a></li>\n<li class=\"markdown-list-item\"><a href=\"https://api.slack.com/methods\" class=\"markdown-link\">Slack API Methods</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtku {\n    text-decoration: underline;\n    text-underline-position: under;\n  }\n  .monokai .mtki { font-style: italic; }\n  .monokai .mtk3 { color: #75715E; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk5 { color: #A6E22E; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk4 { color: #AE81FF; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .mtk10 { color: #FD971F; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","timeToRead":18,"tableOfContents":"<ul>\n<li>\n<p><a href=\"#add-slash-command-in-slack\">Add Slash Command in Slack</a></p>\n</li>\n<li>\n<p><a href=\"#receive-slash-command-in-rails\">Receive Slash Command in Rails</a></p>\n</li>\n<li>\n<p><a href=\"#using-block-kit-to-format-the-response\">Using Block Kit to Format the Response</a></p>\n<ul>\n<li><a href=\"#section-and-divider\">Section and Divider</a></li>\n<li><a href=\"#contextual-information\">Contextual Information</a></li>\n<li><a href=\"#header\">Header</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#refactor\">Refactor</a></p>\n</li>\n<li>\n<p><a href=\"#debugging-blocks\">Debugging Blocks</a></p>\n</li>\n<li>\n<p><a href=\"#app-manifest\">App Manifest</a></p>\n</li>\n<li>\n<p><a href=\"#deployment\">Deployment</a></p>\n</li>\n<li>\n<p><a href=\"#conclusion\">Conclusion</a></p>\n</li>\n</ul>","frontmatter":{"title":"Build a Rails App with Slack Part 5: Slash Command With Block Kit Response","date":"05 Jul 2024","description":"Learn how to build a Slack application with Rails in this comprehensive multi-part series. Part 5 covers receiving a slash command and responding with a visually appealing block kit UI response.","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#787878","images":{"fallback":{"src":"/static/38405384151b8a6587006a01da0dac64/9de14/slack-feat-img-5-david-trinks-pt-MFjIy4Q0-unsplash.jpg","srcSet":"/static/38405384151b8a6587006a01da0dac64/acce8/slack-feat-img-5-david-trinks-pt-MFjIy4Q0-unsplash.jpg 225w,\n/static/38405384151b8a6587006a01da0dac64/c0787/slack-feat-img-5-david-trinks-pt-MFjIy4Q0-unsplash.jpg 450w,\n/static/38405384151b8a6587006a01da0dac64/9de14/slack-feat-img-5-david-trinks-pt-MFjIy4Q0-unsplash.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/38405384151b8a6587006a01da0dac64/a78ee/slack-feat-img-5-david-trinks-pt-MFjIy4Q0-unsplash.webp 225w,\n/static/38405384151b8a6587006a01da0dac64/b579a/slack-feat-img-5-david-trinks-pt-MFjIy4Q0-unsplash.webp 450w,\n/static/38405384151b8a6587006a01da0dac64/e8caa/slack-feat-img-5-david-trinks-pt-MFjIy4Q0-unsplash.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":514}}}},"fields":{"slug":"/blog/rails-slack-app-part5-slash-block-kit-response/"}},"relatedP":{"edges":[{"node":{"id":"a103f88f-4941-5f40-8adc-948b6eba5d2c","frontmatter":{"title":"A Tale of Rails, ChatGPT, and Scopes","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#88a8d8","images":{"fallback":{"src":"/static/6a7549b18238d8d5eea0e365c15f3c5f/26528/rails-scopes-chatgpt-elizabeth-gottwald-dnIWYrliZfU-unsplash.jpg","srcSet":"/static/6a7549b18238d8d5eea0e365c15f3c5f/26528/rails-scopes-chatgpt-elizabeth-gottwald-dnIWYrliZfU-unsplash.jpg 300w,\n/static/6a7549b18238d8d5eea0e365c15f3c5f/43429/rails-scopes-chatgpt-elizabeth-gottwald-dnIWYrliZfU-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/6a7549b18238d8d5eea0e365c15f3c5f/5d6c3/rails-scopes-chatgpt-elizabeth-gottwald-dnIWYrliZfU-unsplash.webp 300w,\n/static/6a7549b18238d8d5eea0e365c15f3c5f/68dbc/rails-scopes-chatgpt-elizabeth-gottwald-dnIWYrliZfU-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/a-tale-of-rails-chatgpt-and-scopes/"}}},{"node":{"id":"c92d7f13-ff75-5632-be8c-e9b5ff992ddc","frontmatter":{"title":"Rails Feature Test Solved by Regex","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#487898","images":{"fallback":{"src":"/static/4b2924a3726801417360b49f81f7747b/26528/rails-feature-test-regex-patrick-tomasso-QMDap1TAu0g-unsplash.jpg","srcSet":"/static/4b2924a3726801417360b49f81f7747b/26528/rails-feature-test-regex-patrick-tomasso-QMDap1TAu0g-unsplash.jpg 300w,\n/static/4b2924a3726801417360b49f81f7747b/43429/rails-feature-test-regex-patrick-tomasso-QMDap1TAu0g-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/4b2924a3726801417360b49f81f7747b/5d6c3/rails-feature-test-regex-patrick-tomasso-QMDap1TAu0g-unsplash.webp 300w,\n/static/4b2924a3726801417360b49f81f7747b/68dbc/rails-feature-test-regex-patrick-tomasso-QMDap1TAu0g-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/rails-feature-test-solved-regex/"}}},{"node":{"id":"334ba24b-01a2-58f3-9962-67e64296c56e","frontmatter":{"title":"Testing Faraday with RSpec","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#e8e8e8","images":{"fallback":{"src":"/static/69f6b56407e655dd690ba4b363161733/26528/faraday-alex-kondratiev-H9t723yPjYI-unsplash.jpg","srcSet":"/static/69f6b56407e655dd690ba4b363161733/26528/faraday-alex-kondratiev-H9t723yPjYI-unsplash.jpg 300w,\n/static/69f6b56407e655dd690ba4b363161733/43429/faraday-alex-kondratiev-H9t723yPjYI-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/69f6b56407e655dd690ba4b363161733/5d6c3/faraday-alex-kondratiev-H9t723yPjYI-unsplash.webp 300w,\n/static/69f6b56407e655dd690ba4b363161733/68dbc/faraday-alex-kondratiev-H9t723yPjYI-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/testing-faraday-with-rspec/"}}}]}},"pageContext":{"slug":"/blog/rails-slack-app-part5-slash-block-kit-response/","relatedPosts":["Testing Faraday with RSpec","A Tale of Rails, ChatGPT, and Scopes","Rails Feature Test Solved by Regex"]}},"staticQueryHashes":["163244226"],"slicesMap":{}}