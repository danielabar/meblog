{"componentChunkName":"component---src-templates-post-js","path":"/blog/roll-your-own-search-service-for-gatsby-part1/","result":{"data":{"markdownRemark":{"html":"<p class=\"markdown-para\">This is the first in a multi-part series of posts detailing how I built the search feature for this blog.</p>\n<p class=\"markdown-para\">This blog is built with <a href=\"https://www.gatsbyjs.com/\" class=\"markdown-link\">Gatsby</a>, which is a React and GraphQL powered static site generator. Gatsby also makes React available at run time to support dynamic content. This blog is primarily static with the posts being written in markdown files. A build step runs a GraphQL query to retrieve the markdown content and metadata (such as title, description, featured image, etc.) and converts this content to HTML templates which are built with React.</p>\n<p class=\"markdown-para\">After some time, as the number of posts on this site grew, I realized it would be useful to add a search feature. Search by definition is dynamic - there's no way to anticipate every possible search string users may type in and build a static pages for each possible set of search results. So this would have to be a dynamic feature.</p>\n<h2 class=\"markdown-subtitle\" id=\"existing-options\" style=\"position:relative;\"><a href=\"#existing-options\" aria-label=\"existing options permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Existing Options</h2>\n<p class=\"markdown-para\">I started my research by looking up the Gatsby docs on how to <a href=\"https://www.gatsbyjs.com/docs/how-to/adding-common-features/adding-search/\" class=\"markdown-link\">add search</a> to a static site. At the time of this writing, there were three options available. After some analysis, I decided none of them were optimal. Briefly, here are the options and my concerns:</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"1-client-side-search\" style=\"position:relative;\"><a href=\"#1-client-side-search\" aria-label=\"1 client side search permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Client-side search</h3>\n<p class=\"markdown-para\">With this approach, a gatsby plugin is used that generates a search index that must be shipped as part of the Gatsby static site. Then some client side components are added to search this index at run time. My main concern with this approach is the increase in the bundle size delivered to each user, whether they want to use search or not. Many users may land on one of these posts from a web search, just quickly want to read that specific article and never execute any in-blog searches. It doesn't make sense to slow down the loading time and force extra data on all users. And even if some users do end up executing a search, it will most likely be for just a small fraction of the entire site index, so it still doesn't make sense that their browser needs to download the entire search index.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"2-server-api---algolia\" style=\"position:relative;\"><a href=\"#2-server-api---algolia\" aria-label=\"2 server api   algolia permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Server API - Algolia</h3>\n<p class=\"markdown-para\">Algolia is a commercial search service (i.e. paid, although there may be a limited use free tier). In this case Algolia will host the search index and provide the search API. The Gatsby site makes search requests to the Algolia server, retrieves results, then renders them in client side components. My concern with this approach was additional costs, and additional dependency on another company.</p>\n<h3 class=\"markdown-sub-subtitle\" id=\"3-server-api---elasticsearchsolr\" style=\"position:relative;\"><a href=\"#3-server-api---elasticsearchsolr\" aria-label=\"3 server api   elasticsearchsolr permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Server API - ElasticSearch/Solr</h3>\n<p class=\"markdown-para\">A similar idea to Algolia, except ElasticSearch and Solr are available either as commercial (i.e. paid) services, or, since they're open source, can be self hosted on any cloud provider such as AWS, DigitalOcean etc. On the commercial side, my concern was the same as Algolia. On the open source side, my concern was the additional time commitment of standing up a server, installing the software, and securing/maintaining it.</p>\n<h2 class=\"markdown-subtitle\" id=\"decision\" style=\"position:relative;\"><a href=\"#decision\" aria-label=\"decision permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Decision</h2>\n<p class=\"markdown-para\">After giving this some more thought, had a breakthrough idea. I already run a Rails server for some custom analytics on this blog. It uses a PostgreSQL database and is hosted on Heroku.</p>\n<p class=\"markdown-para\">PostgreSQL has a <a href=\"https://www.postgresql.org/docs/13/textsearch.html\" class=\"markdown-link\">Full Text Search</a> feature. There's also a <a href=\"https://github.com/Casecommons/pg_search\" class=\"markdown-link\">pg_search</a> gem that makes it relatively easy to integrate the database full text search feature with Rails. The developers of this gem have also written a fantastic <a href=\"https://pganalyze.com/blog/full-text-search-ruby-rails-postgres\" class=\"markdown-link\">blog post</a> explaining the basics of PostgreSQL full text search and how to use the gem in a Rails project.</p>\n<p class=\"markdown-para\">This seemed like a reasonable approach as I'm already paying for a basic Heroku plan, and determined that would suffice for adding search. This would mean no additional costs, and not adding yet another company to depend on. Why the concern about depending on multiple companies? I've been burned by this in the past if the company changes their terms, increases prices, or goes out of business.</p>\n<p class=\"markdown-para\">But even after deciding to go with PostgreSQL full text search, Rails, and the <code>pg-search</code> gem, there were still more problems to solve. Such as generating the search index from the blog markdown content, building out a search API, and building the client side search components. These will all be explained in follow-up posts.</p>\n<h2 class=\"markdown-subtitle\" id=\"whats-next\" style=\"position:relative;\"><a href=\"#whats-next\" aria-label=\"whats next permalink\" class=\"markdown-header-link before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What's Next?</h2>\n<p class=\"markdown-para\">Next up, see <a href=\"../roll-your-own-search-service-for-gatsby-part2\" class=\"markdown-link\">Part 2: Search Index</a> for how to design and populate a table to contain all the content to be searched.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n</style>","timeToRead":3,"tableOfContents":"<ul>\n<li>\n<p><a href=\"#existing-options\">Existing Options</a></p>\n<ul>\n<li><a href=\"#1-client-side-search\">1. Client-side search</a></li>\n<li><a href=\"#2-server-api---algolia\">2. Server API - Algolia</a></li>\n<li><a href=\"#3-server-api---elasticsearchsolr\">3. Server API - ElasticSearch/Solr</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#decision\">Decision</a></p>\n</li>\n<li>\n<p><a href=\"#whats-next\">What's Next?</a></p>\n</li>\n</ul>","frontmatter":{"title":"Roll Your Own Search with Rails and Postgres: Introduction","date":"03 Jul 2021","description":"Learn how to build search service using Rails and Postgres Full Text Search for a Gatsby blog.","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#d8d8d8","images":{"fallback":{"src":"/static/aa21960e30b753912caf858cbcce675b/fc2d4/roll-your-own-luigi-pozzoli-iIS1SIO5_aY-unsplash.jpg","srcSet":"/static/aa21960e30b753912caf858cbcce675b/b834a/roll-your-own-luigi-pozzoli-iIS1SIO5_aY-unsplash.jpg 225w,\n/static/aa21960e30b753912caf858cbcce675b/21c52/roll-your-own-luigi-pozzoli-iIS1SIO5_aY-unsplash.jpg 450w,\n/static/aa21960e30b753912caf858cbcce675b/fc2d4/roll-your-own-luigi-pozzoli-iIS1SIO5_aY-unsplash.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/aa21960e30b753912caf858cbcce675b/71a10/roll-your-own-luigi-pozzoli-iIS1SIO5_aY-unsplash.webp 225w,\n/static/aa21960e30b753912caf858cbcce675b/901f1/roll-your-own-luigi-pozzoli-iIS1SIO5_aY-unsplash.webp 450w,\n/static/aa21960e30b753912caf858cbcce675b/4ffff/roll-your-own-luigi-pozzoli-iIS1SIO5_aY-unsplash.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":600}}}},"fields":{"slug":"/blog/roll-your-own-search-service-for-gatsby-part1/"}},"relatedP":{"edges":[{"node":{"id":"848d2c81-d508-5776-ac83-fb1e50ef5848","frontmatter":{"title":"Fix Rails Blocked Host Error with Docker","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/648daf1a5b7bca42ff3729828586b2dc/26528/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.jpg","srcSet":"/static/648daf1a5b7bca42ff3729828586b2dc/26528/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.jpg 300w,\n/static/648daf1a5b7bca42ff3729828586b2dc/43429/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/648daf1a5b7bca42ff3729828586b2dc/5d6c3/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.webp 300w,\n/static/648daf1a5b7bca42ff3729828586b2dc/68dbc/blocked-host-fix-markus-spiske-KTuHfak_EEk-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/rails-blocked-host-docker-fix/"}}},{"node":{"id":"0c2e1691-4b14-536c-acee-4d0f120de743","frontmatter":{"title":"Rails Strong Params for GET Request","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/30de304c73a206886f15aeaf89655663/26528/strong-params-sigmund-f0dJjQMhfXo-unsplash.jpg","srcSet":"/static/30de304c73a206886f15aeaf89655663/26528/strong-params-sigmund-f0dJjQMhfXo-unsplash.jpg 300w,\n/static/30de304c73a206886f15aeaf89655663/43429/strong-params-sigmund-f0dJjQMhfXo-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/30de304c73a206886f15aeaf89655663/5d6c3/strong-params-sigmund-f0dJjQMhfXo-unsplash.webp 300w,\n/static/30de304c73a206886f15aeaf89655663/68dbc/strong-params-sigmund-f0dJjQMhfXo-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/rails-strong-params-get/"}}},{"node":{"id":"334ba24b-01a2-58f3-9962-67e64296c56e","frontmatter":{"title":"Testing Faraday with RSpec","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#e8e8e8","images":{"fallback":{"src":"/static/69f6b56407e655dd690ba4b363161733/26528/faraday-alex-kondratiev-H9t723yPjYI-unsplash.jpg","srcSet":"/static/69f6b56407e655dd690ba4b363161733/26528/faraday-alex-kondratiev-H9t723yPjYI-unsplash.jpg 300w,\n/static/69f6b56407e655dd690ba4b363161733/43429/faraday-alex-kondratiev-H9t723yPjYI-unsplash.jpg 600w","sizes":"300px"},"sources":[{"srcSet":"/static/69f6b56407e655dd690ba4b363161733/5d6c3/faraday-alex-kondratiev-H9t723yPjYI-unsplash.webp 300w,\n/static/69f6b56407e655dd690ba4b363161733/68dbc/faraday-alex-kondratiev-H9t723yPjYI-unsplash.webp 600w","type":"image/webp","sizes":"300px"}]},"width":300,"height":170}}}},"fields":{"slug":"/blog/testing-faraday-with-rspec/"}}}]}},"pageContext":{"slug":"/blog/roll-your-own-search-service-for-gatsby-part1/","relatedPosts":["Rails Strong Params for GET Request","Testing Faraday with RSpec","Fix Rails Blocked Host Error with Docker"]}},"staticQueryHashes":["163244226"],"slicesMap":{}}