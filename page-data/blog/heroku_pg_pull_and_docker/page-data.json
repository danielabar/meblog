{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/heroku_pg_pull_and_docker/",
    "result": {"data":{"markdownRemark":{"html":"<p class=\"markdown-para\"><strong class=\"markdown-strong\">TLDR:</strong> Use <code>PG_HOST=127.0.0.1</code> when running Heroku's <code>pg:pull</code> to a local target database that is running in a Docker container. For a more detailed explanation, read on...</p>\n<p class=\"markdown-para\">I recently starting using <a href=\"https://www.heroku.com/\" class=\"markdown-link\">Heroku</a> to deploy a side project built with Rails and Postgres. Heroku is a PaaS (Platform as a Service) that makes it really easy to deploy web applications, and other related services such as a database. Since I'm not currently monetizing my side project, I selected the free tier, together with the Hobby Dev package for the database, which provides a limited amount of storage.</p>\n<p class=\"markdown-para\">One thing you might like to do once there's some significant amount of production data in the database, is to make a copy of it to import into a locally running database. For local development you'd usually be using fake or test data (i.e. seeds in Rails). However, it can sometimes be useful to develop against real data. For example, when working on a data visualization app, having real data can help to determine if the data viz is providing any insight.</p>\n<p class=\"markdown-para\">Heroku provides a convenient <code>pg:pull</code> command to pull data from a production database on Heroku to a locally running database. It's run from a terminal (given that you've already authenticated via <code>heroku login</code>). The basic structure of the command is:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">heroku pg:pull your-heroku-db-name target-local-db-name --app your-heroku-app-name</span></span></span></code></pre>\n<p class=\"markdown-para\">Note that this command requires a postgres client to be installed locally, the easiest way on a Mac is via Homebrew: <code>brew update &#x26;&#x26; brew cleanup &#x26;&#x26; brew install postgresql</code> (actually installs both client and server but only client portion is needed).</p>\n<p class=\"markdown-para\">The value of <code>your-heroku-app-name</code> is found on your Heroku dashboard, for example <code>mystic-wind-83</code>. The value of <code>your-heroku-db-name</code> can also be found from the Heroku dashboard by clicking on the app, the database name will be listed in the \"Installed add-ons\" section, for example <code>postgresql-sushi-123</code>. Finally, <code>target-local-db-name</code> is the name of a new database that will be created on your local Postgres, for example <code>my_prod_copy</code>. You can name this any valid database name but it must not already exist on your system. Putting this all together, the command would look like:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">heroku pg:pull postgresql-sushi-123 my_prod_copy --app mystic-wind-83</span></span></span></code></pre>\n<p class=\"markdown-para\">However, since I'm running Postgres in a Docker container for my app, the <code>pg:pull</code> command returned the following error message:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">heroku-cli: Pulling postgresql-sushi-123 ---&gt; my_prod_copy</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">createdb: error: could not connect to database template1: could not connect to server: No such file or directory</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\tIs the server running locally and accepting</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\">\tconnections on Unix domain socket &quot;/tmp/.s.PGSQL.5432&quot;?</span></span></code></pre>\n<p class=\"markdown-para\">According to the Heroku <a href=\"https://devcenter.heroku.com/articles/heroku-postgresql#pg-push-and-pg-pull\" class=\"markdown-link\">docs</a>, this error can result from not having the Postgres binaries in the <code>$PATH</code> because <code>pg:pull</code> is essentially a wrapper around <code>pg_dump</code>. But this was not the root cause of this error in my case as <code>pg_dump</code> was indeed in the PATH. This can be verified as follows:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk9\">type</span><span class=\"mtk1\"> pg_dump</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">pg_dump is /usr/local/bin/pg_dump</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">&gt;</span><span class=\"mtk1\"> </span><span class=\"mtk9\">echo</span><span class=\"mtk1\"> $PATH</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">...:/usr/local/bin:...</span></span></span></code></pre>\n<p class=\"markdown-para\">When running Postgres in a Docker container, the <code>PG_HOST</code> environment variable must be specified to tell Heroku where the running Postgres instance is (otherwise it's assuming localhost). For Docker, the value is <code>127.0.0.1</code>. Also, if you've specified a Postgres root user and password, those must also be specified as environment variables for the <code>pg:pull</code> command.</p>\n<p class=\"markdown-para\">For example, my Postgres container is started via <code>docker-compose up</code> using the following <code>docker-compose.yml</code> file:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"yml\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">version</span><span class=\"mtk1\">: </span><span class=\"mtk6\">&quot;3.8&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">services</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">database</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">image</span><span class=\"mtk1\">: </span><span class=\"mtk6\">postgres:13</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">db_data:/var/lib/postgresql/data</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">./init.sql:/docker-entrypoint-initdb.d/init.sql</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">ports</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      - </span><span class=\"mtk6\">&quot;5432:5432&quot;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">environment</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">POSTGRES_PASSWORD</span><span class=\"mtk1\">: </span><span class=\"mtk6\">somethingSomething</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">POSTGRES_USER</span><span class=\"mtk1\">: </span><span class=\"mtk6\">postgres</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">volumes</span><span class=\"mtk1\">:</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">db_data</span><span class=\"mtk1\">:</span></span></span></code></pre>\n<p class=\"markdown-para\">So the final working command for Heroku to pull the production database to a local copy when using Docker is:</p>\n<pre class=\"grvsc-container gatsby-highlight monokai\" data-language=\"bash\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">PGUSER=postgres PGPASSWORD=somethingSomething PGHOST=127.0.0.1 heroku pg:pull postgresql-sushi-123 my_prod_copy --app mystic-wind-83</span></span></span></code></pre>\n<p class=\"markdown-para\">Now you can connect to your newly created local database <code>my_prod_copy</code>. Note that the <code>pg:pull</code> command will not copy the production user/role, so you'll have to connect with your <code>POSTGRES_USER/POSTGRES_PASSWORD</code> credentials.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .monokai {\n    background-color: #272822;\n    color: #f8f8f2;\n  }\n  .monokai .mtk1 { color: #F8F8F2; }\n  .monokai .mtk7 { color: #F92672; }\n  .monokai .mtk9 { color: #66D9EF; }\n  .monokai .mtk6 { color: #E6DB74; }\n  .monokai .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"title":"Using Heroku's pg:pull with Docker","date":"01 Apr 2021","description":"Learn how to use Heroku's pg:pull command to get a copy of your production data when running Postgres locally in a Docker container.","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8e8d8","images":{"fallback":{"src":"/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/b6f31/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.jpg","srcSet":"/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/21c81/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.jpg 200w,\n/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/dcbfe/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.jpg 400w,\n/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/b6f31/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.jpg 800w","sizes":"(min-width: 800px) 800px, 100vw"},"sources":[{"srcSet":"/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/ae9d9/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.webp 200w,\n/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/58d60/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.webp 400w,\n/static/9ce87e400f8dc9c374f9c9bc7d9a7aa0/62614/pull-rebecca-campbell-81UDWsR6Ehw-unsplash.webp 800w","type":"image/webp","sizes":"(min-width: 800px) 800px, 100vw"}]},"width":800,"height":507}}}},"fields":{"slug":"/blog/heroku_pg_pull_and_docker/"}},"relatedP":{"edges":[{"node":{"id":"46775b70-43f2-584d-8c65-327ac46ebbd7","frontmatter":{"title":"Dockerize a Rails Application for Development","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#d8c8d8","images":{"fallback":{"src":"/static/3281f20a27a3ba24dcc1ca78c639c25d/b0ca9/docker-rails-shipping-containers.jpg","srcSet":"/static/3281f20a27a3ba24dcc1ca78c639c25d/b0ca9/docker-rails-shipping-containers.jpg 270w,\n/static/3281f20a27a3ba24dcc1ca78c639c25d/93b6a/docker-rails-shipping-containers.jpg 540w","sizes":"270px"},"sources":[{"srcSet":"/static/3281f20a27a3ba24dcc1ca78c639c25d/60751/docker-rails-shipping-containers.webp 270w,\n/static/3281f20a27a3ba24dcc1ca78c639c25d/2f2dc/docker-rails-shipping-containers.webp 540w","type":"image/webp","sizes":"270px"}]},"width":270,"height":150}}}},"fields":{"slug":"/blog/dockerize-rails-app-for-dev-debug-and-testing/"}}},{"node":{"id":"d300ca38-a569-5f95-b2a5-0bf6c30486cc","frontmatter":{"title":"Use UUID for primary key with Rails and Postgres","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/30bb7a61cc87a3edc43f8af6d89fa013/b0ca9/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.jpg","srcSet":"/static/30bb7a61cc87a3edc43f8af6d89fa013/b0ca9/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.jpg 270w,\n/static/30bb7a61cc87a3edc43f8af6d89fa013/93b6a/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.jpg 540w","sizes":"270px"},"sources":[{"srcSet":"/static/30bb7a61cc87a3edc43f8af6d89fa013/60751/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.webp 270w,\n/static/30bb7a61cc87a3edc43f8af6d89fa013/2f2dc/primary-keyflorian-berger-SzG0ncGBOeo-unsplash.webp 540w","type":"image/webp","sizes":"270px"}]},"width":270,"height":150}}}},"fields":{"slug":"/blog/rails-uuid-primary-key-postgres/"}}},{"node":{"id":"bb0af7b8-9d5f-597f-90cb-a4da75c3c9a9","frontmatter":{"title":"Roll Your Own Search with Rails and Postgres: Search Engine","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#181818","images":{"fallback":{"src":"/static/86310660995a38a9254ece85739c237f/b0ca9/roll-search-3.jpg","srcSet":"/static/86310660995a38a9254ece85739c237f/b0ca9/roll-search-3.jpg 270w,\n/static/86310660995a38a9254ece85739c237f/93b6a/roll-search-3.jpg 540w","sizes":"270px"},"sources":[{"srcSet":"/static/86310660995a38a9254ece85739c237f/60751/roll-search-3.webp 270w,\n/static/86310660995a38a9254ece85739c237f/2f2dc/roll-search-3.webp 540w","type":"image/webp","sizes":"270px"}]},"width":270,"height":150}}}},"fields":{"slug":"/blog/roll-your-own-search-service-for-gatsby-part3/"}}}]}},"pageContext":{"slug":"/blog/heroku_pg_pull_and_docker/","relatedPosts":["Roll Your Own Search with Rails and Postgres: Search Engine","Use UUID for primary key with Rails and Postgres","Dockerize a Rails Application for Development"]}},
    "staticQueryHashes": ["163244226"]}